/*! For license information please see 5330.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([[5330],{74444:(e,t,n)=>{"use strict";n.d(t,{BH:()=>b,DV:()=>V,GJ:()=>O,L:()=>u,LL:()=>A,P0:()=>_,Sg:()=>y,UG:()=>x,UI:()=>U,US:()=>c,Wl:()=>P,Yr:()=>S,ZR:()=>R,aH:()=>v,b$:()=>E,cI:()=>N,dS:()=>K,eu:()=>C,g5:()=>o,gK:()=>$,gQ:()=>z,h$:()=>h,hl:()=>T,hu:()=>i,m9:()=>W,p$:()=>m,r3:()=>L,uI:()=>k,ug:()=>G,vZ:()=>j,w9:()=>D,xO:()=>H,xb:()=>F,zI:()=>I});var s=n(34155);const r={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},i=function(e,t){if(!e)throw o(t)},o=function(e){return new Error("Firebase Database ("+r.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},a=function(e){const t=[];let n=0;for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&s+1<e.length&&56320==(64512&e.charCodeAt(s+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++s)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let t=0;t<e.length;t+=3){const r=e[t],i=t+1<e.length,o=i?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=r>>2,h=(3&r)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(u=64)),s.push(n[l],n[h],n[u],n[d])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(a(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,s=0;for(;n<e.length;){const r=e[n++];if(r<128)t[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=e[n++];t[s++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&r<365){const i=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[s++]=String.fromCharCode(55296+(i>>10)),t[s++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[s++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let t=0;t<e.length;){const r=n[e.charAt(t++)],i=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==i||null==o||null==a)throw new l;const c=r<<2|i>>4;if(s.push(c),64!==o){const e=i<<4&240|o>>2;if(s.push(e),64!==a){const e=o<<6&192|a;s.push(e)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const h=function(e){const t=a(e);return c.encodeByteArray(t,!0)},u=function(e){return h(e).replace(/\./g,"")},d=function(e){try{return c.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function m(e){return p(void 0,e)}function p(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=p(e[n],t[n]));return e}const f=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,g=()=>{try{return f()||(()=>{if(void 0===s||void 0===s.env)return;const e=s.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&d(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},_=e=>{const t=(e=>{var t,n;return null===(n=null===(t=g())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const s=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),s]:[t.substring(0,n),s]},v=()=>{var e;return null===(e=g())||void 0===e?void 0:e.config};class b{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function y(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",s=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[u(JSON.stringify({alg:"none",type:"JWT"})),u(JSON.stringify(i)),""].join(".")}function w(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function k(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(w())}function x(){var e;const t=null===(e=g())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function E(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function S(){return!0===r.NODE_CLIENT||!0===r.NODE_ADMIN}function T(){try{return"object"==typeof indexedDB}catch(e){return!1}}function C(){return new Promise(((e,t)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}function I(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class R extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,R.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,A.prototype.create)}}class A{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},s=`${this.service}/${e}`,r=this.errors[e],i=r?function(e,t){return e.replace(M,((e,n)=>{const s=t[n];return null!=s?String(s):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${i} (${s}).`;return new R(s,o,n)}}const M=/\{\$([^}]+)}/g;function N(e){return JSON.parse(e)}function P(e){return JSON.stringify(e)}const B=function(e){let t={},n={},s={},r="";try{const i=e.split(".");t=N(d(i[0])||""),n=N(d(i[1])||""),r=i[2],s=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:s,signature:r}},D=function(e){const t=B(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},O=function(e){const t=B(e).claims;return"object"==typeof t&&!0===t.admin};function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function V(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function F(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function U(e,t,n){const s={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=t.call(n,e[r],r,e));return s}function j(e,t){if(e===t)return!0;const n=Object.keys(e),s=Object.keys(t);for(const r of n){if(!s.includes(r))return!1;const n=e[r],i=t[r];if(q(n)&&q(i)){if(!j(n,i))return!1}else if(n!==i)return!1}for(const e of s)if(!n.includes(e))return!1;return!0}function q(e){return null!==e&&"object"==typeof e}function H(e){const t=[];for(const[n,s]of Object.entries(e))Array.isArray(s)?s.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}class z{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let s=0;s<16;s++)n[s]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let s=0;s<16;s++)n[s]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let s,r,i=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(s=c^o&(a^c),r=1518500249):(s=o^a^c,r=1859775393):e<60?(s=o&a|c&(o|a),r=2400959708):(s=o^a^c,r=3395469782);const t=(i<<5|i>>>27)+s+l+r+n[e]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=i,i=t}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let s=0;const r=this.buf_;let i=this.inbuf_;for(;s<t;){if(0===i)for(;s<=n;)this.compress_(e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i]=e.charCodeAt(s),++i,++s,i===this.blockSize){this.compress_(r),i=0;break}}else for(;s<t;)if(r[i]=e[s],++i,++s,i===this.blockSize){this.compress_(r),i=0;break}}this.inbuf_=i,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let s=24;s>=0;s-=8)e[n]=this.chain_[t]>>s&255,++n;return e}}function $(e,t){return`${e} failed: ${t} argument `}const K=function(e){const t=[];let n=0;for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);if(r>=55296&&r<=56319){const t=r-55296;s++,i(s<e.length,"Surrogate pair missing trail surrogate.");r=65536+(t<<10)+(e.charCodeAt(s)-56320)}r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):r<65536?(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},G=function(e){let t=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);s<128?t++:s<2048?t+=2:s>=55296&&s<=56319?(t+=4,n++):t+=3}return t};function W(e){return e&&e._delegate?e._delegate:e}},30692:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var s=n(23645),r=n.n(s)()((function(e){return e[1]}));r.push([e.id,".app-container{font-family:Quicksand,sans-serif;padding:20px 30px 30px}.app-mobile{padding:0}.app-mobile.app-mobile-dark{background:#131415}.app-mobile .user-logged{margin:10px 5px 0 10px}.app-mobile select{margin:10px 0}.app-mobile .button-theme{margin:10px 10px 0 0}.app-mobile .button-theme .button-github,.app-mobile .button-theme .button-github img{height:23px}.user-logged{font-size:12px;margin-right:5px;margin-top:10px}.user-logged.user-logged-dark{color:#fff}select{background:#fff;border:1px solid #e0e2e4;border-radius:4px;height:20px;margin-bottom:20px;outline:none}.button-theme{align-items:center;display:flex;float:right}.button-theme .button-light{background:#fff;border:1px solid #46484e;color:#46484e}.button-theme .button-dark{background:#1c1d21;border:1px solid #1c1d21}.button-theme button{border:none;border-radius:4px;color:#fff;cursor:pointer;font-size:14px;margin-left:10px;outline:none;padding:6px 12px;transition:.3s;vertical-align:middle}.button-theme button.button-github{background:none;height:30px;margin-left:20px;padding:0}.button-theme button.button-github img{height:30px}.button-theme button:hover{opacity:.8}.button-theme button:active{opacity:.6}@media only screen and (max-width:768px){.button-theme button{font-size:13px;padding:3px 6px}}.version-container{color:grey;font-size:14px;padding-top:20px;text-align:right}",""]);const i=r},84937:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var s=n(23645),r=n.n(s)()((function(e){return e[1]}));r.push([e.id,".window-container[data-v-26fe4b0c]{width:100%}.window-mobile form[data-v-26fe4b0c]{padding:0 10px 10px}form[data-v-26fe4b0c]{padding-bottom:20px}input[data-v-26fe4b0c]{border:1px solid #d2d6da;border-radius:4px;font-size:14px;height:21px;outline:none;padding:5px;vertical-align:middle;width:140px}input[data-v-26fe4b0c]::-moz-placeholder{color:#9ca6af}input[data-v-26fe4b0c]::placeholder{color:#9ca6af}button[data-v-26fe4b0c]{background:#1976d2;border:none;border-radius:4px;color:#fff;cursor:pointer;font-size:14px;margin-left:10px;outline:none;padding:8px 12px;transition:.3s;vertical-align:middle}button[data-v-26fe4b0c]:hover{opacity:.8}button[data-v-26fe4b0c]:active{opacity:.6}button[data-v-26fe4b0c]:disabled{background:#c6c9cc;cursor:auto;opacity:.6}.button-cancel[data-v-26fe4b0c]{background:none;color:#a8aeb3;margin-left:5px}select[data-v-26fe4b0c]{font-size:13px;height:33px;margin:0!important;vertical-align:middle;width:152px}",""]);const i=r},62921:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var s=n(23645),r=n.n(s)()((function(e){return e[1]}));r.push([e.id,'.vac-fade-spinner-enter{opacity:0}.vac-fade-spinner-enter-active{transition:opacity .8s}.vac-fade-spinner-leave-active{opacity:0;transition:opacity .2s}.vac-fade-image-enter{opacity:0}.vac-fade-image-enter-active{transition:opacity 1s}.vac-fade-image-leave-active{opacity:0;transition:opacity .5s}.vac-fade-message-enter{opacity:0}.vac-fade-message-enter-active{transition:opacity .5s}.vac-fade-message-leave-active{opacity:0;transition:opacity .2s}.vac-slide-left-enter-active,.vac-slide-right-enter-active{transition:all .3s ease;transition-property:transform,opacity}.vac-slide-left-leave-active,.vac-slide-right-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)!important;transition-property:transform,opacity}.vac-slide-left-enter,.vac-slide-left-leave-to{opacity:0;transform:translateX(10px)}.vac-slide-right-enter,.vac-slide-right-leave-to{opacity:0;transform:translateX(-10px)}.vac-slide-up-enter-active{transition:all .3s ease}.vac-slide-up-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)}.vac-slide-up-enter,.vac-slide-up-leave-to{opacity:0;transform:translateY(10px)}.vac-bounce-enter-active{animation:vac-bounce-in .5s}.vac-bounce-leave-active{animation:vac-bounce-in .3s reverse}@keyframes vac-bounce-in{0%{transform:scale(0)}50%{transform:scale(1.05)}to{transform:scale(1)}}.vac-fade-preview-enter{opacity:0}.vac-fade-preview-enter-active{transition:opacity .1s}.vac-fade-preview-leave-active{opacity:0;transition:opacity .2s}.vac-bounce-preview-enter-active{animation:vac-bounce-image-in .4s}.vac-bounce-preview-leave-active{animation:vac-bounce-image-in .3s reverse}@keyframes vac-bounce-image-in{0%{transform:scale(.6)}to{transform:scale(1)}}.vac-menu-list{background:var(--chat-dropdown-bg-color);border-radius:4px;cursor:pointer;display:block;padding:6px 0}.vac-menu-list :hover{background:var(--chat-dropdown-bg-color-hover)}.vac-menu-list :hover,.vac-menu-list :not(:hover){transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-item{align-items:center;display:flex;flex:1 1 100%;line-height:30px;min-height:30px;padding:5px 16px;position:relative;white-space:nowrap}.vac-menu-options{border-radius:4px;box-shadow:0 2px 2px -4px rgba(0,0,0,.1),0 2px 2px 1px rgba(0,0,0,.12),0 1px 8px 1px rgba(0,0,0,.12);color:var(--chat-color);contain:content;display:inline-block;font-size:14px;min-width:150px;overflow-x:hidden;overflow-y:auto;position:absolute;right:10px;top:20px;z-index:9999}.vac-app-border{border:var(--chat-border-style)}.vac-app-border-t{border-top:var(--chat-border-style)}.vac-app-border-r{border-right:var(--chat-border-style)}.vac-app-border-b{border-bottom:var(--chat-border-style)}.vac-app-box-shadow{box-shadow:0 2px 2px -4px rgba(0,0,0,.1),0 2px 2px 1px rgba(0,0,0,.12),0 1px 8px 1px rgba(0,0,0,.12);transition:all .5s}.vac-item-clickable{cursor:pointer}.vac-vertical-center{align-items:center;display:flex;height:100%}.vac-vertical-center .vac-vertical-container{text-align:center;width:100%}.vac-svg-button{cursor:pointer;display:flex;max-height:30px;transition:all .2s}.vac-svg-button:hover{opacity:.7;transform:scale(1.1)}.vac-avatar{background-color:#ddd;background-position:50%;background-repeat:no-repeat;background-size:cover;border-radius:50%;height:42px;margin-right:15px;min-height:42px;min-width:42px;width:42px}.vac-blur-loading{filter:blur(3px)}.vac-badge-counter{align-items:center;border-radius:50%;display:flex;font-size:11px;font-weight:500;height:13px;justify-content:center;min-width:13px;padding:3px;width:auto}.vac-text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%}.vac-text-bold{font-weight:700}.vac-text-italic{font-style:italic}.vac-text-strike{text-decoration:line-through}.vac-text-underline{text-decoration:underline}.vac-text-inline-code{color:var(--chat-markdown-color);display:inline-block;margin:2px 0;padding:2px 3px}.vac-text-inline-code,.vac-text-multiline-code{background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;font-size:12px}.vac-text-multiline-code{color:var(--chat-markdown-color-multi);display:block;margin:4px 0;padding:7px}.vac-text-tag{color:var(--chat-message-color-tag);cursor:pointer}.vac-file-container{align-content:center;background:var(--chat-bg-color-input);border:var(--chat-border-style-input);border-radius:4px;display:flex;flex-wrap:wrap;justify-content:center;padding:10px;text-align:center}.vac-file-container svg{height:28px;width:28px}.vac-file-container .vac-text-extension{color:var(--chat-message-color-file-extension);font-size:12px;margin-top:-2px}.vac-card-window{-webkit-tap-highlight-color:transparent;background:var(--chat-content-bg-color);border:var(--chat-container-border);border-radius:var(--chat-container-border-radius);box-shadow:var(--chat-container-box-shadow);color:var(--chat-color);display:block;max-width:100%;overflow-wrap:break-word;white-space:normal;width:100%}.vac-card-window *{font-family:inherit}.vac-card-window a{color:#0d579c;font-weight:500}.vac-card-window .vac-chat-container{display:flex;height:100%}.vac-card-window .vac-chat-container input{min-width:10px}.vac-card-window .vac-chat-container input[type=search],.vac-card-window .vac-chat-container input[type=text],.vac-card-window .vac-chat-container textarea{-webkit-appearance:none}.vac-media-preview{align-items:center;background-color:rgba(0,0,0,.8);display:flex;height:100vh;left:0;outline:none;position:absolute;top:0;width:100vw;z-index:99}.vac-media-preview .vac-media-preview-container{height:calc(100% - 140px);margin:0 auto;padding:70px 40px;width:calc(100% - 80px)}.vac-media-preview .vac-image-preview{background-position:50%;background-repeat:no-repeat;background-size:contain;height:100%;width:100%}.vac-media-preview .vac-svg-button{position:absolute;right:30px;top:30px;transform:scale(1.4)}@media only screen and (max-width:768px){.vac-media-preview .vac-svg-button{right:20px;top:20px;transform:scale(1.2)}.vac-media-preview .vac-media-preview-container{padding:70px 20px;width:calc(100% - 40px)}}.vac-col-messages{display:flex;flex:1;flex-flow:column;height:100%;overflow:hidden;position:relative}.vac-col-messages .vac-container-center{align-items:center;display:flex;flex-direction:column;height:100%;justify-content:center;text-align:center;width:100%}.vac-col-messages .vac-room-empty{color:#9ca6af;font-size:14px;font-style:italic;line-height:20px;white-space:pre-line}.vac-col-messages .vac-room-empty div{padding:0 10%}.vac-col-messages .vac-container-scroll{-webkit-overflow-scrolling:touch;background:var(--chat-content-bg-color);flex:1;margin-right:1px;margin-top:60px;overflow-y:auto}.vac-col-messages .vac-container-scroll.vac-scroll-smooth{scroll-behavior:smooth}.vac-col-messages .vac-messages-container{padding:0 5px 5px}.vac-col-messages .vac-text-started{color:var(--chat-message-color-started);font-size:14px;font-style:italic;margin-bottom:20px;margin-top:30px;text-align:center}.vac-col-messages .vac-icon-scroll{background:var(--chat-bg-scroll-icon);border-radius:50%;bottom:80px;box-shadow:0 1px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 2px 0 rgba(0,0,0,.12);cursor:pointer;display:flex;padding:8px;position:absolute;right:20px;z-index:10}.vac-col-messages .vac-icon-scroll svg{height:25px;width:25px}.vac-col-messages .vac-messages-count{background-color:var(--chat-message-bg-color-scroll-counter);color:var(--chat-message-color-scroll-counter);left:11px;position:absolute;top:-8px}.vac-col-messages .vac-messages-hidden{opacity:0}@media only screen and (max-width:768px){.vac-col-messages .vac-container-scroll{margin-top:50px}.vac-col-messages .vac-text-started{margin-top:20px}.vac-col-messages .vac-icon-scroll{bottom:70px}}.vac-room-header{align-items:center;background:var(--chat-header-bg-color);border-top-right-radius:var(--chat-container-border-radius);display:flex;height:64px;margin-right:1px;position:absolute;width:100%;z-index:10}.vac-room-header .vac-room-wrapper{align-items:center;display:flex;height:100%;min-width:0;padding:0 16px;width:100%}.vac-room-header .vac-toggle-button{margin-right:15px}.vac-room-header .vac-toggle-button svg{height:26px;width:26px}.vac-room-header .vac-rotate-icon{transform:rotate(180deg)!important}.vac-room-header .vac-info-wrapper,.vac-room-header .vac-room-selection{align-items:center;display:flex;height:100%;min-width:0;width:100%}.vac-room-header .vac-room-selection .vac-selection-button{background-color:var(--chat-bg-color-button);border-radius:4px;color:var(--chat-color-button);cursor:pointer;margin-right:10px;padding:8px 16px;transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-button:hover{opacity:.7}.vac-room-header .vac-room-selection .vac-selection-button:active{opacity:.9}.vac-room-header .vac-room-selection .vac-selection-button .vac-selection-button-count{margin-left:6px;opacity:.9}.vac-room-header .vac-room-selection .vac-selection-cancel{align-items:center;color:var(--chat-color-button-clear);display:flex;margin-left:auto;transition:all .2s;white-space:nowrap}.vac-room-header .vac-room-selection .vac-selection-cancel:hover{opacity:.7}.vac-room-header .vac-room-name{color:var(--chat-header-color-name);font-size:17px;font-weight:500;line-height:22px}.vac-room-header .vac-room-info{color:var(--chat-header-color-info);font-size:13px;line-height:18px}.vac-room-header .vac-room-options{margin-left:auto}@media only screen and (max-width:768px){.vac-room-header{height:50px}.vac-room-header .vac-room-wrapper{padding:0 10px}.vac-room-header .vac-room-name{font-size:16px;line-height:22px}.vac-room-header .vac-room-info{font-size:12px;line-height:16px}.vac-room-header .vac-avatar{height:37px;min-height:37px;min-width:37px;width:37px}}.vac-room-footer{border-bottom-right-radius:4px;width:100%;z-index:10}.vac-box-footer{background:var(--chat-footer-bg-color);display:flex;padding:10px 8px;position:relative}.vac-textarea{background:var(--chat-bg-color-input);border:var(--chat-border-style-input);border-radius:20px;box-sizing:content-box;caret-color:var(--chat-color-caret);color:var(--chat-color);font-size:16px;height:20px;line-height:20px;outline:0;overflow:hidden;padding:12px 16px;resize:none;width:100%}.vac-textarea::-moz-placeholder{color:var(--chat-color-placeholder);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.vac-textarea::placeholder{color:var(--chat-color-placeholder);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.vac-textarea-outline{border:1px solid var(--chat-border-color-input-selected);box-shadow:inset 0 0 0 1px var(--chat-border-color-input-selected)}.vac-icon-textarea,.vac-icon-textarea-left{align-items:center;display:flex}.vac-icon-textarea .vac-wrapper,.vac-icon-textarea svg,.vac-icon-textarea-left .vac-wrapper,.vac-icon-textarea-left svg{margin:0 7px}.vac-icon-textarea{margin-left:5px}.vac-icon-textarea-left{align-items:center;display:flex;margin-right:5px}.vac-icon-textarea-left .vac-wrapper,.vac-icon-textarea-left svg{margin:0 7px}.vac-icon-textarea-left .vac-icon-microphone{fill:var(--chat-icon-color-microphone);margin:0 7px}.vac-icon-textarea-left .vac-dot-audio-record{animation:vac-scaling .8s ease-in-out infinite alternate;background-color:var(--chat-message-bg-color-audio-record);border-radius:50%;height:15px;width:15px}@keyframes vac-scaling{0%{opacity:.4;transform:scale(1)}to{opacity:1;transform:scale(1.1)}}.vac-icon-textarea-left .vac-dot-audio-record-time{color:var(--chat-color);font-size:16px;margin-left:8px;width:45px}.vac-icon-textarea-left .vac-icon-audio-confirm,.vac-icon-textarea-left .vac-icon-audio-confirm svg,.vac-icon-textarea-left .vac-icon-audio-stop,.vac-icon-textarea-left .vac-icon-audio-stop svg{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop{margin-right:20px}.vac-icon-textarea-left .vac-icon-audio-stop #vac-icon-close-outline{fill:var(--chat-icon-color-audio-cancel)}.vac-icon-textarea-left .vac-icon-audio-confirm{margin-left:12px;margin-right:3px}.vac-icon-textarea-left .vac-icon-audio-confirm #vac-icon-checkmark{fill:var(--chat-icon-color-audio-confirm)}.vac-send-disabled,.vac-send-disabled svg{cursor:none!important;pointer-events:none!important;transform:none!important}@media only screen and (max-width:768px){.vac-room-footer{width:100%}.vac-box-footer{padding:7px 2px 7px 7px}.vac-box-footer.vac-box-footer-border{border-top:var(--chat-border-style-input)}.vac-textarea{line-height:18px;padding:7px}.vac-textarea::-moz-placeholder{color:transparent}.vac-textarea::placeholder{color:transparent}.vac-icon-textarea .vac-wrapper,.vac-icon-textarea svg,.vac-icon-textarea-left .vac-wrapper,.vac-icon-textarea-left svg{margin:0 5px!important}}.vac-emojis-container{align-items:center;background:var(--chat-footer-bg-color);display:flex;overflow:auto;padding:10px 8px;width:calc(100% - 16px)}.vac-emojis-container .vac-emoji-element{background:var(--chat-footer-bg-color-tag);border-radius:4px;cursor:pointer;font-size:30px;padding:0 8px;transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-emojis-container .vac-emoji-element-active{background:var(--chat-footer-bg-color-tag-active)}@media only screen and (max-width:768px){.vac-emojis-container{padding:7px 5px;width:calc(100% - 10px)}.vac-emojis-container .vac-emoji-element{font-size:26px;padding:0 7px}}.vac-reply-container{align-items:center;background:var(--chat-footer-bg-color);display:flex;padding:10px 10px 0;width:calc(100% - 20px)}.vac-reply-container .vac-reply-box{background:var(--chat-footer-bg-color-reply);border-radius:4px;overflow:hidden;padding:8px 10px;width:100%}.vac-reply-container .vac-reply-info{overflow:hidden}.vac-reply-container .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-container .vac-reply-content{color:var(--chat-message-color-reply-content);font-size:12px;white-space:pre-line}.vac-reply-container .vac-icon-reply{margin-left:10px}.vac-reply-container .vac-icon-reply svg{height:20px;width:20px}.vac-reply-container .vac-image-reply{border-radius:4px;margin:4px 10px 0 0;max-height:100px;max-width:200px}.vac-reply-container .vac-audio-reply{margin-right:10px}.vac-reply-container .vac-file-container{max-width:80px}@media only screen and (max-width:768px){.vac-reply-container{padding:5px 8px;width:calc(100% - 16px)}}.vac-room-files-container{align-items:center;background:var(--chat-footer-bg-color);display:flex;padding:10px 6px 0}.vac-room-files-container .vac-files-box{display:flex;overflow:auto;width:calc(100% - 30px)}.vac-room-files-container video{border:var(--chat-border-style-input);border-radius:4px;height:100px}.vac-room-files-container .vac-icon-close{margin-left:auto}.vac-room-files-container .vac-icon-close svg{height:20px;width:20px}@media only screen and (max-width:768px){.vac-files-container{padding:6px 4px 4px 2px}}.vac-room-file-container{display:flex;margin:0 4px;position:relative}.vac-room-file-container .vac-message-image{background-color:var(--chat-message-bg-color-image)!important;background-position:50%!important;background-repeat:no-repeat!important;background-size:cover!important;border:var(--chat-border-style-input);border-radius:4px;height:100px;position:relative;width:100px}.vac-room-file-container .vac-file-container{height:80px;width:80px}.vac-room-file-container .vac-icon-remove{left:6px;position:absolute;top:6px;z-index:10}.vac-room-file-container .vac-icon-remove svg{border-radius:50%;height:20px;width:20px}.vac-room-file-container .vac-icon-remove:before{background:rgba(0,0,0,.5);border-radius:50%;content:" ";height:100%;position:absolute;width:100%;z-index:-1}.vac-tags-container{align-items:center;display:flex;flex-direction:column;width:100%}.vac-tags-container .vac-tags-box{background:var(--chat-footer-bg-color-tag);cursor:pointer;display:flex;height:54px;overflow:hidden;transition:background-color .3s cubic-bezier(.25,.8,.5,1);width:100%}.vac-tags-container .vac-tags-box-active{background:var(--chat-footer-bg-color-tag-active)}.vac-tags-container .vac-tags-info{align-items:center;display:flex;overflow:hidden;padding:0 20px}.vac-tags-container .vac-tags-avatar{height:34px;min-height:34px;min-width:34px;width:34px}.vac-tags-container .vac-tags-username{font-size:14px}@media only screen and (max-width:768px){.vac-tags-container .vac-tags-box{height:50px}.vac-tags-container .vac-tags-info{padding:0 12px}}.vac-template-container{align-items:center;display:flex;flex-direction:column;width:100%}.vac-template-container .vac-template-box{background:var(--chat-footer-bg-color-tag);cursor:pointer;display:flex;height:54px;overflow:hidden;transition:background-color .3s cubic-bezier(.25,.8,.5,1);width:100%}.vac-template-container .vac-template-active{background:var(--chat-footer-bg-color-tag-active)}.vac-template-container .vac-template-info{align-items:center;display:flex;overflow:hidden;padding:0 20px}.vac-template-container .vac-template-tag{font-size:14px;font-weight:700;margin-right:10px}.vac-template-container .vac-template-text{font-size:14px}@media only screen and (max-width:768px){.vac-template-container .vac-template-box{height:50px}.vac-template-container .vac-template-info{padding:0 12px}}.vac-rooms-container{background:var(--chat-sidemenu-bg-color);border-bottom-left-radius:var(--chat-container-border-radius);border-top-left-radius:var(--chat-container-border-radius);display:flex;flex:0 0 25%;flex-flow:column;height:100%;max-width:500px;min-width:260px;position:relative}.vac-rooms-container.vac-rooms-container-full{flex:0 0 100%;max-width:100%}.vac-rooms-container .vac-rooms-empty{color:#9ca6af;font-size:14px;font-style:italic;line-height:20px;margin:40px 0;text-align:center;white-space:pre-line}.vac-rooms-container .vac-room-list{cursor:pointer;flex:1;max-width:100%;overflow-y:auto;padding:0 10px 5px;position:relative}.vac-rooms-container .vac-room-item{align-items:center;border-radius:8px;display:flex;flex:1 1 100%;margin-bottom:5px;min-height:71px;padding:0 14px;position:relative;transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-rooms-container .vac-room-item:hover{background:var(--chat-sidemenu-bg-color-hover)}.vac-rooms-container .vac-room-selected{color:var(--chat-sidemenu-color-active)!important}.vac-rooms-container .vac-room-selected,.vac-rooms-container .vac-room-selected:hover{background:var(--chat-sidemenu-bg-color-active)!important}@media only screen and (max-width:768px){.vac-rooms-container .vac-room-list{padding:0 7px 5px}.vac-rooms-container .vac-room-item{min-height:60px;padding:0 8px}}.vac-menu-options{top:60px}.is-dark .vac-box-footer,.is-dark .vac-chat-container,.is-dark .vac-col-messages .vac-container-scroll,.is-dark .vac-message-actions-wrapper .vac-blur-container,.is-dark .vac-room-header,.is-dark .vac-rooms-container{background:#181a1b}.is-dark .vac-box-search .vac-input,.is-dark .vac-message-wrapper .vac-message-card,.is-dark .vac-room-files-container,.is-dark .vac-rooms-container .vac-room-item:hover,.is-dark .vac-rooms-container .vac-room-selected,.is-dark .vac-textarea{background:#2f2f32!important}.is-dark .vac-box-search .vac-input,.is-dark .vac-textarea{border:1px solid #2f2f32}.is-dark .vac-box-search .vac-input,.is-dark .vac-card-window .vac-chat-container textarea,.is-dark .vac-icon-textarea-left .vac-dot-audio-record-time,.is-dark .vac-message-wrapper .vac-message-card,.is-dark .vac-room-container .vac-room-name,.is-dark .vac-room-header .vac-room-name{color:#fff}.is-dark .vac-room-header,.is-dark .vac-rooms-container{border-color:#2f2f32}.is-dark #vac-icon-emoji-reaction,.is-dark #vac-icon-toggle,.is-dark .vac-room-options #vac-icon-menu{fill:#fff}.is-dark .vac-col-messages .vac-container-scroll::-webkit-scrollbar-track,.is-dark .vac-rooms-container .vac-room-list::-webkit-scrollbar-track{background-color:#181a1b}.is-dark .vac-col-messages .vac-container-scroll::-webkit-scrollbar-thumb,.is-dark .vac-rooms-container .vac-room-list::-webkit-scrollbar-thumb{background-color:#2f2f32}.vac-col-messages .vac-container-scroll::-webkit-scrollbar,.vac-rooms-container .vac-room-list::-webkit-scrollbar{width:9px}html[dir=rtl] .vac-message-actions-wrapper .vac-options-container{left:0;right:auto}html[dir=rtl] .vac-box-search .vac-input{padding:10px 40px 10px 10px}html[dir=rtl] .vac-box-search .vac-icon-search{left:auto;right:30px}html[dir=rtl] .vac-box-search .vac-add-icon{margin-left:0;padding-right:10px}html[dir=rtl] .vac-icon-textarea .vac-send-disabled,html[dir=rtl] .vac-icon-textarea .vac-svg-button{transform:rotate(180deg)!important}html[dir=rtl] .vac-emoji-wrapper .vac-svg-button,html[dir=rtl] .vac-icon-textarea-left .vac-svg-button{transform:rotate(0deg)!important}html[dir=rtl].is-dark .vac-rooms-container{border-left:1px solid #2f2f32}html[dir=rtl] .vac-room-header .vac-toggle-button.vac-toggle-button{transform:rotate(180deg)!important}html[dir=rtl] .vac-menu-options{left:10px;right:auto}html[dir=rtl] .vac-emoji-wrapper .vac-emoji-picker{left:-50px!important;right:auto!important}html[dir=rtl] .vac-message-wrapper .vac-icon-check{margin:-3px 3px 0}html[dir=rtl] .vac-message-wrapper .vac-message-box{justify-content:flex-end;margin-right:auto}html[dir=rtl] .vac-message-wrapper .vac-message-box.vac-offset-current{justify-content:flex-start;margin-right:0}html[dir=rtl] .vac-room-header .vac-toggle-button{margin-left:15px;margin-right:0}html[dir=rtl] .vac-menu-options .vac-menu-list span svg{margin-right:5px}html[dir=rtl] .vac-message-actions-wrapper .vac-blur-container{left:10px;right:auto}.vac-room-container{align-items:center;display:flex;flex:1;width:100%}.vac-room-container .vac-name-container{flex:1}.vac-room-container .vac-title-container{align-items:center;display:flex;line-height:25px}.vac-room-container .vac-state-circle{background-color:var(--chat-room-color-offline);border-radius:50%;height:9px;margin-right:6px;transition:.3s;width:9px}.vac-room-container .vac-state-online{background-color:var(--chat-room-color-online)}.vac-room-container .vac-room-name{color:var(--chat-room-color-username);flex:1;font-weight:500}.vac-room-container .vac-text-date{color:var(--chat-room-color-timestamp);font-size:11px;margin-left:5px}.vac-room-container .vac-text-last{align-items:center;color:var(--chat-room-color-message);display:flex;font-size:12px;line-height:19px}.vac-room-container .vac-message-new{color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-icon-check{display:flex;height:14px;margin-right:2px;margin-top:-2px;vertical-align:middle;width:14px}.vac-room-container .vac-icon-microphone{fill:var(--chat-room-color-message);height:15px;margin:-3px 1px 0 -2px;vertical-align:middle;width:15px}.vac-room-container .vac-room-options-container{display:flex;margin-left:auto}.vac-room-container .vac-room-badge{background-color:var(--chat-room-bg-color-badge);color:var(--chat-room-color-badge);margin-left:5px}.vac-room-container .vac-list-room-options{align-items:center;height:19px;margin-left:5px;width:19px}.vac-box-empty{margin-top:10px}@media only screen and (max-width:768px){.vac-box-empty{margin-top:7px}}.vac-box-search{align-items:center;display:flex;height:64px;padding:0 15px;position:sticky}.vac-box-search .vac-icon-search{display:flex;left:30px;position:absolute}.vac-box-search .vac-icon-search svg{height:18px;width:18px}.vac-box-search .vac-input{background:var(--chat-bg-color-input);border:1px solid var(--chat-sidemenu-border-color-search);border-radius:4px;border-radius:20px;caret-color:var(--chat-color-caret);color:var(--chat-color);font-size:15px;height:38px;outline:0;padding:10px 10px 10px 40px;width:100%}.vac-box-search .vac-input::-moz-placeholder{color:var(--chat-color-placeholder)}.vac-box-search .vac-input::placeholder{color:var(--chat-color-placeholder)}.vac-box-search .vac-add-icon{margin-left:auto;padding-left:10px}@media only screen and (max-width:768px){.vac-box-search{height:58px}}.vac-message-wrapper .vac-card-info{border-radius:4px;box-shadow:0 1px 1px -1px rgba(0,0,0,.1),0 1px 1px -1px rgba(0,0,0,.11),0 1px 2px -1px rgba(0,0,0,.11);display:block;font-size:12px;margin:10px auto;overflow-wrap:break-word;padding:4px;position:relative;text-align:center;white-space:normal}.vac-message-wrapper .vac-card-date{background-color:var(--chat-message-bg-color-date);color:var(--chat-message-color-date);font-weight:500;max-width:150px;text-transform:uppercase}.vac-message-wrapper .vac-card-system{background-color:var(--chat-message-bg-color-system);color:var(--chat-message-color-system);max-width:250px;padding:8px 4px}.vac-message-wrapper .vac-line-new{color:var(--chat-message-color-new-messages);font-size:13px;padding:10px 0;position:relative;text-align:center}.vac-message-wrapper .vac-line-new:after,.vac-message-wrapper .vac-line-new:before{border-top:1px solid var(--chat-message-color-new-messages);content:"";left:0;position:absolute;top:50%;width:calc(50% - 60px)}.vac-message-wrapper .vac-line-new:before{left:auto;right:0}.vac-message-wrapper .vac-message-box{display:flex;flex:0 0 50%;justify-content:flex-start;line-height:1.4;max-width:50%}.vac-message-wrapper .vac-avatar{align-self:flex-end;height:28px;margin:0 0 2px;min-height:28px;min-width:28px;width:28px}.vac-message-wrapper .vac-avatar-current-offset{margin-right:28px}.vac-message-wrapper .vac-avatar-offset{margin-left:28px}.vac-message-wrapper .vac-failure-container{align-self:flex-end;background-color:#f44336;border-radius:50%;height:20px;margin:0 0 2px -4px;position:relative;width:20px}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:6px}.vac-message-wrapper .vac-failure-container .vac-failure-text{color:#fff;font-size:15px;font-weight:700;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.vac-message-wrapper .vac-message-container{align-items:end;box-sizing:content-box;min-width:100px;padding:2px 10px;position:relative}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-offset-current{justify-content:flex-end;margin-left:50%}.vac-message-wrapper .vac-message-card{background-color:var(--chat-message-bg-color);border-radius:8px;box-shadow:0 1px 1px -1px rgba(0,0,0,.1),0 1px 1px -1px rgba(0,0,0,.11),0 1px 2px -1px rgba(0,0,0,.11);color:var(--chat-message-color);font-size:14px;max-width:100%;padding:6px 9px 3px;transition-property:box-shadow,opacity;transition:box-shadow .28s cubic-bezier(.4,0,.2,1);white-space:pre-line;will-change:box-shadow}.vac-message-wrapper .vac-message-highlight{box-shadow:0 1px 2px -1px rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.11),0 1px 5px -1px rgba(0,0,0,.11)}.vac-message-wrapper .vac-message-current{background-color:var(--chat-message-bg-color-me)!important}.vac-message-wrapper .vac-message-deleted{background-color:var(--chat-message-bg-color-deleted)!important;color:var(--chat-message-color-deleted)!important;font-size:13px!important;font-style:italic!important}.vac-message-wrapper .vac-message-selected{background-color:var(--chat-message-bg-color-selected)!important;transition:background-color .2s}.vac-message-wrapper .vac-icon-deleted{fill:var(--chat-message-color-deleted);height:14px;margin:-2px 2px 0 0;vertical-align:middle;width:14px}.vac-message-wrapper .vac-message-image{background-color:var(--chat-message-bg-color-image)!important;background-position:50%!important;background-repeat:no-repeat!important;background-size:cover!important;border-radius:4px;height:250px;margin:4px auto 5px;max-width:100%;position:relative;transition:filter .4s linear;width:250px}.vac-message-wrapper .vac-text-username{color:var(--chat-message-color-username);font-size:13px;margin-bottom:2px}.vac-message-wrapper .vac-username-reply{margin-bottom:5px}.vac-message-wrapper .vac-text-timestamp{color:var(--chat-message-color-timestamp);font-size:10px;text-align:right}.vac-message-wrapper .vac-progress-time{color:var(--chat-color);float:left;font-size:12px;margin:-2px 0 0 40px}.vac-message-wrapper .vac-icon-edited{align-items:center;display:inline-flex;justify-content:center;letter-spacing:normal;line-height:1;margin:0 4px 2px;text-indent:0;vertical-align:middle}.vac-message-wrapper .vac-icon-edited svg{height:12px;width:12px}.vac-message-wrapper .vac-icon-check{height:14px;margin:-3px -3px 0 3px;vertical-align:middle;width:14px}@media only screen and (max-width:768px){.vac-message-wrapper .vac-message-container{padding:2px 3px 1px}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-message-box{flex:0 0 80%;max-width:80%}.vac-message-wrapper .vac-avatar{height:25px;margin:0 6px 1px 0;min-height:25px;min-width:25px;width:25px}.vac-message-wrapper .vac-avatar.vac-avatar-current{margin:0 0 1px 6px}.vac-message-wrapper .vac-avatar-current-offset{margin-right:31px}.vac-message-wrapper .vac-avatar-offset{margin-left:31px}.vac-message-wrapper .vac-failure-container{margin-left:2px}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:0}.vac-message-wrapper .vac-offset-current{margin-left:20%}.vac-message-wrapper .vac-progress-time{margin-left:37px}}.vac-audio-player{display:flex;margin:8px 0 5px}.vac-audio-player .vac-svg-button{margin-left:7px;max-width:18px}@media only screen and (max-width:768px){.vac-audio-player{margin:4px 0 0}.vac-audio-player .vac-svg-button{margin-left:5px;max-width:16px}}.vac-player-bar{align-items:center;display:flex;margin-left:20px;margin-right:7px;max-width:calc(100% - 18px)}.vac-player-bar .vac-player-progress{width:190px}.vac-player-bar .vac-player-progress .vac-line-container{background-color:var(--chat-message-bg-color-audio-line);border-radius:5px;height:4px;position:relative}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-progress{background-color:var(--chat-message-bg-color-audio-progress);border-radius:inherit;height:inherit;position:absolute}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{background-color:var(--chat-message-bg-color-audio-progress-selector);border-radius:50%;height:14px;margin-left:-7px;position:absolute;top:-5px;transition:transform .25s;width:14px}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot__active{transform:scale(1.2)}@media only screen and (max-width:768px){.vac-player-bar{margin-right:5px}.vac-player-bar .vac-player-progress .vac-line-container{height:3px}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{height:12px;margin-left:-5px;top:-5px;width:12px}}.vac-message-actions-wrapper .vac-options-container{border-top-right-radius:8px;height:40px;overflow:hidden;position:absolute;right:10px;top:2px;width:70px}.vac-message-actions-wrapper .vac-blur-container{background:var(--chat-message-bg-color);border-bottom-left-radius:8px;bottom:10px;filter:blur(3px);height:100%;left:8px;position:absolute;width:100%}.vac-message-actions-wrapper .vac-options-me{background:var(--chat-message-bg-color-me)}.vac-message-actions-wrapper .vac-message-options{background:var(--chat-icon-bg-dropdown-message);border-radius:50%;position:absolute;right:7px;top:7px}.vac-message-actions-wrapper .vac-message-options svg{height:17px;margin:-5px;padding:5px;width:17px}.vac-message-actions-wrapper .vac-message-emojis{position:absolute;right:30px;top:6px}.vac-message-actions-wrapper .vac-menu-options{right:15px}.vac-message-actions-wrapper .vac-menu-left{right:-118px}@media only screen and (max-width:768px){.vac-message-actions-wrapper .vac-options-container{right:3px}.vac-message-actions-wrapper .vac-menu-left{right:-50px}}.vac-message-files-container .vac-file-wrapper{position:relative;width:-moz-fit-content;width:fit-content}.vac-message-files-container .vac-file-wrapper .vac-file-container{cursor:pointer;height:60px;margin:3px 0 5px;transition:all .6s;width:60px}.vac-message-files-container .vac-file-wrapper .vac-file-container:hover{opacity:.85}.vac-message-files-container .vac-file-wrapper .vac-file-container svg{height:30px;width:30px}.vac-message-files-container .vac-file-wrapper .vac-file-container.vac-file-container-progress{background-color:rgba(0,0,0,.3)}.vac-message-file-container{position:relative;z-index:0}.vac-message-file-container .vac-message-image-container{cursor:pointer}.vac-message-file-container .vac-image-buttons{background:linear-gradient(180deg,transparent 55%,rgba(0,0,0,.02) 60%,rgba(0,0,0,.05) 65%,rgba(0,0,0,.1) 70%,rgba(0,0,0,.2) 75%,rgba(0,0,0,.3) 80%,rgba(0,0,0,.5) 85%,rgba(0,0,0,.6) 90%,rgba(0,0,0,.7) 95%,rgba(0,0,0,.8));border-radius:4px;height:100%;position:absolute;width:100%}.vac-message-file-container .vac-image-buttons svg{height:26px;width:26px}.vac-message-file-container .vac-image-buttons .vac-button-download,.vac-message-file-container .vac-image-buttons .vac-button-view{bottom:6px;left:7px;position:absolute}.vac-message-file-container .vac-image-buttons :first-child{left:40px}.vac-message-file-container .vac-image-buttons .vac-button-view{bottom:8px;max-width:18px}.vac-message-file-container .vac-video-container{cursor:pointer;margin:4px auto 5px;max-width:100%;width:350px}.vac-message-file-container .vac-video-container video{border-radius:4px}.vac-button-reaction{align-items:center;background:var(--chat-message-bg-color-reaction);border:var(--chat-message-border-style-reaction);border-radius:4px;display:inline-flex;font-size:18px;line-height:23px;margin:4px 2px 0;outline:none;padding:0 5px;transition:.3s}.vac-button-reaction span{color:var(--chat-message-color-reaction-counter);font-size:11px;font-weight:500;min-width:7px}.vac-button-reaction:hover{background:var(--chat-message-bg-color-reaction-hover);border:var(--chat-message-border-style-reaction-hover);cursor:pointer}.vac-button-reaction.vac-reaction-me{background:var(--chat-message-bg-color-reaction-me);border:var(--chat-message-border-style-reaction-me)}.vac-button-reaction.vac-reaction-me span{color:var(--chat-message-color-reaction-counter-me)}.vac-button-reaction.vac-reaction-me:hover{background:var(--chat-message-bg-color-reaction-hover-me);border:var(--chat-message-border-style-reaction-hover-me)}.vac-reply-message{background:var(--chat-message-bg-color-reply);border-radius:4px;margin:-1px -5px 8px;padding:8px 10px}.vac-reply-message .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-message .vac-image-reply-container{width:70px}.vac-reply-message .vac-image-reply-container .vac-message-image-reply{height:70px;margin:4px auto 3px;width:70px}.vac-reply-message .vac-video-reply-container{max-width:100%;width:200px}.vac-reply-message .vac-video-reply-container video{border-radius:4px}.vac-reply-message .vac-reply-content{color:var(--chat-message-color-reply-content);font-size:12px}.vac-reply-message .vac-file-container{height:60px;width:60px}.vac-emoji-wrapper{display:flex;position:relative}.vac-emoji-wrapper .vac-emoji-reaction svg{height:19px;width:19px}.vac-emoji-wrapper .vac-emoji-picker{background:var(--chat-emoji-bg-color);border-radius:.5rem;bottom:32px;box-shadow:0 1px 2px -2px rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1),0 1px 2px 1px rgba(0,0,0,.1);box-sizing:border-box;overflow:scroll;padding-top:4px;position:absolute;right:10px;scrollbar-width:none;width:300px;z-index:9999}.vac-emoji-wrapper .vac-emoji-picker::-webkit-scrollbar{display:none}.vac-emoji-wrapper .vac-emoji-picker.vac-picker-reaction{position:fixed;right:auto;top:auto}.vac-emoji-wrapper .vac-emoji-picker emoji-picker{--emoji-size:1.2rem;--background:var(--chat-emoji-bg-color);--emoji-padding:0.4rem;--border-color:var(--chat-sidemenu-border-color-search);--button-hover-background:var(--chat-sidemenu-bg-color-hover);--button-active-background:var(--chat-sidemenu-bg-color-hover);height:100%;width:100%}.vac-format-message-wrapper .vac-format-container{display:inline}.vac-format-message-wrapper .vac-icon-deleted{fill:var(--chat-room-color-message);height:14px;margin:-3px 1px 0 0;vertical-align:middle;width:14px}.vac-format-message-wrapper .vac-image-link-container{background-color:var(--chat-message-bg-color-media);border-radius:4px;margin:2px auto;padding:8px}.vac-format-message-wrapper .vac-image-link{background-color:var(--chat-message-bg-color-image)!important;background-position:50%!important;background-repeat:no-repeat!important;background-size:contain;border-radius:4px;height:150px;margin:0 auto;max-width:100%;position:relative;width:150px}.vac-format-message-wrapper .vac-image-link-message{font-size:12px;max-width:166px}.vac-loader-wrapper.vac-container-center{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-loader-wrapper.vac-container-top{padding:21px}.vac-loader-wrapper.vac-container-top #vac-circle{height:20px;width:20px}.vac-loader-wrapper #vac-circle{animation:vac-spin 1s linear infinite;border:3px solid rgba(0,0,0,.25);border-bottom:3px solid var(--chat-color-spinner);border-radius:50%;border-right:3px solid var(--chat-color-spinner);border-top:3px solid var(--chat-color-spinner);height:28px;margin:auto;width:28px}@media only screen and (max-width:768px){.vac-loader-wrapper #vac-circle{height:24px;width:24px}.vac-loader-wrapper.vac-container-top{padding:18px}.vac-loader-wrapper.vac-container-top #vac-circle{height:16px;width:16px}}@keyframes vac-spin{0%{transform:rotate(0deg)}to{transform:rotate(359deg)}}#vac-icon-search{fill:var(--chat-icon-color-search)}#vac-icon-add{fill:var(--chat-icon-color-add)}#vac-icon-toggle{fill:var(--chat-icon-color-toggle)}#vac-icon-menu{fill:var(--chat-icon-color-menu)}#vac-icon-close{fill:var(--chat-icon-color-close)}#vac-icon-close-image{fill:var(--chat-icon-color-close-image)}#vac-icon-file{fill:var(--chat-icon-color-file)}#vac-icon-paperclip{fill:var(--chat-icon-color-paperclip)}#vac-icon-close-outline{fill:var(--chat-icon-color-close-outline)}#vac-icon-close-outline-preview{fill:var(--chat-icon-color-close-preview)}#vac-icon-send{fill:var(--chat-icon-color-send)}#vac-icon-send-disabled{fill:var(--chat-icon-color-send-disabled)}#vac-icon-emoji{fill:var(--chat-icon-color-emoji)}#vac-icon-emoji-reaction{fill:var(--chat-icon-color-emoji-reaction)}#vac-icon-document{fill:var(--chat-icon-color-document)}#vac-icon-pencil{fill:var(--chat-icon-color-pencil)}#vac-icon-checkmark,#vac-icon-double-checkmark{fill:var(--chat-icon-color-checkmark)}#vac-icon-checkmark-seen,#vac-icon-double-checkmark-seen{fill:var(--chat-icon-color-checkmark-seen)}#vac-icon-eye{fill:var(--chat-icon-color-eye)}#vac-icon-dropdown-message{fill:var(--chat-icon-color-dropdown-message)}#vac-icon-dropdown-room{fill:var(--chat-icon-color-dropdown-room)}#vac-icon-dropdown-scroll{fill:var(--chat-icon-color-dropdown-scroll)}#vac-icon-audio-play{fill:var(--chat-icon-color-audio-play)}#vac-icon-audio-pause{fill:var(--chat-icon-color-audio-pause)}.vac-progress-wrapper{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-progress-wrapper circle{transform:rotate(-90deg);transform-origin:50% 50%;transition:stroke-dashoffset .35s}.vac-progress-wrapper .vac-progress-content{background-color:rgba(0,0,0,.7);border-radius:50%;left:50%;margin-top:-2px;position:absolute;top:50%;transform:translate(-50%,-50%);z-index:-1}.vac-progress-wrapper .vac-progress-content .vac-progress-text{color:#fff;font-weight:700;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.vac-progress-wrapper .vac-progress-content .vac-progress-text .vac-progress-pourcent{font-size:9px;font-weight:400}',""]);const i=r},97514:(e,t,n)=>{var s=n(51038),r=(s.System,s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays,s.new_array_n,s.new_byte,s.new_double,s.new_float),i=(s.new_float_n,s.new_int,s.new_int_n,s.assert,n(60687));e.exports=function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=r(i.SBMAX_l),this.s=r(i.SBMAX_s),this.psfb21=r(i.PSFB21),this.psfb12=r(i.PSFB12),this.cb_l=r(i.CBANDS),this.cb_s=r(i.CBANDS),this.eql_w=r(i.BLKSIZE/2)}},3724:(e,t,n)=>{var s=n(51038),r=s.System,i=(s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays),o=(s.new_array_n,s.new_byte),a=(s.new_double,s.new_float,s.new_float_n),c=s.new_int,l=(s.new_int_n,s.assert),h=n(15638),u=n(77721),d=n(60687),m=n(91998);function p(){var e=this,t=32,n=null,s=null,p=null,f=null;this.setModules=function(e,t,r,i){n=e,s=t,p=r,f=i};var g=null,_=0,v=0,b=0;function y(e){r.arraycopy(e.header[e.w_ptr].buf,0,g,v,e.sideinfo_len),v+=e.sideinfo_len,_+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&m.MAX_HEADER_BUF-1}function w(e,n,s){for(l(s<t-2);s>0;){var r;0==b&&(b=8,v++,l(v<Lame.LAME_MAXMP3BUFFER),l(e.header[e.w_ptr].write_timing>=_),e.header[e.w_ptr].write_timing==_&&y(e),g[v]=0),r=Math.min(s,b),b-=r,l((s-=r)<t),l(b<t),g[v]|=n>>s<<b,_+=r}}function k(e,n,s){for(l(s<t-2);s>0;){var r;0==b&&(b=8,v++,l(v<Lame.LAME_MAXMP3BUFFER),g[v]=0),r=Math.min(s,b),b-=r,l((s-=r)<t),l(b<t),g[v]|=n>>s<<b,_+=r}}function x(e,t){var n,s=e.internal_flags;if(l(t>=0),t>=8&&(w(s,76,8),t-=8),t>=8&&(w(s,65,8),t-=8),t>=8&&(w(s,77,8),t-=8),t>=8&&(w(s,69,8),t-=8),t>=32){var r=p.getLameShortVersion();if(t>=32)for(n=0;n<r.length&&t>=8;++n)t-=8,w(s,r.charAt(n),8)}for(;t>=1;t-=1)w(s,s.ancillary_flag,1),s.ancillary_flag^=e.disable_reservoir?0:1;l(0==t)}function E(e,n,s){for(var r=e.header[e.h_ptr].ptr;s>0;){var i=Math.min(s,8-(7&r));l((s-=i)<t),e.header[e.h_ptr].buf[r>>3]|=n>>s<<8-(7&r)-i,r+=i}e.header[e.h_ptr].ptr=r}function S(e,t){e<<=8;for(var n=0;n<8;n++)0!=(65536&((t<<=1)^(e<<=1)))&&(t^=32773);return t}function T(e,t){var n,s=u.ht[t.count1table_select+32],r=0,i=t.big_values,o=t.big_values;for(l(t.count1table_select<2),n=(t.count1-t.big_values)/4;n>0;--n){var a,c=0,h=0;0!=(a=t.l3_enc[i+0])&&(h+=8,t.xr[o+0]<0&&c++,l(a<=1)),0!=(a=t.l3_enc[i+1])&&(h+=4,c*=2,t.xr[o+1]<0&&c++,l(a<=1)),0!=(a=t.l3_enc[i+2])&&(h+=2,c*=2,t.xr[o+2]<0&&c++,l(a<=1)),0!=(a=t.l3_enc[i+3])&&(h++,c*=2,t.xr[o+3]<0&&c++,l(a<=1)),i+=4,o+=4,w(e,c+s.table[h],s.hlen[h]),r+=s.hlen[h]}return r}function C(e,n,s,r,i){var o=u.ht[n],a=0;if(l(n<32),0==n)return a;for(var c=s;c<r;c+=2){var h=0,d=0,m=o.xlen,p=o.xlen,f=0,g=i.l3_enc[c],_=i.l3_enc[c+1];if(0!=g&&(i.xr[c]<0&&f++,h--),n>15){if(g>14){var v=g-15;l(v<=o.linmax),f|=v<<1,d=m,g=15}if(_>14){var b=_-15;l(b<=o.linmax),f<<=m,f|=b,d+=m,_=15}p=16}0!=_&&(f<<=1,i.xr[c+1]<0&&f++,h--),l((g|_)<16),g=g*p+_,d-=h,h+=o.hlen[g],l(h<=t),l(d<=t),w(e,o.table[g],h),w(e,f,d),a+=h+d}return a}function I(e,t){var n=3*e.scalefac_band.s[3];n>t.big_values&&(n=t.big_values);var s=C(e,t.table_select[0],0,n,t);return s+=C(e,t.table_select[1],n,t.big_values,t)}function R(e,t){var n,s,r,i;n=t.big_values,l(0<=n&&n<=576);var o=t.region0_count+1;return l(0<=o),l(o<e.scalefac_band.l.length),r=e.scalefac_band.l[o],o+=t.region1_count+1,l(0<=o),l(o<e.scalefac_band.l.length),r>n&&(r=n),(i=e.scalefac_band.l[o])>n&&(i=n),s=C(e,t.table_select[0],0,r,t),s+=C(e,t.table_select[1],r,i,t),s+=C(e,t.table_select[2],i,n,t)}function A(){this.total=0}function M(t,n){var s,i,o,a,c,l=t.internal_flags;return c=l.w_ptr,-1==(a=l.h_ptr-1)&&(a=m.MAX_HEADER_BUF-1),s=l.header[a].write_timing-_,n.total=s,s>=0&&(i=1+a-c,a<c&&(i=1+a-c+m.MAX_HEADER_BUF),s-=8*i*l.sideinfo_len),s+=o=e.getframebits(t),n.total+=o,n.total%8!=0?n.total=1+n.total/8:n.total=n.total/8,n.total+=v+1,s<0&&r.err.println("strange error flushing buffer ... \n"),s}this.getframebits=function(e){var t,n=e.internal_flags;return t=0!=n.bitrate_index?u.bitrate_table[e.version][n.bitrate_index]:e.brate,l(8<=t&&t<=640),8*(0|72e3*(e.version+1)*t/e.out_samplerate+n.padding)},this.CRC_writeheader=function(e,t){var n=65535;n=S(255&t[2],n),n=S(255&t[3],n);for(var s=6;s<e.sideinfo_len;s++)n=S(255&t[s],n);t[4]=byte(n>>8),t[5]=byte(255&n)},this.flush_bitstream=function(e){var t,s,r=e.internal_flags,i=r.h_ptr-1;if(-1==i&&(i=m.MAX_HEADER_BUF-1),t=r.l3_side,!((s=M(e,new A))<0)){if(x(e,s),l(r.header[i].write_timing+this.getframebits(e)==_),r.ResvSize=0,t.main_data_begin=0,r.findReplayGain){var o=n.GetTitleGain(r.rgdata);l(NEQ(o,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),r.RadioGain=0|Math.floor(10*o+.5)}r.findPeakSample&&(r.noclipGainChange=0|Math.ceil(20*Math.log10(r.PeakSample/32767)*10),r.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?r.noclipScale=Math.floor(32767/r.PeakSample*100)/100:r.noclipScale=-1)}},this.add_dummy_byte=function(e,t,n){for(var s,r=e.internal_flags;n-- >0;)for(k(0,t,8),s=0;s<m.MAX_HEADER_BUF;++s)r.header[s].write_timing+=8},this.format_bitstream=function(e){var t,n=e.internal_flags;t=n.l3_side;var s=this.getframebits(e);x(e,t.resvDrain_pre),function(e,t){var n,s,o,a=e.internal_flags;if(n=a.l3_side,a.header[a.h_ptr].ptr=0,i.fill(a.header[a.h_ptr].buf,0,a.sideinfo_len,0),e.out_samplerate<16e3?E(a,4094,12):E(a,4095,12),E(a,e.version,1),E(a,1,2),E(a,e.error_protection?0:1,1),E(a,a.bitrate_index,4),E(a,a.samplerate_index,2),E(a,a.padding,1),E(a,e.extension,1),E(a,e.mode.ordinal(),2),E(a,a.mode_ext,2),E(a,e.copyright,1),E(a,e.original,1),E(a,e.emphasis,2),e.error_protection&&E(a,0,16),1==e.version){for(l(n.main_data_begin>=0),E(a,n.main_data_begin,9),2==a.channels_out?E(a,n.private_bits,3):E(a,n.private_bits,5),o=0;o<a.channels_out;o++){var c;for(c=0;c<4;c++)E(a,n.scfsi[o][c],1)}for(s=0;s<2;s++)for(o=0;o<a.channels_out;o++)E(a,(h=n.tt[s][o]).part2_3_length+h.part2_length,12),E(a,h.big_values/2,9),E(a,h.global_gain,8),E(a,h.scalefac_compress,4),h.block_type!=d.NORM_TYPE?(E(a,1,1),E(a,h.block_type,2),E(a,h.mixed_block_flag,1),14==h.table_select[0]&&(h.table_select[0]=16),E(a,h.table_select[0],5),14==h.table_select[1]&&(h.table_select[1]=16),E(a,h.table_select[1],5),E(a,h.subblock_gain[0],3),E(a,h.subblock_gain[1],3),E(a,h.subblock_gain[2],3)):(E(a,0,1),14==h.table_select[0]&&(h.table_select[0]=16),E(a,h.table_select[0],5),14==h.table_select[1]&&(h.table_select[1]=16),E(a,h.table_select[1],5),14==h.table_select[2]&&(h.table_select[2]=16),E(a,h.table_select[2],5),l(0<=h.region0_count&&h.region0_count<16),l(0<=h.region1_count&&h.region1_count<8),E(a,h.region0_count,4),E(a,h.region1_count,3)),E(a,h.preflag,1),E(a,h.scalefac_scale,1),E(a,h.count1table_select,1)}else for(l(n.main_data_begin>=0),E(a,n.main_data_begin,8),E(a,n.private_bits,a.channels_out),s=0,o=0;o<a.channels_out;o++){var h;E(a,(h=n.tt[s][o]).part2_3_length+h.part2_length,12),E(a,h.big_values/2,9),E(a,h.global_gain,8),E(a,h.scalefac_compress,9),h.block_type!=d.NORM_TYPE?(E(a,1,1),E(a,h.block_type,2),E(a,h.mixed_block_flag,1),14==h.table_select[0]&&(h.table_select[0]=16),E(a,h.table_select[0],5),14==h.table_select[1]&&(h.table_select[1]=16),E(a,h.table_select[1],5),E(a,h.subblock_gain[0],3),E(a,h.subblock_gain[1],3),E(a,h.subblock_gain[2],3)):(E(a,0,1),14==h.table_select[0]&&(h.table_select[0]=16),E(a,h.table_select[0],5),14==h.table_select[1]&&(h.table_select[1]=16),E(a,h.table_select[1],5),14==h.table_select[2]&&(h.table_select[2]=16),E(a,h.table_select[2],5),l(0<=h.region0_count&&h.region0_count<16),l(0<=h.region1_count&&h.region1_count<8),E(a,h.region0_count,4),E(a,h.region1_count,3)),E(a,h.scalefac_scale,1),E(a,h.count1table_select,1)}e.error_protection&&CRC_writeheader(a,a.header[a.h_ptr].buf);var u=a.h_ptr;l(a.header[u].ptr==8*a.sideinfo_len),a.h_ptr=u+1&m.MAX_HEADER_BUF-1,a.header[a.h_ptr].write_timing=a.header[u].write_timing+t,a.h_ptr==a.w_ptr&&r.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}(e,s);var o=8*n.sideinfo_len;if(o+=function(e){var t,n,s,r,i=0,o=e.internal_flags,a=o.l3_side;if(1==e.version)for(t=0;t<2;t++)for(n=0;n<o.channels_out;n++){var c=a.tt[t][n],u=h.slen1_tab[c.scalefac_compress],m=h.slen2_tab[c.scalefac_compress];for(r=0,s=0;s<c.sfbdivide;s++)-1!=c.scalefac[s]&&(w(o,c.scalefac[s],u),r+=u);for(;s<c.sfbmax;s++)-1!=c.scalefac[s]&&(w(o,c.scalefac[s],m),r+=m);l(r==c.part2_length),c.block_type==d.SHORT_TYPE?r+=I(o,c):r+=R(o,c),r+=T(o,c),l(r==c.part2_3_length+c.part2_length),i+=r}else for(t=0,n=0;n<o.channels_out;n++){c=a.tt[t][n];var p,f,g=0;if(l(null!=c.sfb_partition_table),r=0,s=0,f=0,c.block_type==d.SHORT_TYPE){for(;f<4;f++){var _=c.sfb_partition_table[f]/3,v=c.slen[f];for(p=0;p<_;p++,s++)w(o,Math.max(c.scalefac[3*s+0],0),v),w(o,Math.max(c.scalefac[3*s+1],0),v),w(o,Math.max(c.scalefac[3*s+2],0),v),g+=3*v}r+=I(o,c)}else{for(;f<4;f++)for(_=c.sfb_partition_table[f],v=c.slen[f],p=0;p<_;p++,s++)w(o,Math.max(c.scalefac[s],0),v),g+=v;r+=R(o,c)}r+=T(o,c),l(r==c.part2_3_length),l(g==c.part2_length),i+=g+r}return i}(e),x(e,t.resvDrain_post),o+=t.resvDrain_post,t.main_data_begin+=(s-o)/8,M(e,new A)!=n.ResvSize&&r.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*t.main_data_begin!=n.ResvSize&&(r.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*t.main_data_begin,n.ResvSize,t.resvDrain_post,t.resvDrain_pre,8*n.sideinfo_len,o-t.resvDrain_post-8*n.sideinfo_len,o,o%8,s),r.err.println("This is a fatal error.  It has several possible causes:"),r.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),r.err.println(" 9%%  Your system is overclocked"),r.err.println(" 1%%  bug in LAME encoding library"),n.ResvSize=8*t.main_data_begin),l(_%8==0),_>1e9){var a;for(a=0;a<m.MAX_HEADER_BUF;++a)n.header[a].write_timing-=_;_=0}return 0},this.copy_buffer=function(e,t,i,o,h){var u=v+1;if(u<=0)return 0;if(0!=o&&u>o)return-1;if(r.arraycopy(g,0,t,i,u),v=-1,b=0,0!=h){var d=c(1);if(d[0]=e.nMusicCRC,f.updateMusicCRC(d,t,i,u),e.nMusicCRC=d[0],u>0&&(e.VBR_seek_table.nBytesWritten+=u),e.decode_on_the_fly)for(var m,p=a([2,1152]),_=u,y=-1;0!=y;)if(y=s.hip_decode1_unclipped(e.hip,t,i,_,p[0],p[1]),_=0,-1==y&&(y=0),y>0){if(l(y<=1152),e.findPeakSample){for(m=0;m<y;m++)p[0][m]>e.PeakSample?e.PeakSample=p[0][m]:-p[0][m]>e.PeakSample&&(e.PeakSample=-p[0][m]);if(e.channels_out>1)for(m=0;m<y;m++)p[1][m]>e.PeakSample?e.PeakSample=p[1][m]:-p[1][m]>e.PeakSample&&(e.PeakSample=-p[1][m])}if(e.findReplayGain&&n.AnalyzeSamples(e.rgdata,p[0],0,p[1],0,y,e.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}return u},this.init_bit_stream_w=function(e){g=o(Lame.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,v=-1,b=0,_=0}}p.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},p.NEQ=function(e,t){return!p.EQ(e,t)},e.exports=p},49120:(e,t,n)=>{var s=n(51038),r=(s.System,s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays,s.new_array_n,s.new_byte,s.new_double,s.new_float),i=(s.new_float_n,s.new_int),o=(s.new_int_n,s.assert),a=n(23134),c=n(60687),l=n(90354),h=n(91998);e.exports=function(e){var t=e;this.quantize=t,this.iteration_loop=function(e,t,n,s){var u,d=e.internal_flags,m=r(l.SFBMAX),p=r(576),f=i(2),g=0,_=d.l3_side,v=new a(g);this.quantize.rv.ResvFrameBegin(e,v),g=v.bits;for(var b=0;b<d.mode_gr;b++){u=this.quantize.qupvt.on_pe(e,t,f,g,b,b),d.mode_ext==c.MPG_MD_MS_LR&&(this.quantize.ms_convert(d.l3_side,b),this.quantize.qupvt.reduce_side(f,n[b],g,u));for(var y=0;y<d.channels_out;y++){var w,k,x=_.tt[b][y];x.block_type!=c.SHORT_TYPE?(w=0,k=d.PSY.mask_adjust-w):(w=0,k=d.PSY.mask_adjust_short-w),d.masking_lower=Math.pow(10,.1*k),this.quantize.init_outer_loop(d,x),this.quantize.init_xrpow(d,x,p)&&(this.quantize.qupvt.calc_xmin(e,s[b][y],x,m),this.quantize.outer_loop(e,x,m,p,y,f[y])),this.quantize.iteration_finish_one(d,b,y),o(x.part2_3_length<=h.MAX_BITS_PER_CHANNEL),o(x.part2_3_length<=f[y])}}this.quantize.rv.ResvFrameEnd(d,g)}}},3449:(e,t,n)=>{var s=n(51038),r=s.new_float,i=s.new_int;s.assert;e.exports=function(){this.global_gain=0,this.sfb_count1=0,this.step=i(39),this.noise=r(39),this.noise_log=r(39)}},22711:e=>{e.exports=function(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}},60687:(e,t,n)=>{var s=n(51038),r=s.System,i=s.VbrMode,o=(s.Float,s.ShortBlock,s.Util,s.Arrays,s.new_array_n),a=(s.new_byte,s.new_double,s.new_float),c=s.new_float_n,l=s.new_int,h=(s.new_int_n,s.assert);function u(){var e=n(82143),t=n(99584),s=u.FFTOFFSET,d=u.MPG_MD_MS_LR,m=null;this.psy=null;var p=null,f=null,g=null;this.setModules=function(e,t,n,s){m=e,this.psy=t,p=t,f=s,g=n};var _=new e;this.lame_encode_mp3_frame=function(e,n,v,b,y,w){var k,x=o([2,2]);x[0][0]=new t,x[0][1]=new t,x[1][0]=new t,x[1][1]=new t;var E,S=o([2,2]);S[0][0]=new t,S[0][1]=new t,S[1][0]=new t,S[1][1]=new t;var T,C,I,R=[null,null],A=e.internal_flags,M=c([2,4]),N=[.5,.5],P=[[0,0],[0,0]],B=[[0,0],[0,0]];if(R[0]=n,R[1]=v,0==A.lame_encode_frame_init&&function(e,t){var n,s,r=e.internal_flags;if(0==r.lame_encode_frame_init){var i,o,c=a(2014),l=a(2014);for(r.lame_encode_frame_init=1,i=0,o=0;i<286+576*(1+r.mode_gr);++i)i<576*r.mode_gr?(c[i]=0,2==r.channels_out&&(l[i]=0)):(c[i]=t[0][o],2==r.channels_out&&(l[i]=t[1][o]),++o);for(s=0;s<r.mode_gr;s++)for(n=0;n<r.channels_out;n++)r.l3_side.tt[s][n].block_type=u.SHORT_TYPE;_.mdct_sub48(r,c,l),h(576>=u.FFTOFFSET),h(r.mf_size>=u.BLKSIZE+e.framesize-u.FFTOFFSET),h(r.mf_size>=512+e.framesize-32)}}(e,R),A.padding=0,(A.slot_lag-=A.frac_SpF)<0&&(A.slot_lag+=e.out_samplerate,A.padding=1),0!=A.psymodel){var D=[null,null],O=0,L=l(2);for(I=0;I<A.mode_gr;I++){for(C=0;C<A.channels_out;C++)D[C]=R[C],O=576+576*I-u.FFTOFFSET;if(0!=(e.VBR==i.vbr_mtrh||e.VBR==i.vbr_mt?p.L3psycho_anal_vbr(e,D,O,I,x,S,P[I],B[I],M[I],L):p.L3psycho_anal_ns(e,D,O,I,x,S,P[I],B[I],M[I],L)))return-4;for(e.mode==MPEGMode.JOINT_STEREO&&(N[I]=M[I][2]+M[I][3],N[I]>0&&(N[I]=M[I][3]/N[I])),C=0;C<A.channels_out;C++){var V=A.l3_side.tt[I][C];V.block_type=L[C],V.mixed_block_flag=0}}}else for(I=0;I<A.mode_gr;I++)for(C=0;C<A.channels_out;C++)A.l3_side.tt[I][C].block_type=u.NORM_TYPE,A.l3_side.tt[I][C].mixed_block_flag=0,B[I][C]=P[I][C]=700;if(function(e){var t,n;if(0!=e.ATH.useAdjust)if(n=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(n+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(n+=n,t+=t),2==e.mode_gr&&(n=Math.max(n,t)),n*=.5,(n*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var s=31.98*n+625e-6;e.ATH.adjust>=s?(e.ATH.adjust*=.075*s+.925,e.ATH.adjust<s&&(e.ATH.adjust=s)):e.ATH.adjustLimit>=s?e.ATH.adjust=s:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=s}else e.ATH.adjust=1}(A),_.mdct_sub48(A,R[0],R[1]),A.mode_ext=u.MPG_MD_LR_LR,e.force_ms)A.mode_ext=u.MPG_MD_MS_LR;else if(e.mode==MPEGMode.JOINT_STEREO){var F=0,U=0;for(I=0;I<A.mode_gr;I++)for(C=0;C<A.channels_out;C++)F+=B[I][C],U+=P[I][C];if(F<=1*U){var j=A.l3_side.tt[0],q=A.l3_side.tt[A.mode_gr-1];j[0].block_type==j[1].block_type&&q[0].block_type==q[1].block_type&&(A.mode_ext=u.MPG_MD_MS_LR)}}if(A.mode_ext==d?(E=S,T=B):(E=x,T=P),e.analysis&&null!=A.pinfo)for(I=0;I<A.mode_gr;I++)for(C=0;C<A.channels_out;C++)A.pinfo.ms_ratio[I]=A.ms_ratio[I],A.pinfo.ms_ener_ratio[I]=N[I],A.pinfo.blocktype[I][C]=A.l3_side.tt[I][C].block_type,A.pinfo.pe[I][C]=T[I][C],r.arraycopy(A.l3_side.tt[I][C].xr,0,A.pinfo.xr[I][C],0,576),A.mode_ext==d&&(A.pinfo.ers[I][C]=A.pinfo.ers[I][C+2],r.arraycopy(A.pinfo.energy[I][C+2],0,A.pinfo.energy[I][C],0,A.pinfo.energy[I][C].length));if(e.VBR==i.vbr_off||e.VBR==i.vbr_abr){var H,z;for(H=0;H<18;H++)A.nsPsy.pefirbuf[H]=A.nsPsy.pefirbuf[H+1];for(z=0,I=0;I<A.mode_gr;I++)for(C=0;C<A.channels_out;C++)z+=T[I][C];for(A.nsPsy.pefirbuf[18]=z,z=A.nsPsy.pefirbuf[9],H=0;H<9;H++)z+=(A.nsPsy.pefirbuf[H]+A.nsPsy.pefirbuf[18-H])*u.fircoef[H];for(z=3350*A.mode_gr*A.channels_out/z,I=0;I<A.mode_gr;I++)for(C=0;C<A.channels_out;C++)T[I][C]*=z}if(A.iteration_loop.iteration_loop(e,T,N,E),m.format_bitstream(e),k=m.copy_buffer(A,b,y,w,1),e.bWriteVbrTag&&f.addVbrFrame(e),e.analysis&&null!=A.pinfo){for(C=0;C<A.channels_out;C++){var $;for($=0;$<s;$++)A.pinfo.pcmdata[C][$]=A.pinfo.pcmdata[C][$+e.framesize];for($=s;$<1600;$++)A.pinfo.pcmdata[C][$]=R[C][$-s]}g.set_frame_pinfo(e,E)}return function(e){var t,n;for(h(0<=e.bitrate_index&&e.bitrate_index<16),h(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(n=0;n<e.channels_out;++n){var s=0|e.l3_side.tt[t][n].block_type;0!=e.l3_side.tt[t][n].mixed_block_flag&&(s=4),e.bitrate_blockType_Hist[e.bitrate_index][s]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][s]++,e.bitrate_blockType_Hist[15][5]++}}(A),k}}u.ENCDELAY=576,u.POSTDELAY=1152,u.MDCTDELAY=48,u.FFTOFFSET=224+u.MDCTDELAY,u.DECDELAY=528,u.SBLIMIT=32,u.CBANDS=64,u.SBPSY_l=21,u.SBPSY_s=12,u.SBMAX_l=22,u.SBMAX_s=13,u.PSFB21=6,u.PSFB12=6,u.BLKSIZE=1024,u.HBLKSIZE=u.BLKSIZE/2+1,u.BLKSIZE_s=256,u.HBLKSIZE_s=u.BLKSIZE_s/2+1,u.NORM_TYPE=0,u.START_TYPE=1,u.SHORT_TYPE=2,u.STOP_TYPE=3,u.MPG_MD_LR_LR=0,u.MPG_MD_LR_I=1,u.MPG_MD_MS_LR=2,u.MPG_MD_MS_I=3,u.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3898045e-23,.0467745*5,.50455,.756825,.187098*5],e.exports=u},19347:(e,t,n)=>{var s=n(51038),r=(s.System,s.VbrMode,s.Float,s.ShortBlock,s.Util),i=(s.Arrays,s.new_array_n,s.new_byte,s.new_double,s.new_float),o=(s.new_float_n,s.new_int,s.new_int_n,s.assert,n(60687));e.exports=function(){var e=i(o.BLKSIZE),t=i(o.BLKSIZE_s/2),n=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function s(e,t,s){var i,o,a,c=0,l=t+(s<<=1);i=4;do{var h,u,d,m,p,f,g;g=i>>1,f=(p=i<<1)+(m=i),i=p<<1,a=(o=t)+g;do{x=e[o+0]-e[o+m],k=e[o+0]+e[o+m],C=e[o+p]-e[o+f],S=e[o+p]+e[o+f],e[o+p]=k-S,e[o+0]=k+S,e[o+f]=x-C,e[o+m]=x+C,x=e[a+0]-e[a+m],k=e[a+0]+e[a+m],C=r.SQRT2*e[a+f],S=r.SQRT2*e[a+p],e[a+p]=k-S,e[a+0]=k+S,e[a+f]=x-C,e[a+m]=x+C,a+=i,o+=i}while(o<l);for(u=n[c+0],h=n[c+1],d=1;d<g;d++){var _,v;_=1-2*h*h,v=2*h*u,o=t+d,a=t+m-d;do{var b,y,w,k,x,E,S,T,C,I;y=v*e[o+m]-_*e[a+m],b=_*e[o+m]+v*e[a+m],x=e[o+0]-b,k=e[o+0]+b,E=e[a+0]-y,w=e[a+0]+y,y=v*e[o+f]-_*e[a+f],b=_*e[o+f]+v*e[a+f],C=e[o+p]-b,S=e[o+p]+b,I=e[a+p]-y,T=e[a+p]+y,y=h*S-u*I,b=u*S+h*I,e[o+p]=k-b,e[o+0]=k+b,e[a+f]=E-y,e[a+m]=E+y,y=u*T-h*C,b=h*T+u*C,e[a+p]=w-b,e[a+0]=w+b,e[o+f]=x-y,e[o+m]=x+y,a+=i,o+=i}while(o<l);u=(_=u)*n[c+0]-h*n[c+1],h=_*n[c+1]+h*n[c+0]}c+=2}while(i<s)}var a=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(e,n,r,i,c){for(var l=0;l<3;l++){var h=o.BLKSIZE_s/2,u=65535&192*(l+1),d=o.BLKSIZE_s/8-1;do{var m,p,f,g,_,v=255&a[d<<2];p=(m=t[v]*i[r][c+v+u])-(_=t[127-v]*i[r][c+v+u+128]),m+=_,g=(f=t[v+64]*i[r][c+v+u+64])-(_=t[63-v]*i[r][c+v+u+192]),f+=_,h-=4,n[l][h+0]=m+f,n[l][h+2]=m-f,n[l][h+1]=p+g,n[l][h+3]=p-g,p=(m=t[v+1]*i[r][c+v+u+1])-(_=t[126-v]*i[r][c+v+u+129]),m+=_,g=(f=t[v+65]*i[r][c+v+u+65])-(_=t[62-v]*i[r][c+v+u+193]),f+=_,n[l][h+o.BLKSIZE_s/2+0]=m+f,n[l][h+o.BLKSIZE_s/2+2]=m-f,n[l][h+o.BLKSIZE_s/2+1]=p+g,n[l][h+o.BLKSIZE_s/2+3]=p-g}while(--d>=0);s(n[l],h,o.BLKSIZE_s/2)}},this.fft_long=function(t,n,r,i,c){var l=o.BLKSIZE/8-1,h=o.BLKSIZE/2;do{var u,d,m,p,f,g=255&a[l];d=(u=e[g]*i[r][c+g])-(f=e[g+512]*i[r][c+g+512]),u+=f,p=(m=e[g+256]*i[r][c+g+256])-(f=e[g+768]*i[r][c+g+768]),m+=f,n[(h-=4)+0]=u+m,n[h+2]=u-m,n[h+1]=d+p,n[h+3]=d-p,d=(u=e[g+1]*i[r][c+g+1])-(f=e[g+513]*i[r][c+g+513]),u+=f,p=(m=e[g+257]*i[r][c+g+257])-(f=e[g+769]*i[r][c+g+769]),m+=f,n[h+o.BLKSIZE/2+0]=u+m,n[h+o.BLKSIZE/2+2]=u-m,n[h+o.BLKSIZE/2+1]=d+p,n[h+o.BLKSIZE/2+3]=d-p}while(--l>=0);s(n,h,o.BLKSIZE/2)},this.init_fft=function(n){for(var s=0;s<o.BLKSIZE;s++)e[s]=.42-.5*Math.cos(2*Math.PI*(s+.5)/o.BLKSIZE)+.08*Math.cos(4*Math.PI*(s+.5)/o.BLKSIZE);for(s=0;s<o.BLKSIZE_s/2;s++)t[s]=.5*(1-Math.cos(2*Math.PI*(s+.5)/o.BLKSIZE_s))}}},51287:(e,t,n)=>{var s=n(51038),r=s.System,i=(s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays);s.new_array_n,s.new_byte,s.new_double,s.new_float,s.new_float_n,s.new_int,s.new_int_n,s.assert;function o(){o.YULE_ORDER,o.MAX_SAMP_FREQ;var e=o.RMS_WINDOW_TIME_NUMERATOR,t=o.RMS_WINDOW_TIME_DENOMINATOR,n=(o.MAX_SAMPLES_PER_WINDOW,[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]]),s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function a(e,t,n,s,r,i){for(;0!=r--;)n[s]=1e-10+e[t+0]*i[0]-n[s-1]*i[1]+e[t-1]*i[2]-n[s-2]*i[3]+e[t-2]*i[4]-n[s-3]*i[5]+e[t-3]*i[6]-n[s-4]*i[7]+e[t-4]*i[8]-n[s-5]*i[9]+e[t-5]*i[10]-n[s-6]*i[11]+e[t-6]*i[12]-n[s-7]*i[13]+e[t-7]*i[14]-n[s-8]*i[15]+e[t-8]*i[16]-n[s-9]*i[17]+e[t-9]*i[18]-n[s-10]*i[19]+e[t-10]*i[20],++s,++t}function c(e,t,n,s,r,i){for(;0!=r--;)n[s]=e[t+0]*i[0]-n[s-1]*i[1]+e[t-1]*i[2]-n[s-2]*i[3]+e[t-2]*i[4],++s,++t}function l(e){return e*e}this.InitGainAnalysis=function(n,s){return function(n,s){for(var r=0;r<MAX_ORDER;r++)n.linprebuf[r]=n.lstepbuf[r]=n.loutbuf[r]=n.rinprebuf[r]=n.rstepbuf[r]=n.routbuf[r]=0;switch(0|s){case 48e3:n.reqindex=0;break;case 44100:n.reqindex=1;break;case 32e3:n.reqindex=2;break;case 24e3:n.reqindex=3;break;case 22050:n.reqindex=4;break;case 16e3:n.reqindex=5;break;case 12e3:n.reqindex=6;break;case 11025:n.reqindex=7;break;case 8e3:n.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return n.sampleWindow=0|(s*e+t-1)/t,n.lsum=0,n.rsum=0,n.totsamp=0,i.ill(n.A,0),INIT_GAIN_ANALYSIS_OK}(n,s)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(n.linpre=MAX_ORDER,n.rinpre=MAX_ORDER,n.lstep=MAX_ORDER,n.rstep=MAX_ORDER,n.lout=MAX_ORDER,n.rout=MAX_ORDER,i.fill(n.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(e,t,i,h,u,d,m){var p,f,g,_,v,b,y;if(0==d)return GAIN_ANALYSIS_OK;switch(y=0,v=d,m){case 1:h=t,u=i;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(d<MAX_ORDER?(r.arraycopy(t,i,e.linprebuf,MAX_ORDER,d),r.arraycopy(h,u,e.rinprebuf,MAX_ORDER,d)):(r.arraycopy(t,i,e.linprebuf,MAX_ORDER,MAX_ORDER),r.arraycopy(h,u,e.rinprebuf,MAX_ORDER,MAX_ORDER));v>0;){b=v>e.sampleWindow-e.totsamp?e.sampleWindow-e.totsamp:v,y<MAX_ORDER?(p=e.linpre+y,f=e.linprebuf,g=e.rinpre+y,_=e.rinprebuf,b>MAX_ORDER-y&&(b=MAX_ORDER-y)):(p=i+y,f=t,g=u+y,_=h),a(f,p,e.lstepbuf,e.lstep+e.totsamp,b,n[e.reqindex]),a(_,g,e.rstepbuf,e.rstep+e.totsamp,b,n[e.reqindex]),c(e.lstepbuf,e.lstep+e.totsamp,e.loutbuf,e.lout+e.totsamp,b,s[e.reqindex]),c(e.rstepbuf,e.rstep+e.totsamp,e.routbuf,e.rout+e.totsamp,b,s[e.reqindex]),p=e.lout+e.totsamp,f=e.loutbuf,g=e.rout+e.totsamp,_=e.routbuf;for(var w=b%8;0!=w--;)e.lsum+=l(f[p++]),e.rsum+=l(_[g++]);for(w=b/8;0!=w--;)e.lsum+=l(f[p+0])+l(f[p+1])+l(f[p+2])+l(f[p+3])+l(f[p+4])+l(f[p+5])+l(f[p+6])+l(f[p+7]),p+=8,e.rsum+=l(_[g+0])+l(_[g+1])+l(_[g+2])+l(_[g+3])+l(_[g+4])+l(_[g+5])+l(_[g+6])+l(_[g+7]),g+=8;if(v-=b,y+=b,e.totsamp+=b,e.totsamp==e.sampleWindow){var k=10*o.STEPS_per_dB*Math.log10((e.lsum+e.rsum)/e.totsamp*.5+1e-37),x=k<=0?0:0|k;x>=e.A.length&&(x=e.A.length-1),e.A[x]++,e.lsum=e.rsum=0,r.arraycopy(e.loutbuf,e.totsamp,e.loutbuf,0,MAX_ORDER),r.arraycopy(e.routbuf,e.totsamp,e.routbuf,0,MAX_ORDER),r.arraycopy(e.lstepbuf,e.totsamp,e.lstepbuf,0,MAX_ORDER),r.arraycopy(e.rstepbuf,e.totsamp,e.rstepbuf,0,MAX_ORDER),e.totsamp=0}if(e.totsamp>e.sampleWindow)return GAIN_ANALYSIS_ERROR}return d<MAX_ORDER?(r.arraycopy(e.linprebuf,d,e.linprebuf,0,MAX_ORDER-d),r.arraycopy(e.rinprebuf,d,e.rinprebuf,0,MAX_ORDER-d),r.arraycopy(t,i,e.linprebuf,MAX_ORDER-d,d),r.arraycopy(h,u,e.rinprebuf,MAX_ORDER-d,d)):(r.arraycopy(t,i+d-MAX_ORDER,e.linprebuf,0,MAX_ORDER),r.arraycopy(h,u+d-MAX_ORDER,e.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){for(var t=function(e,t){var n,s=0;for(n=0;n<t;n++)s+=e[n];if(0==s)return GAIN_NOT_ENOUGH_SAMPLES;var r=0|Math.ceil(s*(1-.95));for(n=t;n-- >0&&!((r-=e[n])<=0););return 64.82-n/o.STEPS_per_dB}(e.A,e.A.length),n=0;n<e.A.length;n++)e.B[n]+=e.A[n],e.A[n]=0;for(n=0;n<MAX_ORDER;n++)e.linprebuf[n]=e.lstepbuf[n]=e.loutbuf[n]=e.rinprebuf[n]=e.rstepbuf[n]=e.routbuf[n]=0;return e.totsamp=0,e.lsum=e.rsum=0,t}}o.STEPS_per_dB=100,o.MAX_dB=120,o.GAIN_NOT_ENOUGH_SAMPLES=-24601,o.GAIN_ANALYSIS_ERROR=0,o.GAIN_ANALYSIS_OK=1,o.INIT_GAIN_ANALYSIS_ERROR=0,o.INIT_GAIN_ANALYSIS_OK=1,o.YULE_ORDER=10,o.MAX_ORDER=o.YULE_ORDER,o.MAX_SAMP_FREQ=48e3,o.RMS_WINDOW_TIME_NUMERATOR=1,o.RMS_WINDOW_TIME_DENOMINATOR=20,o.MAX_SAMPLES_PER_WINDOW=o.MAX_SAMP_FREQ*o.RMS_WINDOW_TIME_NUMERATOR/o.RMS_WINDOW_TIME_DENOMINATOR+1,e.exports=o},29438:(e,t,n)=>{var s=n(51038),r=(s.System,s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays,s.new_array_n,s.new_byte,s.new_double,s.new_float),i=(s.new_float_n,s.new_int),o=(s.new_int_n,s.assert,n(90354));e.exports=function(){this.xr=r(576),this.l3_enc=i(576),this.scalefac=i(o.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=i(3),this.subblock_gain=i(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=i(o.SFBMAX),this.window=i(o.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=i(4),this.max_nonzero_coeff=0;var e=this;function t(e){return new Int32Array(e)}this.assign=function(n){var s;e.xr=(s=n.xr,new Float32Array(s)),e.l3_enc=t(n.l3_enc),e.scalefac=t(n.scalefac),e.xrpow_max=n.xrpow_max,e.part2_3_length=n.part2_3_length,e.big_values=n.big_values,e.count1=n.count1,e.global_gain=n.global_gain,e.scalefac_compress=n.scalefac_compress,e.block_type=n.block_type,e.mixed_block_flag=n.mixed_block_flag,e.table_select=t(n.table_select),e.subblock_gain=t(n.subblock_gain),e.region0_count=n.region0_count,e.region1_count=n.region1_count,e.preflag=n.preflag,e.scalefac_scale=n.scalefac_scale,e.count1table_select=n.count1table_select,e.part2_length=n.part2_length,e.sfb_lmax=n.sfb_lmax,e.sfb_smin=n.sfb_smin,e.psy_lmax=n.psy_lmax,e.sfbmax=n.sfbmax,e.psymax=n.psymax,e.sfbdivide=n.sfbdivide,e.width=t(n.width),e.window=t(n.window),e.count1bits=n.count1bits,e.sfb_partition_table=n.sfb_partition_table.slice(0),e.slen=t(n.slen),e.max_nonzero_coeff=n.max_nonzero_coeff}}},29524:(e,t,n)=>{var s=n(51038),r=(s.System,s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays,s.new_array_n,s.new_byte,s.new_double,s.new_float,s.new_float_n,s.new_int),i=(s.new_int_n,s.assert,n(29438));e.exports=function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[r(4),r(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new i}},99584:(e,t,n)=>{var s=n(28200);e.exports=function(){this.thm=new s,this.en=new s}},28200:(e,t,n)=>{var s=n(60687),r=n(51038),i=r.System,o=(r.VbrMode,r.Float,r.ShortBlock,r.Util,r.Arrays,r.new_array_n,r.new_byte,r.new_double,r.new_float),a=r.new_float_n;r.new_int,r.new_int_n,r.assert;e.exports=function(){this.l=o(s.SBMAX_l),this.s=a([s.SBMAX_s,3]);var e=this;this.assign=function(t){i.arraycopy(t.l,0,e.l,0,s.SBMAX_l);for(var n=0;n<s.SBMAX_s;n++)for(var r=0;r<3;r++)e.s[n][r]=t.s[n][r]}}},90354:(e,t,n)=>{var s=n(60687),r={};r.SFBMAX=3*s.SBMAX_s,e.exports=r},64566:(e,t,n)=>{var s=n(51038),r=s.System,i=s.VbrMode,o=(s.Float,s.ShortBlock),a=(s.Util,s.Arrays,s.new_array_n,s.new_byte,s.new_double,s.new_float),c=(s.new_float_n,s.new_int,s.new_int_n),l=s.new_short_n,h=s.assert,u=n(99319),d=n(23893),m=n(91998),p=n(97514),f=n(41062),g=n(49120),_=n(3724),v=n(77721),b=n(60687);e.exports=function e(){var t,n,s,y,w,k=this;e.V9=410,e.V8=420,e.V7=430,e.V6=440,e.V5=450,e.V4=460,e.V3=470,e.V2=480,e.V1=490,e.V0=500,e.R3MIX=1e3,e.STANDARD=1001,e.EXTREME=1002,e.INSANE=1003,e.STANDARD_FAST=1004,e.EXTREME_FAST=1005,e.MEDIUM=1006,e.MEDIUM_FAST=1007,e.LAME_MAXMP3BUFFER=147456;var x,E,S,T=new u;function C(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=a(b.SBMAX_l),this.bo_s_weight=a(b.SBMAX_s)}function I(){this.lowerlimit=0}function R(e,t){this.lowpass=t}this.enc=new b,this.setModules=function(e,r,i,o,a,c,l,h,u){t=e,n=r,s=i,y=o,w=a,x=c,l,E=h,S=u,this.enc.setModules(n,T,y,x)};var A=4294479419;function M(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function N(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:case 11025:return t.version=0,0;case 24e3:case 12e3:return t.version=0,1;case 16e3:case 8e3:return t.version=0,2;default:return t.version=0,-1}}function P(e,t,n){n<16e3&&(t=2);for(var s=v.bitrate_table[t][1],r=2;r<=14;r++)v.bitrate_table[t][r]>0&&Math.abs(v.bitrate_table[t][r]-e)<Math.abs(s-e)&&(s=v.bitrate_table[t][r]);return s}function B(e,t,n){n<16e3&&(t=2);for(var s=0;s<=14;s++)if(v.bitrate_table[t][s]>0&&v.bitrate_table[t][s]==e)return s;return-1}function D(e,t){var n=[new R(8,2e3),new R(16,3700),new R(24,3900),new R(32,5500),new R(40,7e3),new R(48,7500),new R(56,1e4),new R(64,11e3),new R(80,13500),new R(96,15100),new R(112,15600),new R(128,17e3),new R(160,17500),new R(192,18600),new R(224,19400),new R(256,19700),new R(320,20500)],s=k.nearestBitrateFullIndex(t);e.lowerlimit=n[s].lowpass}function O(e){var t=b.BLKSIZE+e.framesize-b.FFTOFFSET;return t=Math.max(t,512+e.framesize-32),h(m.MFSIZE>=t),t}function L(e,t,n,s,r,i){var o=k.enc.lame_encode_mp3_frame(e,t,n,s,r,i);return e.frameNum++,o}function V(){this.n_in=0,this.n_out=0}function F(){this.num_used=0}function U(e,t){return 0!=t?U(t,e%t):e}function j(e,t,n){var s=Math.PI*t;(e/=n)<0&&(e=0),e>1&&(e=1);var r=e-.5,i=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(r)<1e-9?s/Math.PI:i*Math.sin(n*s*r)/(Math.PI*n*r)}function q(e,t,n,s,r,i,o,c,l){var u,d,p=e.internal_flags,f=0,g=e.out_samplerate/U(e.out_samplerate,e.in_samplerate);g>m.BPC&&(g=m.BPC);var _=Math.abs(p.resample_ratio-Math.floor(.5+p.resample_ratio))<1e-4?1:0,v=1/p.resample_ratio;v>1&&(v=1);var b=31;0==b%2&&--b;var y=(b+=_)+1;if(0==p.fill_buffer_resample_init){for(p.inbuf_old[0]=a(y),p.inbuf_old[1]=a(y),u=0;u<=2*g;++u)p.blackfilt[u]=a(y);for(p.itime[0]=0,p.itime[1]=0,f=0;f<=2*g;f++){var w=0,k=(f-g)/(2*g);for(u=0;u<=b;u++)w+=p.blackfilt[f][u]=j(u-k,v,b);for(u=0;u<=b;u++)p.blackfilt[f][u]/=w}p.fill_buffer_resample_init=1}var x=p.inbuf_old[l];for(d=0;d<s;d++){var E,S;if(E=d*p.resample_ratio,b+(f=0|Math.floor(E-p.itime[l]))-b/2>=o)break;k=E-p.itime[l]-(f+b%2*.5);h(Math.abs(k)<=.501),S=0|Math.floor(2*k*g+g+.5);var T=0;for(u=0;u<=b;++u){var C=u+f-b/2;h(C<o),h(C+y>=0),T+=(C<0?x[y+C]:r[i+C])*p.blackfilt[S][u]}t[n+d]=T}if(c.num_used=Math.min(o,b+f-b/2),p.itime[l]+=c.num_used-d*p.resample_ratio,c.num_used>=y)for(u=0;u<y;u++)x[u]=r[i+c.num_used+u-y];else{var I=y-c.num_used;for(u=0;u<I;++u)x[u]=x[u+c.num_used];for(f=0;u<y;++u,++f)x[u]=r[i+f];h(f==c.num_used)}return d}function H(e,t,n,s,r,i){var o=e.internal_flags;if(o.resample_ratio<.9999||o.resample_ratio>1.0001)for(var a=0;a<o.channels_out;a++){var c=new F;i.n_out=q(e,t[a],o.mf_size,e.framesize,n[a],s,r,c,a),i.n_in=c.num_used}else{i.n_out=Math.min(e.framesize,r),i.n_in=i.n_out;for(var l=0;l<i.n_out;++l)t[0][o.mf_size+l]=n[0][s+l],2==o.channels_out&&(t[1][o.mf_size+l]=n[1][s+l])}}this.lame_init=function(){var e=new d,t=function(e){var t;return e.class_id=A,t=e.internal_flags=new m,e.mode=MPEGMode.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=i.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=b.ENCDELAY+b.POSTDELAY,e.encoder_padding=0,t.mf_size=b.ENCDELAY-b.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0}(e);return 0!=t?null:(e.lame_allocated_gfp=1,e)},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],n=0,s=0,r=0,i=0;i=t[16],r=16,s=t[16],n=16;for(var o=0;o<16;o++)if(Math.max(e,t[o+1])!=e){i=t[o+1],r=o+1,s=t[o],n=o;break}return i-e>e-s?n:r},this.lame_init_params=function(e){var a,l,d,m=e.internal_flags;if(m.Class_ID=0,null==m.ATH&&(m.ATH=new p),null==m.PSY&&(m.PSY=new C),null==m.rgdata&&(m.rgdata=new f),m.channels_in=e.num_channels,1==m.channels_in&&(e.mode=MPEGMode.MONO),m.channels_out=e.mode==MPEGMode.MONO?1:2,m.mode_ext=b.MPG_MD_MS_LR,e.mode==MPEGMode.MONO&&(e.force_ms=!1),e.VBR==i.vbr_off&&128!=e.VBR_mean_bitrate_kbps&&0==e.brate&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR==i.vbr_off||e.VBR==i.vbr_mtrh||e.VBR==i.vbr_mt||(e.free_format=!1),e.VBR==i.vbr_off&&0==e.brate&&_.EQ(e.compression_ratio,0)&&(e.compression_ratio=11.025),e.VBR==i.vbr_off&&e.compression_ratio>0&&(0==e.out_samplerate&&(e.out_samplerate=map2MP3Frequency(int(.97*e.in_samplerate))),e.brate=0|16*e.out_samplerate*m.channels_out/(1e3*e.compression_ratio),m.samplerate_index=N(e.out_samplerate,e),e.free_format||(e.brate=P(e.brate,e.version,e.out_samplerate))),0!=e.out_samplerate&&(e.out_samplerate<16e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,64)):e.out_samplerate<32e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,160)):(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,32),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320))),0==e.lowpassfreq){var k=16e3;switch(e.VBR){case i.vbr_off:D(R=new I,e.brate),k=R.lowerlimit;break;case i.vbr_abr:var R;D(R=new I,e.VBR_mean_bitrate_kbps),k=R.lowerlimit;break;case i.vbr_rh:var O=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var L=O[e.VBR_q],V=O[e.VBR_q+1],F=e.VBR_q_frac;k=linear_int(L,V,F)}else k=19500;break;default:O=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=e.VBR_q&&e.VBR_q<=9){L=O[e.VBR_q],V=O[e.VBR_q+1],F=e.VBR_q_frac;k=linear_int(L,V,F)}else k=19500}e.mode!=MPEGMode.MONO||e.VBR!=i.vbr_off&&e.VBR!=i.vbr_abr||(k*=1.5),e.lowpassfreq=0|k}if(0==e.out_samplerate&&(2*e.lowpassfreq>e.in_samplerate&&(e.lowpassfreq=e.in_samplerate/2),e.out_samplerate=(a=0|e.lowpassfreq,l=e.in_samplerate,d=44100,l>=48e3?d=48e3:l>=44100?d=44100:l>=32e3?d=32e3:l>=24e3?d=24e3:l>=22050?d=22050:l>=16e3?d=16e3:l>=12e3?d=12e3:l>=11025?d=11025:l>=8e3&&(d=8e3),-1==a?d:(a<=15960&&(d=44100),a<=15250&&(d=32e3),a<=11220&&(d=24e3),a<=9970&&(d=22050),a<=7230&&(d=16e3),a<=5420&&(d=12e3),a<=4510&&(d=11025),a<=3970&&(d=8e3),l<d?l>44100?48e3:l>32e3?44100:l>24e3?32e3:l>22050?24e3:l>16e3?22050:l>12e3?16e3:l>11025?12e3:l>8e3?11025:8e3:d))),e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(e.out_samplerate/2,e.lowpassfreq),e.VBR==i.vbr_off&&(e.compression_ratio=16*e.out_samplerate*m.channels_out/(1e3*e.brate)),e.VBR==i.vbr_abr&&(e.compression_ratio=16*e.out_samplerate*m.channels_out/(1e3*e.VBR_mean_bitrate_kbps)),e.bWriteVbrTag||(e.findReplayGain=!1,e.decode_on_the_fly=!1,m.findPeakSample=!1),m.findReplayGain=e.findReplayGain,m.decode_on_the_fly=e.decode_on_the_fly,m.decode_on_the_fly&&(m.findPeakSample=!0),m.findReplayGain&&t.InitGainAnalysis(m.rgdata,e.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return e.internal_flags=null,-6;switch(m.decode_on_the_fly&&!e.decode_only&&(null!=m.hip&&S.hip_decode_exit(m.hip),m.hip=S.hip_decode_init()),m.mode_gr=e.out_samplerate<=24e3?1:2,e.framesize=576*m.mode_gr,e.encoder_delay=b.ENCDELAY,m.resample_ratio=e.in_samplerate/e.out_samplerate,e.VBR){case i.vbr_mt:case i.vbr_rh:case i.vbr_mtrh:e.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][e.VBR_q];break;case i.vbr_abr:e.compression_ratio=16*e.out_samplerate*m.channels_out/(1e3*e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio=16*e.out_samplerate*m.channels_out/(1e3*e.brate)}if(e.mode==MPEGMode.NOT_SET&&(e.mode=MPEGMode.JOINT_STEREO),e.highpassfreq>0?(m.highpass1=2*e.highpassfreq,e.highpasswidth>=0?m.highpass2=2*(e.highpassfreq+e.highpasswidth):m.highpass2=2*e.highpassfreq,m.highpass1/=e.out_samplerate,m.highpass2/=e.out_samplerate):(m.highpass1=0,m.highpass2=0),e.lowpassfreq>0?(m.lowpass2=2*e.lowpassfreq,e.lowpasswidth>=0?(m.lowpass1=2*(e.lowpassfreq-e.lowpasswidth),m.lowpass1<0&&(m.lowpass1=0)):m.lowpass1=2*e.lowpassfreq,m.lowpass1/=e.out_samplerate,m.lowpass2/=e.out_samplerate):(m.lowpass1=0,m.lowpass2=0),function(e){var t=e.internal_flags,n=32,s=-1;if(t.lowpass1>0){for(var i=999,o=0;o<=31;o++)(h=o/31)>=t.lowpass2&&(n=Math.min(n,o)),t.lowpass1<h&&h<t.lowpass2&&(i=Math.min(i,o));t.lowpass1=999==i?(n-.75)/31:(i-.75)/31,t.lowpass2=n/31}if(t.highpass2>0&&t.highpass2<.75/31*.9&&(t.highpass1=0,t.highpass2=0,r.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),t.highpass2>0){var a=-1;for(o=0;o<=31;o++)(h=o/31)<=t.highpass1&&(s=Math.max(s,o)),t.highpass1<h&&h<t.highpass2&&(a=Math.max(a,o));t.highpass1=s/31,t.highpass2=-1==a?(s+.75)/31:(a+.75)/31}for(o=0;o<32;o++){var c,l,h=o/31;c=t.highpass2>t.highpass1?M((t.highpass2-h)/(t.highpass2-t.highpass1+1e-20)):1,l=t.lowpass2>t.lowpass1?M((h-t.lowpass1)/(t.lowpass2-t.lowpass1+1e-20)):1,t.amp_filter[o]=c*l}}(e),m.samplerate_index=N(e.out_samplerate,e),m.samplerate_index<0)return e.internal_flags=null,-1;if(e.VBR==i.vbr_off){if(e.free_format)m.bitrate_index=0;else if(e.brate=P(e.brate,e.version,e.out_samplerate),m.bitrate_index=B(e.brate,e.version,e.out_samplerate),m.bitrate_index<=0)return e.internal_flags=null,-1}else m.bitrate_index=1;e.analysis&&(e.bWriteVbrTag=!1),null!=m.pinfo&&(e.bWriteVbrTag=!1),n.init_bit_stream_w(m);for(var U,j=m.samplerate_index+3*e.version+6*(e.out_samplerate<16e3?1:0),q=0;q<b.SBMAX_l+1;q++)m.scalefac_band.l[q]=y.sfBandIndex[j].l[q];for(q=0;q<b.PSFB21+1;q++){var H=(m.scalefac_band.l[22]-m.scalefac_band.l[21])/b.PSFB21,z=m.scalefac_band.l[21]+q*H;m.scalefac_band.psfb21[q]=z}m.scalefac_band.psfb21[b.PSFB21]=576;for(q=0;q<b.SBMAX_s+1;q++)m.scalefac_band.s[q]=y.sfBandIndex[j].s[q];for(q=0;q<b.PSFB12+1;q++){H=(m.scalefac_band.s[13]-m.scalefac_band.s[12])/b.PSFB12,z=m.scalefac_band.s[12]+q*H;m.scalefac_band.psfb12[q]=z}for(m.scalefac_band.psfb12[b.PSFB12]=192,1==e.version?m.sideinfo_len=1==m.channels_out?21:36:m.sideinfo_len=1==m.channels_out?13:21,e.error_protection&&(m.sideinfo_len+=2),function(e){var t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&E.id3tag_write_v2(e),t.bitrate_stereoMode_Hist=c([16,5]),t.bitrate_blockType_Hist=c([16,6]),t.PeakSample=0,e.bWriteVbrTag&&x.InitVbrTag(e)}(e),m.Class_ID=A,U=0;U<19;U++)m.nsPsy.pefirbuf[U]=700*m.mode_gr*m.channels_out;switch(-1==e.ATHtype&&(e.ATHtype=4),h(e.VBR_q<=9),h(e.VBR_q>=0),e.VBR){case i.vbr_mt:e.VBR=i.vbr_mtrh;case i.vbr_mtrh:null==e.useTemporal&&(e.useTemporal=!1),s.apply_preset(e,500-10*e.VBR_q,0),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),e.quality<5&&(e.quality=0),e.quality>5&&(e.quality=5),m.PSY.mask_adjust=e.maskingadjust,m.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?m.sfb21_extra=!1:m.sfb21_extra=e.out_samplerate>44e3,m.iteration_loop=new VBRNewIterationLoop(w);break;case i.vbr_rh:s.apply_preset(e,500-10*e.VBR_q,0),m.PSY.mask_adjust=e.maskingadjust,m.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?m.sfb21_extra=!1:m.sfb21_extra=e.out_samplerate>44e3,e.quality>6&&(e.quality=6),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),m.iteration_loop=new VBROldIterationLoop(w);break;default:var $;m.sfb21_extra=!1,e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),($=e.VBR)==i.vbr_off&&(e.VBR_mean_bitrate_kbps=e.brate),s.apply_preset(e,e.VBR_mean_bitrate_kbps,0),e.VBR=$,m.PSY.mask_adjust=e.maskingadjust,m.PSY.mask_adjust_short=e.maskingadjust_short,$==i.vbr_off?m.iteration_loop=new g(w):m.iteration_loop=new ABRIterationLoop(w)}if(h(e.scale>=0),e.VBR!=i.vbr_off){if(m.VBR_min_bitrate=1,m.VBR_max_bitrate=14,e.out_samplerate<16e3&&(m.VBR_max_bitrate=8),0!=e.VBR_min_bitrate_kbps&&(e.VBR_min_bitrate_kbps=P(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),m.VBR_min_bitrate=B(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),m.VBR_min_bitrate<0))return-1;if(0!=e.VBR_max_bitrate_kbps&&(e.VBR_max_bitrate_kbps=P(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),m.VBR_max_bitrate=B(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),m.VBR_max_bitrate<0))return-1;e.VBR_min_bitrate_kbps=v.bitrate_table[e.version][m.VBR_min_bitrate],e.VBR_max_bitrate_kbps=v.bitrate_table[e.version][m.VBR_max_bitrate],e.VBR_mean_bitrate_kbps=Math.min(v.bitrate_table[e.version][m.VBR_max_bitrate],e.VBR_mean_bitrate_kbps),e.VBR_mean_bitrate_kbps=Math.max(v.bitrate_table[e.version][m.VBR_min_bitrate],e.VBR_mean_bitrate_kbps)}return e.tune&&(m.PSY.mask_adjust+=e.tune_value_a,m.PSY.mask_adjust_short+=e.tune_value_a),function(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}(e),h(e.scale>=0),e.athaa_type<0?m.ATH.useAdjust=3:m.ATH.useAdjust=e.athaa_type,m.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),null==e.short_blocks&&(e.short_blocks=o.short_block_allowed),e.short_blocks!=o.short_block_allowed||e.mode!=MPEGMode.JOINT_STEREO&&e.mode!=MPEGMode.STEREO||(e.short_blocks=o.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<0&&(e.msfix=0),e.exp_nspsytune=1|e.exp_nspsytune,e.internal_flags.nsPsy.attackthre<0&&(e.internal_flags.nsPsy.attackthre=u.NSATTACKTHRE),e.internal_flags.nsPsy.attackthre_s<0&&(e.internal_flags.nsPsy.attackthre_s=u.NSATTACKTHRE_S),h(e.scale>=0),e.scale<0&&(e.scale=1),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<0&&(e.ATHcurve=4),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),null==e.useTemporal&&(e.useTemporal=!0),m.slot_lag=m.frac_SpF=0,e.VBR==i.vbr_off&&(m.slot_lag=m.frac_SpF=72e3*(e.version+1)*e.brate%e.out_samplerate|0),y.iteration_init(e),T.psymodel_init(e),h(e.scale>=0),0},this.lame_encode_flush=function(e,t,s,r){var i,o,a,c,h=e.internal_flags,u=l([2,1152]),d=0,m=h.mf_samples_to_encode-b.POSTDELAY,p=O(e);if(h.mf_samples_to_encode<1)return 0;for(i=0,e.in_samplerate!=e.out_samplerate&&(m+=16*e.out_samplerate/e.in_samplerate),(a=e.framesize-m%e.framesize)<576&&(a+=e.framesize),e.encoder_padding=a,c=(m+a)/e.framesize;c>0&&d>=0;){var f=p-h.mf_size,g=e.frameNum;f*=e.in_samplerate,(f/=e.out_samplerate)>1152&&(f=1152),f<1&&(f=1),o=r-i,0==r&&(o=0),s+=d=this.lame_encode_buffer(e,u[0],u[1],f,t,s,o),i+=d,c-=g!=e.frameNum?1:0}if(h.mf_samples_to_encode=0,d<0)return d;if(o=r-i,0==r&&(o=0),n.flush_bitstream(e),(d=n.copy_buffer(h,t,s,o,1))<0)return d;if(s+=d,o=r-(i+=d),0==r&&(o=0),e.write_id3tag_automatic){if(E.id3tag_write_v1(e),(d=n.copy_buffer(h,t,s,o,0))<0)return d;i+=d}return i},this.lame_encode_buffer=function(e,s,r,i,o,c,l){var u=e.internal_flags,d=[null,null];if(u.Class_ID!=A)return-3;if(0==i)return 0;!function(e,t){(null==e.in_buffer_0||e.in_buffer_nsamples<t)&&(e.in_buffer_0=a(t),e.in_buffer_1=a(t),e.in_buffer_nsamples=t)}(u,i),d[0]=u.in_buffer_0,d[1]=u.in_buffer_1;for(var p=0;p<i;p++)d[0][p]=s[p],u.channels_in>1&&(d[1][p]=r[p]);return function(e,s,r,i,o,a,c){var l,u,d,p,f,g=e.internal_flags,v=0,y=[null,null],w=[null,null];if(g.Class_ID!=A)return-3;if(0==i)return 0;if(f=n.copy_buffer(g,o,a,c,0),f<0)return f;if(a+=f,v+=f,w[0]=s,w[1]=r,_.NEQ(e.scale,0)&&_.NEQ(e.scale,1))for(u=0;u<i;++u)w[0][u]*=e.scale,2==g.channels_out&&(w[1][u]*=e.scale);if(_.NEQ(e.scale_left,0)&&_.NEQ(e.scale_left,1))for(u=0;u<i;++u)w[0][u]*=e.scale_left;if(_.NEQ(e.scale_right,0)&&_.NEQ(e.scale_right,1))for(u=0;u<i;++u)w[1][u]*=e.scale_right;if(2==e.num_channels&&1==g.channels_out)for(u=0;u<i;++u)w[0][u]=.5*(w[0][u]+w[1][u]),w[1][u]=0;p=O(e),y[0]=g.mfbuf[0],y[1]=g.mfbuf[1];var k=0;for(;i>0;){var x=[null,null],E=0,S=0;x[0]=w[0],x[1]=w[1];var T=new V;if(H(e,y,x,k,i,T),E=T.n_in,S=T.n_out,g.findReplayGain&&!g.decode_on_the_fly&&t.AnalyzeSamples(g.rgdata,y[0],g.mf_size,y[1],g.mf_size,S,g.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(i-=E,k+=E,g.channels_out,g.mf_size+=S,h(g.mf_size<=m.MFSIZE),g.mf_samples_to_encode<1&&(g.mf_samples_to_encode=b.ENCDELAY+b.POSTDELAY),g.mf_samples_to_encode+=S,g.mf_size>=p){var C=c-v;if(0==c&&(C=0),(l=L(e,y[0],y[1],o,a,C))<0)return l;for(a+=l,v+=l,g.mf_size-=e.framesize,g.mf_samples_to_encode-=e.framesize,d=0;d<g.channels_out;d++)for(u=0;u<g.mf_size;u++)y[d][u]=y[d][u+e.framesize]}}return h(0==i),v}(e,d[0],d[1],i,o,c,l)}}},23893:(e,t,n)=>{var s=n(88231);e.exports=function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=s.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}},91998:(e,t,n)=>{var s=n(51038),r=(s.System,s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays,s.new_array_n,s.new_byte),i=s.new_double,o=s.new_float,a=s.new_float_n,c=s.new_int,l=s.new_int_n,h=(s.assert,n(29524)),u=n(80302),d=n(87885),m=n(93362),p=n(28200),f=n(60687),g=n(90354);function _(){function e(){this.write_timing=0,this.ptr=0,this.buf=r(40)}this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=a([2,_.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new h,this.ms_ratio=o(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=c(2),this.CurrentStep=c(2),this.masking_lower=0,this.bv_scf=c(576),this.pseudohalf=c(g.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*_.BPC+1),this.itime=i(2),this.sideinfo_len=0,this.sb_sample=a([2,2,18,f.SBLIMIT]),this.amp_filter=o(32),this.header=new Array(_.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new u,this.minval_l=o(f.CBANDS),this.minval_s=o(f.CBANDS),this.nb_1=a([4,f.CBANDS]),this.nb_2=a([4,f.CBANDS]),this.nb_s1=a([4,f.CBANDS]),this.nb_s2=a([4,f.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=o(4),this.loudness_sq=a([2,2]),this.loudness_sq_save=o(2),this.mld_l=o(f.SBMAX_l),this.mld_s=o(f.SBMAX_s),this.bm_l=c(f.SBMAX_l),this.bo_l=c(f.SBMAX_l),this.bm_s=c(f.SBMAX_s),this.bo_s=c(f.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=l([f.CBANDS,2]),this.s3ind_s=l([f.CBANDS,2]),this.numlines_s=c(f.CBANDS),this.numlines_l=c(f.CBANDS),this.rnumlines_l=o(f.CBANDS),this.mld_cb_l=o(f.CBANDS),this.mld_cb_s=o(f.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=o(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=c(2),this.nsPsy=new d,this.VBR_seek_table=new m,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=l([16,5]),this.bitrate_blockType_Hist=l([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var t=0;t<this.en.length;t++)this.en[t]=new p;for(t=0;t<this.thm.length;t++)this.thm[t]=new p;for(t=0;t<this.header.length;t++)this.header[t]=new e}_.MFSIZE=3456+f.ENCDELAY-f.MDCTDELAY,_.MAX_HEADER_BUF=256,_.MAX_BITS_PER_CHANNEL=4095,_.MAX_BITS_PER_GRANULE=7680,_.BPC=320,e.exports=_},88231:e=>{function t(e){var t=e;this.ordinal=function(){return t}}t.STEREO=new t(0),t.JOINT_STEREO=new t(1),t.DUAL_CHANNEL=new t(2),t.MONO=new t(3),t.NOT_SET=new t(4),e.exports=t},23134:e=>{e.exports=function(e){this.bits=e}},82143:(e,t,n)=>{var s=n(51038),r=s.System,i=(s.VbrMode,s.Float,s.ShortBlock,s.Util),o=s.Arrays,a=(s.new_array_n,s.new_byte,s.new_double,s.new_float),c=(s.new_float_n,s.new_int,s.new_int_n,s.assert,n(60687));e.exports=function(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*i.SQRT2*.5/2384e-9,.017876148*i.SQRT2*.5/2384e-9,.003134727*i.SQRT2*.5/2384e-9,.002457142*i.SQRT2*.5/2384e-9,971317e-9*i.SQRT2*.5/2384e-9,218868e-9*i.SQRT2*.5/2384e-9,101566e-9*i.SQRT2*.5/2384e-9,13828e-9*i.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],t=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],n=t[c.SHORT_TYPE],s=t[c.SHORT_TYPE],l=t[c.SHORT_TYPE],h=t[c.SHORT_TYPE],u=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function d(t,n,s){for(var r,o,a,c=10,l=n+238-14-286,h=-15;h<0;h++){var u,d,m;u=e[c+-10],d=t[l+-224]*u,m=t[n+224]*u,u=e[c+-9],d+=t[l+-160]*u,m+=t[n+160]*u,u=e[c+-8],d+=t[l+-96]*u,m+=t[n+96]*u,u=e[c+-7],d+=t[l+-32]*u,m+=t[n+32]*u,u=e[c+-6],d+=t[l+32]*u,m+=t[n+-32]*u,u=e[c+-5],d+=t[l+96]*u,m+=t[n+-96]*u,u=e[c+-4],d+=t[l+160]*u,m+=t[n+-160]*u,u=e[c+-3],d+=t[l+224]*u,m+=t[n+-224]*u,u=e[c+-2],d+=t[n+-256]*u,m-=t[l+256]*u,u=e[c+-1],d+=t[n+-192]*u,m-=t[l+192]*u,u=e[c+0],d+=t[n+-128]*u,m-=t[l+128]*u,u=e[c+1],d+=t[n+-64]*u,m-=t[l+64]*u,u=e[c+2],d+=t[n+0]*u,m-=t[l+0]*u,u=e[c+3],d+=t[n+64]*u,m-=t[l+-64]*u,u=e[c+4],d+=t[n+128]*u,m-=t[l+-128]*u,u=e[c+5],d+=t[n+192]*u,u=(m-=t[l+-192]*u)-(d*=e[c+6]),s[30+2*h]=m+d,s[31+2*h]=e[c+7]*u,c+=18,n--,l++}m=t[n+-16]*e[c+-10],d=t[n+-32]*e[c+-2],m+=(t[n+-48]-t[n+16])*e[c+-9],d+=t[n+-96]*e[c+-1],m+=(t[n+-80]+t[n+48])*e[c+-8],d+=t[n+-160]*e[c+0],m+=(t[n+-112]-t[n+80])*e[c+-7],d+=t[n+-224]*e[c+1],m+=(t[n+-144]+t[n+112])*e[c+-6],d-=t[n+32]*e[c+2],m+=(t[n+-176]-t[n+144])*e[c+-5],d-=t[n+96]*e[c+3],m+=(t[n+-208]+t[n+176])*e[c+-4],d-=t[n+160]*e[c+4],m+=(t[n+-240]-t[n+208])*e[c+-3],r=(d-=t[n+224])-m,o=d+m,m=s[14],d=s[15]-m,s[31]=o+m,s[30]=r+d,s[15]=r-d,s[14]=o-m,a=s[28]-s[0],s[0]+=s[28],s[28]=a*e[c+-36+7],a=s[29]-s[1],s[1]+=s[29],s[29]=a*e[c+-36+7],a=s[26]-s[2],s[2]+=s[26],s[26]=a*e[c+-72+7],a=s[27]-s[3],s[3]+=s[27],s[27]=a*e[c+-72+7],a=s[24]-s[4],s[4]+=s[24],s[24]=a*e[c+-108+7],a=s[25]-s[5],s[5]+=s[25],s[25]=a*e[c+-108+7],a=s[22]-s[6],s[6]+=s[22],s[22]=a*i.SQRT2,a=s[23]-s[7],s[7]+=s[23],s[23]=a*i.SQRT2-s[7],s[7]-=s[6],s[22]-=s[7],s[23]-=s[22],a=s[6],s[6]=s[31]-a,s[31]=s[31]+a,a=s[7],s[7]=s[30]-a,s[30]=s[30]+a,a=s[22],s[22]=s[15]-a,s[15]=s[15]+a,a=s[23],s[23]=s[14]-a,s[14]=s[14]+a,a=s[20]-s[8],s[8]+=s[20],s[20]=a*e[c+-180+7],a=s[21]-s[9],s[9]+=s[21],s[21]=a*e[c+-180+7],a=s[18]-s[10],s[10]+=s[18],s[18]=a*e[c+-216+7],a=s[19]-s[11],s[11]+=s[19],s[19]=a*e[c+-216+7],a=s[16]-s[12],s[12]+=s[16],s[16]=a*e[c+-252+7],a=s[17]-s[13],s[13]+=s[17],s[17]=a*e[c+-252+7],a=-s[20]+s[24],s[20]+=s[24],s[24]=a*e[c+-216+7],a=-s[21]+s[25],s[21]+=s[25],s[25]=a*e[c+-216+7],a=s[4]-s[8],s[4]+=s[8],s[8]=a*e[c+-216+7],a=s[5]-s[9],s[5]+=s[9],s[9]=a*e[c+-216+7],a=s[0]-s[12],s[0]+=s[12],s[12]=a*e[c+-72+7],a=s[1]-s[13],s[1]+=s[13],s[13]=a*e[c+-72+7],a=s[16]-s[28],s[16]+=s[28],s[28]=a*e[c+-72+7],a=-s[17]+s[29],s[17]+=s[29],s[29]=a*e[c+-72+7],a=i.SQRT2*(s[2]-s[10]),s[2]+=s[10],s[10]=a,a=i.SQRT2*(s[3]-s[11]),s[3]+=s[11],s[11]=a,a=i.SQRT2*(-s[18]+s[26]),s[18]+=s[26],s[26]=a-s[18],a=i.SQRT2*(-s[19]+s[27]),s[19]+=s[27],s[27]=a-s[19],a=s[2],s[19]-=s[3],s[3]-=a,s[2]=s[31]-a,s[31]+=a,a=s[3],s[11]-=s[19],s[18]-=a,s[3]=s[30]-a,s[30]+=a,a=s[18],s[27]-=s[11],s[19]-=a,s[18]=s[15]-a,s[15]+=a,a=s[19],s[10]-=a,s[19]=s[14]-a,s[14]+=a,a=s[10],s[11]-=a,s[10]=s[23]-a,s[23]+=a,a=s[11],s[26]-=a,s[11]=s[22]-a,s[22]+=a,a=s[26],s[27]-=a,s[26]=s[7]-a,s[7]+=a,a=s[27],s[27]=s[6]-a,s[6]+=a,a=i.SQRT2*(s[0]-s[4]),s[0]+=s[4],s[4]=a,a=i.SQRT2*(s[1]-s[5]),s[1]+=s[5],s[5]=a,a=i.SQRT2*(s[16]-s[20]),s[16]+=s[20],s[20]=a,a=i.SQRT2*(s[17]-s[21]),s[17]+=s[21],s[21]=a,a=-i.SQRT2*(s[8]-s[12]),s[8]+=s[12],s[12]=a-s[8],a=-i.SQRT2*(s[9]-s[13]),s[9]+=s[13],s[13]=a-s[9],a=-i.SQRT2*(s[25]-s[29]),s[25]+=s[29],s[29]=a-s[25],a=-i.SQRT2*(s[24]+s[28]),s[24]-=s[28],s[28]=a-s[24],a=s[24]-s[16],s[24]=a,a=s[20]-a,s[20]=a,a=s[28]-a,s[28]=a,a=s[25]-s[17],s[25]=a,a=s[21]-a,s[21]=a,a=s[29]-a,s[29]=a,a=s[17]-s[1],s[17]=a,a=s[9]-a,s[9]=a,a=s[25]-a,s[25]=a,a=s[5]-a,s[5]=a,a=s[21]-a,s[21]=a,a=s[13]-a,s[13]=a,a=s[29]-a,s[29]=a,a=s[1]-s[0],s[1]=a,a=s[16]-a,s[16]=a,a=s[17]-a,s[17]=a,a=s[8]-a,s[8]=a,a=s[9]-a,s[9]=a,a=s[24]-a,s[24]=a,a=s[25]-a,s[25]=a,a=s[4]-a,s[4]=a,a=s[5]-a,s[5]=a,a=s[20]-a,s[20]=a,a=s[21]-a,s[21]=a,a=s[12]-a,s[12]=a,a=s[13]-a,s[13]=a,a=s[28]-a,s[28]=a,a=s[29]-a,s[29]=a,a=s[0],s[0]+=s[31],s[31]-=a,a=s[1],s[1]+=s[30],s[30]-=a,a=s[16],s[16]+=s[15],s[15]-=a,a=s[17],s[17]+=s[14],s[14]-=a,a=s[8],s[8]+=s[23],s[23]-=a,a=s[9],s[9]+=s[22],s[22]-=a,a=s[24],s[24]+=s[7],s[7]-=a,a=s[25],s[25]+=s[6],s[6]-=a,a=s[4],s[4]+=s[27],s[27]-=a,a=s[5],s[5]+=s[26],s[26]-=a,a=s[20],s[20]+=s[11],s[11]-=a,a=s[21],s[21]+=s[10],s[10]-=a,a=s[12],s[12]+=s[19],s[19]-=a,a=s[13],s[13]+=s[18],s[18]-=a,a=s[28],s[28]+=s[3],s[3]-=a,a=s[29],s[29]+=s[2],s[2]-=a}function m(e,n){for(var s=0;s<3;s++){var r,i,o,a,l,h;i=(a=e[n+6]*t[c.SHORT_TYPE][0]-e[n+15])+(r=e[n+0]*t[c.SHORT_TYPE][2]-e[n+9]),o=a-r,l=(a=e[n+15]*t[c.SHORT_TYPE][0]+e[n+6])+(r=e[n+9]*t[c.SHORT_TYPE][2]+e[n+0]),h=-a+r,r=2069978111953089e-26*(e[n+3]*t[c.SHORT_TYPE][1]-e[n+12]),a=2069978111953089e-26*(e[n+12]*t[c.SHORT_TYPE][1]+e[n+3]),e[n+0]=190752519173728e-25*i+r,e[n+15]=190752519173728e-25*-l+a,o=.8660254037844387*o*1907525191737281e-26,l=.5*l*1907525191737281e-26+a,e[n+3]=o-l,e[n+6]=o+l,i=.5*i*1907525191737281e-26-r,h=.8660254037844387*h*1907525191737281e-26,e[n+9]=i+h,e[n+12]=i-h,n++}}this.mdct_sub48=function(e,i,p){for(var f,g,_,v,b,y,w,k,x,E,S,T,C,I,R,A,M,N,P,B,D,O=i,L=286,V=0;V<e.channels_out;V++){for(var F=0;F<e.mode_gr;F++){for(var U,j=e.l3_side.tt[F][V],q=j.xr,H=0,z=e.sb_sample[V][1-F],$=0,K=0;K<9;K++)for(d(O,L,z[$]),d(O,L+32,z[$+1]),$+=2,L+=64,U=1;U<32;U+=2)z[$-1][U]*=-1;for(U=0;U<32;U++,H+=18){var G=j.block_type,W=e.sb_sample[V][F],Y=e.sb_sample[V][1-F];if(0!=j.mixed_block_flag&&U<2&&(G=0),e.amp_filter[U]<1e-12)o.fill(q,H+0,H+18,0);else{if(e.amp_filter[U]<1)for(K=0;K<18;K++)Y[K][u[U]]*=e.amp_filter[U];if(G==c.SHORT_TYPE){for(K=-3;K<0;K++){var X=t[c.SHORT_TYPE][K+3];q[H+3*K+9]=W[9+K][u[U]]*X-W[8-K][u[U]],q[H+3*K+18]=W[14-K][u[U]]*X+W[15+K][u[U]],q[H+3*K+10]=W[15+K][u[U]]*X-W[14-K][u[U]],q[H+3*K+19]=Y[2-K][u[U]]*X+Y[3+K][u[U]],q[H+3*K+11]=Y[3+K][u[U]]*X-Y[2-K][u[U]],q[H+3*K+20]=Y[8-K][u[U]]*X+Y[9+K][u[U]]}m(q,H)}else{var Q=a(18);for(K=-9;K<0;K++){var Z,J;Z=t[G][K+27]*Y[K+9][u[U]]+t[G][K+36]*Y[8-K][u[U]],J=t[G][K+9]*W[K+9][u[U]]-t[G][K+18]*W[8-K][u[U]],Q[K+9]=Z-J*n[3+K+9],Q[K+18]=Z*n[3+K+9]+J}f=q,g=H,v=void 0,b=void 0,y=void 0,w=void 0,k=void 0,x=void 0,E=void 0,S=void 0,T=void 0,C=void 0,I=void 0,R=void 0,A=void 0,M=void 0,N=void 0,P=void 0,B=void 0,D=void 0,y=(_=Q)[17]-_[9],k=_[15]-_[11],x=_[14]-_[12],E=_[0]+_[8],S=_[1]+_[7],T=_[2]+_[6],C=_[3]+_[5],f[g+17]=E+T-C-(S-_[4]),b=(E+T-C)*s[19]+(S-_[4]),v=(y-k-x)*s[18],f[g+5]=v+b,f[g+6]=v-b,w=(_[16]-_[10])*s[18],S=S*s[19]+_[4],v=y*s[12]+w+k*s[13]+x*s[14],b=-E*s[16]+S-T*s[17]+C*s[15],f[g+1]=v+b,f[g+2]=v-b,v=y*s[13]-w-k*s[14]+x*s[12],b=-E*s[17]+S-T*s[15]+C*s[16],f[g+9]=v+b,f[g+10]=v-b,v=y*s[14]-w+k*s[12]-x*s[13],b=E*s[15]-S+T*s[16]-C*s[17],f[g+13]=v+b,f[g+14]=v-b,I=_[8]-_[0],A=_[6]-_[2],M=_[5]-_[3],N=_[17]+_[9],P=_[16]+_[10],B=_[15]+_[11],D=_[14]+_[12],f[g+0]=N+B+D+(P+_[13]),v=(N+B+D)*s[19]-(P+_[13]),b=(I-A+M)*s[18],f[g+11]=v+b,f[g+12]=v-b,R=(_[7]-_[1])*s[18],P=_[13]-P*s[19],v=N*s[15]-P+B*s[16]+D*s[17],b=I*s[14]+R+A*s[12]+M*s[13],f[g+3]=v+b,f[g+4]=v-b,v=-N*s[17]+P-B*s[15]-D*s[16],b=I*s[13]+R-A*s[14]-M*s[12],f[g+7]=v+b,f[g+8]=v-b,v=-N*s[16]+P-B*s[17]-D*s[15],b=I*s[12]-R+A*s[13]-M*s[14],f[g+15]=v+b,f[g+16]=v-b}}if(G!=c.SHORT_TYPE&&0!=U)for(K=7;K>=0;--K){var ee,te;ee=q[H+K]*l[20+K]+q[H+-1-K]*h[28+K],te=q[H+K]*h[28+K]-q[H+-1-K]*l[20+K],q[H+-1-K]=ee,q[H+K]=te}}}if(O=p,L=286,1==e.mode_gr)for(var ne=0;ne<18;ne++)r.arraycopy(e.sb_sample[V][1][ne],0,e.sb_sample[V][0][ne],0,32)}}}},87885:(e,t,n)=>{var s=n(51038),r=(s.System,s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays,s.new_array_n,s.new_byte,s.new_double,s.new_float),i=s.new_float_n,o=s.new_int,a=(s.new_int_n,s.assert,n(60687));e.exports=function(){this.last_en_subshort=i([4,9]),this.lastAttacks=o(4),this.pefirbuf=r(19),this.longfact=r(a.SBMAX_l),this.shortfact=r(a.SBMAX_s),this.attackthre=0,this.attackthre_s=0}},79457:(e,t,n)=>{var s=n(51038),r=(s.System,s.VbrMode);s.Float,s.ShortBlock,s.Util,s.Arrays,s.new_array_n,s.new_byte,s.new_double,s.new_float,s.new_float_n,s.new_int,s.new_int_n,s.assert;e.exports=function(){function e(e,t,n,s,r,i,o,a,c,l,h,u,d,m,p){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=n,this.expY=s,this.st_lrm=r,this.st_s=i,this.masking_adj=o,this.masking_adj_short=a,this.ath_lower=c,this.ath_curve=l,this.ath_sensitivity=h,this.interch=u,this.safejoint=d,this.sfb21mod=m,this.msfix=p}function t(e,t,n,s,r,i,o,a,c,l,h,u,d,m){this.quant_comp=t,this.quant_comp_s=n,this.safejoint=s,this.nsmsfix=r,this.st_lrm=i,this.st_s=o,this.nsbass=a,this.scale=c,this.masking_adj=l,this.ath_lower=h,this.ath_curve=u,this.interch=d,this.sfscale=m}var n;this.setModules=function(e){n=e};var s=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],i=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function o(e,t,n){var o=e.VBR==r.vbr_rh?s:i,a=e.VBR_q_frac,c=o[t],l=o[t+1],h=c;c.st_lrm=c.st_lrm+a*(l.st_lrm-c.st_lrm),c.st_s=c.st_s+a*(l.st_s-c.st_s),c.masking_adj=c.masking_adj+a*(l.masking_adj-c.masking_adj),c.masking_adj_short=c.masking_adj_short+a*(l.masking_adj_short-c.masking_adj_short),c.ath_lower=c.ath_lower+a*(l.ath_lower-c.ath_lower),c.ath_curve=c.ath_curve+a*(l.ath_curve-c.ath_curve),c.ath_sensitivity=c.ath_sensitivity+a*(l.ath_sensitivity-c.ath_sensitivity),c.interch=c.interch+a*(l.interch-c.interch),c.msfix=c.msfix+a*(l.msfix-c.msfix),function(e,t){var n=0;0>t&&(n=-1,t=0);9<t&&(n=-1,t=9);e.VBR_q=t,e.VBR_q_frac=0}(e,h.vbr_q),0!=n?e.quant_comp=h.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=h.quant_comp),0!=n?e.quant_comp_short=h.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=h.quant_comp_s),0!=h.expY&&(e.experimentalY=0!=h.expY),0!=n?e.internal_flags.nsPsy.attackthre=h.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=h.st_lrm),0!=n?e.internal_flags.nsPsy.attackthre_s=h.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=h.st_s),0!=n?e.maskingadjust=h.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=h.masking_adj),0!=n?e.maskingadjust_short=h.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=h.masking_adj_short),0!=n?e.ATHlower=-h.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-h.ath_lower/10),0!=n?e.ATHcurve=h.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=h.ath_curve),0!=n?e.athaa_sensitivity=h.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=h.ath_sensitivity),h.interch>0&&(0!=n?e.interChRatio=h.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=h.interch)),h.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|h.safejoint),h.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|h.sfb21mod<<20),0!=n?e.msfix=h.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=h.msfix),0==n&&(e.VBR_q=t,e.VBR_q_frac=a)}var a=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function c(e,t,s){var i=t,o=n.nearestBitrateFullIndex(t);if(e.VBR=r.vbr_abr,e.VBR_mean_bitrate_kbps=i,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),a[o].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),a[o].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(a[o].nsbass)>0){var c=int(4*a[o].nsbass);c<0&&(c+=64),e.exp_nspsytune=e.exp_nspsytune|c<<2}return 0!=s?e.quant_comp=a[o].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=a[o].quant_comp),0!=s?e.quant_comp_short=a[o].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=a[o].quant_comp_s),0!=s?e.msfix=a[o].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=a[o].nsmsfix),0!=s?e.internal_flags.nsPsy.attackthre=a[o].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=a[o].st_lrm),0!=s?e.internal_flags.nsPsy.attackthre_s=a[o].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=a[o].st_s),0!=s?e.scale=a[o].scale:Math.abs(e.scale- -1)>0||(e.scale=a[o].scale),0!=s?e.maskingadjust=a[o].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=a[o].masking_adj),a[o].masking_adj>0?0!=s?e.maskingadjust_short=.9*a[o].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*a[o].masking_adj):0!=s?e.maskingadjust_short=1.1*a[o].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*a[o].masking_adj),0!=s?e.ATHlower=-a[o].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-a[o].ath_lower/10),0!=s?e.ATHcurve=a[o].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=a[o].ath_curve),0!=s?e.interChRatio=a[o].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=a[o].interch),t}this.apply_preset=function(e,t,n){switch(t){case Lame.R3MIX:t=Lame.V3,e.VBR=r.vbr_mtrh;break;case Lame.MEDIUM:t=Lame.V4,e.VBR=r.vbr_rh;break;case Lame.MEDIUM_FAST:t=Lame.V4,e.VBR=r.vbr_mtrh;break;case Lame.STANDARD:t=Lame.V2,e.VBR=r.vbr_rh;break;case Lame.STANDARD_FAST:t=Lame.V2,e.VBR=r.vbr_mtrh;break;case Lame.EXTREME:t=Lame.V0,e.VBR=r.vbr_rh;break;case Lame.EXTREME_FAST:t=Lame.V0,e.VBR=r.vbr_mtrh;break;case Lame.INSANE:return t=320,e.preset=t,c(e,t,n),e.VBR=r.vbr_off,t}switch(e.preset=t,t){case Lame.V9:return o(e,9,n),t;case Lame.V8:return o(e,8,n),t;case Lame.V7:return o(e,7,n),t;case Lame.V6:return o(e,6,n),t;case Lame.V5:return o(e,5,n),t;case Lame.V4:return o(e,4,n),t;case Lame.V3:return o(e,3,n),t;case Lame.V2:return o(e,2,n),t;case Lame.V1:return o(e,1,n),t;case Lame.V0:return o(e,0,n),t}return 8<=t&&t<=320?c(e,t,n):(e.preset=0,t)}}},99319:(e,t,n)=>{var s=n(51038),r=(s.System,s.VbrMode),i=s.Float,o=s.ShortBlock,a=s.Util,c=s.Arrays,l=(s.new_array_n,s.new_byte,s.new_double,s.new_float),h=s.new_float_n,u=s.new_int,d=(s.new_int_n,s.assert),m=n(19347),p=n(60687);e.exports=function(){var e=new m,t=2.302585092994046,n=1/217621504/(p.BLKSIZE/2),s=.3,f=21,g=.2302585093;function _(e,t){for(var s=0,r=0;r<p.BLKSIZE/2;++r)s+=e[r]*t.ATH.eql_w[r];return s*=n}function v(t,n,s,r,i,o,c,l,h,u,d){var m=t.internal_flags;if(h<2)e.fft_long(m,r[i],h,u,d),e.fft_short(m,o[c],h,u,d);else if(2==h){for(var f=p.BLKSIZE-1;f>=0;--f){var g=r[i+0][f],v=r[i+1][f];r[i+0][f]=(g+v)*a.SQRT2*.5,r[i+1][f]=(g-v)*a.SQRT2*.5}for(var b=2;b>=0;--b)for(f=p.BLKSIZE_s-1;f>=0;--f){g=o[c+0][b][f],v=o[c+1][b][f];o[c+0][b][f]=(g+v)*a.SQRT2*.5,o[c+1][b][f]=(g-v)*a.SQRT2*.5}}n[0]=r[i+0][0],n[0]*=n[0];for(f=p.BLKSIZE/2-1;f>=0;--f){var y=r[i+0][p.BLKSIZE/2-f],w=r[i+0][p.BLKSIZE/2+f];n[p.BLKSIZE/2-f]=.5*(y*y+w*w)}for(b=2;b>=0;--b){s[b][0]=o[c+0][b][0],s[b][0]*=s[b][0];for(f=p.BLKSIZE_s/2-1;f>=0;--f){y=o[c+0][b][p.BLKSIZE_s/2-f],w=o[c+0][b][p.BLKSIZE_s/2+f];s[b][p.BLKSIZE_s/2-f]=.5*(y*y+w*w)}}var k=0;for(f=11;f<p.HBLKSIZE;f++)k+=n[f];if(m.tot_ener[h]=k,t.analysis){for(f=0;f<p.HBLKSIZE;f++)m.pinfo.energy[l][h][f]=m.pinfo.energy_save[h][f],m.pinfo.energy_save[h][f]=n[f];m.pinfo.pe[l][h]=m.pe[h]}2==t.athaa_loudapprox&&h<2&&(m.loudness_sq[l][h]=m.loudness_sq_save[h],m.loudness_sq_save[h]=_(n,m))}var b,y,w,k=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],x=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],E=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],S=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276];function T(e,t,n,s,r,i){var o;if(t>e){if(!(t<e*y))return e+t;o=t/e}else{if(e>=t*y)return e+t;o=e/t}if(d(e>=0),d(t>=0),e+=t,s+3<=6){if(o>=b)return e;var c=0|a.FAST_LOG10_X(o,16);return e*E[c]}var l,h;c=0|a.FAST_LOG10_X(o,16);return t=0!=i?r.ATH.cb_s[n]*r.ATH.adjust:r.ATH.cb_l[n]*r.ATH.adjust,d(t>=0),e<w*t?e>t?(l=1,c<=13&&(l=S[c]),h=a.FAST_LOG10_X(e/t,10/15),e*((x[c]-l)*h+l)):c>13?e:e*S[c]:e*x[c]}var C=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1];function I(e,t,n){var s;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(s=t>e?t/e:e/t,-2<=n&&n<=2){if(s>=b)return e+t;var r=0|a.FAST_LOG10_X(s,16);return(e+t)*C[r]}return s<y?e+t:(e<t&&(e=t),e)}function R(e,t,n,s,r){var i,o,a=0,c=0;for(i=o=0;i<p.SBMAX_s;++o,++i){for(var l=e.bo_s[i],h=e.npart_s,u=l<h?l:h;o<u;)d(t[o]>=0),d(n[o]>=0),a+=t[o],c+=n[o],o++;if(e.en[s].s[i][r]=a,e.thm[s].s[i][r]=c,o>=h){++i;break}d(t[o]>=0),d(n[o]>=0);var m=e.PSY.bo_s_weight[i],f=1-m;a=m*t[o],c=m*n[o],e.en[s].s[i][r]+=a,e.thm[s].s[i][r]+=c,a=f*t[o],c=f*n[o]}for(;i<p.SBMAX_s;++i)e.en[s].s[i][r]=0,e.thm[s].s[i][r]=0}function A(e,t,n,s){var r,i,o=0,a=0;for(r=i=0;r<p.SBMAX_l;++i,++r){for(var c=e.bo_l[r],l=e.npart_l,h=c<l?c:l;i<h;)d(t[i]>=0),d(n[i]>=0),o+=t[i],a+=n[i],i++;if(e.en[s].l[r]=o,e.thm[s].l[r]=a,i>=l){++r;break}d(t[i]>=0),d(n[i]>=0);var u=e.PSY.bo_l_weight[r],m=1-u;o=u*t[i],a=u*n[i],e.en[s].l[r]+=o,e.thm[s].l[r]+=a,o=m*t[i],a=m*n[i]}for(;r<p.SBMAX_l;++r)e.en[s].l[r]=0,e.thm[s].l[r]=0}function M(e,t,n,s,r,i){var o,a,c=e.internal_flags;for(a=o=0;a<c.npart_s;++a){for(var l=0,h=0,u=c.numlines_s[a],m=0;m<u;++m,++o){var f=t[i][o];l+=f,h<f&&(h=f)}n[a]=l}for(d(a==c.npart_s),d(129==o),o=a=0;a<c.npart_s;a++){var g=c.s3ind_s[a][0],_=c.s3_ss[o++]*n[g];for(++g;g<=c.s3ind_s[a][1];)_+=c.s3_ss[o]*n[g],++o,++g;var v=2*c.nb_s1[r][a];if(s[a]=Math.min(_,v),c.blocktype_old[1&r]==p.SHORT_TYPE){v=16*c.nb_s2[r][a];var b=s[a];s[a]=Math.min(v,b)}c.nb_s2[r][a]=c.nb_s1[r][a],c.nb_s1[r][a]=_,d(s[a]>=0)}for(;a<=p.CBANDS;++a)n[a]=0,s[a]=0}function N(e,t,n){return n>=1?e:n<=0?t:t>0?Math.pow(e/t,n)*t:0}var P=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function B(e,n){for(var s=309.07,r=0;r<p.SBMAX_s-1;r++)for(var i=0;i<3;i++){var o=e.thm.s[r][i];if(d(r<P.length),o>0){var c=o*n,l=e.en.s[r][i];l>c&&(l>1e10*c?s+=P[r]*(10*t):(d(c>0),s+=P[r]*a.FAST_LOG10(l/c)))}}return s}var D=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function O(e,n){for(var s=281.0575,r=0;r<p.SBMAX_l-1;r++){var i=e.thm.l[r];if(d(r<D.length),i>0){var o=i*n,c=e.en.l[r];c>o&&(c>1e10*o?s+=D[r]*(10*t):(d(o>0),s+=D[r]*a.FAST_LOG10(c/o)))}}return s}function L(e,t,n,s,r){var i,o;for(i=o=0;i<e.npart_l;++i){var a,c=0,l=0;for(a=0;a<e.numlines_l[i];++a,++o){var h=t[o];d(h>=0),c+=h,l<h&&(l=h)}n[i]=c,s[i]=l,r[i]=c*e.rnumlines_l[i],d(e.rnumlines_l[i]>=0),d(c>=0),d(n[i]>=0),d(s[i]>=0),d(r[i]>=0)}}function V(e,t,n,s){var r=k.length-1,i=0,o=n[i]+n[i+1];(d(o>=0),o>0)?((a=t[i])<t[i+1]&&(a=t[i+1]),d(e.numlines_l[i]+e.numlines_l[i+1]-1>0),(c=0|(o=20*(2*a-o)/(o*(e.numlines_l[i]+e.numlines_l[i+1]-1))))>r&&(c=r),s[i]=c):s[i]=0;for(i=1;i<e.npart_l-1;i++){var a,c;if(o=n[i-1]+n[i]+n[i+1],d(o>=0),o>0)(a=t[i-1])<t[i]&&(a=t[i]),a<t[i+1]&&(a=t[i+1]),d(e.numlines_l[i-1]+e.numlines_l[i]+e.numlines_l[i+1]-1>0),(c=0|(o=20*(3*a-o)/(o*(e.numlines_l[i-1]+e.numlines_l[i]+e.numlines_l[i+1]-1))))>r&&(c=r),s[i]=c;else s[i]=0}(d(i>0),d(i==e.npart_l-1),o=n[i-1]+n[i],d(o>=0),o>0)?((a=t[i-1])<t[i]&&(a=t[i]),d(e.numlines_l[i-1]+e.numlines_l[i]-1>0),(c=0|(o=20*(2*a-o)/(o*(e.numlines_l[i-1]+e.numlines_l[i]-1))))>r&&(c=r),s[i]=c):s[i]=0;d(i==e.npart_l-1)}var F=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function U(t,n,s,r,i,o,c,l){var h=t.internal_flags;if(r<2)e.fft_long(h,c[l],r,n,s);else if(2==r)for(var u=p.BLKSIZE-1;u>=0;--u){var d=c[l+0][u],m=c[l+1][u];c[l+0][u]=(d+m)*a.SQRT2*.5,c[l+1][u]=(d-m)*a.SQRT2*.5}o[0]=c[l+0][0],o[0]*=o[0];for(u=p.BLKSIZE/2-1;u>=0;--u){var f=c[l+0][p.BLKSIZE/2-u],g=c[l+0][p.BLKSIZE/2+u];o[p.BLKSIZE/2-u]=.5*(f*f+g*g)}var _=0;for(u=11;u<p.HBLKSIZE;u++)_+=o[u];if(h.tot_ener[r]=_,t.analysis){for(u=0;u<p.HBLKSIZE;u++)h.pinfo.energy[i][r][u]=h.pinfo.energy_save[r][u],h.pinfo.energy_save[r][u]=o[u];h.pinfo.pe[i][r]=h.pe[r]}}function j(t,n,s,r,i,o,c,l){var h=t.internal_flags;if(0==i&&r<2&&e.fft_short(h,c[l],r,n,s),2==r)for(var u=p.BLKSIZE_s-1;u>=0;--u){var d=c[l+0][i][u],m=c[l+1][i][u];c[l+0][i][u]=(d+m)*a.SQRT2*.5,c[l+1][i][u]=(d-m)*a.SQRT2*.5}o[i][0]=c[l+0][i][0],o[i][0]*=o[i][0];for(u=p.BLKSIZE_s/2-1;u>=0;--u){var f=c[l+0][i][p.BLKSIZE_s/2-u],g=c[l+0][i][p.BLKSIZE_s/2+u];o[i][p.BLKSIZE_s/2-u]=.5*(f*f+g*g)}}function q(e,t,n,s){var r=e.internal_flags;2==e.athaa_loudapprox&&n<2&&(r.loudness_sq[t][n]=r.loudness_sq_save[n],r.loudness_sq_save[n]=_(s,r))}this.L3psycho_anal_ns=function(e,t,n,i,a,m,g,_,b,y){var w,x,E,S,C,I,P,D,U,j,q=e.internal_flags,H=h([2,p.BLKSIZE]),z=h([2,3,p.BLKSIZE_s]),$=l(p.CBANDS+1),K=l(p.CBANDS+1),G=l(p.CBANDS+2),W=u(2),Y=u(2),X=h([2,576]),Q=u(p.CBANDS+2),Z=u(p.CBANDS+2);for(c.fill(Z,0),w=q.channels_out,e.mode==MPEGMode.JOINT_STEREO&&(w=4),U=e.VBR==r.vbr_off?0==q.ResvMax?0:q.ResvSize/q.ResvMax*.5:e.VBR==r.vbr_rh||e.VBR==r.vbr_mtrh||e.VBR==r.vbr_mt?.6:1,x=0;x<q.channels_out;x++){var J=t[x],ee=n+576-350-f+192;for(d(10==F.length),S=0;S<576;S++){var te,ne;for(te=J[ee+S+10],ne=0,C=0;C<9;C+=2)te+=F[C]*(J[ee+S+C]+J[ee+S+f-C]),ne+=F[C+1]*(J[ee+S+C+1]+J[ee+S+f-C-1]);X[x][S]=te+ne}a[i][x].en.assign(q.en[x]),a[i][x].thm.assign(q.thm[x]),w>2&&(m[i][x].en.assign(q.en[x+2]),m[i][x].thm.assign(q.thm[x+2]))}for(x=0;x<w;x++){var se,re=l(12),ie=[0,0,0,0],oe=l(12),ae=1,ce=l(p.CBANDS),le=l(p.CBANDS),he=[0,0,0,0],ue=l(p.HBLKSIZE),de=h([3,p.HBLKSIZE_s]);for(d(q.npart_s<=p.CBANDS),d(q.npart_l<=p.CBANDS),S=0;S<3;S++)re[S]=q.nsPsy.last_en_subshort[x][S+6],d(q.nsPsy.last_en_subshort[x][S+4]>0),oe[S]=re[S]/q.nsPsy.last_en_subshort[x][S+4],ie[0]+=re[S];if(2==x)for(S=0;S<576;S++){var me,pe;me=X[0][S],pe=X[1][S],X[0][S]=me+pe,X[1][S]=me-pe}var fe=X[1&x],ge=0;for(S=0;S<9;S++){for(var _e=ge+64,ve=1;ge<_e;ge++)ve<Math.abs(fe[ge])&&(ve=Math.abs(fe[ge]));q.nsPsy.last_en_subshort[x][S]=re[S+3]=ve,ie[1+S/3]+=ve,ve>re[S+3-2]?(d(re[S+3-2]>0),ve/=re[S+3-2]):re[S+3-2]>10*ve?(d(ve>0),ve=re[S+3-2]/(10*ve)):ve=0,oe[S+3]=ve}if(e.analysis){var be=oe[0];for(S=1;S<12;S++)be<oe[S]&&(be=oe[S]);q.pinfo.ers[i][x]=q.pinfo.ers_save[x],q.pinfo.ers_save[x]=be}for(se=3==x?q.nsPsy.attackthre_s:q.nsPsy.attackthre,S=0;S<12;S++)0==he[S/3]&&oe[S]>se&&(he[S/3]=S%3+1);for(S=1;S<4;S++){var ye;ie[S-1]>ie[S]?(d(ie[S]>0),ye=ie[S-1]/ie[S]):(d(ie[S-1]>0),ye=ie[S]/ie[S-1]),ye<1.7&&(he[S]=0,1==S&&(he[0]=0))}for(0!=he[0]&&0!=q.nsPsy.lastAttacks[x]&&(he[0]=0),3!=q.nsPsy.lastAttacks[x]&&he[0]+he[1]+he[2]+he[3]==0||(ae=0,0!=he[1]&&0!=he[0]&&(he[1]=0),0!=he[2]&&0!=he[1]&&(he[2]=0),0!=he[3]&&0!=he[2]&&(he[3]=0)),x<2?Y[x]=ae:0==ae&&(Y[0]=Y[1]=0),b[x]=q.tot_ener[x],v(e,ue,de,H,1&x,z,1&x,i,x,t,n),L(q,ue,$,ce,le),V(q,ce,le,Q),D=0;D<3;D++){var we,ke;for(M(e,de,K,G,x,D),R(q,K,G,x,D),P=0;P<p.SBMAX_s;P++){if(ke=q.thm[x].s[P][D],ke*=.8,he[D]>=2||1==he[D+1]){var xe=0!=D?D-1:2;ve=N(q.thm[x].s[P][xe],ke,.6*U);ke=Math.min(ke,ve)}if(1==he[D]){xe=0!=D?D-1:2,ve=N(q.thm[x].s[P][xe],ke,s*U);ke=Math.min(ke,ve)}else if(0!=D&&3==he[D-1]||0==D&&3==q.nsPsy.lastAttacks[x]){xe=2!=D?D+1:0,ve=N(q.thm[x].s[P][xe],ke,s*U);ke=Math.min(ke,ve)}we=re[3*D+3]+re[3*D+4]+re[3*D+5],6*re[3*D+5]<we&&(ke*=.5,6*re[3*D+4]<we&&(ke*=.5)),q.thm[x].s[P][D]=ke}}for(q.nsPsy.lastAttacks[x]=he[2],I=0,E=0;E<q.npart_l;E++){for(var Ee=q.s3ind[E][0],Se=$[Ee]*k[Q[Ee]],Te=q.s3_ll[I++]*Se;++Ee<=q.s3ind[E][1];)Se=$[Ee]*k[Q[Ee]],Te=T(Te,q.s3_ll[I++]*Se,Ee,Ee-E,q,0);Te*=.158489319246111,q.blocktype_old[1&x]==p.SHORT_TYPE?G[E]=Te:G[E]=N(Math.min(Te,Math.min(2*q.nb_1[x][E],16*q.nb_2[x][E])),Te,U),q.nb_2[x][E]=q.nb_1[x][E],q.nb_1[x][E]=Te}for(;E<=p.CBANDS;++E)$[E]=0,G[E]=0;A(q,$,G,x)}(e.mode!=MPEGMode.STEREO&&e.mode!=MPEGMode.JOINT_STEREO||e.interChRatio>0&&function(e,t){var n=e.internal_flags;if(n.channels_out>1){for(var s=0;s<p.SBMAX_l;s++){var r=n.thm[0].l[s],i=n.thm[1].l[s];n.thm[0].l[s]+=i*t,n.thm[1].l[s]+=r*t}for(s=0;s<p.SBMAX_s;s++)for(var o=0;o<3;o++)r=n.thm[0].s[s][o],i=n.thm[1].s[s][o],n.thm[0].s[s][o]+=i*t,n.thm[1].s[s][o]+=r*t}}(e,e.interChRatio),e.mode==MPEGMode.JOINT_STEREO)&&(!function(e){for(var t=0;t<p.SBMAX_l;t++)if(!(e.thm[0].l[t]>1.58*e.thm[1].l[t]||e.thm[1].l[t]>1.58*e.thm[0].l[t])){var n=e.mld_l[t]*e.en[3].l[t],s=Math.max(e.thm[2].l[t],Math.min(e.thm[3].l[t],n));n=e.mld_l[t]*e.en[2].l[t];var r=Math.max(e.thm[3].l[t],Math.min(e.thm[2].l[t],n));e.thm[2].l[t]=s,e.thm[3].l[t]=r}for(t=0;t<p.SBMAX_s;t++)for(var i=0;i<3;i++)e.thm[0].s[t][i]>1.58*e.thm[1].s[t][i]||e.thm[1].s[t][i]>1.58*e.thm[0].s[t][i]||(n=e.mld_s[t]*e.en[3].s[t][i],s=Math.max(e.thm[2].s[t][i],Math.min(e.thm[3].s[t][i],n)),n=e.mld_s[t]*e.en[2].s[t][i],r=Math.max(e.thm[3].s[t][i],Math.min(e.thm[2].s[t][i],n)),e.thm[2].s[t][i]=s,e.thm[3].s[t][i]=r)}(q),j=e.msfix,Math.abs(j)>0&&function(e,t,n){var s=t,r=Math.pow(10,n);t*=2,s*=2;for(var i=0;i<p.SBMAX_l;i++)h=e.ATH.cb_l[e.bm_l[i]]*r,(a=Math.min(Math.max(e.thm[0].l[i],h),Math.max(e.thm[1].l[i],h)))*t<(c=Math.max(e.thm[2].l[i],h))+(l=Math.max(e.thm[3].l[i],h))&&d((c*=u=a*s/(c+l))+(l*=u)>0),e.thm[2].l[i]=Math.min(c,e.thm[2].l[i]),e.thm[3].l[i]=Math.min(l,e.thm[3].l[i]);for(r*=p.BLKSIZE_s/p.BLKSIZE,i=0;i<p.SBMAX_s;i++)for(var o=0;o<3;o++){var a,c,l,h,u;h=e.ATH.cb_s[e.bm_s[i]]*r,(a=Math.min(Math.max(e.thm[0].s[i][o],h),Math.max(e.thm[1].s[i][o],h)))*t<(c=Math.max(e.thm[2].s[i][o],h))+(l=Math.max(e.thm[3].s[i][o],h))&&d((c*=u=a*t/(c+l))+(l*=u)>0),e.thm[2].s[i][o]=Math.min(e.thm[2].s[i][o],c),e.thm[3].s[i][o]=Math.min(e.thm[3].s[i][o],l)}}(q,j,e.ATHlower*q.ATH.adjust));for(function(e,t,n,s){var r=e.internal_flags;e.short_blocks!=o.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var i=0;i<r.channels_out;i++)s[i]=p.NORM_TYPE,e.short_blocks==o.short_block_dispensed&&(t[i]=1),e.short_blocks==o.short_block_forced&&(t[i]=0),0!=t[i]?(d(r.blocktype_old[i]!=p.START_TYPE),r.blocktype_old[i]==p.SHORT_TYPE&&(s[i]=p.STOP_TYPE)):(s[i]=p.SHORT_TYPE,r.blocktype_old[i]==p.NORM_TYPE&&(r.blocktype_old[i]=p.START_TYPE),r.blocktype_old[i]==p.STOP_TYPE&&(r.blocktype_old[i]=p.SHORT_TYPE)),n[i]=r.blocktype_old[i],r.blocktype_old[i]=s[i]}(e,Y,y,W),x=0;x<w;x++){var Ce,Ie,Re,Ae=0;x>1?(Ce=_,Ae=-2,Ie=p.NORM_TYPE,y[0]!=p.SHORT_TYPE&&y[1]!=p.SHORT_TYPE||(Ie=p.SHORT_TYPE),Re=m[i][x-2]):(Ce=g,Ae=0,Ie=y[x],Re=a[i][x]),Ie==p.SHORT_TYPE?Ce[Ae+x]=B(Re,q.masking_lower):Ce[Ae+x]=O(Re,q.masking_lower),e.analysis&&(q.pinfo.pe[i][x]=Ce[Ae+x])}return 0};var H=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function z(e,t,n){if(0==n)for(var s=0;s<e.npart_s;s++)e.nb_s2[t][s]=e.nb_s1[t][s],e.nb_s1[t][s]=0}function $(e,t){for(var n=0;n<e.npart_l;n++)e.nb_2[t][n]=e.nb_1[t][n],e.nb_1[t][n]=0}function K(e,t,n,s,r,i){var o,a,c,h=e.internal_flags,u=new float[p.CBANDS],m=l(p.CBANDS),f=new int[p.CBANDS];for(c=a=0;c<h.npart_s;++c){var g=0,_=0,v=h.numlines_s[c];for(o=0;o<v;++o,++a){var b=t[i][a];g+=b,_<b&&(_=b)}n[c]=g,d(g>=0),u[c]=_,d(v>0),m[c]=g/v,d(m[c]>=0)}for(d(c==h.npart_s),d(129==a);c<p.CBANDS;++c)u[c]=0,m[c]=0;for(function(e,t,n,s){var r=k.length-1,i=0,o=n[i]+n[i+1];for(d(o>=0),o>0?((a=t[i])<t[i+1]&&(a=t[i+1]),d(e.numlines_s[i]+e.numlines_s[i+1]-1>0),(c=0|(o=20*(2*a-o)/(o*(e.numlines_s[i]+e.numlines_s[i+1]-1))))>r&&(c=r),s[i]=c):s[i]=0,i=1;i<e.npart_s-1;i++){var a,c;o=n[i-1]+n[i]+n[i+1],d(i+1<e.npart_s),d(o>=0),o>0?((a=t[i-1])<t[i]&&(a=t[i]),a<t[i+1]&&(a=t[i+1]),d(e.numlines_s[i-1]+e.numlines_s[i]+e.numlines_s[i+1]-1>0),(c=0|(o=20*(3*a-o)/(o*(e.numlines_s[i-1]+e.numlines_s[i]+e.numlines_s[i+1]-1))))>r&&(c=r),s[i]=c):s[i]=0}d(i>0),d(i==e.npart_s-1),o=n[i-1]+n[i],d(o>=0),o>0?((a=t[i-1])<t[i]&&(a=t[i]),d(e.numlines_s[i-1]+e.numlines_s[i]-1>0),(c=0|(o=20*(2*a-o)/(o*(e.numlines_s[i-1]+e.numlines_s[i]-1))))>r&&(c=r),s[i]=c):s[i]=0,d(i==e.npart_s-1)}(h,u,m,f),a=c=0;c<h.npart_s;c++){var y,w,x,E,S,T=h.s3ind_s[c][0],C=h.s3ind_s[c][1];for(y=f[T],w=1,E=h.s3_ss[a]*n[T]*k[f[T]],++a,++T;T<=C;)y+=f[T],w+=1,E=I(E,x=h.s3_ss[a]*n[T]*k[f[T]],T-c),++a,++T;E*=S=.5*k[y=(1+2*y)/(2*w)],s[c]=E,h.nb_s2[r][c]=h.nb_s1[r][c],h.nb_s1[r][c]=E,x=u[c],x*=h.minval_s[c],x*=S,s[c]>x&&(s[c]=x),h.masking_lower>1&&(s[c]*=h.masking_lower),s[c]>n[c]&&(s[c]=n[c]),h.masking_lower<1&&(s[c]*=h.masking_lower),d(s[c]>=0)}for(;c<p.CBANDS;++c)n[c]=0,s[c]=0}function G(e,t,n,r,i){var o,a=l(p.CBANDS),c=l(p.CBANDS),h=u(p.CBANDS+2);L(e,t,n,a,c),V(e,a,c,h);var m=0;for(o=0;o<e.npart_l;o++){var f,g,_,v=e.s3ind[o][0],b=e.s3ind[o][1],y=0,w=0;for(y=h[v],w+=1,g=e.s3_ll[m]*n[v]*k[h[v]],++m,++v;v<=b;)y+=h[v],w+=1,g=I(g,f=e.s3_ll[m]*n[v]*k[h[v]],v-o),++m,++v;if(g*=_=.5*k[y=(1+2*y)/(2*w)],e.blocktype_old[1&i]==p.SHORT_TYPE){var x=2*e.nb_1[i][o];r[o]=x>0?Math.min(g,x):Math.min(g,n[o]*s)}else{var E=16*e.nb_2[i][o],S=2*e.nb_1[i][o];E<=0&&(E=g),S<=0&&(S=g),x=e.blocktype_old[1&i]==p.NORM_TYPE?Math.min(S,E):S,r[o]=Math.min(g,x)}e.nb_2[i][o]=e.nb_1[i][o],e.nb_1[i][o]=g,f=a[o],f*=e.minval_l[o],f*=_,r[o]>f&&(r[o]=f),e.masking_lower>1&&(r[o]*=e.masking_lower),r[o]>n[o]&&(r[o]=n[o]),e.masking_lower<1&&(r[o]*=e.masking_lower),d(r[o]>=0)}for(;o<p.CBANDS;++o)n[o]=0,r[o]=0}function W(e,t,n,s,r,i,o){for(var a,c,l=2*i,h=i>0?Math.pow(10,r):1,u=0;u<o;++u){var m=e[2][u],p=e[3][u],f=t[0][u],g=t[1][u],_=t[2][u],v=t[3][u];if(f<=1.58*g&&g<=1.58*f){var b=n[u]*p,y=n[u]*m;c=Math.max(_,Math.min(v,b)),a=Math.max(v,Math.min(_,y))}else c=_,a=v;if(i>0){var w,k,x=s[u]*h;if(w=Math.min(Math.max(f,x),Math.max(g,x)),(k=(_=Math.max(c,x))+(v=Math.max(a,x)))>0&&w*l<k){var E=w*l/k;_*=E,v*=E,d(k>0)}c=Math.min(_,c),a=Math.min(v,a)}c>m&&(c=m),a>p&&(a=p),t[2][u]=c,t[3][u]=a}}function Y(e,t){var n;return(n=e>=0?27*-e:e*t)<=-72?0:Math.exp(n*g)}function X(e){var t,n,s=0;for(s=0;Y(s,e)>1e-20;s-=1);for(r=s,i=0;Math.abs(i-r)>1e-12;)Y(s=(i+r)/2,e)>0?i=s:r=s;t=r;var r,i;s=0;for(s=0;Y(s,e)>1e-20;s+=1);for(r=0,i=s;Math.abs(i-r)>1e-12;)Y(s=(i+r)/2,e)>0?r=s:i=s;n=i;var o,a=0,c=1e3;for(o=0;o<=c;++o){a+=Y(s=t+o*(n-t)/c,e)}return(c+1)/(a*(n-t))}function Q(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function Z(e,t,n,s,r,i,o,a,c,h,m,f){var g,_=l(p.CBANDS+1),v=a/(f>15?1152:384),b=u(p.HBLKSIZE);a/=c;var y=0,w=0;for(g=0;g<p.CBANDS;g++){var k;for(M=Q(a*y),_[g]=a*y,k=y;Q(a*k)-M<.34&&k<=c/2;k++);for(e[g]=k-y,w=g+1;y<k;)d(y<p.HBLKSIZE),b[y++]=g;if(y>c/2){y=c/2,++g;break}}d(g<p.CBANDS),_[g]=a*y;for(var x=0;x<f;x++){var E,S,T,C,I;T=h[x],C=h[x+1],(E=0|Math.floor(.5+m*(T-.5)))<0&&(E=0),(S=0|Math.floor(.5+m*(C-.5)))>c/2&&(S=c/2),n[x]=(b[E]+b[S])/2,t[x]=b[S];var R=v*C;o[x]=(R-_[t[x]])/(_[t[x]+1]-_[t[x]]),o[x]<0?o[x]=0:o[x]>1&&(o[x]=1),I=Q(a*h[x]*m),I=Math.min(I,15.5)/15.5,i[x]=Math.pow(10,1.25*(1-Math.cos(Math.PI*I))-2.5)}y=0;for(var A=0;A<w;A++){var M,N,P=e[A];M=Q(a*y),N=Q(a*(y+P-1)),s[A]=.5*(M+N),M=Q(a*(y-.5)),N=Q(a*(y+P-.5)),r[A]=N-M,y+=P}return w}function J(e,t,n,s,r,i){var o,a,c,u,d,m,f=h([p.CBANDS,p.CBANDS]),_=0;if(i)for(var v=0;v<t;v++)for(o=0;o<t;o++){var b=(a=n[v]-n[o],c=void 0,u=void 0,d=void 0,m=void 0,c=a,u=(c*=c>=0?3:1.5)>=.5&&c<=2.5?8*((m=c-.5)*m-2*m):0,((d=15.811389+7.5*(c+=.474)-17.5*Math.sqrt(1+c*c))<=-60?0:(c=Math.exp((u+d)*g),c/=.6609193))*s[o]);f[v][o]=b*r[v]}else for(o=0;o<t;o++){var y=15+Math.min(21/n[o],12),w=X(y);for(v=0;v<t;v++){b=w*Y(n[v]-n[o],y)*s[o];f[v][o]=b*r[v]}}for(v=0;v<t;v++){for(o=0;o<t&&!(f[v][o]>0);o++);for(e[v][0]=o,o=t-1;o>0&&!(f[v][o]>0);o--);e[v][1]=o,_+=e[v][1]-e[v][0]+1}var k=l(_),x=0;for(v=0;v<t;v++)for(o=e[v][0];o<=e[v][1];o++)k[x++]=f[v][o];return k}function ee(e){var t=Q(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function te(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}this.L3psycho_anal_vbr=function(e,t,n,s,r,i,a,c,m,g){var _=e.internal_flags,v=l(p.HBLKSIZE),b=h([3,p.HBLKSIZE_s]),y=h([2,p.BLKSIZE]),w=h([2,3,p.BLKSIZE_s]),k=h([4,p.CBANDS]),x=h([4,p.CBANDS]),E=h([4,3]),S=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],T=u(2),C=e.mode==MPEGMode.JOINT_STEREO?4:_.channels_out;!function(e,t,n,s,r,i,o,a,c,u){for(var m=h([2,576]),p=e.internal_flags,g=p.channels_out,_=e.mode==MPEGMode.JOINT_STEREO?4:g,v=0;v<g;v++){firbuf=t[v];var b=n+576-350-f+192;d(10==H.length);for(var y=0;y<576;y++){var w,k;w=firbuf[b+y+10],k=0;for(var x=0;x<9;x+=2)w+=H[x]*(firbuf[b+y+x]+firbuf[b+y+f-x]),k+=H[x+1]*(firbuf[b+y+x+1]+firbuf[b+y+f-x-1]);m[v][y]=w+k}r[s][v].en.assign(p.en[v]),r[s][v].thm.assign(p.thm[v]),_>2&&(i[s][v].en.assign(p.en[v+2]),i[s][v].thm.assign(p.thm[v+2]))}for(v=0;v<_;v++){var E=l(12),S=l(12),T=[0,0,0,0],C=m[1&v],I=0,R=3==v?p.nsPsy.attackthre_s:p.nsPsy.attackthre,A=1;if(2==v)for(y=0,x=576;x>0;++y,--x){var M=m[0][y],N=m[1][y];m[0][y]=M+N,m[1][y]=M-N}for(y=0;y<3;y++)S[y]=p.nsPsy.last_en_subshort[v][y+6],d(p.nsPsy.last_en_subshort[v][y+4]>0),E[y]=S[y]/p.nsPsy.last_en_subshort[v][y+4],T[0]+=S[y];for(y=0;y<9;y++){for(var P=I+64,B=1;I<P;I++)B<Math.abs(C[I])&&(B=Math.abs(C[I]));p.nsPsy.last_en_subshort[v][y]=S[y+3]=B,T[1+y/3]+=B,B>S[y+3-2]?(d(S[y+3-2]>0),B/=S[y+3-2]):S[y+3-2]>10*B?(d(B>0),B=S[y+3-2]/(10*B)):B=0,E[y+3]=B}for(y=0;y<3;++y){var D=S[3*y+3]+S[3*y+4]+S[3*y+5],O=1;6*S[3*y+5]<D&&(O*=.5,6*S[3*y+4]<D&&(O*=.5)),a[v][y]=O}if(e.analysis){var L=E[0];for(y=1;y<12;y++)L<E[y]&&(L=E[y]);p.pinfo.ers[s][v]=p.pinfo.ers_save[v],p.pinfo.ers_save[v]=L}for(y=0;y<12;y++)0==c[v][y/3]&&E[y]>R&&(c[v][y/3]=y%3+1);for(y=1;y<4;y++){var V=T[y-1],F=T[y];Math.max(V,F)<4e4&&V<1.7*F&&F<1.7*V&&(1==y&&c[v][0]<=c[v][y]&&(c[v][0]=0),c[v][y]=0)}c[v][0]<=p.nsPsy.lastAttacks[v]&&(c[v][0]=0),3!=p.nsPsy.lastAttacks[v]&&c[v][0]+c[v][1]+c[v][2]+c[v][3]==0||(A=0,0!=c[v][1]&&0!=c[v][0]&&(c[v][1]=0),0!=c[v][2]&&0!=c[v][1]&&(c[v][2]=0),0!=c[v][3]&&0!=c[v][2]&&(c[v][3]=0)),v<2?u[v]=A:0==A&&(u[0]=u[1]=0),o[v]=p.tot_ener[v]}}(e,t,n,s,r,i,m,E,S,T),function(e,t){var n=e.internal_flags;e.short_blocks!=o.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var s=0;s<n.channels_out;s++)e.short_blocks==o.short_block_dispensed&&(t[s]=1),e.short_blocks==o.short_block_forced&&(t[s]=0)}(e,T);for(var I=0;I<C;I++){U(e,t,n,I,s,v,y,P=1&I),q(e,s,I,v),0!=T[P]?G(_,v,k[I],x[I],I):$(_,I)}T[0]+T[1]==2&&e.mode==MPEGMode.JOINT_STEREO&&W(k,x,_.mld_cb_l,_.ATH.cb_l,e.ATHlower*_.ATH.adjust,e.msfix,_.npart_l);for(I=0;I<C;I++){0!=T[P=1&I]&&A(_,k[I],x[I],I)}for(var M=0;M<3;M++){for(I=0;I<C;++I){0!=T[P=1&I]?z(_,I,M):(j(e,t,n,I,M,b,w,P),K(e,b,k[I],x[I],I,M))}T[0]+T[1]==0&&e.mode==MPEGMode.JOINT_STEREO&&W(k,x,_.mld_cb_s,_.ATH.cb_s,e.ATHlower*_.ATH.adjust,e.msfix,_.npart_s);for(I=0;I<C;++I){0==T[P=1&I]&&R(_,k[I],x[I],I,M)}}for(I=0;I<C;I++){var P;if(0==T[P=1&I])for(var D=0;D<p.SBMAX_s;D++){var L=l(3);for(M=0;M<3;M++){var V=_.thm[I].s[D][M];if(V*=.8,S[I][M]>=2||1==S[I][M+1]){var F=0!=M?M-1:2,Y=N(_.thm[I].s[D][F],V,.36);V=Math.min(V,Y)}else if(1==S[I][M]){F=0!=M?M-1:2,Y=N(_.thm[I].s[D][F],V,.18);V=Math.min(V,Y)}else if(0!=M&&3==S[I][M-1]||0==M&&3==_.nsPsy.lastAttacks[I]){F=2!=M?M+1:0,Y=N(_.thm[I].s[D][F],V,.18);V=Math.min(V,Y)}V*=E[I][M],L[M]=V}for(M=0;M<3;M++)_.thm[I].s[D][M]=L[M]}}for(I=0;I<C;I++)_.nsPsy.lastAttacks[I]=S[I][2];!function(e,t,n){for(var s=e.internal_flags,r=0;r<s.channels_out;r++){var i=p.NORM_TYPE;0!=t[r]?(d(s.blocktype_old[r]!=p.START_TYPE),s.blocktype_old[r]==p.SHORT_TYPE&&(i=p.STOP_TYPE)):(i=p.SHORT_TYPE,s.blocktype_old[r]==p.NORM_TYPE&&(s.blocktype_old[r]=p.START_TYPE),s.blocktype_old[r]==p.STOP_TYPE&&(s.blocktype_old[r]=p.SHORT_TYPE)),n[r]=s.blocktype_old[r],s.blocktype_old[r]=i}}(e,T,g);for(I=0;I<C;I++){var X,Q,Z,J;I>1?(X=c,Q=-2,Z=p.NORM_TYPE,g[0]!=p.SHORT_TYPE&&g[1]!=p.SHORT_TYPE||(Z=p.SHORT_TYPE),J=i[s][I-2]):(X=a,Q=0,Z=g[I],J=r[s][I]),Z==p.SHORT_TYPE?X[Q+I]=B(J,_.masking_lower):X[Q+I]=O(J,_.masking_lower),e.analysis&&(_.pinfo.pe[s][I]=X[Q+I])}return 0},this.psymodel_init=function(n){var s,o=n.internal_flags,a=!0,c=13,h=24,u=0,m=0,f=-8.25,g=-4.5,_=l(p.CBANDS),v=l(p.CBANDS),k=l(p.CBANDS),x=n.out_samplerate;switch(n.experimentalZ){default:case 0:a=!0;break;case 1:a=n.VBR!=r.vbr_mtrh&&n.VBR!=r.vbr_mt;break;case 2:a=!1;break;case 3:c=8,u=-1.75,m=-.0125,f=-8.25,g=-2.25}for(o.ms_ener_ratio_old=.25,o.blocktype_old[0]=o.blocktype_old[1]=p.NORM_TYPE,s=0;s<4;++s){for(var E=0;E<p.CBANDS;++E)o.nb_1[s][E]=1e20,o.nb_2[s][E]=1e20,o.nb_s1[s][E]=o.nb_s2[s][E]=1;for(var S=0;S<p.SBMAX_l;S++)o.en[s].l[S]=1e20,o.thm[s].l[S]=1e20;for(E=0;E<3;++E){for(S=0;S<p.SBMAX_s;S++)o.en[s].s[S][E]=1e20,o.thm[s].s[S][E]=1e20;o.nsPsy.lastAttacks[s]=0}for(E=0;E<9;E++)o.nsPsy.last_en_subshort[s][E]=10}for(o.loudness_sq_save[0]=o.loudness_sq_save[1]=0,o.npart_l=Z(o.numlines_l,o.bo_l,o.bm_l,_,v,o.mld_l,o.PSY.bo_l_weight,x,p.BLKSIZE,o.scalefac_band.l,p.BLKSIZE/1152,p.SBMAX_l),d(o.npart_l<p.CBANDS),s=0;s<o.npart_l;s++){var T=u;_[s]>=c&&(T=m*(_[s]-c)/(h-c)+u*(h-_[s])/(h-c)),k[s]=Math.pow(10,T/10),o.numlines_l[s]>0?o.rnumlines_l[s]=1/o.numlines_l[s]:o.rnumlines_l[s]=0}o.s3_ll=J(o.s3ind,o.npart_l,_,v,k,a);var C;E=0;for(s=0;s<o.npart_l;s++){A=i.MAX_VALUE;for(var I=0;I<o.numlines_l[s];I++,E++){var R=x*E/(1e3*p.BLKSIZE);M=this.ATHformula(1e3*R,n)-20,M=Math.pow(10,.1*M),A>(M*=o.numlines_l[s])&&(A=M)}o.ATH.cb_l[s]=A,(A=20*_[s]/10-20)>6&&(A=100),A<-15&&(A=-15),A-=8,o.minval_l[s]=Math.pow(10,A/10)*o.numlines_l[s]}for(o.npart_s=Z(o.numlines_s,o.bo_s,o.bm_s,_,v,o.mld_s,o.PSY.bo_s_weight,x,p.BLKSIZE_s,o.scalefac_band.s,p.BLKSIZE_s/384,p.SBMAX_s),d(o.npart_s<p.CBANDS),E=0,s=0;s<o.npart_s;s++){var A;T=f;_[s]>=c&&(T=g*(_[s]-c)/(h-c)+f*(h-_[s])/(h-c)),k[s]=Math.pow(10,T/10),A=i.MAX_VALUE;for(I=0;I<o.numlines_s[s];I++,E++){var M;R=x*E/(1e3*p.BLKSIZE_s);M=this.ATHformula(1e3*R,n)-20,M=Math.pow(10,.1*M),A>(M*=o.numlines_s[s])&&(A=M)}o.ATH.cb_s[s]=A,A=7*_[s]/12-7,_[s]>12&&(A*=1+3.1*Math.log(1+A)),_[s]<12&&(A*=1+2.3*Math.log(1-A)),A<-15&&(A=-15),A-=8,o.minval_s[s]=Math.pow(10,A/10)*o.numlines_s[s]}o.s3_ss=J(o.s3ind_s,o.npart_s,_,v,k,a),b=Math.pow(10,9/16),y=Math.pow(10,1.5),w=Math.pow(10,1.5),e.init_fft(o),o.decay=Math.exp(-1*t/(.01*x/192)),C=3.5,0!=(2&n.exp_nspsytune)&&(C=1),Math.abs(n.msfix)>0&&(C=n.msfix),n.msfix=C;for(var N=0;N<o.npart_l;N++)o.s3ind[N][1]>o.npart_l-1&&(o.s3ind[N][1]=o.npart_l-1);var P=576*o.mode_gr/x;if(o.ATH.decay=Math.pow(10,-1.2*P),o.ATH.adjust=.01,o.ATH.adjustLimit=1,d(o.bo_l[p.SBMAX_l-1]<=o.npart_l),d(o.bo_s[p.SBMAX_s-1]<=o.npart_s),-1!=n.ATHtype){var B=n.out_samplerate/p.BLKSIZE,D=0;for(R=0,s=0;s<p.BLKSIZE/2;++s)R+=B,o.ATH.eql_w[s]=1/Math.pow(10,this.ATHformula(R,n)/10),D+=o.ATH.eql_w[s];for(D=1/D,s=p.BLKSIZE/2;--s>=0;)o.ATH.eql_w[s]*=D}for(N=E=0;N<o.npart_s;++N)for(s=0;s<o.numlines_s[N];++s)++E;d(129==E);for(N=E=0;N<o.npart_l;++N)for(s=0;s<o.numlines_l[N];++s)++E;for(d(513==E),E=0,s=0;s<o.npart_l;s++){R=x*(E+o.numlines_l[s]/2)/(1*p.BLKSIZE);o.mld_cb_l[s]=ee(R),E+=o.numlines_l[s]}for(;s<p.CBANDS;++s)o.mld_cb_l[s]=1;for(E=0,s=0;s<o.npart_s;s++){R=x*(E+o.numlines_s[s]/2)/(1*p.BLKSIZE_s);o.mld_cb_s[s]=ee(R),E+=o.numlines_s[s]}for(;s<p.CBANDS;++s)o.mld_cb_s[s]=1;return 0},this.ATHformula=function(e,t){var n;switch(t.ATHtype){case 0:n=te(e,9);break;case 1:n=te(e,-1);break;case 2:default:n=te(e,0);break;case 3:n=te(e,1)+6;break;case 4:n=te(e,t.ATHcurve)}return n}}},19833:(e,t,n)=>{var s=n(51038),r=s.System,i=s.VbrMode,o=(s.Float,s.ShortBlock,s.Util),a=s.Arrays,c=(s.new_array_n,s.new_byte,s.new_double,s.new_float),l=(s.new_float_n,s.new_int,s.new_int_n,s.assert),h=n(77095),u=n(22711),d=n(3449),m=n(60687),p=n(29438),f=n(90354);e.exports=function(){var e,t,n;this.rv=null,this.qupvt=null;var s,g=new h;function _(e){this.ordinal=e}function v(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function b(e,t,n,s,r){var i;switch(e){default:case 9:t.over_count>0?(i=n.over_SSD<=t.over_SSD,n.over_SSD==t.over_SSD&&(i=n.bits<t.bits)):i=n.max_noise<0&&10*n.max_noise+n.bits<=10*t.max_noise+t.bits;break;case 0:i=n.over_count<t.over_count||n.over_count==t.over_count&&n.over_noise<t.over_noise||n.over_count==t.over_count&&BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 8:n.max_noise=function(e,t){for(var n,s=1e-37,r=0;r<t.psymax;r++)s+=(n=e[r],o.FAST_LOG10(.368+.632*n*n*n));return Math.max(1e-20,s)}(r,s);case 1:i=n.max_noise<t.max_noise;break;case 2:i=n.tot_noise<t.tot_noise;break;case 3:i=n.tot_noise<t.tot_noise&&n.max_noise<t.max_noise;break;case 4:i=n.max_noise<=0&&t.max_noise>.2||n.max_noise<=0&&t.max_noise<0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise||n.max_noise<=0&&t.max_noise>0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.05&&t.max_noise>n.max_noise-.1&&n.tot_noise+n.over_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.1&&t.max_noise>n.max_noise-.15&&n.tot_noise+n.over_noise+n.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:i=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 6:i=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&(n.max_noise<t.max_noise||BitStream.EQ(n.max_noise,t.max_noise)&&n.tot_noise<=t.tot_noise);break;case 7:i=n.over_count<t.over_count||n.over_noise<t.over_noise}return 0==t.over_count&&(i=i&&n.bits<t.bits),i}function y(e,t,r,i,o){var c=e.internal_flags;!function(e,t,n,s,r){var i,o=e.internal_flags;i=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var a=0,c=0;c<t.sfbmax;c++)a<n[c]&&(a=n[c]);var l=o.noise_shaping_amp;switch(3==l&&(l=r?2:1),l){case 2:break;case 1:a>1?a=Math.pow(a,.5):a*=.95;break;default:a>1?a=1:a*=.95}var h=0;for(c=0;c<t.sfbmax;c++){var u,d=t.width[c];if(h+=d,!(n[c]<a)){if(0!=(2&o.substep_shaping)&&(o.pseudohalf[c]=0==o.pseudohalf[c]?1:0,0==o.pseudohalf[c]&&2==o.noise_shaping_amp))return;for(t.scalefac[c]++,u=-d;u<0;u++)s[h+u]*=i,s[h+u]>t.xrpow_max&&(t.xrpow_max=s[h+u]);if(2==o.noise_shaping_amp)return}}}(e,t,r,i,o);var h=v(t);return!h&&(!(h=2==c.mode_gr?s.scale_bitcount(t):s.scale_bitcount_lsf(c,t))||(c.noise_shaping>1&&(a.fill(c.pseudohalf,0),0==t.scalefac_scale?(!function(e,t){for(var s=0,r=0;r<e.sfbmax;r++){var i=e.width[r],o=e.scalefac[r];if(0!=e.preflag&&(o+=n.pretab[r]),s+=i,0!=(1&o)){o++;for(var a=-i;a<0;a++)t[s+a]*=1.2968395546510096,t[s+a]>e.xrpow_max&&(e.xrpow_max=t[s+a])}e.scalefac[r]=o>>1}e.preflag=0,e.scalefac_scale=1}(t,i),h=!1):t.block_type==m.SHORT_TYPE&&c.subblock_gain>0&&(h=function(e,t,s){var r,i=t.scalefac;for(r=0;r<t.sfb_lmax;r++)if(i[r]>=16)return!0;for(var o=0;o<3;o++){var a=0,c=0;for(r=t.sfb_lmax+o;r<t.sfbdivide;r+=3)a<i[r]&&(a=i[r]);for(;r<t.sfbmax;r+=3)c<i[r]&&(c=i[r]);if(!(a<16&&c<8)){if(t.subblock_gain[o]>=7)return!0;t.subblock_gain[o]++;var h=e.scalefac_band.l[t.sfb_lmax];for(r=t.sfb_lmax+o;r<t.sfbmax;r+=3){var u=t.width[r],d=i[r];if(l(d>=0),(d-=4>>t.scalefac_scale)>=0)i[r]=d,h+=3*u;else{i[r]=0;var m=210+(d<<t.scalefac_scale+1);f=n.IPOW20(m),h+=u*(o+1);for(var p=-u;p<0;p++)s[h+p]*=f,s[h+p]>t.xrpow_max&&(t.xrpow_max=s[h+p]);h+=u*(3-o-1)}}var f=n.IPOW20(202);for(h+=t.width[r]*(o+1),p=-t.width[r];p<0;p++)s[h+p]*=f,s[h+p]>t.xrpow_max&&(t.xrpow_max=s[h+p])}}return!1}(c,t,i)||v(t))),h||(h=2==c.mode_gr?s.scale_bitcount(t):s.scale_bitcount_lsf(c,t)),!h))}this.setModules=function(r,i,o,a){e=r,t=i,this.rv=i,n=o,this.qupvt=o,s=a,g.setModules(n,s)},this.ms_convert=function(e,t){for(var n=0;n<576;++n){var s=e.tt[t][0].xr[n],r=e.tt[t][1].xr[n];e.tt[t][0].xr[n]=(s+r)*(.5*o.SQRT2),e.tt[t][1].xr[n]=(s-r)*(.5*o.SQRT2)}},this.init_xrpow=function(e,t,n){var s=0,r=0|t.max_nonzero_coeff;if(l(null!=n),t.xrpow_max=0,l(0<=r&&r<=575),a.fill(n,r,576,0),s=function(e,t,n,s){s=0;for(var r=0;r<=n;++r){var i=Math.abs(e.xr[r]);s+=i,t[r]=Math.sqrt(i*Math.sqrt(i)),t[r]>e.xrpow_max&&(e.xrpow_max=t[r])}return s}(t,n,r,s),s>1e-20){var i=0;0!=(2&e.substep_shaping)&&(i=1);for(var o=0;o<t.psymax;o++)e.pseudohalf[o]=i;return!0}return a.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,t){t.part2_3_length=0,t.big_values=0,t.count1=0,t.global_gain=210,t.scalefac_compress=0,t.table_select[0]=0,t.table_select[1]=0,t.table_select[2]=0,t.subblock_gain[0]=0,t.subblock_gain[1]=0,t.subblock_gain[2]=0,t.subblock_gain[3]=0,t.region0_count=0,t.region1_count=0,t.preflag=0,t.scalefac_scale=0,t.count1table_select=0,t.part2_length=0,t.sfb_lmax=m.SBPSY_l,t.sfb_smin=m.SBPSY_s,t.psy_lmax=e.sfb21_extra?m.SBMAX_l:m.SBPSY_l,t.psymax=t.psy_lmax,t.sfbmax=t.sfb_lmax,t.sfbdivide=11;for(var s=0;s<m.SBMAX_l;s++)t.width[s]=e.scalefac_band.l[s+1]-e.scalefac_band.l[s],t.window[s]=3;if(t.block_type==m.SHORT_TYPE){var i=c(576);t.sfb_smin=0,t.sfb_lmax=0,0!=t.mixed_block_flag&&(t.sfb_smin=3,t.sfb_lmax=2*e.mode_gr+4),t.psymax=t.sfb_lmax+3*((e.sfb21_extra?m.SBMAX_s:m.SBPSY_s)-t.sfb_smin),t.sfbmax=t.sfb_lmax+3*(m.SBPSY_s-t.sfb_smin),t.sfbdivide=t.sfbmax-18,t.psy_lmax=t.sfb_lmax;var o=e.scalefac_band.l[t.sfb_lmax];r.arraycopy(t.xr,0,i,0,576);for(s=t.sfb_smin;s<m.SBMAX_s;s++)for(var l=e.scalefac_band.s[s],h=e.scalefac_band.s[s+1],u=0;u<3;u++)for(var d=l;d<h;d++)t.xr[o++]=i[3*d+u];var p=t.sfb_lmax;for(s=t.sfb_smin;s<m.SBMAX_s;s++)t.width[p]=t.width[p+1]=t.width[p+2]=e.scalefac_band.s[s+1]-e.scalefac_band.s[s],t.window[p]=0,t.window[p+1]=1,t.window[p+2]=2,p+=3}t.count1bits=0,t.sfb_partition_table=n.nr_of_sfb_block[0][0],t.slen[0]=0,t.slen[1]=0,t.slen[2]=0,t.slen[3]=0,t.max_nonzero_coeff=575,a.fill(t.scalefac,0),function(e,t){var s=e.ATH,r=t.xr;if(t.block_type!=m.SHORT_TYPE)for(var i=!1,o=m.PSFB21-1;o>=0&&!i;o--){var a=e.scalefac_band.psfb21[o],c=e.scalefac_band.psfb21[o+1],l=n.athAdjust(s.adjust,s.psfb21[o],s.floor);e.nsPsy.longfact[21]>1e-12&&(l*=e.nsPsy.longfact[21]);for(var h=c-1;h>=a;h--){if(!(Math.abs(r[h])<l)){i=!0;break}r[h]=0}}else for(var u=0;u<3;u++)for(i=!1,o=m.PSFB12-1;o>=0&&!i;o--){c=(a=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*u+(e.scalefac_band.psfb12[o]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[o+1]-e.scalefac_band.psfb12[o]);var d=n.athAdjust(s.adjust,s.psfb12[o],s.floor);for(e.nsPsy.shortfact[12]>1e-12&&(d*=e.nsPsy.shortfact[12]),h=c-1;h>=a;h--){if(!(Math.abs(r[h])<d)){i=!0;break}r[h]=0}}}(e,t)},_.BINSEARCH_NONE=new _(0),_.BINSEARCH_UP=new _(1),_.BINSEARCH_DOWN=new _(2),this.trancate_smallspectrums=function(e,t,r,i){var o=c(f.SFBMAX);if((0!=(4&e.substep_shaping)||t.block_type!=m.SHORT_TYPE)&&0==(128&e.substep_shaping)){n.calc_noise(t,r,o,new u,null);for(var l=0;l<576;l++){var h=0;0!=t.l3_enc[l]&&(h=Math.abs(t.xr[l])),i[l]=h}l=0;var d=8;t.block_type==m.SHORT_TYPE&&(d=6);do{var p,g,_,v,b=t.width[d];if(l+=b,!(o[d]>=1||(a.sort(i,l-b,b),BitStream.EQ(i[l-1],0)))){p=(1-o[d])*r[d],g=0,v=0;do{var y;for(_=1;v+_<b&&!BitStream.NEQ(i[v+l-b],i[v+l+_-b]);_++);if(p<(y=i[v+l-b]*i[v+l-b]*_)){0!=v&&(g=i[v+l-b-1]);break}p-=y,v+=_}while(v<b);if(!BitStream.EQ(g,0))do{Math.abs(t.xr[l-b])<=g&&(t.l3_enc[l-b]=0)}while(--b>0)}}while(++d<t.psymax);t.part2_3_length=s.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,t,o,a,h,g){var v=e.internal_flags,w=new p,k=c(576),x=c(f.SFBMAX),E=new u,S=new d,T=9999999,C=!1,I=!1,R=0;if(function(e,t,n,r,i){var o,a=e.CurrentStep[r],c=!1,h=e.OldValue[r],u=_.BINSEARCH_NONE;for(t.global_gain=h,n-=t.part2_length,l(0!=a);;){var d;if(o=s.count_bits(e,i,t,null),1==a||o==n)break;o>n?(u==_.BINSEARCH_DOWN&&(c=!0),c&&(a/=2),u=_.BINSEARCH_UP,d=a):(u==_.BINSEARCH_UP&&(c=!0),c&&(a/=2),u=_.BINSEARCH_DOWN,d=-a),t.global_gain+=d,t.global_gain<0&&(t.global_gain=0,c=!0),t.global_gain>255&&(t.global_gain=255,c=!0)}for(l(t.global_gain>=0),l(t.global_gain<256);o>n&&t.global_gain<255;)t.global_gain++,o=s.count_bits(e,i,t,null);e.CurrentStep[r]=h-t.global_gain>=4?4:2,e.OldValue[r]=t.global_gain,t.part2_3_length=o}(v,t,g,h,a),0==v.noise_shaping)return 100;n.calc_noise(t,o,x,E,S),E.bits=t.part2_3_length,w.assign(t);var A=0;for(r.arraycopy(a,0,k,0,576);!C;){do{var M,N=new u,P=255;if(M=0!=(2&v.substep_shaping)?20:3,v.sfb21_extra){if(x[w.sfbmax]>1)break;if(w.block_type==m.SHORT_TYPE&&(x[w.sfbmax+1]>1||x[w.sfbmax+2]>1))break}if(!y(e,w,x,a,I))break;0!=w.scalefac_scale&&(P=254);var B=g-w.part2_length;if(B<=0)break;for(;(w.part2_3_length=s.count_bits(v,a,w,S))>B&&w.global_gain<=P;)w.global_gain++;if(w.global_gain>P)break;if(0==E.over_count){for(;(w.part2_3_length=s.count_bits(v,a,w,S))>T&&w.global_gain<=P;)w.global_gain++;if(w.global_gain>P)break}if(n.calc_noise(w,o,x,N,S),N.bits=w.part2_3_length,0!=(b(t.block_type!=m.SHORT_TYPE?e.quant_comp:e.quant_comp_short,E,N,w,x)?1:0))T=t.part2_3_length,E=N,t.assign(w),A=0,r.arraycopy(a,0,k,0,576);else if(0==v.full_outer_loop){if(++A>M&&0==E.over_count)break;if(3==v.noise_shaping_amp&&I&&A>30)break;if(3==v.noise_shaping_amp&&I&&w.global_gain-R>15)break}}while(w.global_gain+w.scalefac_scale<255);3==v.noise_shaping_amp?I?C=!0:(w.assign(t),r.arraycopy(k,0,a,0,576),A=0,R=w.global_gain,I=!0):C=!0}return l(t.global_gain+t.scalefac_scale<=255),e.VBR==i.vbr_rh||e.VBR==i.vbr_mtrh?r.arraycopy(k,0,a,0,576):0!=(1&v.substep_shaping)&&trancate_smallspectrums(v,t,o,a),E.over_count},this.iteration_finish_one=function(e,n,r){var i=e.l3_side,o=i.tt[n][r];s.best_scalefac_store(e,n,r,i),1==e.use_best_huffman&&s.best_huffman_divide(e,o),t.ResvAdjust(e,o)},this.VBR_encode_granule=function(e,t,n,s,i,o,h){var u,d=e.internal_flags,m=new p,f=c(576),g=h,_=h+1,v=(h+o)/2,b=0,y=d.sfb21_extra;l(g<=LameInternalFlags.MAX_BITS_PER_CHANNEL),a.fill(m.l3_enc,0);do{l(v>=o),l(v<=h),l(o<=h),d.sfb21_extra=!(v>g-42)&&y,outer_loop(e,t,n,s,i,v)<=0?(b=1,_=t.part2_3_length,m.assign(t),r.arraycopy(s,0,f,0,576),u=(h=_-32)-o,v=(h+o)/2):(u=h-(o=v+32),v=(h+o)/2,0!=b&&(b=2,t.assign(m),r.arraycopy(f,0,s,0,576)))}while(u>12);d.sfb21_extra=y,2==b&&r.arraycopy(m.l3_enc,0,t.l3_enc,0,576),l(t.part2_3_length<=g)},this.get_framebits=function(n,s){var r=n.internal_flags;r.bitrate_index=r.VBR_min_bitrate;var i=e.getframebits(n);r.bitrate_index=1,i=e.getframebits(n);for(var o=1;o<=r.VBR_max_bitrate;o++){r.bitrate_index=o;var a=new MeanBits(i);s[o]=t.ResvFrameBegin(n,a),i=a.bits}},this.VBR_old_prepare=function(e,s,r,i,o,a,c,l,h){var u,d=e.internal_flags,p=0,f=1,g=0;d.bitrate_index=d.VBR_max_bitrate;var _=t.ResvFrameBegin(e,new MeanBits(0))/d.mode_gr;get_framebits(e,a);for(var v=0;v<d.mode_gr;v++){var b=n.on_pe(e,s,l[v],_,v,0);d.mode_ext==m.MPG_MD_MS_LR&&(ms_convert(d.l3_side,v),n.reduce_side(l[v],r[v],_,b));for(var y=0;y<d.channels_out;++y){var w=d.l3_side.tt[v][y];w.block_type!=m.SHORT_TYPE?(p=1.28/(1+Math.exp(3.5-s[v][y]/300))-.05,u=d.PSY.mask_adjust-p):(p=2.56/(1+Math.exp(3.5-s[v][y]/300))-.14,u=d.PSY.mask_adjust_short-p),d.masking_lower=Math.pow(10,.1*u),init_outer_loop(d,w),h[v][y]=n.calc_xmin(e,i[v][y],w,o[v][y]),0!=h[v][y]&&(f=0),c[v][y]=126,g+=l[v][y]}}for(v=0;v<d.mode_gr;v++)for(y=0;y<d.channels_out;y++)g>a[d.VBR_max_bitrate]&&(l[v][y]*=a[d.VBR_max_bitrate],l[v][y]/=g),c[v][y]>l[v][y]&&(c[v][y]=l[v][y]);return f},this.bitpressure_strategy=function(e,t,n,s){for(var r=0;r<e.mode_gr;r++)for(var i=0;i<e.channels_out;i++){for(var o=e.l3_side.tt[r][i],a=t[r][i],c=0,l=0;l<o.psy_lmax;l++)a[c++]*=1+.029*l*l/m.SBMAX_l/m.SBMAX_l;if(o.block_type==m.SHORT_TYPE)for(l=o.sfb_smin;l<m.SBMAX_s;l++)a[c++]*=1+.029*l*l/m.SBMAX_s/m.SBMAX_s,a[c++]*=1+.029*l*l/m.SBMAX_s/m.SBMAX_s,a[c++]*=1+.029*l*l/m.SBMAX_s/m.SBMAX_s;s[r][i]=0|Math.max(n[r][i],.9*s[r][i])}},this.VBR_new_prepare=function(e,s,r,i,o,a){var c,l=e.internal_flags,h=1,u=0,d=0;if(e.free_format){l.bitrate_index=0;p=new MeanBits(u);c=t.ResvFrameBegin(e,p),u=p.bits,o[0]=c}else{l.bitrate_index=l.VBR_max_bitrate;var p=new MeanBits(u);t.ResvFrameBegin(e,p),u=p.bits,get_framebits(e,o),c=o[l.VBR_max_bitrate]}for(var f=0;f<l.mode_gr;f++){n.on_pe(e,s,a[f],u,f,0),l.mode_ext==m.MPG_MD_MS_LR&&ms_convert(l.l3_side,f);for(var g=0;g<l.channels_out;++g){var _=l.l3_side.tt[f][g];l.masking_lower=Math.pow(10,.1*l.PSY.mask_adjust),init_outer_loop(l,_),0!=n.calc_xmin(e,r[f][g],_,i[f][g])&&(h=0),d+=a[f][g]}}for(f=0;f<l.mode_gr;f++)for(g=0;g<l.channels_out;g++)d>c&&(a[f][g]*=c,a[f][g]/=d);return h},this.calc_target_bits=function(s,r,i,o,a,c){var l,h,u,d,p=s.internal_flags,f=p.l3_side,g=0;p.bitrate_index=p.VBR_max_bitrate;var _=new MeanBits(g);for(c[0]=t.ResvFrameBegin(s,_),g=_.bits,p.bitrate_index=1,g=e.getframebits(s)-8*p.sideinfo_len,a[0]=g/(p.mode_gr*p.channels_out),g=s.VBR_mean_bitrate_kbps*s.framesize*1e3,0!=(1&p.substep_shaping)&&(g*=1.09),g/=s.out_samplerate,g-=8*p.sideinfo_len,g/=p.mode_gr*p.channels_out,(l=.93+.07*(11-s.compression_ratio)/5.5)<.9&&(l=.9),l>1&&(l=1),h=0;h<p.mode_gr;h++){var v=0;for(u=0;u<p.channels_out;u++){if(o[h][u]=int(l*g),r[h][u]>700){var b=int((r[h][u]-700)/1.4),y=f.tt[h][u];o[h][u]=int(l*g),y.block_type==m.SHORT_TYPE&&b<g/2&&(b=g/2),b>3*g/2?b=3*g/2:b<0&&(b=0),o[h][u]+=b}o[h][u]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(o[h][u]=LameInternalFlags.MAX_BITS_PER_CHANNEL),v+=o[h][u]}if(v>LameInternalFlags.MAX_BITS_PER_GRANULE)for(u=0;u<p.channels_out;++u)o[h][u]*=LameInternalFlags.MAX_BITS_PER_GRANULE,o[h][u]/=v}if(p.mode_ext==m.MPG_MD_MS_LR)for(h=0;h<p.mode_gr;h++)n.reduce_side(o[h],i[h],g*p.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(d=0,h=0;h<p.mode_gr;h++)for(u=0;u<p.channels_out;u++)o[h][u]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(o[h][u]=LameInternalFlags.MAX_BITS_PER_CHANNEL),d+=o[h][u];if(d>c[0])for(h=0;h<p.mode_gr;h++)for(u=0;u<p.channels_out;u++)o[h][u]*=c[0],o[h][u]/=d}}},70429:(e,t,n)=>{var s=n(80302),r=n(51038),i=(r.System,r.VbrMode),o=r.Float,a=(r.ShortBlock,r.Util),c=(r.Arrays,r.new_array_n,r.new_byte,r.new_double,r.new_float),l=(r.new_float_n,r.new_int),h=(r.new_int_n,r.assert),u=n(60687),d=n(23134),m=n(91998);function p(){var e=null,t=null,n=null;this.setModules=function(s,r,i){e=s,t=r,n=i},this.IPOW20=function(e){return h(0<=e&&e<p.Q_MAX),w[e]};var r=2220446049250313e-31,f=p.IXMAX_VAL+2,g=p.Q_MAX,_=p.Q_MAX2,v=(p.LARGE_BITS,100);this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var b=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=b,this.sfBandIndex=[new s([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new s([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new s([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new s([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new s([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new s([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new s([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new s([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new s([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var y=c(g+_+1),w=c(g),k=c(f),x=c(f);function E(e,t){var s=n.ATHformula(t,e);return s-=v,s=Math.pow(10,s/10+e.ATHlower)}function S(e){this.s=e}this.adj43=x,this.iteration_init=function(t){var n,s=t.internal_flags,r=s.l3_side;if(0==s.iteration_init_init){for(s.iteration_init_init=1,r.main_data_begin=0,function(e){for(var t=e.internal_flags.ATH.l,n=e.internal_flags.ATH.psfb21,s=e.internal_flags.ATH.s,r=e.internal_flags.ATH.psfb12,i=e.internal_flags,a=e.out_samplerate,c=0;c<u.SBMAX_l;c++){var l=i.scalefac_band.l[c],h=i.scalefac_band.l[c+1];t[c]=o.MAX_VALUE;for(var d=l;d<h;d++){var m=E(e,d*a/1152);t[c]=Math.min(t[c],m)}}for(c=0;c<u.PSFB21;c++)for(l=i.scalefac_band.psfb21[c],h=i.scalefac_band.psfb21[c+1],n[c]=o.MAX_VALUE,d=l;d<h;d++)m=E(e,d*a/1152),n[c]=Math.min(n[c],m);for(c=0;c<u.SBMAX_s;c++){for(l=i.scalefac_band.s[c],h=i.scalefac_band.s[c+1],s[c]=o.MAX_VALUE,d=l;d<h;d++)m=E(e,d*a/384),s[c]=Math.min(s[c],m);s[c]*=i.scalefac_band.s[c+1]-i.scalefac_band.s[c]}for(c=0;c<u.PSFB12;c++){for(l=i.scalefac_band.psfb12[c],h=i.scalefac_band.psfb12[c+1],r[c]=o.MAX_VALUE,d=l;d<h;d++)m=E(e,d*a/384),r[c]=Math.min(r[c],m);r[c]*=i.scalefac_band.s[13]-i.scalefac_band.s[12]}if(e.noATH){for(c=0;c<u.SBMAX_l;c++)t[c]=1e-20;for(c=0;c<u.PSFB21;c++)n[c]=1e-20;for(c=0;c<u.SBMAX_s;c++)s[c]=1e-20;for(c=0;c<u.PSFB12;c++)r[c]=1e-20}i.ATH.floor=10*Math.log10(E(e,-1))}(t),k[0]=0,n=1;n<f;n++)k[n]=Math.pow(n,4/3);for(n=0;n<f-1;n++)x[n]=n+1-Math.pow(.5*(k[n]+k[n+1]),.75);for(x[n]=.5,n=0;n<g;n++)w[n]=Math.pow(2,-.1875*(n-210));for(n=0;n<=g+_;n++)y[n]=Math.pow(2,.25*(n-210-_));var i,a,c,l;for(e.huffman_init(s),(n=t.exp_nspsytune>>2&63)>=32&&(n-=64),i=Math.pow(10,n/4/10),(n=t.exp_nspsytune>>8&63)>=32&&(n-=64),a=Math.pow(10,n/4/10),(n=t.exp_nspsytune>>14&63)>=32&&(n-=64),c=Math.pow(10,n/4/10),(n=t.exp_nspsytune>>20&63)>=32&&(n-=64),l=c*Math.pow(10,n/4/10),n=0;n<u.SBMAX_l;n++){h=n<=6?i:n<=13?a:n<=20?c:l,s.nsPsy.longfact[n]=h}for(n=0;n<u.SBMAX_s;n++){var h;h=n<=5?i:n<=10?a:n<=11?c:l,s.nsPsy.shortfact[n]=h}}},this.on_pe=function(e,n,s,r,i,o){var a,c,u=e.internal_flags,p=0,f=l(2),g=new d(p),_=t.ResvMaxBits(e,r,g,o),v=(p=g.bits)+_;for(v>m.MAX_BITS_PER_GRANULE&&(v=m.MAX_BITS_PER_GRANULE),a=0,c=0;c<u.channels_out;++c)s[c]=Math.min(m.MAX_BITS_PER_CHANNEL,p/u.channels_out),f[c]=0|s[c]*n[i][c]/700-s[c],f[c]>3*r/4&&(f[c]=3*r/4),f[c]<0&&(f[c]=0),f[c]+s[c]>m.MAX_BITS_PER_CHANNEL&&(f[c]=Math.max(0,m.MAX_BITS_PER_CHANNEL-s[c])),a+=f[c];if(a>_)for(c=0;c<u.channels_out;++c)f[c]=_*f[c]/a;for(c=0;c<u.channels_out;++c)s[c]+=f[c],_-=f[c];for(a=0,c=0;c<u.channels_out;++c)a+=s[c];if(a>m.MAX_BITS_PER_GRANULE){var b=0;for(c=0;c<u.channels_out;++c)s[c]*=m.MAX_BITS_PER_GRANULE,s[c]/=a,b+=s[c];h(b<=m.MAX_BITS_PER_GRANULE)}return v},this.reduce_side=function(e,t,n,s){h(s<=m.MAX_BITS_PER_GRANULE),h(e[0]+e[1]<=m.MAX_BITS_PER_GRANULE);var r=.33*(.5-t)/.5;r<0&&(r=0),r>.5&&(r=.5);var i=0|.5*r*(e[0]+e[1]);i>m.MAX_BITS_PER_CHANNEL-e[0]&&(i=m.MAX_BITS_PER_CHANNEL-e[0]),i<0&&(i=0),e[1]>=125&&(e[1]-i>125?(e[0]<n&&(e[0]+=i),e[1]-=i):(e[0]+=e[1]-125,e[1]=125)),(i=e[0]+e[1])>s&&(e[0]=s*e[0]/i,e[1]=s*e[1]/i),h(e[0]<=m.MAX_BITS_PER_CHANNEL),h(e[1]<=m.MAX_BITS_PER_CHANNEL),h(e[0]+e[1]<=m.MAX_BITS_PER_GRANULE)},this.athAdjust=function(e,t,n){var s=90.30873362,r=a.FAST_LOG10_X(t,10),i=e*e,o=0;return r-=n,i>1e-20&&(o=1+a.FAST_LOG10_X(i,10/s)),o<0&&(o=0),r*=o,r+=n+s-94.82444863,Math.pow(10,.1*r)},this.calc_xmin=function(e,t,n,s){var o,a=0,c=e.internal_flags,l=0,h=0,d=c.ATH,m=n.xr,p=e.VBR==i.vbr_mtrh?1:0,f=c.masking_lower;for(e.VBR!=i.vbr_mtrh&&e.VBR!=i.vbr_mt||(f=1),o=0;o<n.psy_lmax;o++){x=(k=e.VBR==i.vbr_rh||e.VBR==i.vbr_mtrh?athAdjust(d.adjust,d.l[o],d.floor):d.adjust*d.l[o])/(b=n.width[o]),E=r,I=b>>1,C=0;do{C+=R=m[l]*m[l],E+=R<x?R:x,C+=A=m[++l]*m[l],E+=A<x?A:x,l++}while(--I>0);if(C>k&&h++,o==u.SBPSY_l)E<(T=k*c.nsPsy.longfact[o])&&(E=T);if(0!=p&&(k=E),!e.ATHonly)if((S=t.en.l[o])>0)T=C*t.thm.l[o]*f/S,0!=p&&(T*=c.nsPsy.longfact[o]),k<T&&(k=T);s[a++]=0!=p?k:k*c.nsPsy.longfact[o]}var g=575;if(n.block_type!=u.SHORT_TYPE)for(var _=576;0!=_--&&BitStream.EQ(m[_],0);)g=_;n.max_nonzero_coeff=g;for(var v=n.sfb_smin;o<n.psymax;v++,o+=3){var b,y,w;for(w=e.VBR==i.vbr_rh||e.VBR==i.vbr_mtrh?athAdjust(d.adjust,d.s[v],d.floor):d.adjust*d.s[v],b=n.width[o],y=0;y<3;y++){var k,x,E,S,T,C=0,I=b>>1;x=w/b,E=r;do{var R,A;C+=R=m[l]*m[l],E+=R<x?R:x,C+=A=m[++l]*m[l],E+=A<x?A:x,l++}while(--I>0);if(C>w&&h++,v==u.SBPSY_s)E<(T=w*c.nsPsy.shortfact[v])&&(E=T);if(k=0!=p?E:w,!e.ATHonly&&!e.ATHshort)if((S=t.en.s[v][y])>0)T=C*t.thm.s[v][y]*f/S,0!=p&&(T*=c.nsPsy.shortfact[v]),k<T&&(k=T);s[a++]=0!=p?k:k*c.nsPsy.shortfact[v]}e.useTemporal&&(s[a-3]>s[a-3+1]&&(s[a-3+1]+=(s[a-3]-s[a-3+1])*c.decay),s[a-3+1]>s[a-3+2]&&(s[a-3+2]+=(s[a-3+1]-s[a-3+2])*c.decay))}return h},this.calc_noise_core=function(e,t,n,s){var r=0,i=t.s,o=e.l3_enc;if(i>e.count1)for(;0!=n--;){l=e.xr[i],i++,r+=l*l,l=e.xr[i],i++,r+=l*l}else if(i>e.big_values){var a=c(2);for(a[0]=0,a[1]=s;0!=n--;){l=Math.abs(e.xr[i])-a[o[i]],i++,r+=l*l,l=Math.abs(e.xr[i])-a[o[i]],i++,r+=l*l}}else for(;0!=n--;){var l;l=Math.abs(e.xr[i])-k[o[i]]*s,i++,r+=l*l,l=Math.abs(e.xr[i])-k[o[i]]*s,i++,r+=l*l}return t.s=i,r},this.calc_noise=function(e,t,n,s,r){var i,o,c,l=0,u=0,d=0,m=0,f=0,g=-20,_=0,v=e.scalefac,w=0;for(s.over_SSD=0,i=0;i<e.psymax;i++){var k,x=e.global_gain-(v[w++]+(0!=e.preflag?b[i]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[i]],E=0;if(null!=r&&r.step[i]==x)E=r.noise[i],_+=e.width[i],n[l++]=E/t[u++],E=r.noise_log[i];else{var T,C=(h(0<=(c=x)+p.Q_MAX2&&c<p.Q_MAX),y[c+p.Q_MAX2]);if(o=e.width[i]>>1,_+e.width[i]>e.max_nonzero_coeff)o=(T=e.max_nonzero_coeff-_+1)>0?T>>1:0;var I=new S(_);E=this.calc_noise_core(e,I,o,C),_=I.s,null!=r&&(r.step[i]=x,r.noise[i]=E),E=n[l++]=E/t[u++],E=a.FAST_LOG10(Math.max(E,1e-20)),null!=r&&(r.noise_log[i]=E)}if(null!=r&&(r.global_gain=e.global_gain),f+=E,E>0)k=Math.max(0|10*E+.5,1),s.over_SSD+=k*k,d++,m+=E;g=Math.max(g,E)}return s.over_count=d,s.tot_noise=f,s.over_noise=m,s.max_noise=g,d},this.set_pinfo=function(e,t,n,s,r){var i,o,a,l,d,m=e.internal_flags,p=0==t.scalefac_scale?.5:1,f=t.scalefac,g=c(L3Side.SFBMAX),_=c(L3Side.SFBMAX),v=new CalcNoiseResult;calc_xmin(e,n,t,g),calc_noise(t,g,_,v,null);var y=0;for(o=t.sfb_lmax,t.block_type!=u.SHORT_TYPE&&0==t.mixed_block_flag&&(o=22),i=0;i<o;i++){var w=m.scalefac_band.l[i],k=(x=m.scalefac_band.l[i+1])-w;for(l=0;y<x;y++)l+=t.xr[y]*t.xr[y];l/=k,d=1e15,m.pinfo.en[s][r][i]=d*l,m.pinfo.xfsf[s][r][i]=d*g[i]*_[i]/k,n.en.l[i]>0&&!e.ATHonly?l/=n.en.l[i]:l=0,m.pinfo.thr[s][r][i]=d*Math.max(l*n.thm.l[i],m.ATH.l[i]),m.pinfo.LAMEsfb[s][r][i]=0,0!=t.preflag&&i>=11&&(m.pinfo.LAMEsfb[s][r][i]=-p*b[i]),i<u.SBPSY_l&&(h(f[i]>=0),m.pinfo.LAMEsfb[s][r][i]-=p*f[i])}if(t.block_type==u.SHORT_TYPE)for(o=i,i=t.sfb_smin;i<u.SBMAX_s;i++){w=m.scalefac_band.s[i],k=(x=m.scalefac_band.s[i+1])-w;for(var x,E=0;E<3;E++){for(l=0,a=w;a<x;a++)l+=t.xr[y]*t.xr[y],y++;l=Math.max(l/k,1e-20),d=1e15,m.pinfo.en_s[s][r][3*i+E]=d*l,m.pinfo.xfsf_s[s][r][3*i+E]=d*g[o]*_[o]/k,n.en.s[i][E]>0?l/=n.en.s[i][E]:l=0,(e.ATHonly||e.ATHshort)&&(l=0),m.pinfo.thr_s[s][r][3*i+E]=d*Math.max(l*n.thm.s[i][E],m.ATH.s[i]),m.pinfo.LAMEsfb_s[s][r][3*i+E]=-2*t.subblock_gain[E],i<u.SBPSY_s&&(m.pinfo.LAMEsfb_s[s][r][3*i+E]-=p*f[o]),o++}}m.pinfo.LAMEqss[s][r]=t.global_gain,m.pinfo.LAMEmainbits[s][r]=t.part2_3_length+t.part2_length,m.pinfo.LAMEsfbits[s][r]=t.part2_length,m.pinfo.over[s][r]=v.over_count,m.pinfo.max_noise[s][r]=10*v.max_noise,m.pinfo.over_noise[s][r]=10*v.over_noise,m.pinfo.tot_noise[s][r]=10*v.tot_noise,m.pinfo.over_SSD[s][r]=v.over_SSD}}p.Q_MAX=257,p.Q_MAX2=116,p.LARGE_BITS=1e5,p.IXMAX_VAL=8206,e.exports=p},41062:(e,t,n)=>{var s=n(51038),r=(s.System,s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays,s.new_array_n,s.new_byte,s.new_double,s.new_float),i=(s.new_float_n,s.new_int),o=(s.new_int_n,s.assert,n(51287));e.exports=function(){this.linprebuf=r(2*o.MAX_ORDER),this.linpre=0,this.lstepbuf=r(o.MAX_SAMPLES_PER_WINDOW+o.MAX_ORDER),this.lstep=0,this.loutbuf=r(o.MAX_SAMPLES_PER_WINDOW+o.MAX_ORDER),this.lout=0,this.rinprebuf=r(2*o.MAX_ORDER),this.rinpre=0,this.rstepbuf=r(o.MAX_SAMPLES_PER_WINDOW+o.MAX_ORDER),this.rstep=0,this.routbuf=r(o.MAX_SAMPLES_PER_WINDOW+o.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=i(0|o.STEPS_per_dB*o.MAX_dB),this.B=i(0|o.STEPS_per_dB*o.MAX_dB)}},93060:(e,t,n)=>{var s=n(51038).assert;e.exports=function(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,n){var r,i=t.internal_flags,o=i.l3_side,a=e.getframebits(t);n.bits=(a-8*i.sideinfo_len)/i.mode_gr;var c=2048*i.mode_gr-8;t.brate>320?r=8*int(1e3*t.brate/(t.out_samplerate/1152)/8+.5):(r=11520,t.strict_ISO&&(r=8*int(32e4/(t.out_samplerate/1152)/8+.5))),i.ResvMax=r-a,i.ResvMax>c&&(i.ResvMax=c),(i.ResvMax<0||t.disable_reservoir)&&(i.ResvMax=0);var l=n.bits*i.mode_gr+Math.min(i.ResvSize,i.ResvMax);return l>r&&(l=r),s(0==i.ResvMax%8),s(i.ResvMax>=0),o.resvDrain_pre=0,null!=i.pinfo&&(i.pinfo.mean_bits=n.bits/2,i.pinfo.resvsize=i.ResvSize),l},this.ResvMaxBits=function(e,t,n,s){var r,i=e.internal_flags,o=i.ResvSize,a=i.ResvMax;0!=s&&(o+=t),0!=(1&i.substep_shaping)&&(a*=.9),n.bits=t,10*o>9*a?(r=o-9*a/10,n.bits+=r,i.substep_shaping|=128):(r=0,i.substep_shaping&=127,e.disable_reservoir||0!=(1&i.substep_shaping)||(n.bits-=.1*t));var c=o<6*i.ResvMax/10?o:6*i.ResvMax/10;return(c-=r)<0&&(c=0),c},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var n,r=e.l3_side;e.ResvSize+=t*e.mode_gr;var i=0;r.resvDrain_post=0,r.resvDrain_pre=0,0!=(n=e.ResvSize%8)&&(i+=n),(n=e.ResvSize-i-e.ResvMax)>0&&(s(0==n%8),s(n>=0),i+=n);var o=Math.min(8*r.main_data_begin,i)/8;r.resvDrain_pre+=8*o,i-=8*o,e.ResvSize-=8*o,r.main_data_begin-=o,r.resvDrain_post+=i,e.ResvSize-=i}}},80302:(e,t,n)=>{var s=n(51038),r=s.System,i=(s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays,s.new_array_n,s.new_byte,s.new_double,s.new_float,s.new_float_n,s.new_int),o=(s.new_int_n,s.assert,n(60687));e.exports=function(e,t,n,s){this.l=i(1+o.SBMAX_l),this.s=i(1+o.SBMAX_s),this.psfb21=i(1+o.PSFB21),this.psfb12=i(1+o.PSFB12);var a=this.l,c=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],r.arraycopy(this.arrL,0,a,0,Math.min(this.arrL.length,this.l.length)),r.arraycopy(this.arrS,0,c,0,Math.min(this.arrS.length,this.s.length)),r.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),r.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}},77721:e=>{function t(e,t,n,s){this.xlen=e,this.linmax=t,this.table=n,this.hlen=s}var n={t1HB:[1,1,1,0],t2HB:[1,2,1,3,1,1,3,2,0],t3HB:[3,2,1,1,1,1,3,2,0],t5HB:[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],t6HB:[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],t7HB:[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],t8HB:[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],t9HB:[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],t10HB:[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],t11HB:[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],t12HB:[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],t13HB:[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],t15HB:[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],t16HB:[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],t24HB:[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],t32HB:[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],t33HB:[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],t1l:[1,4,3,5],t2l:[1,4,7,4,5,7,6,7,8],t3l:[2,3,7,4,4,7,6,7,8],t5l:[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],t6l:[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],t7l:[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],t8l:[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],t9l:[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],t10l:[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],t11l:[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],t12l:[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],t13l:[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],t15l:[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],t16_5l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],t16l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],t24l:[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],t32l:[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],t33l:[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8]};n.ht=[new t(0,0,null,null),new t(2,0,n.t1HB,n.t1l),new t(3,0,n.t2HB,n.t2l),new t(3,0,n.t3HB,n.t3l),new t(0,0,null,null),new t(4,0,n.t5HB,n.t5l),new t(4,0,n.t6HB,n.t6l),new t(6,0,n.t7HB,n.t7l),new t(6,0,n.t8HB,n.t8l),new t(6,0,n.t9HB,n.t9l),new t(8,0,n.t10HB,n.t10l),new t(8,0,n.t11HB,n.t11l),new t(8,0,n.t12HB,n.t12l),new t(16,0,n.t13HB,n.t13l),new t(0,0,null,n.t16_5l),new t(16,0,n.t15HB,n.t15l),new t(1,1,n.t16HB,n.t16l),new t(2,3,n.t16HB,n.t16l),new t(3,7,n.t16HB,n.t16l),new t(4,15,n.t16HB,n.t16l),new t(6,63,n.t16HB,n.t16l),new t(8,255,n.t16HB,n.t16l),new t(10,1023,n.t16HB,n.t16l),new t(13,8191,n.t16HB,n.t16l),new t(4,15,n.t24HB,n.t24l),new t(5,31,n.t24HB,n.t24l),new t(6,63,n.t24HB,n.t24l),new t(7,127,n.t24HB,n.t24l),new t(8,255,n.t24HB,n.t24l),new t(9,511,n.t24HB,n.t24l),new t(11,2047,n.t24HB,n.t24l),new t(13,8191,n.t24HB,n.t24l),new t(0,0,n.t32HB,n.t32l),new t(0,0,n.t33HB,n.t33l)],n.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],n.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],n.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],n.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],n.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],n.scfsi_band=[0,6,11,16,21],e.exports=n},15638:(e,t,n)=>{var s=n(51038),r=s.System,i=(s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays),o=(s.new_array_n,s.new_byte,s.new_double,s.new_float,s.new_float_n,s.new_int),a=(s.new_int_n,s.assert),c=n(60687),l=n(77721),h=n(29438),u=n(70429);e.exports=function e(){var t=null;function n(e){this.bits=0|e}this.qupvt=null,this.setModules=function(e){this.qupvt=e,t=e};var s=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function d(e,t,n,s,r,i){var o=.5946/t;for(a(e>0),e>>=1;0!=e--;)r[i++]=o>n[s++]?0:1,r[i++]=o>n[s++]?0:1}function m(e,n,s,r,i,o){a(e>0);var c=(e>>=1)%2;for(e>>=1;0!=e--;){var l,h,u,d,m,p,f,g;l=s[r++]*n,h=s[r++]*n,m=0|l,u=s[r++]*n,p=0|h,d=s[r++]*n,f=0|u,l+=t.adj43[m],g=0|d,h+=t.adj43[p],i[o++]=0|l,u+=t.adj43[f],i[o++]=0|h,d+=t.adj43[g],i[o++]=0|u,i[o++]=0|d}0!=c&&(m=0|(l=s[r++]*n),p=0|(h=s[r++]*n),l+=t.adj43[m],h+=t.adj43[p],i[o++]=0|l,i[o++]=0|h)}var p=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function f(e,t,n,s){var r=function(e,t,n){var s=0,r=0;do{var i=e[t++],o=e[t++];s<i&&(s=i),r<o&&(r=o)}while(t<n);return s<r&&(s=r),s}(e,t,n);switch(r){case 0:return r;case 1:return function(e,t,n,s){var r=0,i=l.ht[1].hlen;do{var o=2*e[t+0]+e[t+1];t+=2,r+=i[o]}while(t<n);return s.bits+=r,1}(e,t,n,s);case 2:case 3:return function(e,t,n,s,r){var i,o,a=0,c=l.ht[s].xlen;o=2==s?l.table23:l.table56;do{var h=e[t+0]*c+e[t+1];t+=2,a+=o[h]}while(t<n);return i=65535&a,(a>>=16)>i&&(a=i,s++),r.bits+=a,s}(e,t,n,p[r-1],s);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return function(e,t,n,s,r){var i=0,o=0,a=0,c=l.ht[s].xlen,h=l.ht[s].hlen,u=l.ht[s+1].hlen,d=l.ht[s+2].hlen;do{var m=e[t+0]*c+e[t+1];t+=2,i+=h[m],o+=u[m],a+=d[m]}while(t<n);var p=s;return i>o&&(i=o,p++),i>a&&(i=a,p=s+2),r.bits+=i,p}(e,t,n,p[r-1],s);default:if(r>u.IXMAX_VAL)return s.bits=u.LARGE_BITS,-1;var i,o;for(r-=15,i=24;i<32&&!(l.ht[i].linmax>=r);i++);for(o=i-8;o<24&&!(l.ht[o].linmax>=r);o++);return function(e,t,n,s,r,i){var o,a=65536*l.ht[s].xlen+l.ht[r].xlen,c=0;do{var h=e[t++],u=e[t++];0!=h&&(h>14&&(h=15,c+=a),h*=16),0!=u&&(u>14&&(u=15,c+=a),h+=u),c+=l.largetbl[h]}while(t<n);return o=65535&c,(c>>=16)>o&&(c=o,s=r),i.bits+=c,s}(e,t,n,o,i,s)}}function g(e,t,s,r,i,o,a,l){for(var h=t.big_values,u=2;u<c.SBMAX_l+1;u++){var d=e.scalefac_band.l[u];if(d>=h)break;var m=i[u-2]+t.count1bits;if(s.part2_3_length<=m)break;var p=new n(m),g=f(r,d,h,p);m=p.bits,s.part2_3_length<=m||(s.assign(t),s.part2_3_length=m,s.region0_count=o[u-2],s.region1_count=u-2-o[u-2],s.table_select[0]=a[u-2],s.table_select[1]=l[u-2],s.table_select[2]=g)}}this.noquant_count_bits=function(e,t,s){var r=t.l3_enc,i=Math.min(576,t.max_nonzero_coeff+2>>1<<1);for(null!=s&&(s.sfb_count1=0);i>1&&0==(r[i-1]|r[i-2]);i-=2);t.count1=i;for(var o=0,h=0;i>3;i-=4){var u;if((2147483647&(r[i-1]|r[i-2]|r[i-3]|r[i-4]))>1)break;u=2*(2*(2*r[i-4]+r[i-3])+r[i-2])+r[i-1],o+=l.t32l[u],h+=l.t33l[u]}var d=o;if(t.count1table_select=0,o>h&&(d=h,t.count1table_select=1),t.count1bits=d,t.big_values=i,0==i)return d;if(t.block_type==c.SHORT_TYPE)(o=3*e.scalefac_band.s[3])>t.big_values&&(o=t.big_values),h=t.big_values;else if(t.block_type==c.NORM_TYPE){if(a(i<=576),o=t.region0_count=e.bv_scf[i-2],h=t.region1_count=e.bv_scf[i-1],a(o+h+2<c.SBPSY_l),h=e.scalefac_band.l[o+h+2],o=e.scalefac_band.l[o+1],h<i){var m=new n(d);t.table_select[2]=f(r,h,i,m),d=m.bits}}else t.region0_count=7,t.region1_count=c.SBMAX_l-1-7-1,(o=e.scalefac_band.l[8])>(h=i)&&(o=h);if(o=Math.min(o,i),h=Math.min(h,i),a(o>=0),a(h>=0),0<o){m=new n(d);t.table_select[0]=f(r,0,o,m),d=m.bits}if(o<h){m=new n(d);t.table_select[1]=f(r,o,h,m),d=m.bits}if(2==e.use_best_huffman&&(t.part2_3_length=d,best_huffman_divide(e,t),d=t.part2_3_length),null!=s&&t.block_type==c.NORM_TYPE){for(var p=0;e.scalefac_band.l[p]<t.big_values;)p++;s.sfb_count1=p}return d},this.count_bits=function(e,n,s,r){var o=s.l3_enc,l=u.IXMAX_VAL/t.IPOW20(s.global_gain);if(s.xrpow_max>l)return u.LARGE_BITS;if(function(e,n,s,r,o){var l,h,u,p=0,f=0,g=0,_=0,v=n,b=0,y=v,w=0,k=e,x=0;for(u=null!=o&&r.global_gain==o.global_gain,h=r.block_type==c.SHORT_TYPE?38:21,l=0;l<=h;l++){var E=-1;if((u||r.block_type==c.NORM_TYPE)&&(E=r.global_gain-(r.scalefac[l]+(0!=r.preflag?t.pretab[l]:0)<<r.scalefac_scale+1)-8*r.subblock_gain[r.window[l]]),a(r.width[l]>=0),u&&o.step[l]==E)0!=f&&(m(f,s,k,x,y,w),f=0),0!=g&&(d(g,s,k,x,y,w),g=0);else{var S,T=r.width[l];if(p+r.width[l]>r.max_nonzero_coeff&&(S=r.max_nonzero_coeff-p+1,i.fill(n,r.max_nonzero_coeff,576,0),(T=S)<0&&(T=0),l=h+1),0==f&&0==g&&(y=v,w=b,k=e,x=_),null!=o&&o.sfb_count1>0&&l>=o.sfb_count1&&o.step[l]>0&&E>=o.step[l]?(0!=f&&(m(f,s,k,x,y,w),f=0,y=v,w=b,k=e,x=_),g+=T):(0!=g&&(d(g,s,k,x,y,w),g=0,y=v,w=b,k=e,x=_),f+=T),T<=0){0!=g&&(d(g,s,k,x,y,w),g=0),0!=f&&(m(f,s,k,x,y,w),f=0);break}}l<=h&&(b+=r.width[l],_+=r.width[l],p+=r.width[l])}0!=f&&(m(f,s,k,x,y,w),f=0),0!=g&&(d(g,s,k,x,y,w),g=0)}(n,o,t.IPOW20(s.global_gain),s,r),0!=(2&e.substep_shaping))for(var h=0,p=s.global_gain+s.scalefac_scale,f=.634521682242439/t.IPOW20(p),g=0;g<s.sfbmax;g++){var _,v=s.width[g];if(a(v>=0),0==e.pseudohalf[g])h+=v;else for(_=h,h+=v;_<h;++_)o[_]=n[_]>=f?o[_]:0}return this.noquant_count_bits(e,s,r)},this.best_huffman_divide=function(e,t){var s=new h,r=t.l3_enc,i=o(23),d=o(23),m=o(23),p=o(23);if(t.block_type!=c.SHORT_TYPE||1!=e.mode_gr){s.assign(t),t.block_type==c.NORM_TYPE&&(!function(e,t,s,r,i,o,a){for(var c=t.big_values,l=0;l<=22;l++)r[l]=u.LARGE_BITS;for(l=0;l<16;l++){var h=e.scalefac_band.l[l+1];if(h>=c)break;var d=0,m=new n(d),p=f(s,0,h,m);d=m.bits;for(var g=0;g<8;g++){var _=e.scalefac_band.l[l+g+2];if(_>=c)break;var v=d,b=f(s,h,_,m=new n(v));v=m.bits,r[l+g]>v&&(r[l+g]=v,i[l+g]=l,o[l+g]=p,a[l+g]=b)}}}(e,t,r,i,d,m,p),g(e,s,t,r,i,d,m,p));var _=s.big_values;if(!(0==_||(r[_-2]|r[_-1])>1||(_=t.count1+2)>576)){s.assign(t),s.count1=_;var v=0,b=0;for(a(_<=576);_>s.big_values;_-=4){var y=2*(2*(2*r[_-4]+r[_-3])+r[_-2])+r[_-1];v+=l.t32l[y],b+=l.t33l[y]}if(s.big_values=_,s.count1table_select=0,v>b&&(v=b,s.count1table_select=1),s.count1bits=v,s.block_type==c.NORM_TYPE)g(e,s,t,r,i,d,m,p);else{if(s.part2_3_length=v,(v=e.scalefac_band.l[8])>_&&(v=_),v>0){var w=new n(s.part2_3_length);s.table_select[0]=f(r,0,v,w),s.part2_3_length=w.bits}if(_>v){w=new n(s.part2_3_length);s.table_select[1]=f(r,v,_,w),s.part2_3_length=w.bits}t.part2_3_length>s.part2_3_length&&t.assign(s)}}}};var _=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],v=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],b=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],y=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];e.slen1_tab=b,e.slen2_tab=y,this.best_scalefac_store=function(e,n,s,r){var i,o,h,u,d=r.tt[n][s],m=0;for(h=0,i=0;i<d.sfbmax;i++){var p=d.width[i];for(a(p>=0),h+=p,u=-p;u<0&&0==d.l3_enc[u+h];u++);0==u&&(d.scalefac[i]=m=-2)}if(0==d.scalefac_scale&&0==d.preflag){var f=0;for(i=0;i<d.sfbmax;i++)d.scalefac[i]>0&&(f|=d.scalefac[i]);if(0==(1&f)&&0!=f){for(i=0;i<d.sfbmax;i++)d.scalefac[i]>0&&(d.scalefac[i]>>=1);d.scalefac_scale=m=1}}if(0==d.preflag&&d.block_type!=c.SHORT_TYPE&&2==e.mode_gr){for(i=11;i<c.SBPSY_l&&!(d.scalefac[i]<t.pretab[i]&&-2!=d.scalefac[i]);i++);if(i==c.SBPSY_l){for(i=11;i<c.SBPSY_l;i++)d.scalefac[i]>0&&(d.scalefac[i]-=t.pretab[i]);d.preflag=m=1}}for(o=0;o<4;o++)r.scfsi[s][o]=0;for(2==e.mode_gr&&1==n&&r.tt[0][s].block_type!=c.SHORT_TYPE&&r.tt[1][s].block_type!=c.SHORT_TYPE&&(!function(e,t){for(var n,s=t.tt[1][e],r=t.tt[0][e],i=0;i<l.scfsi_band.length-1;i++){for(n=l.scfsi_band[i];n<l.scfsi_band[i+1]&&!(r.scalefac[n]!=s.scalefac[n]&&s.scalefac[n]>=0);n++);if(n==l.scfsi_band[i+1]){for(n=l.scfsi_band[i];n<l.scfsi_band[i+1];n++)s.scalefac[n]=-1;t.scfsi[e][i]=1}}var o=0,a=0;for(n=0;n<11;n++)-1!=s.scalefac[n]&&(a++,o<s.scalefac[n]&&(o=s.scalefac[n]));for(var h=0,u=0;n<c.SBPSY_l;n++)-1!=s.scalefac[n]&&(u++,h<s.scalefac[n]&&(h=s.scalefac[n]));for(i=0;i<16;i++)if(o<_[i]&&h<v[i]){var d=b[i]*a+y[i]*u;s.part2_length>d&&(s.part2_length=d,s.scalefac_compress=i)}}(s,r),m=0),i=0;i<d.sfbmax;i++)-2==d.scalefac[i]&&(d.scalefac[i]=0);0!=m&&(2==e.mode_gr?this.scale_bitcount(d):this.scale_bitcount_lsf(e,d))};var w=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],k=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],x=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var n,s,r,i=0,o=0,l=e.scalefac;if(a(function(e,t){for(var n=0;n<t;++n)if(e[n]<0)return!1;return!0}(l,e.sfbmax)),e.block_type==c.SHORT_TYPE)r=w,0!=e.mixed_block_flag&&(r=k);else if(r=x,0==e.preflag){for(s=11;s<c.SBPSY_l&&!(l[s]<t.pretab[s]);s++);if(s==c.SBPSY_l)for(e.preflag=1,s=11;s<c.SBPSY_l;s++)l[s]-=t.pretab[s]}for(s=0;s<e.sfbdivide;s++)i<l[s]&&(i=l[s]);for(;s<e.sfbmax;s++)o<l[s]&&(o=l[s]);for(e.part2_length=u.LARGE_BITS,n=0;n<16;n++)i<_[n]&&o<v[n]&&e.part2_length>r[n]&&(e.part2_length=r[n],e.scalefac_compress=n);return e.part2_length==u.LARGE_BITS};var E=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,n){var s,i,l,h,u,d,m,p,f=o(4),g=n.scalefac;for(s=0!=n.preflag?2:0,m=0;m<4;m++)f[m]=0;if(n.block_type==c.SHORT_TYPE){i=1;var _=t.nr_of_sfb_block[s][i];for(p=0,l=0;l<4;l++)for(h=_[l]/3,m=0;m<h;m++,p++)for(u=0;u<3;u++)g[3*p+u]>f[l]&&(f[l]=g[3*p+u])}else{i=0;_=t.nr_of_sfb_block[s][i];for(p=0,l=0;l<4;l++)for(h=_[l],m=0;m<h;m++,p++)g[p]>f[l]&&(f[l]=g[p])}for(d=!1,l=0;l<4;l++)f[l]>E[s][l]&&(d=!0);if(!d){var v,b,y,w;for(n.sfb_partition_table=t.nr_of_sfb_block[s][i],l=0;l<4;l++)n.slen[l]=S[f[l]];switch(v=n.slen[0],b=n.slen[1],y=n.slen[2],w=n.slen[3],s){case 0:n.scalefac_compress=(5*v+b<<4)+(y<<2)+w;break;case 1:n.scalefac_compress=400+(5*v+b<<2)+y;break;case 2:n.scalefac_compress=500+3*v+b;break;default:r.err.printf("intensity stereo not implemented yet\n")}}if(!d)for(a(null!=n.sfb_partition_table),n.part2_length=0,l=0;l<4;l++)n.part2_length+=n.slen[l]*n.sfb_partition_table[l];return d};var S=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var n,r=0;e.scalefac_band.l[++r]<t;);for(n=s[r][0];e.scalefac_band.l[n+1]>t;)n--;for(n<0&&(n=s[r][0]),e.bv_scf[t-2]=n,n=s[r][1];e.scalefac_band.l[n+e.bv_scf[t-2]+2]>t;)n--;n<0&&(n=s[r][1]),e.bv_scf[t-1]=n}}}},77095:e=>{e.exports=function(){this.setModules=function(e,t){e,t}}},93362:e=>{e.exports=function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}},53398:(e,t,n)=>{var s=n(51038),r=s.System,i=s.VbrMode,o=(s.Float,s.ShortBlock),a=(s.Util,s.Arrays),c=(s.new_array_n,s.new_byte),l=(s.new_double,s.new_float,s.new_float_n,s.new_int,s.new_int_n,s.assert);function h(){var e,t,n;this.setModules=function(s,r,i){e=s,t=r,n=i};var s=h.NUMTOCENTRIES,u=h.MAXFRAMESIZE,d=s+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2,m="Xing",p="Info",f=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function g(e,t){var n=255&e[t+0];return n<<=8,n|=255&e[t+1],n<<=8,n|=255&e[t+2],n<<=8,n|=255&e[t+3]}function _(e,t,n){e[t+0]=255&n>>24,e[t+1]=255&n>>16,e[t+2]=255&n>>8,e[t+3]=255&n}function v(e,t,n){e[t+0]=255&n>>8,e[t+1]=255&n}function b(e,t,n){return 255&(e<<t|n&~(-1<<t))}function y(t,n){var s=t.internal_flags;n[0]=b(n[0],8,255),n[1]=b(n[1],3,7),n[1]=b(n[1],1,t.out_samplerate<16e3?0:1),n[1]=b(n[1],1,t.version),n[1]=b(n[1],2,1),n[1]=b(n[1],1,t.error_protection?0:1),n[2]=b(n[2],4,s.bitrate_index),n[2]=b(n[2],2,s.samplerate_index),n[2]=b(n[2],1,0),n[2]=b(n[2],1,t.extension),n[3]=b(n[3],2,t.mode.ordinal()),n[3]=b(n[3],2,s.mode_ext),n[3]=b(n[3],1,t.copyright),n[3]=b(n[3],1,t.original),n[3]=b(n[3],2,t.emphasis),n[0]=255;var r,o,a=241&n[1];r=1==t.version?128:t.out_samplerate<16e3?32:64,t.VBR==i.vbr_off&&(r=t.brate),o=t.free_format?0:255&16*e.BitrateIndex(r,t.version,t.out_samplerate),1==t.version?(n[1]=255&(10|a),a=13&n[2],n[2]=255&(o|a)):(n[1]=255&(2|a),a=13&n[2],n[2]=255&(o|a))}function w(e,t){return t=t>>8^f[255&(t^e)]}this.addVbrFrame=function(e){var t=e.internal_flags,n=Tables.bitrate_table[e.version][t.bitrate_index];l(null!=t.VBR_seek_table.bag),function(e,t){if(e.nVbrNumFrames++,e.sum+=t,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var n=1;n<e.size;n+=2)e.bag[n/2]=e.bag[n];e.want*=2,e.pos/=2}}(t.VBR_seek_table,n)},this.getVbrTag=function(e){var t=new VBRTagData,n=0;t.flags=0;var r=e[n+1]>>3&1,i=e[n+2]>>2&3,o=e[n+3]>>6&3,a=e[n+2]>>4&15;if(a=Tables.bitrate_table[r][a],e[n+1]>>4==14?t.samprate=Tables.samplerate_table[2][i]:t.samprate=Tables.samplerate_table[r][i],!function(e,t){return new String(e,t,4(),null).equals(m)||new String(e,t,4(),null).equals(p)}(e,n+=0!=r?3!=o?36:21:3!=o?21:13))return null;n+=4,t.hId=r;var c=t.flags=g(e,n);if(n+=4,0!=(1&c)&&(t.frames=g(e,n),n+=4),0!=(2&c)&&(t.bytes=g(e,n),n+=4),0!=(4&c)){if(null!=t.toc)for(var l=0;l<s;l++)t.toc[l]=e[n+l];n+=s}t.vbrScale=-1,0!=(8&c)&&(t.vbrScale=g(e,n),n+=4),t.headersize=72e3*(r+1)*a/t.samprate;var h=e[(n+=21)+0]<<4;h+=e[n+1]>>4;var u=(15&e[n+1])<<8;return(h<0||h>3e3)&&(h=-1),((u+=255&e[n+2])<0||u>3e3)&&(u=-1),t.encDelay=h,t.encPadding=u,t},this.InitVbrTag=function(e){var n,s=e.internal_flags;n=1==e.version?128:e.out_samplerate<16e3?32:64,e.VBR==i.vbr_off&&(n=e.brate);var r=72e3*(e.version+1)*n/e.out_samplerate,o=s.sideinfo_len+d;if(s.VBR_seek_table.TotalFrameSize=r,r<o||r>u)e.bWriteVbrTag=!1;else{s.VBR_seek_table.nVbrNumFrames=0,s.VBR_seek_table.nBytesWritten=0,s.VBR_seek_table.sum=0,s.VBR_seek_table.seen=0,s.VBR_seek_table.want=1,s.VBR_seek_table.pos=0,null==s.VBR_seek_table.bag&&(s.VBR_seek_table.bag=new int[400],s.VBR_seek_table.size=400);var a=c(u);y(e,a);for(var l=s.VBR_seek_table.TotalFrameSize,h=0;h<l;++h)t.add_dummy_byte(e,255&a[h],1)}},this.updateMusicCRC=function(e,t,n,s){for(var r=0;r<s;++r)e[0]=w(t[n+r],e[0])},this.getLameTagFrame=function(e,l){var h=e.internal_flags;if(!e.bWriteVbrTag)return 0;if(h.Class_ID!=Lame.LAME_ID)return 0;if(h.VBR_seek_table.pos<=0)return 0;if(l.length<h.VBR_seek_table.TotalFrameSize)return h.VBR_seek_table.TotalFrameSize;a.fill(l,0,h.VBR_seek_table.TotalFrameSize,0),y(e,l);var u=c(s);if(e.free_format)for(var d=1;d<s;++d)u[d]=255&255*d/100;else!function(e,t){if(!(e.pos<=0))for(var n=1;n<s;++n){var r=n/s,i=0|Math.floor(r*e.pos);i>e.pos-1&&(i=e.pos-1);var o=0|256*e.bag[i]/e.sum;o>255&&(o=255),t[n]=255&o}}(h.VBR_seek_table,u);var f=h.sideinfo_len;e.error_protection&&(f-=2),e.VBR==i.vbr_off?(l[f++]=255&p.charAt(0),l[f++]=255&p.charAt(1),l[f++]=255&p.charAt(2),l[f++]=255&p.charAt(3)):(l[f++]=255&m.charAt(0),l[f++]=255&m.charAt(1),l[f++]=255&m.charAt(2),l[f++]=255&m.charAt(3)),_(l,f,15),_(l,f+=4,h.VBR_seek_table.nVbrNumFrames),f+=4;var g=h.VBR_seek_table.nBytesWritten+h.VBR_seek_table.TotalFrameSize;_(l,f,0|g),f+=4,r.arraycopy(u,0,l,f,u.length),f+=u.length,e.error_protection&&t.CRC_writeheader(h,l);var b=0;for(d=0;d<f;d++)b=w(l[d],b);return f+=function(e,t,s,r,i){var a,c,l,h,u,d=e.internal_flags,m=0,p=e.encoder_delay,f=e.encoder_padding,g=100-10*e.VBR_q-e.quality,b=n.getLameVeryShortVersion(),y=[1,5,3,2,4,0,3],k=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),x=0,E=0,S=e.internal_flags.noise_shaping,T=0,C=0,I=0,R=0!=(1&e.exp_nspsytune),A=0!=(2&e.exp_nspsytune),M=!1,N=!1,P=e.internal_flags.nogap_total,B=e.internal_flags.nogap_current,D=e.ATHtype;switch(e.VBR){case vbr_abr:u=e.VBR_mean_bitrate_kbps;break;case vbr_off:u=e.brate;break;default:u=e.VBR_min_bitrate_kbps}switch(a=0+(e.VBR.ordinal()<y.length?y[e.VBR.ordinal()]:0),d.findReplayGain&&(d.RadioGain>510&&(d.RadioGain=510),d.RadioGain<-510&&(d.RadioGain=-510),E=8192,E|=3072,d.RadioGain>=0?E|=d.RadioGain:(E|=512,E|=-d.RadioGain)),d.findPeakSample&&(x=Math.abs(0|d.PeakSample/32767*Math.pow(2,23)+.5)),-1!=P&&(B>0&&(N=!0),B<P-1&&(M=!0)),h=D+((R?1:0)<<4)+((A?1:0)<<5)+((M?1:0)<<6)+((N?1:0)<<7),g<0&&(g=0),e.mode){case MONO:T=0;break;case STEREO:T=1;break;case DUAL_CHANNEL:T=2;break;case JOINT_STEREO:T=e.force_ms?4:3;break;case NOT_SET:default:T=7}I=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==o.short_block_forced||e.short_blocks==o.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==D||e.in_samplerate<=32e3)&&(C=1),c=S+(T<<2)+(C<<5)+(I<<6),l=d.nMusicCRC,_(s,r+m,g),m+=4;for(var O=0;O<9;O++)s[r+m+O]=255&b.charAt(O);s[r+(m+=9)]=255&a,s[r+ ++m]=255&k,_(s,r+ ++m,x),v(s,r+(m+=4),E),v(s,r+(m+=2),0),s[r+(m+=2)]=255&h,s[r+ ++m]=u>=255?255:255&u,s[r+ ++m]=255&p>>4,s[r+m+1]=255&(p<<4)+(f>>8),s[r+m+2]=255&f,s[r+(m+=3)]=255&c,m++,s[r+m++]=0,v(s,r+m,e.preset),_(s,r+(m+=2),t),v(s,r+(m+=4),l),m+=2;for(var L=0;L<m;L++)i=w(s[r+L],i);return v(s,r+m,i),m+2}(e,g,l,f,b),h.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(e,t){if(e.internal_flags.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var n=function(e){e.seek(0);var t=c(10);return e.readFully(t),new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}(t);t.seek(n);var s=c(u),r=getLameTagFrame(e,s);return r>s.length?-1:(r<1||t.write(s,0,r),0)}}h.NUMTOCENTRIES=100,h.MAXFRAMESIZE=2880,e.exports=h},2367:e=>{e.exports=function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}}},51038:e=>{function t(e){return new Int16Array(e)}function n(e){return new Int32Array(e)}function s(e){return new Float32Array(e)}var r={fill:function(e,t,n,s){if(2==arguments.length)for(var r=0;r<e.length;r++)e[r]=arguments[1];else for(r=t;r<n;r++)e[r]=s}},i={arraycopy:function(e,t,n,s,r){for(var i=t+r;t<i;)n[s++]=e[t++]}},o={};function a(e){this.ordinal=e}o.SQRT2=1.4142135623730951,o.FAST_LOG10=function(e){return Math.log10(e)},o.FAST_LOG10_X=function(e,t){return Math.log10(e)*t},a.short_block_allowed=new a(0),a.short_block_coupled=new a(1),a.short_block_dispensed=new a(2),a.short_block_forced=new a(3);var c={};function l(e){this.ordinal=e}c.MAX_VALUE=34028235e31,l.vbr_off=new l(0),l.vbr_mt=new l(1),l.vbr_rh=new l(2),l.vbr_abr=new l(3),l.vbr_mtrh=new l(4),l.vbr_default=l.vbr_mtrh;e.exports={System:i,VbrMode:l,Float:c,ShortBlock:a,Util:o,Arrays:r,new_array_n:function e(t){if(1==t.length)return new Array(t[0]);var n=t[0];t=t.slice(1);for(var s=[],r=0;r<n;r++)s.push(e(t));return s},new_byte:function(e){return new Int8Array(e)},new_double:function(e){return new Float64Array(e)},new_float:s,new_float_n:function e(t){if(1==t.length)return s(t[0]);var n=t[0];t=t.slice(1);for(var r=[],i=0;i<n;i++)r.push(e(t));return r},new_int:n,new_int_n:function e(t){if(1==t.length)return n(t[0]);var s=t[0];t=t.slice(1);for(var r=[],i=0;i<s;i++)r.push(e(t));return r},new_short:t,new_short_n:function e(n){if(1==n.length)return t(n[0]);var s=n[0];n=n.slice(1);for(var r=[],i=0;i<s;i++)r.push(e(n));return r},assert:function(e){}}},75644:(e,t,n)=>{var s=n(51038),r=(s.System,s.VbrMode,s.Float,s.ShortBlock,s.Util,s.Arrays,s.new_array_n,s.new_byte),i=(s.new_double,s.new_float,s.new_float_n,s.new_int,s.new_int_n,s.assert);Lame=n(64566),Presets=n(79457),GainAnalysis=n(51287),QuantizePVT=n(70429),Quantize=n(19833),Takehiro=n(15638),Reservoir=n(93060),MPEGMode=n(88231),BitStream=n(3724);n(60687);var o=n(2367),a=n(53398);function c(){this.setModules=function(e,t){e,t}}function l(){this.setModules=function(e,t,n){e,t,n}}function h(){}function u(){this.setModules=function(e,t){e,t}}function d(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function m(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}d.RIFF=m("RIFF"),d.WAVE=m("WAVE"),d.fmt_=m("fmt "),d.data=m("data"),d.readHeader=function(e){var t=new d,n=e.getUint32(0,!1);if(d.RIFF==n){e.getUint32(4,!0);if(d.WAVE==e.getUint32(8,!1)&&d.fmt_==e.getUint32(12,!1)){var s=e.getUint32(16,!0),r=20;switch(s){case 16:case 18:t.channels=e.getUint16(r+2,!0),t.sampleRate=e.getUint32(r+4,!0);break;default:throw"extended fmt chunk not implemented"}r+=s;for(var i=d.data,o=0;i!=n&&(n=e.getUint32(r,!1),o=e.getUint32(r+4,!0),i!=n);)r+=o+8;return t.dataLen=o,t.dataOffset=r+8,t}}},e.exports.Mp3Encoder=function(e,t,n){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,n=128);var s=new Lame,d=new c,m=new GainAnalysis,p=new BitStream,f=new Presets,g=new QuantizePVT,_=new Quantize,v=new a,b=new o,y=new u,w=new Reservoir,k=new Takehiro,x=new l,E=new h;s.setModules(m,p,f,g,_,v,b,y,E),p.setModules(m,E,b,v),y.setModules(p,b),f.setModules(s),_.setModules(p,w,g,k),g.setModules(k,w,s.enc.psy),w.setModules(p),k.setModules(g),v.setModules(s,p,b),d.setModules(x,E),x.setModules(b,y,f);var S=s.lame_init();S.num_channels=e,S.in_samplerate=t,S.brate=n,S.mode=MPEGMode.STEREO,S.quality=3,S.bWriteVbrTag=!1,S.disable_reservoir=!0,S.write_id3tag_automatic=!1;var T=s.lame_init_params(S);i(0==T);var C=1152,I=0|1.25*C+7200,R=r(I);this.encodeBuffer=function(t,n){1==e&&(n=t),i(t.length==n.length),t.length>C&&(C=t.length,R=r(I=0|1.25*C+7200));var o=s.lame_encode_buffer(S,t,n,t.length,R,0,I);return new Int8Array(R.subarray(0,o))},this.flush=function(){var e=s.lame_encode_flush(S,R,0,I);return new Int8Array(R.subarray(0,e))}},e.exports.WavHeader=d},25235:(e,t,n)=>{e.exports=n(8425)},8425:(e,t,n)=>{"use strict";t.__esModule=!0,t.tokenize=t.test=t.scanner=t.parser=t.options=t.inherits=t.find=void 0;var s=n(72227),r=a(n(47951)),i=a(n(6417)),o=a(n(45788));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var c=function(e){return o.run(i.run(e))};t.find=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=c(e),s=[],r=0;r<n.length;r++){var i=n[r];!i.isLink||t&&i.type!==t||s.push(i.toObject())}return s},t.inherits=s.inherits,t.options=r,t.parser=o,t.scanner=i,t.test=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=c(e);return 1===n.length&&n[0].isLink&&(!t||n[0].type===t)},t.tokenize=c},45788:(e,t,n)=>{"use strict";t.__esModule=!0,t.start=t.run=t.TOKENS=t.State=void 0;var s=n(25439),r=n(23370),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(r),o=n(63333);var a=function(e){return new s.TokenState(e)},c=a(),l=a(),h=a(),u=a(),d=a(),m=a(),p=a(),f=a(r.URL),g=a(),_=a(r.URL),v=a(r.URL),b=a(),y=a(),w=a(),k=a(),x=a(),E=a(r.URL),S=a(r.URL),T=a(r.URL),C=a(r.URL),I=a(),R=a(),A=a(),M=a(),N=a(),P=a(),B=a(r.EMAIL),D=a(),O=a(r.EMAIL),L=a(r.MAILTOEMAIL),V=a(),F=a(),U=a(),j=a(),q=a(r.NL);c.on(o.NL,q).on(o.PROTOCOL,l).on(o.MAILTO,h).on(o.SLASH,u),l.on(o.SLASH,u),u.on(o.SLASH,d),c.on(o.TLD,m).on(o.DOMAIN,m).on(o.LOCALHOST,f).on(o.NUM,m),d.on(o.TLD,v).on(o.DOMAIN,v).on(o.NUM,v).on(o.LOCALHOST,v),m.on(o.DOT,p),N.on(o.DOT,P),p.on(o.TLD,f).on(o.DOMAIN,m).on(o.NUM,m).on(o.LOCALHOST,m),P.on(o.TLD,B).on(o.DOMAIN,N).on(o.NUM,N).on(o.LOCALHOST,N),f.on(o.DOT,p),B.on(o.DOT,P),f.on(o.COLON,g).on(o.SLASH,v),g.on(o.NUM,_),_.on(o.SLASH,v),B.on(o.COLON,D),D.on(o.NUM,O);var H=[o.DOMAIN,o.AT,o.LOCALHOST,o.NUM,o.PLUS,o.POUND,o.PROTOCOL,o.SLASH,o.TLD,o.UNDERSCORE,o.SYM,o.AMPERSAND],z=[o.COLON,o.DOT,o.QUERY,o.PUNCTUATION,o.CLOSEBRACE,o.CLOSEBRACKET,o.CLOSEANGLEBRACKET,o.CLOSEPAREN,o.OPENBRACE,o.OPENBRACKET,o.OPENANGLEBRACKET,o.OPENPAREN];v.on(o.OPENBRACE,y).on(o.OPENBRACKET,w).on(o.OPENANGLEBRACKET,k).on(o.OPENPAREN,x),b.on(o.OPENBRACE,y).on(o.OPENBRACKET,w).on(o.OPENANGLEBRACKET,k).on(o.OPENPAREN,x),y.on(o.CLOSEBRACE,v),w.on(o.CLOSEBRACKET,v),k.on(o.CLOSEANGLEBRACKET,v),x.on(o.CLOSEPAREN,v),E.on(o.CLOSEBRACE,v),S.on(o.CLOSEBRACKET,v),T.on(o.CLOSEANGLEBRACKET,v),C.on(o.CLOSEPAREN,v),I.on(o.CLOSEBRACE,v),R.on(o.CLOSEBRACKET,v),A.on(o.CLOSEANGLEBRACKET,v),M.on(o.CLOSEPAREN,v),y.on(H,E),w.on(H,S),k.on(H,T),x.on(H,C),y.on(z,I),w.on(z,R),k.on(z,A),x.on(z,M),E.on(H,E),S.on(H,S),T.on(H,T),C.on(H,C),E.on(z,E),S.on(z,S),T.on(z,T),C.on(z,C),I.on(H,E),R.on(H,S),A.on(H,T),M.on(H,C),I.on(z,I),R.on(z,R),A.on(z,A),M.on(z,M),v.on(H,v),b.on(H,v),v.on(z,b),b.on(z,b),h.on(o.TLD,L).on(o.DOMAIN,L).on(o.NUM,L).on(o.LOCALHOST,L),L.on(H,L).on(z,V),V.on(H,L).on(z,V);var $=[o.DOMAIN,o.NUM,o.PLUS,o.POUND,o.QUERY,o.UNDERSCORE,o.SYM,o.AMPERSAND,o.TLD];m.on($,F).on(o.AT,U),f.on($,F).on(o.AT,U),p.on($,F),F.on($,F).on(o.AT,U).on(o.DOT,j),j.on($,F),U.on(o.TLD,N).on(o.DOMAIN,N).on(o.LOCALHOST,B);t.State=s.TokenState,t.TOKENS=i,t.run=function(e){for(var t=e.length,n=0,s=[],i=[];n<t;){for(var o=c,a=null,l=null,h=0,u=null,d=-1;n<t&&!(a=o.next(e[n]));)i.push(e[n++]);for(;n<t&&(l=a||o.next(e[n]));)a=null,(o=l).accepts()?(d=0,u=o):d>=0&&d++,n++,h++;if(d<0)for(var m=n-h;m<n;m++)i.push(e[m]);else{i.length>0&&(s.push(new r.TEXT(i)),i=[]),n-=d,h-=d;var p=u.emit();s.push(new p(e.slice(n-h,n)))}}return i.length>0&&s.push(new r.TEXT(i)),s},t.start=c},6417:(e,t,n)=>{"use strict";t.__esModule=!0,t.start=t.run=t.TOKENS=t.State=void 0;var s=n(25439),r=n(63333),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(r);var o="aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|aetna|af|afamilycompany|afl|africa|ag|agakhan|agency|ai|aig|aigo|airbus|airforce|airtel|akdn|al|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|cat|catering|catholic|cba|cbn|cbre|cbs|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dodge|dog|doha|domains|dot|download|drive|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epost|epson|equipment|er|ericsson|erni|es|esq|estate|esurance|et|etisalat|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glade|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|guardian|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|hospital|host|hosting|hot|hoteles|hotels|hotmail|house|how|hr|hsbc|ht|htc|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|intel|international|intuit|investments|io|ipiranga|iq|ir|irish|is|iselect|ismaili|ist|istanbul|it|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|je|jeep|jetzt|jewelry|jio|jlc|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|lk|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|lupin|luxe|luxury|lv|ly|ma|macys|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|merckmsd|metlife|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|mobily|moda|moe|moi|mom|monash|money|monster|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|mutual|mv|mw|mx|my|mz|na|nab|nadex|nagoya|name|nationwide|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|northwesternmutual|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|off|office|okiBaraa|olayan|olayangroup|oldnavy|ollo|om|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|qvc|racing|radio|raid|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|ro|rocher|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sb|sbi|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|sd|se|search|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|showtime|shriram|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|srt|st|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiftcover|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|telecity|telefonica|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelchannel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|uconnect|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vn|vodka|volkswagen|volvo|vote|voting|voto|voyage|vu|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3oq18vl8pn36a|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq61u9w7b|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaakc7dvf|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pbt977c|xn--pgbs0dh|xn--pssy2u|xn--q9jyb4c|xn--qcka1pmc|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zippo|zm|zone|zuerich|zw".split("|"),a="0123456789".split(""),c="0123456789abcdefghijklmnopqrstuvwxyz".split(""),l=[" ","\f","\r","\t","\v"," "," ","᠎"],h=[],u=function(e){return new s.CharacterState(e)},d=u(),m=u(r.NUM),p=u(r.DOMAIN),f=u(),g=u(r.WS);d.on("@",u(r.AT)).on(".",u(r.DOT)).on("+",u(r.PLUS)).on("#",u(r.POUND)).on("?",u(r.QUERY)).on("/",u(r.SLASH)).on("_",u(r.UNDERSCORE)).on(":",u(r.COLON)).on("{",u(r.OPENBRACE)).on("[",u(r.OPENBRACKET)).on("<",u(r.OPENANGLEBRACKET)).on("(",u(r.OPENPAREN)).on("}",u(r.CLOSEBRACE)).on("]",u(r.CLOSEBRACKET)).on(">",u(r.CLOSEANGLEBRACKET)).on(")",u(r.CLOSEPAREN)).on("&",u(r.AMPERSAND)).on([",",";","!",'"',"'"],u(r.PUNCTUATION)),d.on("\n",u(r.NL)).on(l,g),g.on(l,g);for(var _=0;_<o.length;_++){var v=(0,s.stateify)(o[_],d,r.TLD,r.DOMAIN);h.push.apply(h,v)}var b=(0,s.stateify)("file",d,r.DOMAIN,r.DOMAIN),y=(0,s.stateify)("ftp",d,r.DOMAIN,r.DOMAIN),w=(0,s.stateify)("http",d,r.DOMAIN,r.DOMAIN),k=(0,s.stateify)("mailto",d,r.DOMAIN,r.DOMAIN);h.push.apply(h,b),h.push.apply(h,y),h.push.apply(h,w),h.push.apply(h,k);var x=b.pop(),E=y.pop(),S=w.pop(),T=k.pop(),C=u(r.DOMAIN),I=u(r.PROTOCOL),R=u(r.MAILTO);E.on("s",C).on(":",I),S.on("s",C).on(":",I),h.push(C),x.on(":",I),C.on(":",I),T.on(":",R);var A=(0,s.stateify)("localhost",d,r.LOCALHOST,r.DOMAIN);h.push.apply(h,A),d.on(a,m),m.on("-",f).on(a,m).on(c,p),p.on("-",f).on(c,p);for(var M=0;M<h.length;M++)h[M].on("-",f).on(c,p);f.on("-",f).on(a,p).on(c,p),d.defaultTransition=u(r.SYM);var N=d;t.State=s.CharacterState,t.TOKENS=i,t.run=function(e){for(var t=e.replace(/[A-Z]/g,(function(e){return e.toLowerCase()})),n=e.length,s=[],r=0;r<n;){for(var i=d,o=null,a=0,c=null,l=-1;r<n&&(o=i.next(t[r]));)(i=o).accepts()?(l=0,c=i):l>=0&&l++,a++,r++;if(!(l<0)){r-=l,a-=l;var h=c.emit();s.push(new h(e.substr(r-a,a)))}}return s},t.start=N},25439:(e,t,n)=>{"use strict";t.__esModule=!0,t.stateify=t.TokenState=t.CharacterState=void 0;var s=n(72227);var r=function(e){this.j=[],this.T=e||null};r.prototype={defaultTransition:!1,on:function(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)this.j.push([e[n],t]);return this}return this.j.push([e,t]),this},next:function(e){for(var t=0;t<this.j.length;t++){var n=this.j[t],s=n[0],r=n[1];if(this.test(e,s))return r}return this.defaultTransition},accepts:function(){return!!this.T},test:function(e,t){return e===t},emit:function(){return this.T}};var i=(0,s.inherits)(r,(function(e){this.j=[],this.T=e||null}),{test:function(e,t){return e===t||t instanceof RegExp&&t.test(e)}}),o=(0,s.inherits)(r,(function(e){this.j=[],this.T=e||null}),{jump:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.next(new e(""));return n===this.defaultTransition?(n=new this.constructor(t),this.on(e,n)):t&&(n.T=t),n},test:function(e,t){return e instanceof t}});t.CharacterState=i,t.TokenState=o,t.stateify=function(e,t,n,s){for(var r=0,o=e.length,a=t,c=[],l=void 0;r<o&&(l=a.next(e[r]));)a=l,r++;if(r>=o)return[];for(;r<o-1;)l=new i(s),c.push(l),a.on(e[r],l),a=l,r++;return l=new i(n),c.push(l),a.on(e[o-1],l),c}},9770:(e,t)=>{"use strict";t.__esModule=!0,t.createTokenClass=function(){return function(e){e&&(this.v=e)}}},23370:(e,t,n)=>{"use strict";t.__esModule=!0,t.URL=t.TEXT=t.NL=t.EMAIL=t.MAILTOEMAIL=t.Base=void 0;var s=n(9770),r=n(72227),i=n(63333);var o=(0,s.createTokenClass)();o.prototype={type:"token",isLink:!1,toString:function(){for(var e=[],t=0;t<this.v.length;t++)e.push(this.v[t].toString());return e.join("")},toHref:function(){return this.toString()},toObject:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(e)}}};var a=(0,r.inherits)(o,(0,s.createTokenClass)(),{type:"email",isLink:!0}),c=(0,r.inherits)(o,(0,s.createTokenClass)(),{type:"email",isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),l=(0,r.inherits)(o,(0,s.createTokenClass)(),{type:"text"}),h=(0,r.inherits)(o,(0,s.createTokenClass)(),{type:"nl"}),u=(0,r.inherits)(o,(0,s.createTokenClass)(),{type:"url",isLink:!0,toHref:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http",n=!1,s=!1,r=this.v,o=[],a=0;r[a]instanceof i.PROTOCOL;)n=!0,o.push(r[a].toString().toLowerCase()),a++;for(;r[a]instanceof i.SLASH;)s=!0,o.push(r[a].toString()),a++;for(;(e=r[a])instanceof i.DOMAIN||e instanceof i.TLD;)o.push(r[a].toString().toLowerCase()),a++;for(;a<r.length;a++)o.push(r[a].toString());return o=o.join(""),n||s||(o=t+"://"+o),o},hasProtocol:function(){return this.v[0]instanceof i.PROTOCOL}});t.Base=o,t.MAILTOEMAIL=a,t.EMAIL=c,t.NL=h,t.TEXT=l,t.URL=u},63333:(e,t,n)=>{"use strict";t.__esModule=!0,t.AMPERSAND=t.CLOSEPAREN=t.CLOSEANGLEBRACKET=t.CLOSEBRACKET=t.CLOSEBRACE=t.OPENPAREN=t.OPENANGLEBRACKET=t.OPENBRACKET=t.OPENBRACE=t.WS=t.TLD=t.SYM=t.UNDERSCORE=t.SLASH=t.MAILTO=t.PROTOCOL=t.QUERY=t.POUND=t.PLUS=t.NUM=t.NL=t.LOCALHOST=t.PUNCTUATION=t.DOT=t.COLON=t.AT=t.DOMAIN=t.Base=void 0;var s=n(9770),r=n(72227),i=(0,s.createTokenClass)();function o(e){var t=e?{v:e}:{};return(0,r.inherits)(i,(0,s.createTokenClass)(),t)}i.prototype={toString:function(){return this.v+""}};var a=o(),c=o("@"),l=o(":"),h=o("."),u=o(),d=o(),m=o("\n"),p=o(),f=o("+"),g=o("#"),_=o(),v=o("mailto:"),b=o("?"),y=o("/"),w=o("_"),k=o(),x=o(),E=o(),S=o("{"),T=o("["),C=o("<"),I=o("("),R=o("}"),A=o("]"),M=o(">"),N=o(")"),P=o("&");t.Base=i,t.DOMAIN=a,t.AT=c,t.COLON=l,t.DOT=h,t.PUNCTUATION=u,t.LOCALHOST=d,t.NL=m,t.NUM=p,t.PLUS=f,t.POUND=g,t.QUERY=b,t.PROTOCOL=_,t.MAILTO=v,t.SLASH=y,t.UNDERSCORE=w,t.SYM=k,t.TLD=x,t.WS=E,t.OPENBRACE=S,t.OPENBRACKET=T,t.OPENANGLEBRACKET=C,t.OPENPAREN=I,t.CLOSEBRACE=R,t.CLOSEBRACKET=A,t.CLOSEANGLEBRACKET=M,t.CLOSEPAREN=N,t.AMPERSAND=P},72227:(e,t)=>{"use strict";t.__esModule=!0,t.inherits=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=Object.create(e.prototype);for(var r in n)s[r]=n[r];return s.constructor=t,t.prototype=s,t}},47951:(e,t)=>{"use strict";t.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s={defaultProtocol:"http",events:null,format:i,formatHref:i,nl2br:!1,tagName:"a",target:function(e,t){return"url"===t?"_blank":null},validate:!0,ignoreTags:[],attributes:null,className:"linkified"};function r(e){e=e||{},this.defaultProtocol=e.hasOwnProperty("defaultProtocol")?e.defaultProtocol:s.defaultProtocol,this.events=e.hasOwnProperty("events")?e.events:s.events,this.format=e.hasOwnProperty("format")?e.format:s.format,this.formatHref=e.hasOwnProperty("formatHref")?e.formatHref:s.formatHref,this.nl2br=e.hasOwnProperty("nl2br")?e.nl2br:s.nl2br,this.tagName=e.hasOwnProperty("tagName")?e.tagName:s.tagName,this.target=e.hasOwnProperty("target")?e.target:s.target,this.validate=e.hasOwnProperty("validate")?e.validate:s.validate,this.ignoreTags=[],this.attributes=e.attributes||e.linkAttributes||s.attributes,this.className=e.hasOwnProperty("className")?e.className:e.linkClass||s.className;for(var t=e.hasOwnProperty("ignoreTags")?e.ignoreTags:s.ignoreTags,n=0;n<t.length;n++)this.ignoreTags.push(t[n].toUpperCase())}function i(e){return e}t.defaults=s,t.Options=r,t.contains=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},r.prototype={resolve:function(e){var t=e.toHref(this.defaultProtocol);return{formatted:this.get("format",e.toString(),e),formattedHref:this.get("formatHref",t,e),tagName:this.get("tagName",t,e),className:this.get("className",t,e),target:this.get("target",t,e),events:this.getObject("events",t,e),attributes:this.getObject("attributes",t,e)}},check:function(e){return this.get("validate",e.toString(),e)},get:function(e,t,r){var i=void 0,o=this[e];if(!o)return o;switch(void 0===o?"undefined":n(o)){case"function":return o(t,r.type);case"object":return"function"==typeof(i=o.hasOwnProperty(r.type)?o[r.type]:s[e])?i(t,r.type):i}return o},getObject:function(e,t,n){var s=this[e];return"function"==typeof s?s(t,n.type):s}}},38973:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Uc:()=>firestoreDb,tO:()=>storage,yG:()=>realtimeDb});var firebase_app__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(83977),firebase_database__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(89355),firebase_firestore__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(36100),firebase_storage__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(86650),firebase_messaging__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(80175);const development=()=>window.firestoreConfig.devConfig,production=()=>window.firestoreConfig.lifeConfig,firebaseSettings=eval("production()");(0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.ZF)(firebaseSettings.config);const firestoreDb=(0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.ad)(),realtimeDb=(0,firebase_database__WEBPACK_IMPORTED_MODULE_1__.N8)(),storage=(0,firebase_storage__WEBPACK_IMPORTED_MODULE_3__.cF)()},23007:(e,t,n)=>{"use strict";n.d(t,{Go:()=>i,jn:()=>r,v5:()=>s});const s=["png","jpg","jpeg","webp","svg","gif"],r=["mp4","video/ogg","webm","quicktime"],i=["mp3","audio/ogg","wav","mpeg"]},8391:(e,t,n)=>{"use strict";function s(e){if(!((e,t)=>t.every((t=>{let n=!1;return("array"===t.type[0]&&Array.isArray(e[t.key])||t.type.find((n=>n===typeof e[t.key])))&&(n=!0),n&&o(e,t.key)})))(e,[{key:"roomId",type:["string","number"]},{key:"roomName",type:["string"]},{key:"users",type:["array"]}]))throw new Error("Rooms object is not valid! Must contain roomId[String, Number], roomName[String] and users[Array]")}function r(e){if(!((e,t)=>t.every((t=>t.type.find((n=>n===typeof e[t.key]))&&o(e,t.key))))(e,[{key:"_id",type:["string","number"]},{key:"username",type:["string"]}]))throw new Error("Participants object is not valid! Must contain _id[String, Number] and username[String]")}function i(e){if(!((e,t)=>t.every((t=>t.type.find((n=>n===typeof e[t.key]))&&o(e,t.key))))(e,[{key:"_id",type:["string","number"]},{key:"content",type:["string","number"]},{key:"senderId",type:["string","number"]}]))throw new Error("Messages object is not valid! Must contain _id[String, Number], content[String, Number] and senderId[String, Number]")}function o(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&null!==e[t]&&void 0!==e[t]}n.r(t),n.d(t,{messagesValidation:()=>i,partcipantsValidation:()=>r,roomsValidation:()=>s})},84539:(e,t,n)=>{"use strict";n.r(t),n.d(t,{isAudioFile:()=>c,isImageFile:()=>i,isImageVideoFile:()=>a,isVideoFile:()=>o});var s=n(23007);function r(e,t){if(t&&t.type)return e.some((e=>t.type.toLowerCase().includes(e)))}function i(e){return r(s.v5,e)}function o(e){return r(s.jn,e)}function a(e){return r(s.v5,e)||r(s.jn,e)}function c(e){return r(s.Go,e)}},36032:(e,t,n)=>{"use strict";function s(){var e=function(){var e=navigator.userAgent||navigator.vendor||window.opera||null;if(!e)throw new Error("Failed to look for user agent information.");return e}(),t=e.substr(0,4);return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw(n|u)|c55\/|capi|ccwa|cdm|cell|chtm|cldc|cmd|co(mp|nd)|craw|da(it|ll|ng)|dbte|dcs|devi|dica|dmob|do(c|p)o|ds(12|d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(|_)|g1 u|g560|gene|gf5|gmo|go(\.w|od)|gr(ad|un)|haie|hcit|hd(m|p|t)|hei|hi(pt|ta)|hp( i|ip)|hsc|ht(c(| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i(20|go|ma)|i230|iac( ||\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|[a-w])|libw|lynx|m1w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|mcr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|([1-8]|c))|phil|pire|pl(ay|uc)|pn2|po(ck|rt|se)|prox|psio|ptg|qaa|qc(07|12|21|32|60|[2-7]|i)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h|oo|p)|sdk\/|se(c(|0|1)|47|mc|nd|ri)|sgh|shar|sie(|m)|sk0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h|v|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl|tdg|tel(i|m)|tim|tmo|to(pl|sh)|ts(70|m|m3|m5)|tx9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas|your|zeto|zte/i.test(t)}n.r(t),n.d(t,{detectMobile:()=>s})},67536:function(e){e.exports=function(){var e="__v-click-outside",t="undefined"!=typeof window,n="undefined"!=typeof navigator,s=t&&("ontouchstart"in window||n&&navigator.msMaxTouchPoints>0)?["touchstart"]:["click"];function r(e){var t=e.event,n=e.handler;(0,e.middleware)(t)&&n(t)}function i(t,n){var i=function(e){var t="function"==typeof e;if(!t&&"object"!=typeof e)throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:t?e:e.handler,middleware:e.middleware||function(e){return e},events:e.events||s,isActive:!(!1===e.isActive),detectIframe:!(!1===e.detectIframe),capture:!!e.capture}}(n.value),o=i.handler,a=i.middleware,c=i.detectIframe,l=i.capture;if(i.isActive){if(t[e]=i.events.map((function(e){return{event:e,srcTarget:document.documentElement,handler:function(e){return function(e){var t=e.el,n=e.event,s=e.handler,i=e.middleware,o=n.composedPath&&n.composedPath()||n.path;(o?o.indexOf(t)<0:!t.contains(n.target))&&r({event:n,handler:s,middleware:i})}({el:t,event:e,handler:o,middleware:a})},capture:l}})),c){var h={event:"blur",srcTarget:window,handler:function(e){return function(e){var t=e.el,n=e.event,s=e.handler,i=e.middleware;setTimeout((function(){var e=document.activeElement;e&&"IFRAME"===e.tagName&&!t.contains(e)&&r({event:n,handler:s,middleware:i})}),0)}({el:t,event:e,handler:o,middleware:a})},capture:l};t[e]=[].concat(t[e],[h])}t[e].forEach((function(n){var s=n.event,r=n.srcTarget,i=n.handler;return setTimeout((function(){t[e]&&r.addEventListener(s,i,l)}),0)}))}}function o(t){(t[e]||[]).forEach((function(e){return e.srcTarget.removeEventListener(e.event,e.handler,e.capture)})),delete t[e]}var a=t?{bind:i,update:function(e,t){var n=t.value,s=t.oldValue;JSON.stringify(n)!==JSON.stringify(s)&&(o(e),i(e,{value:n}))},unbind:o}:{};return{install:function(e){e.directive("click-outside",a)},directive:a}}()},15330:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Qo});var s=n(70821);var r=n(38973),i=n(36100);const o="users",a=window.firestoreConfig.roomBath??"chatRooms",c=e=>`${a}/${e}/messages`,l=e=>`${a}/${e}/${o}`,h="timestamp",u="lastUpdated",d="users",m=i.cf,p=(0,i.AK)(),f=e=>(0,i.PL)(e).then((e=>({data:j(e),docs:e.docs}))),g=e=>(0,i.QT)(e).then((e=>U(e))),v=(e,t)=>(0,i.ET)(e,t),b=(e,t,n)=>(0,i.pl)((0,i.JU)(r.Uc,e,t),n),y=(e,t)=>(0,i.r7)(e,t),w=(e,t)=>(0,i.oe)((0,i.JU)(r.Uc,e,t)),k=(0,i.hJ)(r.Uc,o),x=e=>(0,i.JU)(r.Uc,o,e),E=(e,t)=>g((0,i.JU)(r.Uc,((e,t)=>`${a}/${e}/${o}/${t}`)(e,t))),S=e=>f((0,i.IO)((e=>(0,i.hJ)(r.Uc,l(e)))(e))),T=(e,t)=>b(o,e,t),C=(0,i.hJ)(r.Uc,a),I=e=>(0,i.JU)(r.Uc,a,e),R=(e,t,n)=>b(l(e),t,n),A=e=>v(C,e),M=(e,t)=>y(I(e),t),N=e=>w(a,e),P=(e,t)=>f((0,i.IO)(C,(0,i.ar)(o,"==",[e,t]))),B=e=>(0,i.hJ)(r.Uc,c(e)),D=(e,t)=>(0,i.JU)(r.Uc,c(e),t),O=(e,t,n)=>f(n?(0,i.IO)(B(e),(0,i.Xo)(h,"desc"),(0,i.b9)(t),(0,i.TQ)(n)):t?(0,i.IO)(B(e),(0,i.Xo)(h,"desc"),(0,i.b9)(t)):B(e)),L=(e,t,n)=>y(D(e,t),n),V=(e,t)=>w(c(e),t),F=(e,t,n,s)=>m(((e,t,n)=>t&&n?(0,i.IO)(B(e),(0,i.Xo)(h),(0,i.e0)(t),(0,i.Wu)(n)):t?(0,i.IO)(B(e),(0,i.Xo)(h),(0,i.e0)(t)):n?(0,i.IO)(B(e),(0,i.Xo)(h),(0,i.Wu)(n)):(0,i.IO)(B(e),(0,i.Xo)(h)))(e,t,n),(e=>{s(j(e))})),U=e=>({...e.data(),id:e.id}),j=e=>{const t=[];return e.forEach((e=>{t.push(U(e))})),t},q=(e,t)=>m((0,i.IO)((e=>(0,i.IO)(B(e),(0,i.Xo)(h,"desc"),(0,i.b9)(1)))(e)),(e=>{t(j(e))}));var H=n(86650);const z=(e,t,n)=>(0,H.iH)(r.tO,`files/${e}/${t}/${n}`),$=(e,t,n)=>(0,H.oq)(z(e,t,`${n.name}.${n.extension||n.type}`)),K=(e,t,n,s,r,i,o)=>{const a=((e,t,n,s)=>{const r=z(e,t,`${n.name}.${s}`);return(0,H.B0)(r,n.blob,{contentType:s})})(e,t,n,s);a.on("state_changed",(e=>{const t=Math.round(e.bytesTransferred/e.totalBytes*100);r(t)}),(e=>{i(e)}),(async()=>{const e=await(t=a.snapshot.ref,(0,H.Jt)(t));var t;o(e)}))},G=["disabled"],W=["disabled"],Y=(e=>((0,s.pushScopeId)("data-v-26fe4b0c"),e=e(),(0,s.popScopeId)(),e))((()=>(0,s.createElementVNode)("option",{default:"",value:""},"Select User",-1))),X=["value"],Q=["disabled"];var Z=n(89355);const J=Z.jM,ee=e=>(0,Z.iH)(r.yG,"/status/"+e),te=(e,t)=>String(e).padStart(t,"0"),ne=(e,t="")=>{if(!e)return;const n=e.seconds?new Date(1e3*e.seconds):e;if("HH:mm"===t)return`${te(n.getHours(),2)}:${te(n.getMinutes(),2)}`;if("DD MMMM YYYY"===t){const e={month:"long",year:"numeric",day:"numeric"};return`${new Intl.DateTimeFormat("en-GB",e).format(n)}`}if("DD/MM/YY"===t){const e={month:"numeric",year:"numeric",day:"numeric"};return`${new Intl.DateTimeFormat("en-GB",e).format(n)}`}if("DD MMMM, HH:mm"===t){const e={month:"long",day:"numeric"};return`${new Intl.DateTimeFormat("en-GB",e).format(n)}, ${te(n.getHours(),2)}:${te(n.getMinutes(),2)}`}return n},se=(e,t)=>{const n=(s=e,r=new Date,s.getFullYear()===r.getFullYear()&&s.getMonth()===r.getMonth()&&s.getDate()===r.getDate()?"HH:mm":"DD/MM/YY");var s,r;const i=ne(t,n);return"HH:mm"===n?`Today, ${i}`:i},re={class:"vac-chat-container"};const ie={key:0,class:"vac-rooms-empty"},oe={key:1,id:"rooms-list",class:"vac-room-list"},ae=["id","onClick"],ce={key:0,id:"infinite-loader-rooms"};const le=(0,s.createElementVNode)("div",{id:"vac-circle"},null,-1);const he={name:"Loader",props:{show:{type:Boolean,default:!1},infinite:{type:Boolean,default:!1}}};var ue=n(83744);const de=(0,ue.Z)(he,[["render",function(e,t,n,r,i,o){return(0,s.openBlock)(),(0,s.createBlock)(s.Transition,{name:"vac-fade-spinner",appear:""},{default:(0,s.withCtx)((()=>[n.show?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:(0,s.normalizeClass)(["vac-loader-wrapper",{"vac-container-center":!n.infinite,"vac-container-top":n.infinite}])},[(0,s.renderSlot)(e.$slots,"spinner-icon",(0,s.normalizeProps)((0,s.guardReactiveProps)({show:n.show,infinite:n.infinite})),(()=>[le]))],2)):(0,s.createCommentVNode)("",!0)])),_:3})}]]),me={key:0,class:"vac-icon-search"},pe=["placeholder"];const fe=["viewBox"],ge=["id","d"],_e=["id","d"];const ve={name:"SvgIcon",props:{name:{type:String,default:null},param:{type:String,default:null}},data:()=>({svgItem:{search:{path:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},add:{path:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"},toggle:{path:"M5,13L9,17L7.6,18.42L1.18,12L7.6,5.58L9,7L5,11H21V13H5M21,6V8H11V6H21M21,16V18H11V16H21Z"},menu:{path:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"},close:{path:"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"},file:{path:"M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"},paperclip:{path:"M16.5,6V17.5A4,4 0 0,1 12.5,21.5A4,4 0 0,1 8.5,17.5V5A2.5,2.5 0 0,1 11,2.5A2.5,2.5 0 0,1 13.5,5V15.5A1,1 0 0,1 12.5,16.5A1,1 0 0,1 11.5,15.5V6H10V15.5A2.5,2.5 0 0,0 12.5,18A2.5,2.5 0 0,0 15,15.5V5A4,4 0 0,0 11,1A4,4 0 0,0 7,5V17.5A5.5,5.5 0 0,0 12.5,23A5.5,5.5 0 0,0 18,17.5V6H16.5Z"},"close-outline":{path:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},send:{path:"M2,21L23,12L2,3V10L17,12L2,14V21Z"},emoji:{path:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"},document:{path:"M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"},pencil:{path:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"},checkmark:{path:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"},"double-checkmark":{path:"M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"},eye:{path:"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"},dropdown:{path:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},deleted:{path:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12C4,13.85 4.63,15.55 5.68,16.91L16.91,5.68C15.55,4.63 13.85,4 12,4M12,20A8,8 0 0,0 20,12C20,10.15 19.37,8.45 18.32,7.09L7.09,18.32C8.45,19.37 10.15,20 12,20Z"},microphone:{size:"large",path:"M432.8,216.4v39.2c0,45.2-15.3,84.3-45.2,118.4c-29.8,33.2-67.3,52.8-111.6,57.9v40.9h78.4c5.1,0,10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6c0,5.1-1.7,10.2-6,13.6c-4.3,4.3-8.5,6-13.6,6H157.6c-5.1,0-10.2-1.7-13.6-6c-4.3-4.3-6-8.5-6-13.6c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6H236v-40.9c-44.3-5.1-81.8-23.9-111.6-57.9s-45.2-73.3-45.2-118.4v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6s10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6v39.2c0,37.5,13.6,70.7,40,97.1s59.6,40,97.1,40s70.7-13.6,97.1-40c26.4-26.4,40-59.6,40-97.1v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6c5.1,0,10.2,1.7,13.6,6C430.2,206.2,432.8,211.3,432.8,216.4z M353.5,98v157.6c0,27.3-9.4,50.3-29,69c-19.6,19.6-42.6,29-69,29s-50.3-9.4-69-29c-19.6-19.6-29-42.6-29-69V98c0-27.3,9.4-50.3,29-69c19.6-19.6,42.6-29,69-29s50.3,9.4,69,29C344.2,47.7,353.5,71.6,353.5,98z"},"audio-play":{size:"medium",path:"M43.331,21.237L7.233,0.397c-0.917-0.529-2.044-0.529-2.96,0c-0.916,0.528-1.48,1.505-1.48,2.563v41.684   c0,1.058,0.564,2.035,1.48,2.563c0.458,0.268,0.969,0.397,1.48,0.397c0.511,0,1.022-0.133,1.48-0.397l36.098-20.84   c0.918-0.529,1.479-1.506,1.479-2.564S44.247,21.767,43.331,21.237z"},"audio-pause":{size:"medium",path:"M17.991,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C4.729,2.969,7.698,0,11.36,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z",path2:"M42.877,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C29.616,2.969,32.585,0,36.246,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z"}}}),computed:{svgId(){const e=this.param?"-"+this.param:"";return`vac-icon-${this.name}${e}`},size(){const e=this.svgItem[this.name];return"large"===e.size?512:"medium"===e.size?48:24}}},be=(0,ue.Z)(ve,[["render",function(e,t,n,r,i,o){return(0,s.openBlock)(),(0,s.createElementBlock)("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",width:"24",height:"24",viewBox:`0 0 ${o.size} ${o.size}`},[(0,s.createElementVNode)("path",{id:o.svgId,d:i.svgItem[n.name].path},null,8,ge),i.svgItem[n.name].path2?((0,s.openBlock)(),(0,s.createElementBlock)("path",{key:0,id:o.svgId,d:i.svgItem[n.name].path2},null,8,_e)):(0,s.createCommentVNode)("",!0)],8,fe)}]]),ye={name:"RoomsSearch",components:{SvgIcon:be},props:{textMessages:{type:Object,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0}},emits:["search-room","add-room"],computed:{showSearchBar(){return this.showSearch||this.showAddRoom}}},we=(0,ue.Z)(ye,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("svg-icon");return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:(0,s.normalizeClass)({"vac-box-search":o.showSearchBar,"vac-box-empty":!o.showSearchBar})},[n.showSearch?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:0},[!n.loadingRooms&&n.rooms.length?((0,s.openBlock)(),(0,s.createElementBlock)("div",me,[(0,s.renderSlot)(e.$slots,"search-icon",{},(()=>[(0,s.createVNode)(a,{name:"search"})]))])):(0,s.createCommentVNode)("",!0),!n.loadingRooms&&n.rooms.length?((0,s.openBlock)(),(0,s.createElementBlock)("input",{key:1,type:"search",placeholder:n.textMessages.SEARCH,autocomplete:"off",class:"vac-input",onInput:t[0]||(t[0]=t=>e.$emit("search-room",t))},null,40,pe)):(0,s.createCommentVNode)("",!0)],64)):(0,s.createCommentVNode)("",!0),n.showAddRoom?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:1,class:"vac-svg-button vac-add-icon",onClick:t[1]||(t[1]=t=>e.$emit("add-room"))},[(0,s.renderSlot)(e.$slots,"add-icon",{},(()=>[(0,s.createVNode)(a,{name:"add"})]))])):(0,s.createCommentVNode)("",!0)],2)}]]),ke={class:"vac-room-container"},xe={class:"vac-name-container vac-text-ellipsis"},Ee={class:"vac-title-container"},Se={class:"vac-room-name vac-text-ellipsis"},Te={key:1,class:"vac-text-date"},Ce={key:0},Ie={key:1,class:"vac-text-ellipsis"},Re={key:3,class:"vac-text-ellipsis"},Ae={class:"vac-room-options-container"},Me={key:0,class:"vac-badge-counter vac-room-badge"},Ne={key:0,class:"vac-menu-options"},Pe={class:"vac-menu-list"},Be=["onClick"];var De=n(67536),Oe=n.n(De);const Le={class:"vac-image-link-container"},Ve={class:"vac-image-link-message"},Fe={key:1},Ue={key:1};const je=n(25235),qe=(e,t,n)=>{const s={bold:n.bold,italic:n.italic,strike:n.strike,underline:n.underline,multilineCode:n.multilineCode,inlineCode:n.inlineCode},r={[s.bold]:{end:"\\"+s.bold,allowed_chars:".",type:"bold"},[s.italic]:{end:s.italic,allowed_chars:".",type:"italic"},[s.strike]:{end:s.strike,allowed_chars:".",type:"strike"},[s.underline]:{end:s.underline,allowed_chars:".",type:"underline"},[s.multilineCode]:{end:s.multilineCode,allowed_chars:"(.|\n)",type:"multiline-code"},[s.inlineCode]:{end:s.inlineCode,allowed_chars:".",type:"inline-code"},"<usertag>":{allowed_chars:".",end:"</usertag>",type:"tag"}},i=function(e,t){const n=[];return e.forEach((e=>{"string"==typeof e?n.push({types:[],value:e}):t[e.start]&&n.push(function(e){const t=[];return ze(e,t,[]),t}(e))})),n}(He(e,r),r),o=[].concat.apply([],i);return t&&function(e){const t=[];e.forEach((e=>{const n=je.find(e.value);if(n.length){const s=e.value.replace(n[0].value,"");t.push({types:e.types,value:s}),e.types=["url"].concat(e.types),e.href=n[0].href,e.value=n[0].value}t.push(e)}))}(o),o};function He(e,t){let n=[],s=-1,r=null,i=je.find(e),o=!1;if(i.length>0&&(s=e.indexOf(i[0].value),o=!0),Object.keys(t).forEach((t=>{const n=e.indexOf(t);n>=0&&(s<0||n<s)&&(s=n,r=t,o=!1)})),o&&-1!==r){let r=e.substr(0,s),o=e.substr(s,i[0].value.length),a=e.substr(s+i[0].value.length);return n.push(r),n.push(o),n=n.concat(He(a,t)),n}if(r){let i=e.substr(0,s);const o=r;let a=e.substr(s+o.length);if(e.replace(/\s/g,"").length===2*o.length)return[e];const c=a.match(new RegExp("^("+(t[o].allowed_chars||".")+"*"+(t[o].end?"?":"")+")"+(t[o].end?"("+t[o].end+")":""),"m"));if(c&&c[1]){i&&n.push(i);const e={start:o,content:He(c[1],t),end:c[2],type:t[o].type};n.push(e),a=a.substr(c[0].length)}else i+=o,n.push(i);return n=n.concat(He(a,t)),n}return e?[e]:[]}function ze(e,t,n){e.content.forEach((s=>{"string"==typeof s?t.push({types:$e(n.concat([e.type])),value:s}):ze(s,t,$e([s.type].concat([e.type]).concat(n)))}))}function $e(e){return[...new Set(e)]}var Ke=n(23007);const Ge={name:"FormatMessage",components:{SvgIcon:be},props:{content:{type:[String,Number],required:!0},deleted:{type:Boolean,default:!1},users:{type:Array,default:()=>[]},linkify:{type:Boolean,default:!0},singleLine:{type:Boolean,default:!1},reply:{type:Boolean,default:!1},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["open-user-tag"],computed:{linkifiedMessage(){const e=qe(this.formatTags(this.content),this.linkify&&!this.linkOptions.disabled,this.textFormatting);return e.forEach((e=>{e.url=this.checkType(e,"url"),e.bold=this.checkType(e,"bold"),e.italic=this.checkType(e,"italic"),e.strike=this.checkType(e,"strike"),e.underline=this.checkType(e,"underline"),e.inline=this.checkType(e,"inline-code"),e.multiline=this.checkType(e,"multiline-code"),e.tag=this.checkType(e,"tag"),e.image=this.checkImageType(e)})),e},formattedContent(){return this.formatTags(this.content)}},methods:{checkType:(e,t)=>-1!==e.types.indexOf(t),checkImageType(e){let t=e.value.lastIndexOf(".");e.value.lastIndexOf("/")>t&&(t=-1);const n=e.value.substring(t+1,e.value.length),s=t>0&&Ke.v5.some((e=>n.toLowerCase().includes(e)));return s&&this.setImageSize(e),s},setImageSize(e){const t=new Image;t.src=e.value,t.addEventListener("load",(function n(s){const r=s.path[0].width/150;e.height=Math.round(s.path[0].height/r)+"px",t.removeEventListener("load",n)}))},formatTags(e){const t="<usertag>",n=[...e.matchAll(new RegExp(t,"gi"))].map((e=>e.index)),s=e;return n.forEach((t=>{const n=s.substring(t+9,s.indexOf("</usertag>",t)),r=this.users.find((e=>e._id===n));e=e.replaceAll(n,`@${r?.username||"unknown"}`)})),e},openTag(e){if(!this.singleLine&&this.checkType(e,"tag")){const t=this.users.find((t=>-1!==e.value.indexOf(t.username)));this.$emit("open-user-tag",t)}}}},We=(0,ue.Z)(Ge,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("svg-icon");return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:(0,s.normalizeClass)(["vac-format-message-wrapper",{"vac-text-ellipsis":n.singleLine}])},[n.textFormatting.disabled?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ue,(0,s.toDisplayString)(o.formattedContent),1)):((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:(0,s.normalizeClass)({"vac-text-ellipsis":n.singleLine})},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.linkifiedMessage,((t,r)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:r,class:"vac-format-container"},[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(t.url?"a":"span"),{class:(0,s.normalizeClass)({"vac-text-ellipsis":n.singleLine,"vac-text-bold":t.bold,"vac-text-italic":n.deleted||t.italic,"vac-text-strike":t.strike,"vac-text-underline":t.underline,"vac-text-inline-code":!n.singleLine&&t.inline,"vac-text-multiline-code":!n.singleLine&&t.multiline,"vac-text-tag":!n.singleLine&&!n.reply&&t.tag}),href:t.href,target:t.href?n.linkOptions.target:null,rel:t.href?n.linkOptions.rel:null,onClick:e=>o.openTag(t)},{default:(0,s.withCtx)((()=>[(0,s.renderSlot)(e.$slots,"deleted-icon",(0,s.normalizeProps)((0,s.guardReactiveProps)({deleted:n.deleted})),(()=>[n.deleted?((0,s.openBlock)(),(0,s.createBlock)(a,{key:0,name:"deleted",class:"vac-icon-deleted"})):(0,s.createCommentVNode)("",!0)])),t.url&&t.image?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:0},[(0,s.createElementVNode)("div",Le,[(0,s.createElementVNode)("div",{class:"vac-image-link",style:(0,s.normalizeStyle)({"background-image":`url('${t.value}')`,height:t.height})},null,4)]),(0,s.createElementVNode)("div",Ve,[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(t.value),1)])],64)):((0,s.openBlock)(),(0,s.createElementBlock)("span",Fe,(0,s.toDisplayString)(t.value),1))])),_:2},1032,["class","href","target","rel","onClick"]))])))),128))],2))],2)}]]),Ye=(e,t,n)=>{if(e.typingUsers&&e.typingUsers.length){if(!e.typingUsers.filter((e=>e!==t)).length)return;return e.users.length,n.IS_TYPING}},{isAudioFile:Xe}=n(84539),Qe={name:"RoomsContent",components:{SvgIcon:be,FormatMessage:We},directives:{clickOutside:Oe().directive},props:{currentUserId:{type:[String,Number],required:!0},room:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},roomActions:{type:Array,required:!0}},emits:["room-action-handler"],data:()=>({roomMenuOpened:null}),computed:{getLastMessage(){const e=this.typingUsers;if(e)return e;const t=this.room.lastMessage.deleted?this.textMessages.MESSAGE_DELETED:this.room.lastMessage.content;if(this.room.users.length<=2)return t;const n=this.room.users.find((e=>e._id===this.room.lastMessage.senderId));return this.room.lastMessage.username?`${this.room.lastMessage.username} - ${t}`:n&&n._id!==this.currentUserId?`${n.username} - ${t}`:t},userStatus(){if(!this.room.users||2!==this.room.users.length)return;const e=this.room.users.find((e=>e._id!==this.currentUserId));return e&&e.status?e.status.state:null},typingUsers(){return Ye(this.room,this.currentUserId,this.textMessages)},isMessageCheckmarkVisible(){return!this.typingUsers&&this.room.lastMessage&&!this.room.lastMessage.deleted&&this.room.lastMessage.senderId===this.currentUserId&&(this.room.lastMessage.saved||this.room.lastMessage.distributed||this.room.lastMessage.seen)},formattedDuration(){const e=this.room.lastMessage.files[0];if(!e.duration)return`${e.name}.${e.extension}`;let t=Math.floor(e.duration);return(t-(t%=60))/60+(t>9?":":":0")+t},isAudio(){return!!this.room.lastMessage.files&&Xe(this.room.lastMessage.files[0])}},methods:{roomActionHandler(e){this.closeRoomMenu(),this.$emit("room-action-handler",{action:e,roomId:this.room.roomId})},closeRoomMenu(){this.roomMenuOpened=null}}},Ze=(e,t,n,s=!1)=>n&&""!==n?e.filter((e=>s?Je(e[t]).startsWith(Je(n)):Je(e[t]).includes(Je(n)))):e;function Je(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}const et={name:"RoomsList",components:{Loader:de,RoomsSearch:we,RoomContent:(0,ue.Z)(Qe,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("svg-icon"),c=(0,s.resolveComponent)("format-message"),l=(0,s.resolveDirective)("click-outside");return(0,s.openBlock)(),(0,s.createElementBlock)("div",ke,[(0,s.renderSlot)(e.$slots,"room-list-item",(0,s.normalizeProps)((0,s.guardReactiveProps)({room:n.room})),(()=>[(0,s.renderSlot)(e.$slots,"room-list-avatar",(0,s.normalizeProps)((0,s.guardReactiveProps)({room:n.room})),(()=>[n.room.avatar?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-avatar",style:(0,s.normalizeStyle)({"background-image":`url('${n.room.avatar}')`})},null,4)):(0,s.createCommentVNode)("",!0)])),(0,s.createElementVNode)("div",xe,[(0,s.createElementVNode)("div",Ee,[o.userStatus?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:(0,s.normalizeClass)(["vac-state-circle",{"vac-state-online":"online"===o.userStatus}])},null,2)):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",Se,(0,s.toDisplayString)(n.room.roomName),1),n.room.lastMessage?((0,s.openBlock)(),(0,s.createElementBlock)("div",Te,(0,s.toDisplayString)(n.room.lastMessage.timestamp),1)):(0,s.createCommentVNode)("",!0)]),(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["vac-text-last",{"vac-message-new":n.room.lastMessage&&n.room.lastMessage.new&&!o.typingUsers}])},[o.isMessageCheckmarkVisible?((0,s.openBlock)(),(0,s.createElementBlock)("span",Ce,[(0,s.renderSlot)(e.$slots,"checkmark-icon",(0,s.normalizeProps)((0,s.guardReactiveProps)({message:n.room.lastMessage})),(()=>[(0,s.createVNode)(a,{name:n.room.lastMessage.distributed?"double-checkmark":"checkmark",param:n.room.lastMessage.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])]))])):(0,s.createCommentVNode)("",!0),n.room.lastMessage&&!n.room.lastMessage.deleted&&o.isAudio?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ie,[(0,s.renderSlot)(e.$slots,"microphone-icon",{},(()=>[(0,s.createVNode)(a,{name:"microphone",class:"vac-icon-microphone"})])),(0,s.createTextVNode)(" "+(0,s.toDisplayString)(o.formattedDuration),1)])):n.room.lastMessage?((0,s.openBlock)(),(0,s.createBlock)(c,{key:2,content:o.getLastMessage,deleted:!!n.room.lastMessage.deleted&&!o.typingUsers,users:n.room.users,linkify:!1,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"single-line":!0},{"deleted-icon":(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,"deleted-icon",(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))])),_:3},8,["content","deleted","users","text-formatting","link-options"])):(0,s.createCommentVNode)("",!0),!n.room.lastMessage&&o.typingUsers?((0,s.openBlock)(),(0,s.createElementBlock)("div",Re,(0,s.toDisplayString)(o.typingUsers),1)):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",Ae,[n.room.unreadCount?((0,s.openBlock)(),(0,s.createElementBlock)("div",Me,(0,s.toDisplayString)(n.room.unreadCount),1)):(0,s.createCommentVNode)("",!0),(0,s.renderSlot)(e.$slots,"room-list-options",(0,s.normalizeProps)((0,s.guardReactiveProps)({room:n.room})),(()=>[n.roomActions.length?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-svg-button vac-list-room-options",onClick:t[0]||(t[0]=(0,s.withModifiers)((e=>i.roomMenuOpened=n.room.roomId),["stop"]))},[(0,s.renderSlot)(e.$slots,"room-list-options-icon",{},(()=>[(0,s.createVNode)(a,{name:"dropdown",param:"room"})]))])):(0,s.createCommentVNode)("",!0),n.roomActions.length?((0,s.openBlock)(),(0,s.createBlock)(s.Transition,{key:1,name:"vac-slide-left"},{default:(0,s.withCtx)((()=>[i.roomMenuOpened===n.room.roomId?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",Ne,[(0,s.createElementVNode)("div",Pe,[(0,s.createElementVNode)("span",{onClick:t[1]||(t[1]=(...e)=>o.closeRoomMenu&&o.closeRoomMenu(...e))},[(0,s.renderSlot)(e.$slots,"menu-close",{},(()=>[(0,s.createVNode)(a,{name:"close-outline"})]))]),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.roomActions,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:e.name},[(0,s.createElementVNode)("div",{class:"vac-menu-item",onClick:(0,s.withModifiers)((t=>o.roomActionHandler(e)),["stop"])},(0,s.toDisplayString)(e.title),9,Be)])))),128))])])),[[l,o.closeRoomMenu]]):(0,s.createCommentVNode)("",!0)])),_:3})):(0,s.createCommentVNode)("",!0)]))])],2)])]))])}]])},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},showRoomsList:{type:Boolean,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0},roomsLoaded:{type:Boolean,required:!0},room:{type:Object,required:!0},roomActions:{type:Array,required:!0},scrollDistance:{type:Number,required:!0}},emits:["add-room","room-action-handler","loading-more-rooms","fetch-room","fetch-more-rooms"],data(){return{filteredRooms:this.rooms||[],observer:null,showLoader:!0,loadingMoreRooms:!1,selectedRoomId:""}},watch:{rooms:{deep:!0,handler(e,t){this.filteredRooms=e,(e.length!==t.length||this.roomsLoaded)&&(this.loadingMoreRooms=!1)}},loadingRooms(e){e||setTimeout((()=>this.initIntersectionObserver()))},loadingMoreRooms(e){this.$emit("loading-more-rooms",e)},roomsLoaded:{immediate:!0,handler(e){e&&(this.loadingMoreRooms=!1,this.loadingRooms||(this.showLoader=!1))}},room:{immediate:!0,handler(e){e&&!this.isMobile&&(this.selectedRoomId=e.roomId)}}},methods:{initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.getElementById("infinite-loader-rooms");if(e){const t={root:document.getElementById("rooms-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver((e=>{e[0].isIntersecting&&this.loadMoreRooms()}),t),this.observer.observe(e)}},searchRoom(e){this.filteredRooms=Ze(this.rooms,"roomName",e.target.value)},openRoom(e){(e.roomId!==this.room.roomId||this.isMobile)&&(this.isMobile||(this.selectedRoomId=e.roomId),this.$emit("fetch-room",{room:e}))},loadMoreRooms(){if(!this.loadingMoreRooms){if(this.roomsLoaded)return this.loadingMoreRooms=!1,void(this.showLoader=!1);this.$emit("fetch-more-rooms"),this.loadingMoreRooms=!0}}}},tt=(0,ue.Z)(et,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("rooms-search"),c=(0,s.resolveComponent)("loader"),l=(0,s.resolveComponent)("room-content");return(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:(0,s.normalizeClass)(["vac-rooms-container vac-app-border-r",{"vac-rooms-container-full":n.isMobile}])},[(0,s.renderSlot)(e.$slots,"rooms-header"),(0,s.renderSlot)(e.$slots,"rooms-list-search",{},(()=>[(0,s.createVNode)(a,{rooms:n.rooms,"loading-rooms":n.loadingRooms,"text-messages":n.textMessages,"show-search":n.showSearch,"show-add-room":n.showAddRoom,onSearchRoom:o.searchRoom,onAddRoom:t[0]||(t[0]=t=>e.$emit("add-room"))},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["rooms","loading-rooms","text-messages","show-search","show-add-room","onSearchRoom"])])),(0,s.createVNode)(c,{show:n.loadingRooms},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["show"]),n.loadingRooms||n.rooms.length?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",ie,[(0,s.renderSlot)(e.$slots,"rooms-empty",{},(()=>[(0,s.createTextVNode)((0,s.toDisplayString)(n.textMessages.ROOMS_EMPTY),1)]))])),n.loadingRooms?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",oe,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(i.filteredRooms,(r=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{id:r.roomId,key:r.roomId,class:(0,s.normalizeClass)(["vac-room-item",{"vac-room-selected":i.selectedRoomId===r.roomId}]),onClick:e=>o.openRoom(r)},[(0,s.createVNode)(l,{"current-user-id":n.currentUserId,room:r,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"text-messages":n.textMessages,"room-actions":n.roomActions,onRoomActionHandler:t[1]||(t[1]=t=>e.$emit("room-action-handler",t))},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["current-user-id","room","text-formatting","link-options","text-messages","room-actions"])],10,ae)))),128)),(0,s.createVNode)(s.Transition,{name:"vac-fade-message"},{default:(0,s.withCtx)((()=>[n.rooms.length&&!n.loadingRooms?((0,s.openBlock)(),(0,s.createElementBlock)("div",ce,[(0,s.createVNode)(c,{show:i.showLoader,infinite:!0},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["show"])])):(0,s.createCommentVNode)("",!0)])),_:3})]))],2)),[[s.vShow,n.showRoomsList]])}]]),nt={class:"vac-container-center vac-room-empty"},st={class:"vac-messages-container"},rt={key:0,class:"vac-text-started"},it={key:1,class:"vac-text-started"},ot={key:0,id:"infinite-loader-messages"},at={key:2},ct={key:0,class:"vac-badge-counter vac-messages-count"};const lt={class:"vac-room-header vac-app-border-b"},ht={class:"vac-room-wrapper"},ut={key:0,class:"vac-room-selection"},dt=["id"],mt=["onClick"],pt={class:"vac-selection-button-count"},ft={class:"vac-text-ellipsis"},gt={class:"vac-room-name vac-text-ellipsis"},_t={key:0,class:"vac-room-info vac-text-ellipsis"},vt={key:1,class:"vac-room-info vac-text-ellipsis"},bt={key:0,class:"vac-menu-options"},yt={class:"vac-menu-list"},wt=["onClick"];const kt={name:"RoomHeader",components:{SvgIcon:be},directives:{clickOutside:Oe().directive},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},room:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},messageSelectionActions:{type:Array,required:!0},selectedMessagesTotal:{type:Number,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","cancel-message-selection","message-selection-action-handler"],data:()=>({menuOpened:!1,messageSelectionAnimationEnded:!0}),computed:{typingUsers(){return Ye(this.room,this.currentUserId,this.textMessages)},userStatus(){if(!this.room.users||2!==this.room.users.length)return;const e=this.room.users.find((e=>e._id!==this.currentUserId));if(!e.status)return;let t="";return"online"===e.status.state?t=this.textMessages.IS_ONLINE:e.status.lastChanged&&(t=this.textMessages.LAST_SEEN+e.status.lastChanged),t}},watch:{messageSelectionEnabled(e){e?this.messageSelectionAnimationEnded=!1:setTimeout((()=>{this.messageSelectionAnimationEnded=!0}),300)}},methods:{menuActionHandler(e){this.closeMenu(),this.$emit("menu-action-handler",e)},closeMenu(){this.menuOpened=!1},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",e)}}},xt=(0,ue.Z)(kt,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("svg-icon"),c=(0,s.resolveDirective)("click-outside");return(0,s.openBlock)(),(0,s.createElementBlock)("div",lt,[(0,s.renderSlot)(e.$slots,"room-header",(0,s.normalizeProps)((0,s.guardReactiveProps)({room:n.room,typingUsers:o.typingUsers,userStatus:o.userStatus})),(()=>[(0,s.createElementVNode)("div",ht,[(0,s.createVNode)(s.Transition,{name:"vac-slide-up"},{default:(0,s.withCtx)((()=>[n.messageSelectionEnabled?((0,s.openBlock)(),(0,s.createElementBlock)("div",ut,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.messageSelectionActions,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{id:e.name,key:e.name},[(0,s.createElementVNode)("div",{class:"vac-selection-button",onClick:t=>o.messageSelectionActionHandler(e)},[(0,s.createTextVNode)((0,s.toDisplayString)(e.title)+" ",1),(0,s.createElementVNode)("span",pt,(0,s.toDisplayString)(n.selectedMessagesTotal),1)],8,mt)],8,dt)))),128)),(0,s.createElementVNode)("div",{class:"vac-selection-cancel vac-item-clickable",onClick:t[0]||(t[0]=t=>e.$emit("cancel-message-selection"))},(0,s.toDisplayString)(n.textMessages.CANCEL_SELECT_MESSAGE),1)])):(0,s.createCommentVNode)("",!0)])),_:1}),!n.messageSelectionEnabled&&i.messageSelectionAnimationEnded?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:0},[n.singleRoom?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:(0,s.normalizeClass)(["vac-svg-button vac-toggle-button",{"vac-rotate-icon":!n.showRoomsList&&!n.isMobile}]),onClick:t[1]||(t[1]=t=>e.$emit("toggle-rooms-list"))},[(0,s.renderSlot)(e.$slots,"toggle-icon",{},(()=>[(0,s.createVNode)(a,{name:"toggle"})]))],2)),(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["vac-info-wrapper",{"vac-item-clickable":n.roomInfoEnabled}]),onClick:t[2]||(t[2]=t=>e.$emit("room-info"))},[(0,s.renderSlot)(e.$slots,"room-header-avatar",(0,s.normalizeProps)((0,s.guardReactiveProps)({room:n.room})),(()=>[n.room.avatar?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-avatar",style:(0,s.normalizeStyle)({"background-image":`url('${n.room.avatar}')`})},null,4)):(0,s.createCommentVNode)("",!0)])),(0,s.renderSlot)(e.$slots,"room-header-info",(0,s.normalizeProps)((0,s.guardReactiveProps)({room:n.room,typingUsers:o.typingUsers,userStatus:o.userStatus})),(()=>[(0,s.createElementVNode)("div",ft,[(0,s.createElementVNode)("div",gt,(0,s.toDisplayString)(n.room.roomName),1),o.typingUsers?((0,s.openBlock)(),(0,s.createElementBlock)("div",_t,(0,s.toDisplayString)(o.typingUsers),1)):((0,s.openBlock)(),(0,s.createElementBlock)("div",vt,(0,s.toDisplayString)(o.userStatus),1))])]))],2),n.room.roomId?(0,s.renderSlot)(e.$slots,"room-options",{key:1},(()=>[n.menuActions.length?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-svg-button vac-room-options",onClick:t[3]||(t[3]=e=>i.menuOpened=!i.menuOpened)},[(0,s.renderSlot)(e.$slots,"menu-icon",{},(()=>[(0,s.createVNode)(a,{name:"menu"})]))])):(0,s.createCommentVNode)("",!0),n.menuActions.length?((0,s.openBlock)(),(0,s.createBlock)(s.Transition,{key:1,name:"vac-slide-left"},{default:(0,s.withCtx)((()=>[i.menuOpened?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",bt,[(0,s.createElementVNode)("div",yt,[(0,s.createElementVNode)("span",{onClick:t[4]||(t[4]=(...e)=>o.closeMenu&&o.closeMenu(...e))},[(0,s.renderSlot)(e.$slots,"menu-close",{},(()=>[(0,s.createVNode)(a,{name:"close-outline"})]))]),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.menuActions,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:e.name},[(0,s.createElementVNode)("div",{class:"vac-menu-item",onClick:t=>o.menuActionHandler(e)},(0,s.toDisplayString)(e.title),9,wt)])))),128))])])),[[c,o.closeMenu]]):(0,s.createCommentVNode)("",!0)])),_:3})):(0,s.createCommentVNode)("",!0)])):(0,s.createCommentVNode)("",!0)],64)):(0,s.createCommentVNode)("",!0)])]))])}]]),Et={key:0,class:"vac-icon-textarea-left"},St=(0,s.createElementVNode)("div",{class:"vac-dot-audio-record"},null,-1),Tt={class:"vac-dot-audio-record-time"},Ct=["placeholder"],It={class:"vac-icon-textarea"},Rt=["accept"];function At(e){if("string"!=typeof e||!e)throw new Error("expected a non-empty string, got: "+e)}function Mt(e){if("number"!=typeof e)throw new Error("expected a number, got: "+e)}const Nt=1,Pt=1,Bt="emoji",Dt="keyvalue",Ot="favorites",Lt="tokens",Vt="tokens",Ft="unicode",Ut="count",jt="group",qt="order",Ht="group-order",zt="eTag",$t="url",Kt="skinTone",Gt="readonly",Wt="readwrite",Yt="skinUnicodes",Xt="skinUnicodes";function Qt(e){return function(e,t){const n=new Set,s=[];for(const r of e){const e=t(r);n.has(e)||(n.add(e),s.push(r))}return s}(e,(e=>e.unicode))}const Zt={},Jt={},en={};function tn(e,t,n){n.onerror=()=>t(n.error),n.onblocked=()=>t(new Error("IDB blocked")),n.onsuccess=()=>e(n.result)}async function nn(e){const t=await new Promise(((t,n)=>{const s=indexedDB.open(e,Nt);Zt[e]=s,s.onupgradeneeded=e=>{e.oldVersion<Pt&&function(e){function t(t,n,s){const r=n?e.createObjectStore(t,{keyPath:n}):e.createObjectStore(t);if(s)for(const[e,[t,n]]of Object.entries(s))r.createIndex(e,t,{multiEntry:n});return r}t(Dt),t(Bt,Ft,{[Vt]:[Lt,!0],[Ht]:[[jt,qt]],[Yt]:[Xt,!0]}),t(Ot,void 0,{[Ut]:[""]})}(s.result)},tn(t,n,s)}));return t.onclose=()=>rn(e),t}function sn(e,t,n,s){return new Promise(((r,i)=>{const o=e.transaction(t,n,{durability:"relaxed"}),a="string"==typeof t?o.objectStore(t):t.map((e=>o.objectStore(e)));let c;s(a,o,(e=>{c=e})),o.oncomplete=()=>r(c),o.onerror=()=>i(o.error)}))}function rn(e){const t=Zt[e],n=t&&t.result;if(n){n.close();const t=en[e];if(t)for(const e of t)e()}delete Zt[e],delete Jt[e],delete en[e]}const on=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function an(e){return e.split(/[\s_]+/).map((e=>!e.match(/\w/)||on.has(e)?e.toLowerCase():e.replace(/[)(:,]/g,"").replace(/’/g,"'").toLowerCase())).filter(Boolean)}const cn=2;function ln(e){return e.filter(Boolean).map((e=>e.toLowerCase())).filter((e=>e.length>=cn))}function hn(e,t,n,s){e[t](n).onsuccess=e=>s&&s(e.target.result)}function un(e,t,n){hn(e,"get",t,n)}function dn(e,t,n){hn(e,"getAll",t,n)}function mn(e){e.commit&&e.commit()}function pn(e,t){const n=function(e,t){let n=e[0];for(let s=1;s<e.length;s++){const r=e[s];t(n)>t(r)&&(n=r)}return n}(e,(e=>e.length)),s=[];for(const r of n)e.some((e=>-1===e.findIndex((e=>t(e)===t(r)))))||s.push(r);return s}async function fn(e,t,n,s){try{const r=function(e){return e.map((({annotation:e,emoticon:t,group:n,order:s,shortcodes:r,skins:i,tags:o,emoji:a,version:c})=>{const l=[...new Set(ln([...(r||[]).map(an).flat(),...o.map(an).flat(),...an(e),t]))].sort(),h={annotation:e,group:n,order:s,tags:o,tokens:l,unicode:a,version:c};if(t&&(h.emoticon=t),r&&(h.shortcodes=r),i){h.skinTones=[],h.skinUnicodes=[],h.skinVersions=[];for(const{tone:e,emoji:t,version:n}of i)h.skinTones.push(e),h.skinUnicodes.push(t),h.skinVersions.push(n)}return h}))}(t);await sn(e,[Bt,Dt],Wt,(([e,t],i)=>{let o,a,c=0;function l(){2==++c&&function(){if(o===s&&a===n)return;e.clear();for(const t of r)e.put(t);t.put(s,zt),t.put(n,$t),mn(i)}()}un(t,zt,(e=>{o=e,l()})),un(t,$t,(e=>{a=e,l()}))}))}finally{}}async function gn(e,t){const n=ln(an(t));return n.length?sn(e,Bt,Gt,((e,t,s)=>{const r=[],i=()=>{const e=pn(r,(e=>e.unicode));s(e.sort(((e,t)=>e.order<t.order?-1:1)))};for(let t=0;t<n.length;t++){const s=n[t],o=t===n.length-1?IDBKeyRange.bound(s,s+"￿",!1,!0):IDBKeyRange.only(s);dn(e.index(Vt),o,(e=>{r.push(e),r.length===n.length&&i()}))}})):[]}async function _n(e,t){const n=await gn(e,t);if(!n.length){const n=e=>(e.shortcodes||[]).includes(t.toLowerCase());return await async function(e,t){return sn(e,Bt,Gt,((e,n,s)=>{let r;const i=()=>{e.getAll(r&&IDBKeyRange.lowerBound(r,!0),50).onsuccess=e=>{const n=e.target.result;for(const e of n)if(r=e.unicode,t(e))return s(e);if(n.length<50)return s();i()}};i()}))}(e,n)||null}return n.filter((e=>{const n=(e.shortcodes||[]).map((e=>e.toLowerCase()));return n.includes(t.toLowerCase())}))[0]||null}function vn(e,t,n){return sn(e,t,Gt,((e,t,s)=>un(e,n,s)))}const bn="";const yn=["name","url"];function wn(e){!function(e){const t=e&&Array.isArray(e),n=t&&e.length&&(!e[0]||yn.some((t=>!(t in e[0]))));if(!t||n)throw new Error("Custom emojis are in the wrong format")}(e);const t=(e,t)=>e.name.toLowerCase()<t.name.toLowerCase()?-1:1,n=e.sort(t),s=function(e,t){const n=new Map;for(const s of e){const e=t(s);for(const t of e){let e=n;for(let n=0;n<t.length;n++){const s=t.charAt(n);let r=e.get(s);r||(r=new Map,e.set(s,r)),e=r}let r=e.get(bn);r||(r=[],e.set(bn,r)),r.push(s)}}return(e,t)=>{let s=n;for(let t=0;t<e.length;t++){const n=e.charAt(t),r=s.get(n);if(!r)return[];s=r}if(t)return s.get(bn)||[];const r=[],i=[s];for(;i.length;){const e=[...i.shift().entries()].sort(((e,t)=>e[0]<t[0]?-1:1));for(const[t,n]of e)t===bn?r.push(...n):i.push(n)}return r}}(e,(e=>[...new Set((e.shortcodes||[]).map((e=>an(e))).flat())])),r=e=>s(e,!0),i=e=>s(e,!1),o=new Map,a=new Map;for(const t of e){a.set(t.name.toLowerCase(),t);for(const e of t.shortcodes||[])o.set(e.toLowerCase(),t)}return{all:n,search:e=>{const n=an(e);return pn(n.map(((e,t)=>(t<n.length-1?r:i)(e))),(e=>e.name)).sort(t)},byShortcode:e=>o.get(e.toLowerCase()),byName:e=>a.get(e.toLowerCase())}}const kn="undefined"!=typeof wrappedJSObject;function xn(e){if(!e)return e;if(kn&&(e=structuredClone(e)),delete e.tokens,e.skinTones){const t=e.skinTones.length;e.skins=Array(t);for(let n=0;n<t;n++)e.skins[n]={tone:e.skinTones[n],unicode:e.skinUnicodes[n],version:e.skinVersions[n]};delete e.skinTones,delete e.skinUnicodes,delete e.skinVersions}return e}function En(e){e||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const Sn=["annotation","emoji","group","order","tags","version"];function Tn(e,t){if(2!==Math.floor(e.status/100))throw new Error("Failed to fetch: "+t+":  "+e.status)}async function Cn(e){const t=await fetch(e);Tn(t,e);const n=t.headers.get("etag");En(n);const s=await t.json();return function(e){if(!e||!Array.isArray(e)||!e[0]||"object"!=typeof e[0]||Sn.some((t=>!(t in e[0]))))throw new Error("Emoji data is in the wrong format")}(s),[n,s]}async function In(e){const t=function(e){for(var t=e.length,n=new ArrayBuffer(t),s=new Uint8Array(n),r=-1;++r<t;)s[r]=e.charCodeAt(r);return n}(JSON.stringify(e)),n=function(e){for(var t="",n=new Uint8Array(e),s=n.byteLength,r=-1;++r<s;)t+=String.fromCharCode(n[r]);return t}(await crypto.subtle.digest("SHA-1",t));return btoa(n)}async function Rn(e,t){let n,s=await async function(e){const t=await fetch(e,{method:"HEAD"});Tn(t,e);const n=t.headers.get("etag");return En(n),n}(t);if(!s){const e=await Cn(t);s=e[0],n=e[1],s||(s=await In(n))}if(await async function(e,t,n){const[s,r]=await Promise.all([zt,$t].map((t=>vn(e,Dt,t))));return s===n&&r===t}(e,t,s));else{if(!n){n=(await Cn(t))[1]}await fn(e,n,t,s)}}class An{constructor({dataSource:e="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",locale:t="en",customEmoji:n=[]}={}){this.dataSource=e,this.locale=t,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=wn(n),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const e=this._db=await(t=this._dbName,Jt[t]||(Jt[t]=nn(t)),Jt[t]);var t;!function(e,t){let n=en[e];n||(n=en[e]=[]),n.push(t)}(this._dbName,this._clear);const n=this.dataSource,s=await async function(e){return!await vn(e,Dt,$t)}(e);s?await async function(e,t){let[n,s]=await Cn(t);n||(n=await In(s)),await fn(e,s,t,n)}(e,n):this._lazyUpdate=Rn(e,n)}async ready(){const e=async()=>(this._ready||(this._ready=this._init()),this._ready);await e(),this._db||await e()}async getEmojiByGroup(e){return Mt(e),await this.ready(),Qt(await async function(e,t){return sn(e,Bt,Gt,((e,n,s)=>{const r=IDBKeyRange.bound([t,0],[t+1,0],!1,!0);dn(e.index(Ht),r,s)}))}(this._db,e)).map(xn)}async getEmojiBySearchQuery(e){At(e),await this.ready();return[...this._custom.search(e),...Qt(await gn(this._db,e)).map(xn)]}async getEmojiByShortcode(e){At(e),await this.ready();const t=this._custom.byShortcode(e);return t||xn(await _n(this._db,e))}async getEmojiByUnicodeOrName(e){At(e),await this.ready();const t=this._custom.byName(e);return t||xn(await async function(e,t){return sn(e,Bt,Gt,((e,n,s)=>un(e,t,(n=>{if(n)return s(n);un(e.index(Yt),t,(e=>s(e||null)))}))))}(this._db,e))}async getPreferredSkinTone(){return await this.ready(),await vn(this._db,Dt,Kt)||0}async setPreferredSkinTone(e){return Mt(e),await this.ready(),t=this._db,n=Kt,s=e,sn(t,Dt,Wt,((e,t)=>{e.put(s,n),mn(t)}));var t,n,s}async incrementFavoriteEmojiCount(e){return At(e),await this.ready(),t=this._db,n=e,sn(t,Ot,Wt,((e,t)=>un(e,n,(s=>{e.put((s||0)+1,n),mn(t)}))));var t,n}async getTopFavoriteEmoji(e){return Mt(e),await this.ready(),(await function(e,t,n){return 0===n?[]:sn(e,[Ot,Bt],Gt,(([e,s],r,i)=>{const o=[];e.index(Ut).openCursor(void 0,"prev").onsuccess=e=>{const r=e.target.result;if(!r)return i(o);function a(e){if(o.push(e),o.length===n)return i(o);r.continue()}const c=r.primaryKey,l=t.byName(c);if(l)return a(l);un(s,c,(e=>{if(e)return a(e);r.continue()}))}}))}(this._db,this._custom,e)).map(xn)}set customEmoji(e){this._custom=wn(e)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch(e){}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await rn(this._dbName)}async delete(){var e;await this._shutdown(),await(e=this._dbName,new Promise(((t,n)=>{rn(e),tn(t,n,indexedDB.deleteDatabase(e))})))}}function Mn(){}function Nn(e){return e()}function Pn(){return Object.create(null)}function Bn(e){e.forEach(Nn)}function Dn(e){return"function"==typeof e}function On(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let Ln;function Vn(e,t){return Ln||(Ln=document.createElement("a")),Ln.href=t,e===Ln.href}const Fn="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function Un(e,t){e.appendChild(t)}function jn(e,t,n){e.insertBefore(t,n||null)}function qn(e){e.parentNode&&e.parentNode.removeChild(e)}function Hn(e){return document.createElement(e)}function zn(e){return document.createTextNode(e)}function $n(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function Kn(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Gn(e,t){t=""+t,e.data!==t&&(e.data=t)}function Wn(e,t){e.value=null==t?"":t}function Yn(e,t,n,s){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,s?"important":"")}let Xn;function Qn(e){Xn=e}function Zn(e){(function(){if(!Xn)throw new Error("Function called outside component initialization");return Xn})().$$.on_mount.push(e)}const Jn=[],es=[];let ts=[];const ns=[],ss=Promise.resolve();let rs=!1;function is(e){ts.push(e)}const os=new Set;let as=0;function cs(){if(0!==as)return;const e=Xn;do{try{for(;as<Jn.length;){const e=Jn[as];as++,Qn(e),ls(e.$$)}}catch(e){throw Jn.length=0,as=0,e}for(Qn(null),Jn.length=0,as=0;es.length;)es.pop()();for(let e=0;e<ts.length;e+=1){const t=ts[e];os.has(t)||(os.add(t),t())}ts.length=0}while(Jn.length);for(;ns.length;)ns.pop()();rs=!1,os.clear(),Qn(e)}function ls(e){if(null!==e.fragment){e.update(),Bn(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(is)}}const hs=new Set;function us(e,t){e.d(1),t.delete(e.key)}function ds(e,t,n,s,r,i,o,a,c,l,h,u){let d=e.length,m=i.length,p=d;const f={};for(;p--;)f[e[p].key]=p;const g=[],_=new Map,v=new Map,b=[];for(p=m;p--;){const e=u(r,i,p),a=n(e);let c=o.get(a);c?s&&b.push((()=>c.p(e,t))):(c=l(a,e),c.c()),_.set(a,g[p]=c),a in f&&v.set(a,Math.abs(p-f[a]))}const y=new Set,w=new Set;function k(e){!function(e,t){e&&e.i&&(hs.delete(e),e.i(t))}(e,1),e.m(a,h),o.set(e.key,e),h=e.first,m--}for(;d&&m;){const t=g[m-1],n=e[d-1],s=t.key,r=n.key;t===n?(h=t.first,d--,m--):_.has(r)?!o.has(s)||y.has(s)?k(t):w.has(r)?d--:v.get(s)>v.get(r)?(w.add(s),k(t)):(y.add(r),d--):(c(n,o),d--)}for(;d--;){const t=e[d];_.has(t.key)||c(t,o)}for(;m;)k(g[m-1]);return Bn(b),g}function ms(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];ts.forEach((s=>-1===e.indexOf(s)?t.push(s):n.push(s))),n.forEach((e=>e())),ts=t}(n.after_update),Bn(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ps(e,t){-1===e.$$.dirty[0]&&(Jn.push(e),rs||(rs=!0,ss.then(cs)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function fs(e,t,n,s,r,i,o,a=[-1]){const c=Xn;Qn(e);const l=e.$$={fragment:null,ctx:[],props:i,update:Mn,not_equal:r,bound:Pn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:Pn(),dirty:a,skip_bound:!1,root:t.target||c.$$.root};o&&o(l.root);let h=!1;l.ctx=n?n(e,t.props||{},((t,n,...s)=>{const i=s.length?s[0]:n;return l.ctx&&r(l.ctx[t],l.ctx[t]=i)&&(!l.skip_bound&&l.bound[t]&&l.bound[t](i),h&&ps(e,t)),n})):[],l.update(),h=!0,Bn(l.before_update),l.fragment=!!s&&s(l.ctx),t.target&&(l.fragment&&l.fragment.c(),function(e,t,n,s){const{fragment:r,after_update:i}=e.$$;r&&r.m(t,n),s||is((()=>{const t=e.$$.on_mount.map(Nn).filter(Dn);e.$$.on_destroy?e.$$.on_destroy.push(...t):Bn(t),e.$$.on_mount=[]})),i.forEach(is)}(e,t.target,void 0,void 0),cs()),Qn(c)}class gs{$destroy(){ms(this,1),this.$destroy=Mn}$on(e,t){if(!Dn(t))return Mn;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const _s=[[-1,"✨","custom"],[0,"😀","smileys-emotion"],[1,"👋","people-body"],[3,"🐱","animals-nature"],[4,"🍎","food-drink"],[5,"🏠️","travel-places"],[6,"⚽","activities"],[7,"📝","objects"],[8,"⛔️","symbols"],[9,"🏁","flags"]].map((([e,t,n])=>({id:e,emoji:t,name:n}))),vs=_s.slice(1),bs=_s[0],ys="function"==typeof requestIdleCallback?requestIdleCallback:setTimeout;function ws(e){return e.unicode.includes("‍")}const ks={"🫨":15,"🫠":14,"🥲":13.1,"🥻":12.1,"🥰":11,"🤩":5,"👱‍♀️":4,"🤣":3,"👁️‍🗨️":2,"😀":1,"😐️":.7,"😃":.6},xs=["😊","😒","♥️","👍️","😍","😂","😭","☺️","😔","😩","😏","💕","🙌","😘"],Es='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',Ss=(e,t)=>e<t?-1:e>t?1:0,Ts=(e,t)=>{const n=document.createElement("canvas");n.width=n.height=1;const s=n.getContext("2d");return s.textBaseline="top",s.font=`100px ${Es}`,s.fillStyle=t,s.scale(.01,.01),s.fillText(e,0,0),s.getImageData(0,0,1,1).data},Cs=(e,t)=>{const n=[...e].join(",");return n===[...t].join(",")&&!n.startsWith("0,0,0,")};function Is(e){const t=Ts(e,"#000"),n=Ts(e,"#fff");return t&&n&&Cs(t,n)}let Rs;const As=()=>(Rs||(Rs=new Promise((e=>ys((()=>e(function(){const e=Object.entries(ks);try{for(const[t,n]of e)if(Is(t))return n}catch(e){}return e[0][1]}())))))),Rs),Ms=new Map,Ns="️",Ps="\ud83c",Bs="‍",Ds=127995,Os=57339;function Ls(e){e.preventDefault(),e.stopPropagation()}function Vs(e,t,n){return(t+=e?-1:1)<0?t=n.length-1:t>=n.length&&(t=0),t}function Fs(e,t){const n=new Set,s=[];for(const r of e){const e=t(r);n.has(e)||(n.add(e),s.push(r))}return s}const Us=requestAnimationFrame;let js,qs="function"==typeof ResizeObserver;function Hs(e){{const t=document.createRange();return t.selectNode(e.firstChild),t.getBoundingClientRect().width}}const{Map:zs}=Fn;function $s(e,t,n){const s=e.slice();return s[64]=t[n],s[66]=n,s}function Ks(e,t,n){const s=e.slice();return s[67]=t[n],s[66]=n,s}function Gs(e,t,n){const s=e.slice();return s[64]=t[n],s[66]=n,s}function Ws(e,t,n){const s=e.slice();return s[70]=t[n],s}function Ys(e,t,n){const s=e.slice();return s[73]=t[n],s[66]=n,s}function Xs(e,t){let n,s,r,i,o,a,c,l=t[73]+"";return{key:e,first:null,c(){n=Hn("div"),s=zn(l),Kn(n,"id",r="skintone-"+t[66]),Kn(n,"class",i="emoji "+(t[66]===t[20]?"active":"")),Kn(n,"aria-selected",o=t[66]===t[20]),Kn(n,"role","option"),Kn(n,"title",a=t[0].skinTones[t[66]]),Kn(n,"aria-label",c=t[0].skinTones[t[66]]),this.first=n},m(e,t){jn(e,n,t),Un(n,s)},p(e,h){t=e,512&h[0]&&l!==(l=t[73]+"")&&Gn(s,l),512&h[0]&&r!==(r="skintone-"+t[66])&&Kn(n,"id",r),1049088&h[0]&&i!==(i="emoji "+(t[66]===t[20]?"active":""))&&Kn(n,"class",i),1049088&h[0]&&o!==(o=t[66]===t[20])&&Kn(n,"aria-selected",o),513&h[0]&&a!==(a=t[0].skinTones[t[66]])&&Kn(n,"title",a),513&h[0]&&c!==(c=t[0].skinTones[t[66]])&&Kn(n,"aria-label",c)},d(e){e&&qn(n)}}}function Qs(e,t){let n,s,r,i,o,a,c,l,h,u=t[70].emoji+"";function d(){return t[50](t[70])}return{key:e,first:null,c(){n=Hn("button"),s=Hn("div"),r=zn(u),Kn(s,"class","nav-emoji emoji"),Kn(n,"role","tab"),Kn(n,"class","nav-button"),Kn(n,"aria-controls",i="tab-"+t[70].id),Kn(n,"aria-label",o=t[0].categories[t[70].name]),Kn(n,"aria-selected",a=!t[4]&&t[13].id===t[70].id),Kn(n,"title",c=t[0].categories[t[70].name]),this.first=n},m(e,t){jn(e,n,t),Un(n,s),Un(s,r),l||(h=$n(n,"click",d),l=!0)},p(e,s){t=e,4096&s[0]&&u!==(u=t[70].emoji+"")&&Gn(r,u),4096&s[0]&&i!==(i="tab-"+t[70].id)&&Kn(n,"aria-controls",i),4097&s[0]&&o!==(o=t[0].categories[t[70].name])&&Kn(n,"aria-label",o),12304&s[0]&&a!==(a=!t[4]&&t[13].id===t[70].id)&&Kn(n,"aria-selected",a),4097&s[0]&&c!==(c=t[0].categories[t[70].name])&&Kn(n,"title",c)},d(e){e&&qn(n),l=!1,h()}}}function Zs(e){let t,n;return{c(){t=Hn("img"),Kn(t,"class","custom-emoji"),Vn(t.src,n=e[64].url)||Kn(t,"src",n),Kn(t,"alt",""),Kn(t,"loading","lazy")},m(e,n){jn(e,t,n)},p(e,s){32768&s[0]&&!Vn(t.src,n=e[64].url)&&Kn(t,"src",n)},d(e){e&&qn(t)}}}function Js(e){let t,n=e[27](e[64],e[8])+"";return{c(){t=zn(n)},m(e,n){jn(e,t,n)},p(e,s){33024&s[0]&&n!==(n=e[27](e[64],e[8])+"")&&Gn(t,n)},d(e){e&&qn(t)}}}function er(e,t){let n,s,r,i,o,a,c;function l(e,t){return e[64].unicode?Js:Zs}let h=l(t),u=h(t);return{key:e,first:null,c(){n=Hn("button"),u.c(),Kn(n,"role",s=t[4]?"option":"menuitem"),Kn(n,"aria-selected",r=t[4]?t[66]==t[5]:""),Kn(n,"aria-label",i=t[28](t[64],t[8])),Kn(n,"title",o=t[64].title),Kn(n,"class",a="emoji "+(t[4]&&t[66]===t[5]?"active":"")),Kn(n,"id",c="emo-"+t[64].id),this.first=n},m(e,t){jn(e,n,t),u.m(n,null)},p(e,d){h===(h=l(t=e))&&u?u.p(t,d):(u.d(1),u=h(t),u&&(u.c(),u.m(n,null))),16&d[0]&&s!==(s=t[4]?"option":"menuitem")&&Kn(n,"role",s),32816&d[0]&&r!==(r=t[4]?t[66]==t[5]:"")&&Kn(n,"aria-selected",r),33024&d[0]&&i!==(i=t[28](t[64],t[8]))&&Kn(n,"aria-label",i),32768&d[0]&&o!==(o=t[64].title)&&Kn(n,"title",o),32816&d[0]&&a!==(a="emoji "+(t[4]&&t[66]===t[5]?"active":""))&&Kn(n,"class",a),32768&d[0]&&c!==(c="emo-"+t[64].id)&&Kn(n,"id",c)},d(e){e&&qn(n),u.d()}}}function tr(e,t){let n,s,r,i,o,a,c,l,h=(t[4]?t[0].searchResultsLabel:t[67].category?t[67].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"",u=[],d=new zs,m=t[67].emojis;const p=e=>e[64].id;for(let e=0;e<m.length;e+=1){let n=Gs(t,m,e),s=p(n);d.set(s,u[e]=er(s,n))}return{key:e,first:null,c(){n=Hn("div"),s=zn(h),o=Hn("div");for(let e=0;e<u.length;e+=1)u[e].c();Kn(n,"id",r="menu-label-"+t[66]),Kn(n,"class",i="category "+(1===t[15].length&&""===t[15][0].category?"gone":"")),Kn(n,"aria-hidden","true"),Kn(o,"class","emoji-menu"),Kn(o,"role",a=t[4]?"listbox":"menu"),Kn(o,"aria-labelledby",c="menu-label-"+t[66]),Kn(o,"id",l=t[4]?"search-results":""),this.first=n},m(e,t){jn(e,n,t),Un(n,s),jn(e,o,t);for(let e=0;e<u.length;e+=1)u[e]&&u[e].m(o,null)},p(e,f){t=e,40977&f[0]&&h!==(h=(t[4]?t[0].searchResultsLabel:t[67].category?t[67].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"")&&Gn(s,h),32768&f[0]&&r!==(r="menu-label-"+t[66])&&Kn(n,"id",r),32768&f[0]&&i!==(i="category "+(1===t[15].length&&""===t[15][0].category?"gone":""))&&Kn(n,"class",i),402686256&f[0]&&(m=t[67].emojis,u=ds(u,f,p,1,t,m,d,o,us,er,null,Gs)),16&f[0]&&a!==(a=t[4]?"listbox":"menu")&&Kn(o,"role",a),32768&f[0]&&c!==(c="menu-label-"+t[66])&&Kn(o,"aria-labelledby",c),16&f[0]&&l!==(l=t[4]?"search-results":"")&&Kn(o,"id",l)},d(e){e&&qn(n),e&&qn(o);for(let e=0;e<u.length;e+=1)u[e].d()}}}function nr(e){let t,n;return{c(){t=Hn("img"),Kn(t,"class","custom-emoji"),Vn(t.src,n=e[64].url)||Kn(t,"src",n),Kn(t,"alt",""),Kn(t,"loading","lazy")},m(e,n){jn(e,t,n)},p(e,s){1024&s[0]&&!Vn(t.src,n=e[64].url)&&Kn(t,"src",n)},d(e){e&&qn(t)}}}function sr(e){let t,n=e[27](e[64],e[8])+"";return{c(){t=zn(n)},m(e,n){jn(e,t,n)},p(e,s){1280&s[0]&&n!==(n=e[27](e[64],e[8])+"")&&Gn(t,n)},d(e){e&&qn(t)}}}function rr(e,t){let n,s,r,i;function o(e,t){return e[64].unicode?sr:nr}let a=o(t),c=a(t);return{key:e,first:null,c(){n=Hn("button"),c.c(),Kn(n,"role","menuitem"),Kn(n,"aria-label",s=t[28](t[64],t[8])),Kn(n,"title",r=t[64].title),Kn(n,"class","emoji"),Kn(n,"id",i="fav-"+t[64].id),this.first=n},m(e,t){jn(e,n,t),c.m(n,null)},p(e,l){a===(a=o(t=e))&&c?c.p(t,l):(c.d(1),c=a(t),c&&(c.c(),c.m(n,null))),1280&l[0]&&s!==(s=t[28](t[64],t[8]))&&Kn(n,"aria-label",s),1024&l[0]&&r!==(r=t[64].title)&&Kn(n,"title",r),1024&l[0]&&i!==(i="fav-"+t[64].id)&&Kn(n,"id",i)},d(e){e&&qn(n),c.d()}}}function ir(e){let t,n,s,r,i,o,a,c,l,h,u,d,m,p,f,g,_,v,b,y,w,k,x,E,S,T,C,I,R,A,M,N,P,B,D,O,L,V,F,U,j,q,H,z,$=e[0].searchLabel+"",K=e[0].searchDescription+"",G=e[0].skinToneDescription+"",W=[],Y=new zs,X=[],Q=new zs,Z=[],J=new zs,ee=[],te=new zs,ne=e[9];const se=e=>e[73];for(let t=0;t<ne.length;t+=1){let n=Ys(e,ne,t),s=se(n);Y.set(s,W[t]=Xs(s,n))}let re=e[12];const ie=e=>e[70].id;for(let t=0;t<re.length;t+=1){let n=Ws(e,re,t),s=ie(n);Q.set(s,X[t]=Qs(s,n))}let oe=e[15];const ae=e=>e[67].category;for(let t=0;t<oe.length;t+=1){let n=Ks(e,oe,t),s=ae(n);J.set(s,Z[t]=tr(s,n))}let ce=e[10];const le=e=>e[64].id;for(let t=0;t<ce.length;t+=1){let n=$s(e,ce,t),s=le(n);te.set(s,ee[t]=rr(s,n))}return{c(){t=Hn("section"),n=Hn("div"),s=Hn("div"),r=Hn("div"),i=Hn("input"),l=Hn("label"),h=zn($),u=Hn("span"),d=zn(K),m=Hn("div"),p=Hn("button"),f=zn(e[21]),v=Hn("span"),b=zn(G),y=Hn("div");for(let e=0;e<W.length;e+=1)W[e].c();S=Hn("div");for(let e=0;e<X.length;e+=1)X[e].c();C=Hn("div"),I=Hn("div"),R=Hn("div"),A=zn(e[18]),N=Hn("div"),P=Hn("div");for(let e=0;e<Z.length;e+=1)Z[e].c();V=Hn("div");for(let e=0;e<ee.length;e+=1)ee[e].c();j=Hn("button"),j.textContent="😀",Kn(n,"class","pad-top"),Kn(i,"id","search"),Kn(i,"class","search"),Kn(i,"type","search"),Kn(i,"role","combobox"),Kn(i,"enterkeyhint","search"),Kn(i,"placeholder",o=e[0].searchLabel),Kn(i,"autocapitalize","none"),Kn(i,"autocomplete","off"),Kn(i,"spellcheck","true"),Kn(i,"aria-expanded",a=!(!e[4]||!e[1].length)),Kn(i,"aria-controls","search-results"),Kn(i,"aria-describedby","search-description"),Kn(i,"aria-autocomplete","list"),Kn(i,"aria-activedescendant",c=e[26]?`emo-${e[26]}`:""),Kn(l,"class","sr-only"),Kn(l,"for","search"),Kn(u,"id","search-description"),Kn(u,"class","sr-only"),Kn(r,"class","search-wrapper"),Kn(p,"id","skintone-button"),Kn(p,"class",g="emoji "+(e[6]?"hide-focus":"")),Kn(p,"aria-label",e[23]),Kn(p,"title",e[23]),Kn(p,"aria-describedby","skintone-description"),Kn(p,"aria-haspopup","listbox"),Kn(p,"aria-expanded",e[6]),Kn(p,"aria-controls","skintone-list"),Kn(m,"class",_="skintone-button-wrapper "+(e[19]?"expanded":"")),Kn(v,"id","skintone-description"),Kn(v,"class","sr-only"),Kn(y,"id","skintone-list"),Kn(y,"class",w="skintone-list hide-focus "+(e[6]?"":"hidden no-animate")),Yn(y,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),Kn(y,"role","listbox"),Kn(y,"aria-label",k=e[0].skinTonesLabel),Kn(y,"aria-activedescendant",x="skintone-"+e[20]),Kn(y,"aria-hidden",E=!e[6]),Kn(y,"tabindex","-1"),Kn(s,"class","search-row"),Kn(S,"class","nav"),Kn(S,"role","tablist"),Yn(S,"grid-template-columns","repeat("+e[12].length+", 1fr)"),Kn(S,"aria-label",T=e[0].categoriesLabel),Kn(I,"class","indicator"),Yn(I,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),Kn(C,"class","indicator-wrapper"),Kn(R,"class",M="message "+(e[18]?"":"gone")),Kn(R,"role","alert"),Kn(R,"aria-live","polite"),Kn(N,"class",B="tabpanel "+(!e[14]||e[18]?"gone":"")),Kn(N,"role",D=e[4]?"region":"tabpanel"),Kn(N,"aria-label",O=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name]),Kn(N,"id",L=e[4]?"":`tab-${e[13].id}`),Kn(N,"tabindex","0"),Kn(V,"class",F="favorites emoji-menu "+(e[18]?"gone":"")),Kn(V,"role","menu"),Kn(V,"aria-label",U=e[0].favoritesLabel),Yn(V,"padding-inline-end",e[25]+"px"),Kn(j,"aria-hidden","true"),Kn(j,"tabindex","-1"),Kn(j,"class","abs-pos hidden emoji"),Kn(t,"class","picker"),Kn(t,"aria-label",q=e[0].regionLabel),Kn(t,"style",e[22])},m(o,a){jn(o,t,a),Un(t,n),Un(t,s),Un(s,r),Un(r,i),Wn(i,e[2]),Un(r,l),Un(l,h),Un(r,u),Un(u,d),Un(s,m),Un(m,p),Un(p,f),Un(s,v),Un(v,b),Un(s,y);for(let e=0;e<W.length;e+=1)W[e]&&W[e].m(y,null);e[49](y),Un(t,S);for(let e=0;e<X.length;e+=1)X[e]&&X[e].m(S,null);Un(t,C),Un(C,I),Un(t,R),Un(R,A),Un(t,N),Un(N,P);for(let e=0;e<Z.length;e+=1)Z[e]&&Z[e].m(P,null);e[51](N),Un(t,V);for(let e=0;e<ee.length;e+=1)ee[e]&&ee[e].m(V,null);var c;Un(t,j),e[52](j),e[53](t),H||(z=[$n(i,"input",e[48]),$n(i,"keydown",e[30]),$n(p,"click",e[35]),$n(y,"focusout",e[38]),$n(y,"click",e[34]),$n(y,"keydown",e[36]),$n(y,"keyup",e[37]),$n(S,"keydown",e[32]),(c=e[29].call(null,P),c&&Dn(c.destroy)?c.destroy:Mn),$n(N,"click",e[33]),$n(V,"click",e[33])],H=!0)},p(e,n){1&n[0]&&o!==(o=e[0].searchLabel)&&Kn(i,"placeholder",o),18&n[0]&&a!==(a=!(!e[4]||!e[1].length))&&Kn(i,"aria-expanded",a),67108864&n[0]&&c!==(c=e[26]?`emo-${e[26]}`:"")&&Kn(i,"aria-activedescendant",c),4&n[0]&&i.value!==e[2]&&Wn(i,e[2]),1&n[0]&&$!==($=e[0].searchLabel+"")&&Gn(h,$),1&n[0]&&K!==(K=e[0].searchDescription+"")&&Gn(d,K),2097152&n[0]&&Gn(f,e[21]),64&n[0]&&g!==(g="emoji "+(e[6]?"hide-focus":""))&&Kn(p,"class",g),8388608&n[0]&&Kn(p,"aria-label",e[23]),8388608&n[0]&&Kn(p,"title",e[23]),64&n[0]&&Kn(p,"aria-expanded",e[6]),524288&n[0]&&_!==(_="skintone-button-wrapper "+(e[19]?"expanded":""))&&Kn(m,"class",_),1&n[0]&&G!==(G=e[0].skinToneDescription+"")&&Gn(b,G),1049089&n[0]&&(ne=e[9],W=ds(W,n,se,1,e,ne,Y,y,us,Xs,null,Ys)),64&n[0]&&w!==(w="skintone-list hide-focus "+(e[6]?"":"hidden no-animate"))&&Kn(y,"class",w),64&n[0]&&Yn(y,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),1&n[0]&&k!==(k=e[0].skinTonesLabel)&&Kn(y,"aria-label",k),1048576&n[0]&&x!==(x="skintone-"+e[20])&&Kn(y,"aria-activedescendant",x),64&n[0]&&E!==(E=!e[6])&&Kn(y,"aria-hidden",E),12305&n[0]|1&n[1]&&(re=e[12],X=ds(X,n,ie,1,e,re,Q,S,us,Qs,null,Ws)),4096&n[0]&&Yn(S,"grid-template-columns","repeat("+e[12].length+", 1fr)"),1&n[0]&&T!==(T=e[0].categoriesLabel)&&Kn(S,"aria-label",T),16779264&n[0]&&Yn(I,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),262144&n[0]&&Gn(A,e[18]),262144&n[0]&&M!==(M="message "+(e[18]?"":"gone"))&&Kn(R,"class",M),402694449&n[0]&&(oe=e[15],Z=ds(Z,n,ae,1,e,oe,J,P,us,tr,null,Ks)),278528&n[0]&&B!==(B="tabpanel "+(!e[14]||e[18]?"gone":""))&&Kn(N,"class",B),16&n[0]&&D!==(D=e[4]?"region":"tabpanel")&&Kn(N,"role",D),8209&n[0]&&O!==(O=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name])&&Kn(N,"aria-label",O),8208&n[0]&&L!==(L=e[4]?"":`tab-${e[13].id}`)&&Kn(N,"id",L),402654464&n[0]&&(ce=e[10],ee=ds(ee,n,le,1,e,ce,te,V,us,rr,null,$s)),262144&n[0]&&F!==(F="favorites emoji-menu "+(e[18]?"gone":""))&&Kn(V,"class",F),1&n[0]&&U!==(U=e[0].favoritesLabel)&&Kn(V,"aria-label",U),33554432&n[0]&&Yn(V,"padding-inline-end",e[25]+"px"),1&n[0]&&q!==(q=e[0].regionLabel)&&Kn(t,"aria-label",q),4194304&n[0]&&Kn(t,"style",e[22])},i:Mn,o:Mn,d(n){n&&qn(t);for(let e=0;e<W.length;e+=1)W[e].d();e[49](null);for(let e=0;e<X.length;e+=1)X[e].d();for(let e=0;e<Z.length;e+=1)Z[e].d();e[51](null);for(let e=0;e<ee.length;e+=1)ee[e].d();e[52](null),e[53](null),H=!1,Bn(z)}}}function or(e,t,n){let s,r,i,o,a,c,l,h,u,d,{skinToneEmoji:m}=t,{i18n:p}=t,{database:f}=t,{customEmoji:g}=t,{customCategorySorting:_}=t,{emojiVersion:v}=t,b=[],y=[],w="",k="",x=!1,E=-1,S=!1,T=!1,C=0,I=0,R="",A=[],M=[],N=8,P=!1,B=0,D=0,O=vs,L=!1;const V=e=>{s.getRootNode().getElementById(e).focus()},F=(e,t)=>{s.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0}))},U=(e,t)=>t&&e.skins&&e.skins[t]||e.unicode;function j(e){const t=s.getRootNode();!function(e,t,n){for(const s of e){const e=Hs(n(s));void 0===js&&(js=Hs(t));const r=e/1.8<js;Ms.set(s.unicode,r)}}(e,r,(e=>t.getElementById(`emo-${e.id}`))),n(1,b)}function q(e){return!e.unicode||!ws(e)||Ms.get(e.unicode)}async function H(e){const t=v||await As();return e.filter((({version:e})=>!e||e<=t))}async function z(e){return function(e,t){const n=e=>{const n={};for(const s of e)"number"==typeof s.tone&&s.version<=t&&(n[s.tone]=s.unicode);return n};return e.map((({unicode:e,skins:t,shortcodes:s,url:r,name:i,category:o})=>({unicode:e,name:i,shortcodes:s,url:r,category:o,id:e||i,skins:t&&n(t),title:(s||[]).join(", ")})))}(e,v||await As())}function $(e){n(2,w=""),n(45,k=""),n(5,E=-1),n(11,D=O.findIndex((t=>t.id===e.id)))}async function K(e){const t=await f.getEmojiByUnicodeOrName(e),n=[...b,...M].find((t=>t.id===e)),s=n.unicode&&U(n,C);await f.incrementFavoriteEmojiCount(e),F("emoji-click",{emoji:t,skinTone:C,...s&&{unicode:s},...n.name&&{name:n.name}})}function G(e){n(8,C=e),n(6,S=!1),V("skintone-button"),F("skin-tone-change",{skinTone:e}),f.setPreferredSkinTone(e)}Zn((()=>{v||As().then((e=>{e||n(18,o=p.emojiUnsupportedMessage)}))}));return e.$$set=e=>{"skinToneEmoji"in e&&n(40,m=e.skinToneEmoji),"i18n"in e&&n(0,p=e.i18n),"database"in e&&n(39,f=e.database),"customEmoji"in e&&n(41,g=e.customEmoji),"customCategorySorting"in e&&n(42,_=e.customCategorySorting),"emojiVersion"in e&&n(43,v=e.emojiVersion)},e.$$.update=()=>{if(1280&e.$$.dirty[1]&&g&&f&&n(39,f.customEmoji=g,f),1&e.$$.dirty[0]|256&e.$$.dirty[1]){async function t(){let e=!1;const t=setTimeout((()=>{e=!0,n(18,o=p.loadingMessage)}),1e3);try{await f.ready(),n(14,L=!0)}catch(e){console.error(e),n(18,o=p.networkErrorMessage)}finally{clearTimeout(t),e&&(e=!1,n(18,o=""))}}f&&t()}if(6144&e.$$.dirty[0]|1024&e.$$.dirty[1]&&(g&&g.length?n(12,O=[bs,...vs]):O!==vs&&(D&&n(11,D--,D),n(12,O=vs))),4&e.$$.dirty[0]&&ys((()=>{n(45,k=(w||"").trim()),n(5,E=-1)})),6144&e.$$.dirty[0]&&n(13,u=O[D]),24576&e.$$.dirty[0]|16384&e.$$.dirty[1]){async function s(){if(L){if(k.length>=2){const e=k,t=await async function(e){return z(await H(await f.getEmojiBySearchQuery(e)))}(e);e===k&&(n(1,b=t),n(4,x=!0))}else if(u){const e=u.id,t=await async function(e){const t=-1===e?g:await f.getEmojiByGroup(e);return z(await H(t))}(e);e===u.id&&(n(1,b=t),n(4,x=!1))}}else n(1,b=[]),n(4,x=!1)}s()}if(4112&e.$$.dirty[0]&&n(22,l=`\n  --num-groups: ${O.length}; \n  --indicator-opacity: ${x?0:1}; \n  --num-skintones: 6;`),16384&e.$$.dirty[0]|256&e.$$.dirty[1]){async function r(){L&&n(8,C=await f.getPreferredSkinTone())}r()}if(512&e.$$.dirty[1]&&n(9,A=Array(6).fill().map(((e,t)=>function(e,t){if(0===t)return e;const n=e.indexOf(Bs);return-1!==n?e.substring(0,n)+String.fromCodePoint(Ds+t-1)+e.substring(n):(e.endsWith(Ns)&&(e=e.substring(0,e.length-1)),e+Ps+String.fromCodePoint(Os+t-1))}(m,t)))),768&e.$$.dirty[0]&&n(21,c=A[C]),257&e.$$.dirty[0]&&n(23,R=p.skinToneLabel.replace("{skinTone}",p.skinTones[C])),16384&e.$$.dirty[0]|256&e.$$.dirty[1]){async function I(){n(46,h=(await Promise.all(xs.map((e=>f.getEmojiByUnicodeOrName(e))))).filter(Boolean))}L&&I()}if(16384&e.$$.dirty[0]|98560&e.$$.dirty[1]){async function P(){const e=await f.getTopFavoriteEmoji(N),t=await z(Fs([...e,...h],(e=>e.unicode||e.name)).slice(0,N));n(10,M=t)}L&&h&&P()}if(10&e.$$.dirty[0]|4096&e.$$.dirty[1]){const B=b.filter((e=>e.unicode)).filter((e=>ws(e)&&!Ms.has(e.unicode)));!v&&B.length?Us((()=>j(B))):(n(1,b=v?b:b.filter(q)),Us((()=>{var e;(e=i)&&(e.scrollTop=0)})))}if(e.$$.dirty[0],e.$$.dirty[1],18&e.$$.dirty[0]|2048&e.$$.dirty[1]){function V(){if(x)return[{category:"",emojis:b}];const e=new Map;for(const t of b){const n=t.category||"";let s=e.get(n);s||(s=[],e.set(n,s)),s.push(t)}return[...e.entries()].map((([e,t])=>({category:e,emojis:t}))).sort(((e,t)=>_(e.category,t.category)))}n(15,y=V())}34&e.$$.dirty[0]&&n(26,d=-1!==E&&b[E].id),192&e.$$.dirty[0]&&(S?a.addEventListener("transitionend",(()=>{n(19,T=!0)}),{once:!0}):n(19,T=!1))},[p,b,w,i,x,E,S,a,C,A,M,D,O,u,L,y,s,r,o,T,I,c,l,R,P,B,d,U,(e,t)=>{return(n=[e.name||U(e,t),...e.shortcodes||[]],Fs(n,(e=>e))).join(", ");var n},function(e){return function(e,t){let n;return qs?(n=new ResizeObserver((e=>t(e[0].contentRect.width))),n.observe(e)):Us((()=>t(e.getBoundingClientRect().width))),{destroy(){n&&n.disconnect()}}}(e,(t=>{{const r=getComputedStyle(s),i=parseInt(r.getPropertyValue("--num-columns"),10),o="rtl"===r.getPropertyValue("direction"),a=e.parentElement.getBoundingClientRect().width-t;n(47,N=i),n(25,B=a),n(24,P=o)}}))},function(e){if(!x||!b.length)return;const t=t=>{Ls(e),n(5,E=Vs(t,E,b))};switch(e.key){case"ArrowDown":return t(!1);case"ArrowUp":return t(!0);case"Enter":if(-1!==E)return Ls(e),K(b[E].id);b.length&&n(5,E=0)}},$,function(e){const{target:t,key:n}=e,s=t=>{t&&(Ls(e),t.focus())};switch(n){case"ArrowLeft":return s(t.previousSibling);case"ArrowRight":return s(t.nextSibling);case"Home":return s(t.parentElement.firstChild);case"End":return s(t.parentElement.lastChild)}},async function(e){const{target:t}=e;if(!t.classList.contains("emoji"))return;Ls(e),K(t.id.substring(4))},function(e){const{target:{id:t}}=e,n=t&&t.match(/^skintone-(\d)/);if(!n)return;Ls(e),G(parseInt(n[1],10))},function(e){n(6,S=!S),n(20,I=C),S&&(Ls(e),Us((()=>V("skintone-list"))))},function(e){if(!S)return;const t=async t=>{Ls(e),n(20,I=t)};switch(e.key){case"ArrowUp":return t(Vs(!0,I,A));case"ArrowDown":return t(Vs(!1,I,A));case"Home":return t(0);case"End":return t(A.length-1);case"Enter":return Ls(e),G(I);case"Escape":return Ls(e),n(6,S=!1),V("skintone-button")}},function(e){if(S)return" "===e.key?(Ls(e),G(I)):void 0},async function(e){const{relatedTarget:t}=e;t&&"skintone-list"===t.id||n(6,S=!1)},f,m,g,_,v,!0,k,h,N,function(){w=this.value,n(2,w)},function(e){es[e?"unshift":"push"]((()=>{a=e,n(7,a)}))},e=>$(e),function(e){es[e?"unshift":"push"]((()=>{i=e,n(3,i)}))},function(e){es[e?"unshift":"push"]((()=>{r=e,n(17,r)}))},function(e){es[e?"unshift":"push"]((()=>{s=e,n(16,s)}))}]}class ar extends gs{constructor(e){super(),fs(this,e,or,ir,On,{skinToneEmoji:40,i18n:0,database:39,customEmoji:41,customCategorySorting:42,emojiVersion:43},null,[-1,-1,-1])}}var cr={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading…",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}};const lr=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji","emojiVersion"],hr=`:host{--emoji-font-family:${Es}}`;class ur extends HTMLElement{constructor(e){super(),this.attachShadow({mode:"open"});const t=document.createElement("style");t.textContent=":host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){color-scheme:light;--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.custom-emoji,.emoji,button.emoji{height:var(--total-emoji-size);width:var(--total-emoji-size)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;line-height:1;overflow:hidden;font-family:var(--emoji-font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.custom-emoji{padding:var(--emoji-padding);object-fit:contain;pointer-events:none;background-repeat:no-repeat;background-position:center center;background-size:var(--emoji-size) var(--emoji-size)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}"+hr,this.shadowRoot.appendChild(t),this._ctx={locale:"en",dataSource:"https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",skinToneEmoji:"🖐️",customCategorySorting:Ss,customEmoji:null,i18n:cr,emojiVersion:null,...e};for(const e of lr)"database"!==e&&Object.prototype.hasOwnProperty.call(this,e)&&(this._ctx[e]=this[e],delete this[e]);this._dbFlush()}connectedCallback(){this._cmp||(this._cmp=new ar({target:this.shadowRoot,props:this._ctx}))}disconnectedCallback(){Promise.resolve().then((()=>{if(!this.isConnected&&this._cmp){this._cmp.$destroy(),this._cmp=void 0;const{database:e}=this._ctx;e.close().catch((e=>console.error(e)))}}))}static get observedAttributes(){return["locale","data-source","skin-tone-emoji","emoji-version"]}attributeChangedCallback(e,t,n){this._set(e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase())),"emoji-version"===e?parseFloat(n):n)}_set(e,t){this._ctx[e]=t,this._cmp&&this._cmp.$set({[e]:t}),["locale","dataSource"].includes(e)&&this._dbFlush()}_dbCreate(){const{locale:e,dataSource:t,database:n}=this._ctx;n&&n.locale===e&&n.dataSource===t||this._set("database",new An({locale:e,dataSource:t}))}_dbFlush(){Promise.resolve().then((()=>this._dbCreate()))}}const dr={};for(const e of lr)dr[e]={get(){return"database"===e&&this._dbCreate(),this._ctx[e]},set(t){if("database"===e)throw new Error("database is read-only");this._set(e,t)}};Object.defineProperties(ur.prototype,dr),customElements.get("emoji-picker")||customElements.define("emoji-picker",ur);const mr={class:"vac-emoji-wrapper"};const pr={name:"EmojiPickerContainer",components:{SvgIcon:be},props:{emojiOpened:{type:Boolean,default:!1},emojiReaction:{type:Boolean,default:!1},positionTop:{type:Boolean,default:!1},positionRight:{type:Boolean,default:!1}},emits:["add-emoji","open-emoji"],data:()=>({emojiPickerHeight:320,emojiPickerTop:0,emojiPickerRight:""}),watch:{emojiOpened(e){e&&setTimeout((()=>{this.addCustomStyling(),this.$refs.emojiPicker.shadowRoot.addEventListener("emoji-click",(({detail:e})=>{this.$emit("add-emoji",{unicode:e.unicode})}))}),0)}},methods:{addCustomStyling(){const e=document.createElement("style");e.textContent=".picker {\n\t\t\t\tborder: none;\n\t\t\t}.nav {\n\t\t\t\toverflow-x: auto;\n\t\t\t}.search-wrapper {\n\t\t\t\tpadding-right: 2px;\n\t\t\t\tpadding-left: 2px;\n\t\t\t}input.search {\n\t\t\t\theight: 32px;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tborder-radius: 10rem;\n\t\t\t\tborder: var(--chat-border-style);\n\t\t\t\tpadding: 5px 10px;\n\t\t\t\toutline: none;\n\t\t\t\tbackground: var(--chat-bg-color-input);\n\t\t\t\tcolor: var(--chat-color);\n\t\t\t}",this.$refs.emojiPicker.shadowRoot.appendChild(e)},openEmoji(e){this.$emit("open-emoji",!this.emojiOpened),this.setEmojiPickerPosition(e.clientY,e.view.innerWidth,e.view.innerHeight)},setEmojiPickerPosition(e,t,n){setTimeout((()=>{const s=t<500||n<700,r=document.getElementById("room-footer");if(r)if(s)this.emojiPickerRight=t/2-150+"px",this.emojiPickerTop=100,this.emojiPickerHeight=n-200;else{const t=r.getBoundingClientRect().top-e>this.emojiPickerHeight-50;this.emojiPickerTop=t?e+10:e-this.emojiPickerHeight-10,this.emojiPickerRight=this.positionTop?"-50px":this.positionRight?"60px":""}else s&&(this.emojiPickerRight="-50px")}))}}},fr=(0,ue.Z)(pr,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("svg-icon"),c=(0,s.resolveComponent)("emoji-picker");return(0,s.openBlock)(),(0,s.createElementBlock)("div",mr,[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["vac-svg-button",{"vac-emoji-reaction":n.emojiReaction}]),onClick:t[0]||(t[0]=(...e)=>o.openEmoji&&o.openEmoji(...e))},[(0,s.renderSlot)(e.$slots,"emoji-picker-icon",{},(()=>[(0,s.createVNode)(a,{name:"emoji",param:n.emojiReaction?"reaction":""},null,8,["param"])]))],2),n.emojiOpened?((0,s.openBlock)(),(0,s.createBlock)(s.Transition,{key:0,name:"vac-slide-up",appear:""},{default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["vac-emoji-picker",{"vac-picker-reaction":n.emojiReaction}]),style:(0,s.normalizeStyle)({height:`${i.emojiPickerHeight}px`,top:n.positionTop?i.emojiPickerHeight:`${i.emojiPickerTop}px`,right:i.emojiPickerRight,display:i.emojiPickerTop||!n.emojiReaction?"initial":"none"})},[n.emojiOpened?((0,s.openBlock)(),(0,s.createBlock)(c,{key:0,ref:"emojiPicker"},null,512)):(0,s.createCommentVNode)("",!0)],6)])),_:1})):(0,s.createCommentVNode)("",!0)])}]]),gr={class:"vac-files-box"},_r={class:"vac-icon-close"};const vr={class:"vac-room-file-container"},br=["src"],yr={class:"vac-text-ellipsis"},wr={key:0,class:"vac-text-ellipsis vac-text-extension"};const{isImageFile:kr,isVideoFile:xr}=n(84539),Er={name:"RoomFiles",components:{Loader:de,SvgIcon:be},props:{file:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["remove-file"],computed:{isImage(){return kr(this.file)},isVideo(){return xr(this.file)}}},Sr={name:"RoomFiles",components:{SvgIcon:be,RoomFile:(0,ue.Z)(Er,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("loader"),c=(0,s.resolveComponent)("svg-icon");return(0,s.openBlock)(),(0,s.createElementBlock)("div",vr,[(0,s.createVNode)(a,{show:n.file.loading},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["show"]),(0,s.createElementVNode)("div",{class:"vac-svg-button vac-icon-remove",onClick:t[0]||(t[0]=t=>e.$emit("remove-file",n.index))},[(0,s.renderSlot)(e.$slots,"image-close-icon",{},(()=>[(0,s.createVNode)(c,{name:"close",param:"image"})]))]),o.isImage?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:(0,s.normalizeClass)(["vac-message-image",{"vac-blur-loading":n.file.loading}]),style:(0,s.normalizeStyle)({"background-image":`url('${n.file.localUrl||n.file.url}')`})},null,6)):o.isVideo?((0,s.openBlock)(),(0,s.createElementBlock)("video",{key:1,controls:"",class:(0,s.normalizeClass)({"vac-blur-loading":n.file.loading})},[(0,s.createElementVNode)("source",{src:n.file.localUrl||n.file.url},null,8,br)],2)):((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:2,class:(0,s.normalizeClass)(["vac-file-container",{"vac-blur-loading":n.file.loading}])},[(0,s.createElementVNode)("div",null,[(0,s.renderSlot)(e.$slots,"file-icon",{},(()=>[(0,s.createVNode)(c,{name:"file"})]))]),(0,s.createElementVNode)("div",yr,(0,s.toDisplayString)(n.file.name),1),n.file.extension?((0,s.openBlock)(),(0,s.createElementBlock)("div",wr,(0,s.toDisplayString)(n.file.extension),1)):(0,s.createCommentVNode)("",!0)],2))])}]])},props:{files:{type:Array,required:!0}},emits:["remove-file","reset-message"],computed:{footerHeight:()=>document.getElementById("room-footer").clientHeight}},Tr=(0,ue.Z)(Sr,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("room-file"),c=(0,s.resolveComponent)("svg-icon");return(0,s.openBlock)(),(0,s.createBlock)(s.Transition,{name:"vac-slide-up"},{default:(0,s.withCtx)((()=>[n.files.length?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-room-files-container",style:(0,s.normalizeStyle)({bottom:`${o.footerHeight}px`})},[(0,s.createElementVNode)("div",gr,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.files,((n,r)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:r},[(0,s.createVNode)(a,{file:n,index:r,onRemoveFile:t[0]||(t[0]=t=>e.$emit("remove-file",t))},null,8,["file","index"])])))),128))]),(0,s.createElementVNode)("div",_r,[(0,s.createElementVNode)("div",{class:"vac-svg-button",onClick:t[1]||(t[1]=t=>e.$emit("reset-message"))},[(0,s.renderSlot)(e.$slots,"reply-close-icon",{},(()=>[(0,s.createVNode)(c,{name:"close-outline"})]))])])],4)):(0,s.createCommentVNode)("",!0)])),_:3})}]]),Cr={class:"vac-reply-box"},Ir={class:"vac-reply-info"},Rr={class:"vac-reply-username"},Ar={class:"vac-reply-content"},Mr=["src"],Nr={key:1,controls:"",class:"vac-image-reply"},Pr=["src"],Br={key:3,class:"vac-image-reply vac-file-container"},Dr={class:"vac-text-ellipsis"},Or={key:0,class:"vac-text-ellipsis vac-text-extension"},Lr={class:"vac-icon-reply"};const Vr={class:"vac-audio-player"},Fr=["id","src"];const Ur={class:"vac-player-progress"},jr={class:"vac-line-container"};const qr={props:{percentage:{type:Number,default:0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","change-linehead"],data:()=>({isMouseDown:!1}),methods:{onMouseDown(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!0;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},onMouseUp(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!1,document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove);const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},onMouseMove(e){if(this.messageSelectionEnabled)return;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},calculateLineHeadPosition(e,t){const n=t.getBoundingClientRect().width,s=t.getBoundingClientRect().left;let r=(e.clientX-s)/n;return r=r<0?0:r,r=r>1?1:r,r}}},Hr={name:"AudioPlayer",components:{SvgIcon:be,AudioControl:(0,ue.Z)(qr,[["render",function(e,t,n,r,i,o){return(0,s.openBlock)(),(0,s.createElementBlock)("div",{ref:"progress",class:"vac-player-bar",onMousedown:t[0]||(t[0]=(...e)=>o.onMouseDown&&o.onMouseDown(...e)),onMouseover:t[1]||(t[1]=t=>e.$emit("hover-audio-progress",!0)),onMouseout:t[2]||(t[2]=t=>e.$emit("hover-audio-progress",!1))},[(0,s.createElementVNode)("div",Ur,[(0,s.createElementVNode)("div",jr,[(0,s.createElementVNode)("div",{class:"vac-line-progress",style:(0,s.normalizeStyle)({width:`${n.percentage}%`})},null,4),(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["vac-line-dot",{"vac-line-dot__active":i.isMouseDown}]),style:(0,s.normalizeStyle)({left:`${n.percentage}%`})},null,6)])])],544)}]])},props:{messageId:{type:[String,Number],default:null},src:{type:String,default:null},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","update-progress-time"],data(){return{isPlaying:!1,duration:this.convertTimeMMSS(0),playedTime:this.convertTimeMMSS(0),progress:0}},computed:{playerUniqId(){return`audio-player${this.messageId}`},audioSource(){return this.src?this.src:(this.resetProgress(),null)}},mounted(){this.player=document.getElementById(this.playerUniqId),this.player.addEventListener("ended",(()=>{this.isPlaying=!1})),this.player.addEventListener("loadeddata",(()=>{this.resetProgress(),this.duration=this.convertTimeMMSS(this.player.duration),this.updateProgressTime()})),this.player.addEventListener("timeupdate",this.onTimeUpdate)},methods:{convertTimeMMSS:e=>new Date(1e3*e).toISOString().substr(14,5),playback(){!this.messageSelectionEnabled&&this.audioSource&&(this.isPlaying?this.player.pause():setTimeout((()=>this.player.play())),this.isPlaying=!this.isPlaying)},resetProgress(){this.isPlaying&&this.player.pause(),this.duration=this.convertTimeMMSS(0),this.playedTime=this.convertTimeMMSS(0),this.progress=0,this.isPlaying=!1,this.updateProgressTime()},onTimeUpdate(){this.playedTime=this.convertTimeMMSS(this.player.currentTime),this.progress=this.player.currentTime/this.player.duration*100,this.updateProgressTime()},onUpdateProgress(e){e&&(this.player.currentTime=e*this.player.duration)},updateProgressTime(){this.$emit("update-progress-time",this.progress>1?this.playedTime:this.duration)}}},zr=(0,ue.Z)(Hr,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("svg-icon"),c=(0,s.resolveComponent)("audio-control");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",Vr,[(0,s.createElementVNode)("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=(...e)=>o.playback&&o.playback(...e))},[i.isPlaying?(0,s.renderSlot)(e.$slots,"audio-pause-icon",{key:0},(()=>[(0,s.createVNode)(a,{name:"audio-pause"})])):(0,s.renderSlot)(e.$slots,"audio-play-icon",{key:1},(()=>[(0,s.createVNode)(a,{name:"audio-play"})]))]),(0,s.createVNode)(c,{percentage:i.progress,"message-selection-enabled":n.messageSelectionEnabled,onChangeLinehead:o.onUpdateProgress,onHoverAudioProgress:t[1]||(t[1]=t=>e.$emit("hover-audio-progress",t))},null,8,["percentage","message-selection-enabled","onChangeLinehead"]),(0,s.createElementVNode)("audio",{id:o.playerUniqId,src:o.audioSource},null,8,Fr)])])}]]),{isAudioFile:$r,isImageFile:Kr,isVideoFile:Gr}=n(84539),Wr={name:"RoomMessageReply",components:{SvgIcon:be,FormatMessage:We,AudioPlayer:zr},props:{room:{type:Object,required:!0},messageReply:{type:Object,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["reset-message"],computed:{footerHeight:()=>document.getElementById("room-footer").clientHeight,firstFile(){return this.messageReply.files?.length?this.messageReply.files[0]:{}},isImage(){return Kr(this.firstFile)},isVideo(){return Gr(this.firstFile)},isAudio(){return $r(this.firstFile)},isOtherFile(){return this.messageReply.files?.length&&!this.isAudio&&!this.isVideo&&!this.isImage}}},Yr=(0,ue.Z)(Wr,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("format-message"),c=(0,s.resolveComponent)("audio-player"),l=(0,s.resolveComponent)("svg-icon");return(0,s.openBlock)(),(0,s.createBlock)(s.Transition,{name:"vac-slide-up"},{default:(0,s.withCtx)((()=>[n.messageReply?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-reply-container",style:(0,s.normalizeStyle)({bottom:`${o.footerHeight}px`})},[(0,s.createElementVNode)("div",Cr,[(0,s.createElementVNode)("div",Ir,[(0,s.createElementVNode)("div",Rr,(0,s.toDisplayString)(n.messageReply.username),1),(0,s.createElementVNode)("div",Ar,[(0,s.createVNode)(a,{content:n.messageReply.content,users:n.room.users,"text-formatting":n.textFormatting,"link-options":n.linkOptions,reply:!0},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["content","users","text-formatting","link-options"])])]),o.isImage?((0,s.openBlock)(),(0,s.createElementBlock)("img",{key:0,src:o.firstFile.url,class:"vac-image-reply"},null,8,Mr)):o.isVideo?((0,s.openBlock)(),(0,s.createElementBlock)("video",Nr,[(0,s.createElementVNode)("source",{src:o.firstFile.url},null,8,Pr)])):o.isAudio?((0,s.openBlock)(),(0,s.createBlock)(c,{key:2,src:o.firstFile.url,class:"vac-audio-reply"},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["src"])):o.isOtherFile?((0,s.openBlock)(),(0,s.createElementBlock)("div",Br,[(0,s.createElementVNode)("div",null,[(0,s.renderSlot)(e.$slots,"file-icon",{},(()=>[(0,s.createVNode)(l,{name:"file"})]))]),(0,s.createElementVNode)("div",Dr,(0,s.toDisplayString)(o.firstFile.name),1),o.firstFile.extension?((0,s.openBlock)(),(0,s.createElementBlock)("div",Or,(0,s.toDisplayString)(o.firstFile.extension),1)):(0,s.createCommentVNode)("",!0)])):(0,s.createCommentVNode)("",!0)]),(0,s.createElementVNode)("div",Lr,[(0,s.createElementVNode)("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=t=>e.$emit("reset-message"))},[(0,s.renderSlot)(e.$slots,"reply-close-icon",{},(()=>[(0,s.createVNode)(l,{name:"close-outline"})]))])])],4)):(0,s.createCommentVNode)("",!0)])),_:3})}]]),Xr=["onMouseover","onClick"],Qr={class:"vac-tags-info"},Zr={class:"vac-tags-username"};const Jr={name:"RoomUsersTag",props:{filteredUsersTag:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-user-tag","activate-item"],data:()=>({activeItem:null}),computed:{footerHeight:()=>document.getElementById("room-footer").clientHeight},watch:{filteredUsersTag(e,t){t.length&&e.length===t.length||(this.activeItem=0)},selectItem(e){e&&this.$emit("select-user-tag",this.filteredUsersTag[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredUsersTag.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},ei=(0,ue.Z)(Jr,[["render",function(e,t,n,r,i,o){return(0,s.openBlock)(),(0,s.createBlock)(s.Transition,{name:"vac-slide-up"},{default:(0,s.withCtx)((()=>[n.filteredUsersTag.length?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-tags-container",style:(0,s.normalizeStyle)({bottom:`${o.footerHeight}px`})},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.filteredUsersTag,((t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t._id,class:(0,s.normalizeClass)(["vac-tags-box",{"vac-tags-box-active":n===i.activeItem}]),onMouseover:e=>i.activeItem=n,onClick:n=>e.$emit("select-user-tag",t)},[(0,s.createElementVNode)("div",Qr,[t.avatar?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-avatar vac-tags-avatar",style:(0,s.normalizeStyle)({"background-image":`url('${t.avatar}')`})},null,4)):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",Zr,(0,s.toDisplayString)(t.username),1)])],42,Xr)))),128))],4)):(0,s.createCommentVNode)("",!0)])),_:1})}]]),ti=["onMouseover","onClick"];const ni={name:"RoomEmojis",props:{filteredEmojis:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-emoji","activate-item"],data:()=>({activeItem:null}),computed:{footerHeight:()=>document.getElementById("room-footer").clientHeight},watch:{filteredEmojis(e,t){t.length&&e.length===t.length||(this.activeItem=0)},selectItem(e){e&&this.$emit("select-emoji",this.filteredEmojis[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredEmojis.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},si=(0,ue.Z)(ni,[["render",function(e,t,n,r,i,o){return(0,s.openBlock)(),(0,s.createBlock)(s.Transition,{name:"vac-slide-up"},{default:(0,s.withCtx)((()=>[n.filteredEmojis.length?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-emojis-container",style:(0,s.normalizeStyle)({bottom:`${o.footerHeight}px`})},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.filteredEmojis,((t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t,class:(0,s.normalizeClass)(["vac-emoji-element",{"vac-emoji-element-active":n===i.activeItem}]),onMouseover:e=>i.activeItem=n,onClick:n=>e.$emit("select-emoji",t)},(0,s.toDisplayString)(t),43,ti)))),128))],4)):(0,s.createCommentVNode)("",!0)])),_:1})}]]),ri=["onMouseover","onClick"],ii={class:"vac-template-info"},oi={class:"vac-template-tag"},ai={class:"vac-template-text"};const ci={name:"RoomTemplatesText",props:{filteredTemplatesText:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-template-text","activate-item"],data:()=>({activeItem:null}),computed:{footerHeight:()=>document.getElementById("room-footer").clientHeight},watch:{filteredTemplatesText(e,t){t.length&&e.length===t.length||(this.activeItem=0)},selectItem(e){e&&this.$emit("select-template-text",this.filteredTemplatesText[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredTemplatesText.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},li=(0,ue.Z)(ci,[["render",function(e,t,n,r,i,o){return(0,s.openBlock)(),(0,s.createBlock)(s.Transition,{name:"vac-slide-up"},{default:(0,s.withCtx)((()=>[n.filteredTemplatesText.length?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-template-container vac-app-box-shadow",style:(0,s.normalizeStyle)({bottom:`${o.footerHeight}px`})},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.filteredTemplatesText,((t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:n,class:(0,s.normalizeClass)(["vac-template-box",{"vac-template-active":n===i.activeItem}]),onMouseover:e=>i.activeItem=n,onClick:n=>e.$emit("select-template-text",t)},[(0,s.createElementVNode)("div",ii,[(0,s.createElementVNode)("div",oi," /"+(0,s.toDisplayString)(t.tag),1),(0,s.createElementVNode)("div",ai,(0,s.toDisplayString)(t.text),1)])],42,ri)))),128))],4)):(0,s.createCommentVNode)("",!0)])),_:1})}]]);let hi;try{hi=n(75644)}catch(e){hi={missing:!0}}const{Mp3Encoder:ui}=hi,di=class{constructor(e){if(hi.missing)throw new Error('You must add lamejs in your dependencies to use the audio recorder. Please run "npm install lamejs --save"');this.bitRate=e.bitRate,this.sampleRate=e.sampleRate,this.dataBuffer=[],this.encoder=new ui(1,this.sampleRate,this.bitRate)}encode(e){const t=1152,n=this._convertBuffer(e);let s=n.length;for(let e=0;s>=0;e+=t){const r=n.subarray(e,e+t),i=this.encoder.encodeBuffer(r);this.dataBuffer.push(new Int8Array(i)),s-=t}}finish(){this.dataBuffer.push(this.encoder.flush());const e=new Blob(this.dataBuffer,{type:"audio/mp3"});return this.dataBuffer=[],{id:Date.now(),blob:e,url:URL.createObjectURL(e)}}_floatTo16BitPCM(e,t){for(let n=0;n<e.length;n++){const s=Math.max(-1,Math.min(1,e[n]));t[n]=s<0?32768*s:32767*s}}_convertBuffer(e){const t=new Float32Array(e),n=new Int16Array(e.length);return this._floatTo16BitPCM(t,n),n}},mi=class{constructor(e={}){this.beforeRecording=e.beforeRecording,this.pauseRecording=e.pauseRecording,this.afterRecording=e.afterRecording,this.micFailed=e.micFailed,this.encoderOptions={bitRate:e.bitRate,sampleRate:e.sampleRate},this.bufferSize=4096,this.records=[],this.isPause=!1,this.isRecording=!1,this.duration=0,this.volume=0,this._duration=0}start(){this.beforeRecording&&this.beforeRecording("start recording"),navigator.mediaDevices.getUserMedia({video:!1,audio:{channelCount:1,echoCancellation:!1}}).then(this._micCaptured.bind(this)).catch(this._micError.bind(this)),this.isPause=!1,this.isRecording=!0,this.lameEncoder||(this.lameEncoder=new di(this.encoderOptions))}stop(){this.stream.getTracks().forEach((e=>e.stop())),this.input.disconnect(),this.processor.disconnect(),this.context.close();let e=null;e=this.lameEncoder.finish(),e.duration=this.duration,this.records.push(e),this._duration=0,this.duration=0,this.isPause=!1,this.isRecording=!1,this.afterRecording&&this.afterRecording(e)}pause(){this.stream.getTracks().forEach((e=>e.stop())),this.input.disconnect(),this.processor.disconnect(),this._duration=this.duration,this.isPause=!0,this.pauseRecording&&this.pauseRecording("pause recording")}_micCaptured(e){this.context=new(window.AudioContext||window.webkitAudioContext),this.duration=this._duration,this.input=this.context.createMediaStreamSource(e),this.processor=this.context.createScriptProcessor(this.bufferSize,1,1),this.stream=e,this.processor.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0);let n=0;this.lameEncoder&&this.lameEncoder.encode(t);for(let e=0;e<t.length;++e)n+=t[e]*t[e];this.duration=parseFloat(this._duration)+parseFloat(this.context.currentTime.toFixed(2)),this.volume=Math.sqrt(n/t.length).toFixed(2)},this.input.connect(this.processor),this.processor.connect(this.context.destination)}_micError(e){this.micFailed&&this.micFailed(e)}},{detectMobile:pi}=n(36032),fi={name:"RoomFooter",components:{SvgIcon:be,EmojiPickerContainer:fr,RoomFiles:Tr,RoomMessageReply:Yr,RoomUsersTag:ei,RoomEmojis:si,RoomTemplatesText:li},directives:{clickOutside:Oe().directive},props:{room:{type:Object,required:!0},roomId:{type:[String,Number],required:!0},roomMessage:{type:String,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},showEmojis:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textareaActionEnabled:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},templatesText:{type:Array,default:null},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},initReplyMessage:{type:Object,default:null},initEditMessage:{type:Object,default:null}},emits:["edit-message","send-message","update-edited-message-id","textarea-action-handler","typing-message"],data(){return{message:"",editedMessage:{},messageReply:null,cursorRangePosition:null,files:[],fileDialog:!1,selectUsersTagItem:null,selectEmojiItem:null,selectTemplatesTextItem:null,format:"mp3",activeUpOrDownEmojis:null,activeUpOrDownUsersTag:null,activeUpOrDownTemplatesText:null,emojisDB:new An,emojiOpened:!1,keepKeyboardOpen:!1,filteredEmojis:[],filteredUsersTag:[],selectedUsersTag:[],filteredTemplatesText:[],recorder:this.initRecorder(),isRecording:!1}},computed:{isMessageEmpty(){return!this.files.length&&!this.message.trim()},isFileLoading(){return this.files.some((e=>e.loading))},recordedTime(){return new Date(1e3*this.recorder.duration).toISOString().substr(14,5)},shadowFooter(){return!!(this.filteredEmojis.length||this.filteredUsersTag.length||this.filteredTemplatesText.length||this.files.length||this.messageReply)}},watch:{roomId(){this.resetMessage(!0,!0),this.roomMessage&&(this.message=this.roomMessage,setTimeout((()=>this.onChangeInput())))},message(e){this.getTextareaRef().value=e},roomMessage:{immediate:!0,handler(e){e&&(this.message=this.roomMessage)}},editedMessage(e){this.$emit("update-edited-message-id",e._id)},initReplyMessage(e){this.replyMessage(e)},initEditMessage(e){this.editMessage(e)}},mounted(){const e=pi();this.getTextareaRef().addEventListener("keyup",(t=>{"Enter"!==t.key||t.shiftKey||this.fileDialog||(e?(this.message=this.message+"\n",setTimeout((()=>this.onChangeInput()))):this.filteredEmojis.length||this.filteredUsersTag.length||this.filteredTemplatesText.length||this.sendMessage()),setTimeout((()=>{this.updateFooterLists()}),60)})),this.getTextareaRef().addEventListener("click",(()=>{e&&(this.keepKeyboardOpen=!0),this.updateFooterLists()})),this.getTextareaRef().addEventListener("blur",(()=>{this.resetFooterList(),e&&setTimeout((()=>this.keepKeyboardOpen=!1))}))},beforeDestroy(){this.stopRecorder()},methods:{getTextareaRef(){return this.$refs.roomTextarea},focusTextarea(e){pi()&&e||this.getTextareaRef()&&(this.getTextareaRef().focus(),this.cursorRangePosition&&setTimeout((()=>{this.getTextareaRef().setSelectionRange(this.cursorRangePosition,this.cursorRangePosition),this.cursorRangePosition=null})))},onChangeInput(){(this.getTextareaRef()?.value||""===this.getTextareaRef()?.value)&&(this.message=this.getTextareaRef()?.value),this.keepKeyboardOpen=!0,this.resizeTextarea(),this.$emit("typing-message",this.message)},resizeTextarea(){const e=this.getTextareaRef();if(!e)return;const t=window.getComputedStyle(e,null).getPropertyValue("padding-top").replace("px","");e.style.height=0,e.style.height=e.scrollHeight-2*t+"px"},escapeTextarea(){this.filteredEmojis.length?this.filteredEmojis=[]:this.filteredUsersTag.length?this.filteredUsersTag=[]:this.filteredTemplatesText.length?this.filteredTemplatesText=[]:this.resetMessage()},onPasteImage(e){const t=e.clipboardData?.items;t&&Array.from(t).forEach((e=>{if(e.type.includes("image")){const t=e.getAsFile();this.onFileChange([t])}}))},updateActiveUpOrDown(e){this.filteredEmojis.length?this.activeUpOrDownEmojis=e:this.filteredUsersTag.length?this.activeUpOrDownUsersTag=e:this.filteredTemplatesText.length&&(this.activeUpOrDownTemplatesText=e)},selectItem(){this.filteredEmojis.length?this.selectEmojiItem=!0:this.filteredUsersTag.length?this.selectUsersTagItem=!0:this.filteredTemplatesText.length&&(this.selectTemplatesTextItem=!0)},selectEmoji(e){if(this.selectEmojiItem=!1,!e)return;const{position:t,endPosition:n}=this.getCharPosition(":");this.message=this.message.substr(0,t-1)+e+this.message.substr(n,this.message.length-1),this.cursorRangePosition=t,this.focusTextarea()},selectTemplateText(e){if(this.selectTemplatesTextItem=!1,!e)return;const{position:t,endPosition:n}=this.getCharPosition("/"),s=this.message.substr(n,n).length?"":" ";this.message=this.message.substr(0,t-1)+e.text+s+this.message.substr(n,this.message.length-1),this.cursorRangePosition=t+e.text.length+s.length+1,this.focusTextarea()},addEmoji(e){this.message+=e.unicode,this.focusTextarea(!0)},launchFilePicker(){this.$refs.file.value="",this.$refs.file.click()},async onFileChange(e){this.fileDialog=!0,this.focusTextarea(),Array.from(e).forEach((async e=>{const t=URL.createObjectURL(e),n=e.name.lastIndexOf(".");console.log("file",e),this.files.push({loading:!0,name:e.name.substring(0,n),size:e.size,type:e.type,extension:e.name.substring(n+1),localUrl:t});const s=await fetch(t).then((e=>e.blob()));let r=this.files.find((e=>e.localUrl===t));r&&(r.blob=s,r.loading=!1,delete r.loading)})),setTimeout((()=>this.fileDialog=!1),500)},removeFile(e){this.files.splice(e,1),this.focusTextarea()},toggleRecorder(e){if(this.isRecording=e,this.recorder.isRecording)try{this.recorder.stop();const e=this.recorder.records[0];this.files.push({blob:e.blob,name:`audio.${this.format}`,size:e.blob.size,duration:e.duration,type:e.blob.type,audio:!0,localUrl:URL.createObjectURL(e.blob)}),this.recorder=this.initRecorder(),this.sendMessage()}catch{setTimeout((()=>this.stopRecorder()),100)}else setTimeout((()=>this.recorder.start()),200)},stopRecorder(){if(this.recorder.isRecording)try{this.recorder.stop(),this.recorder=this.initRecorder()}catch{setTimeout((()=>this.stopRecorder()),100)}},textareaActionHandler(){this.$emit("textarea-action-handler",this.message)},sendMessage(){let e=this.message.trim();if(!this.files.length&&!e)return;if(this.isFileLoading)return;this.selectedUsersTag.forEach((t=>{e=e.replace(`@${t.username}`,`<usertag>${t._id}</usertag>`)}));const t=this.files.length?this.files:null;this.editedMessage._id?(this.editedMessage.content!==e||this.editedMessage.files?.length||this.files.length)&&this.$emit("edit-message",{messageId:this.editedMessage._id,newContent:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}):this.$emit("send-message",{content:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}),this.resetMessage(!0)},editMessage(e){this.resetMessage(),this.editedMessage={...e};let t=e.content;const n=t,s="<usertag>",r="</usertag>";[...t.matchAll(new RegExp(s,"gi"))].map((e=>e.index)).forEach((e=>{const i=n.substring(e+9,n.indexOf(r,e)),o=this.room.users.find((e=>e._id===i));t=t.replace(`${s}${i}${r}`,`@${o?.username||"unknown"}`),this.selectUserTag(o,!0)})),this.message=t,e.files&&(this.files=[...e.files]),setTimeout((()=>this.resizeTextarea()))},replyMessage(e){this.editedMessage={},this.messageReply=e,this.focusTextarea()},updateFooterLists(){this.updateFooterList("@"),this.updateFooterList(":"),this.updateFooterList("/")},updateFooterList(e){if(!this.getTextareaRef())return;if(":"===e&&!this.emojisSuggestionEnabled)return;if(!("@"!==e||this.userTagsEnabled&&this.room.users))return;if("/"===e&&!this.templatesText)return;const t=this.getTextareaRef().selectionStart;let n=t;for(;n>0&&this.message.charAt(n-1)!==e&&(" "!==this.message.charAt(n-1)||":"!==e);)n--;const s=this.message.charAt(n-2),r=!s.match(/^[0-9a-zA-Z]+$/);if(this.message.charAt(n-1)!==e||s&&" "!==s&&!r)this.resetFooterList(e);else{const s=this.message.substring(n,t);":"===e?this.updateEmojis(s):"@"===e?this.updateShowUsersTag(s):"/"===e&&this.updateShowTemplatesText(s)}},updateShowUsersTag(e){this.filteredUsersTag=Ze(this.room.users,"username",e,!0).filter((e=>e._id!==this.currentUserId))},selectUserTag(e,t=!1){if(this.selectUsersTagItem=!1,!e)return;const{position:n,endPosition:s}=this.getCharPosition("@"),r=this.message.substr(s,s).length?"":" ";this.message=this.message.substr(0,n)+e.username+r+this.message.substr(s,this.message.length-1),this.selectedUsersTag=[...this.selectedUsersTag,{...e}],t||(this.cursorRangePosition=n+e.username.length+r.length+1),this.focusTextarea()},updateShowTemplatesText(e){this.filteredTemplatesText=Ze(this.templatesText,"tag",e,!0)},getCharPosition(e){let t=this.getTextareaRef().selectionStart;for(;t>0&&this.message.charAt(t-1)!==e;)t--;return{position:t,endPosition:this.getTextareaRef().selectionEnd}},async updateEmojis(e){if(!e)return;const t=await this.emojisDB.getEmojiBySearchQuery(e);this.filteredEmojis=t.map((e=>e.unicode))},resetFooterList(e=null){":"===e?this.filteredEmojis=[]:"@"===e?this.filteredUsersTag=[]:("/"===e||(this.filteredEmojis=[],this.filteredUsersTag=[]),this.filteredTemplatesText=[])},resetMessage(e=!1,t=!1){t||this.$emit("typing-message",null),this.selectedUsersTag=[],this.resetFooterList(),this.resetTextareaSize(),this.message="",this.editedMessage={},this.messageReply=null,this.files=[],this.emojiOpened=!1,this.preventKeyboardFromClosing(),setTimeout((()=>this.focusTextarea(e)))},resetTextareaSize(){this.getTextareaRef()&&(this.getTextareaRef().style.height="20px")},preventKeyboardFromClosing(){this.keepKeyboardOpen&&this.getTextareaRef().focus()},initRecorder(){return this.isRecording=!1,new mi({bitRate:this.audioBitRate,sampleRate:this.audioSampleRate,beforeRecording:null,afterRecording:null,pauseRecording:null,micFailed:this.micFailed})},micFailed(){this.isRecording=!1,this.recorder=this.initRecorder()}}},gi=(0,ue.Z)(fi,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("room-emojis"),c=(0,s.resolveComponent)("room-users-tag"),l=(0,s.resolveComponent)("room-templates-text"),h=(0,s.resolveComponent)("room-message-reply"),u=(0,s.resolveComponent)("room-files"),d=(0,s.resolveComponent)("svg-icon"),m=(0,s.resolveComponent)("emoji-picker-container"),p=(0,s.resolveDirective)("click-outside");return(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{id:"room-footer",class:(0,s.normalizeClass)(["vac-room-footer",{"vac-app-box-shadow":o.shadowFooter}])},[(0,s.createVNode)(a,{"filtered-emojis":i.filteredEmojis,"select-item":i.selectEmojiItem,"active-up-or-down":i.activeUpOrDownEmojis,onSelectEmoji:t[0]||(t[0]=e=>o.selectEmoji(e)),onActivateItem:t[1]||(t[1]=e=>i.activeUpOrDownEmojis=0)},null,8,["filtered-emojis","select-item","active-up-or-down"]),(0,s.createVNode)(c,{"filtered-users-tag":i.filteredUsersTag,"select-item":i.selectUsersTagItem,"active-up-or-down":i.activeUpOrDownUsersTag,onSelectUserTag:t[2]||(t[2]=e=>o.selectUserTag(e)),onActivateItem:t[3]||(t[3]=e=>i.activeUpOrDownUsersTag=0)},null,8,["filtered-users-tag","select-item","active-up-or-down"]),(0,s.createVNode)(l,{"filtered-templates-text":i.filteredTemplatesText,"select-item":i.selectTemplatesTextItem,"active-up-or-down":i.activeUpOrDownTemplatesText,onSelectTemplateText:t[4]||(t[4]=e=>o.selectTemplateText(e)),onActivateItem:t[5]||(t[5]=e=>i.activeUpOrDownTemplatesText=0)},null,8,["filtered-templates-text","select-item","active-up-or-down"]),(0,s.createVNode)(h,{room:n.room,"message-reply":i.messageReply,"text-formatting":n.textFormatting,"link-options":n.linkOptions,onResetMessage:o.resetMessage},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["room","message-reply","text-formatting","link-options","onResetMessage"]),(0,s.createVNode)(u,{files:i.files,onRemoveFile:o.removeFile,onResetMessage:o.resetMessage},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["files","onRemoveFile","onResetMessage"]),(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["vac-box-footer",{"vac-box-footer-border":!i.files.length}])},[n.showAudio&&!i.files.length?((0,s.openBlock)(),(0,s.createElementBlock)("div",Et,[i.isRecording?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:0},[(0,s.createElementVNode)("div",{class:"vac-svg-button vac-icon-audio-stop",onClick:t[6]||(t[6]=(...e)=>o.stopRecorder&&o.stopRecorder(...e))},[(0,s.renderSlot)(e.$slots,"audio-stop-icon",{},(()=>[(0,s.createVNode)(d,{name:"close-outline"})]))]),St,(0,s.createElementVNode)("div",Tt,(0,s.toDisplayString)(o.recordedTime),1),(0,s.createElementVNode)("div",{class:"vac-svg-button vac-icon-audio-confirm",onClick:t[7]||(t[7]=e=>o.toggleRecorder(!1))},[(0,s.renderSlot)(e.$slots,"audio-stop-icon",{},(()=>[(0,s.createVNode)(d,{name:"checkmark"})]))])],64)):((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:1,class:"vac-svg-button",onClick:t[8]||(t[8]=e=>o.toggleRecorder(!0))},[(0,s.renderSlot)(e.$slots,"microphone-icon",{},(()=>[(0,s.createVNode)(d,{name:"microphone",class:"vac-icon-microphone"})]))]))])):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("textarea",{id:"roomTextarea",ref:"roomTextarea",placeholder:n.textMessages.TYPE_MESSAGE,class:(0,s.normalizeClass)(["vac-textarea",{"vac-textarea-outline":i.editedMessage._id}]),style:{"min-height":"20px","padding-left":"12px"},onInput:t[9]||(t[9]=(...e)=>o.onChangeInput&&o.onChangeInput(...e)),onKeydown:[t[10]||(t[10]=(0,s.withKeys)(((...e)=>o.escapeTextarea&&o.escapeTextarea(...e)),["esc"])),t[11]||(t[11]=(0,s.withKeys)((0,s.withModifiers)(((...e)=>o.selectItem&&o.selectItem(...e)),["exact","prevent"]),["enter"])),t[13]||(t[13]=(0,s.withKeys)((0,s.withModifiers)((()=>{}),["exact","prevent"]),["tab"])),t[14]||(t[14]=(0,s.withKeys)(((...e)=>o.selectItem&&o.selectItem(...e)),["tab"])),t[15]||(t[15]=(0,s.withKeys)((0,s.withModifiers)((()=>{}),["exact","prevent"]),["up"])),t[16]||(t[16]=(0,s.withKeys)((e=>o.updateActiveUpOrDown(-1)),["up"])),t[17]||(t[17]=(0,s.withKeys)((0,s.withModifiers)((()=>{}),["exact","prevent"]),["down"])),t[18]||(t[18]=(0,s.withKeys)((e=>o.updateActiveUpOrDown(1)),["down"]))],onPaste:t[12]||(t[12]=(...e)=>o.onPasteImage&&o.onPasteImage(...e))},null,42,Ct),(0,s.createElementVNode)("div",It,[i.editedMessage._id?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-svg-button",onClick:t[19]||(t[19]=(...e)=>o.resetMessage&&o.resetMessage(...e))},[(0,s.renderSlot)(e.$slots,"edit-close-icon",{},(()=>[(0,s.createVNode)(d,{name:"close-outline"})]))])):(0,s.createCommentVNode)("",!0),n.showEmojis?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(m,{key:1,"emoji-opened":i.emojiOpened,"position-top":!0,onAddEmoji:o.addEmoji,onOpenEmoji:t[20]||(t[20]=e=>i.emojiOpened=e)},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["emoji-opened","onAddEmoji"])),[[p,()=>i.emojiOpened=!1]]):(0,s.createCommentVNode)("",!0),n.showFiles?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:2,class:"vac-svg-button",onClick:t[21]||(t[21]=(...e)=>o.launchFilePicker&&o.launchFilePicker(...e))},[(0,s.renderSlot)(e.$slots,"paperclip-icon",{},(()=>[(0,s.createVNode)(d,{name:"paperclip"})]))])):(0,s.createCommentVNode)("",!0),n.textareaActionEnabled?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:3,class:"vac-svg-button",onClick:t[22]||(t[22]=(...e)=>o.textareaActionHandler&&o.textareaActionHandler(...e))},[(0,s.renderSlot)(e.$slots,"custom-action-icon",{},(()=>[(0,s.createVNode)(d,{name:"deleted"})]))])):(0,s.createCommentVNode)("",!0),n.showFiles?((0,s.openBlock)(),(0,s.createElementBlock)("input",{key:4,ref:"file",type:"file",multiple:"",accept:n.acceptedFiles,style:{display:"none"},onChange:t[23]||(t[23]=e=>o.onFileChange(e.target.files))},null,40,Rt)):(0,s.createCommentVNode)("",!0),n.showSendIcon?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:5,class:(0,s.normalizeClass)(["vac-svg-button",{"vac-send-disabled":o.isMessageEmpty}]),onClick:t[24]||(t[24]=(...e)=>o.sendMessage&&o.sendMessage(...e))},[(0,s.renderSlot)(e.$slots,"send-icon",{},(()=>[(0,s.createVNode)(d,{name:"send",param:o.isMessageEmpty||o.isFileLoading?"disabled":""},null,8,["param"])]))],2)):(0,s.createCommentVNode)("",!0)])],2)],2)),[[s.vShow,Object.keys(n.room).length&&n.showFooter]])}]]),_i=["id"],vi={key:0,class:"vac-card-info vac-card-date"},bi={key:1,class:"vac-line-new"},yi={key:2,class:"vac-card-info vac-card-system"},wi={key:1,class:"vac-avatar-offset"},ki={key:2},xi={key:0,class:"vac-progress-time"},Ei={class:"vac-text-timestamp"},Si={key:0,class:"vac-icon-edited"},Ti={key:1},Ci=[(0,s.createElementVNode)("div",{class:"vac-failure-text"}," ! ",-1)],Ii={key:3,class:"vac-avatar-current-offset"};const Ri={class:"vac-reply-message"},Ai={class:"vac-reply-username"},Mi={key:0,class:"vac-image-reply-container"},Ni={key:1,class:"vac-video-reply-container"},Pi={width:"100%",height:"100%",controls:""},Bi=["src"],Di={key:3,class:"vac-file-container"},Oi={class:"vac-text-ellipsis"},Li={key:0,class:"vac-text-ellipsis vac-text-extension"},Vi={class:"vac-reply-content"};const{isAudioFile:Fi,isImageFile:Ui,isVideoFile:ji}=n(84539),qi={name:"MessageReply",components:{AudioPlayer:zr,SvgIcon:be,FormatMessage:We},props:{message:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},roomUsers:{type:Array,required:!0}},computed:{replyUsername(){const{senderId:e}=this.message.replyMessage,t=this.roomUsers.find((t=>t._id===e));return t?t.username:""},firstFile(){return this.message.replyMessage.files?.length?this.message.replyMessage.files[0]:{}},isAudio(){return Fi(this.firstFile)},isImage(){return Ui(this.firstFile)},isVideo(){return ji(this.firstFile)},isOtherFile(){return this.message.replyMessage.files?.length&&!this.isAudio&&!this.isVideo&&!this.isImage}}},Hi=(0,ue.Z)(qi,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("audio-player"),c=(0,s.resolveComponent)("svg-icon"),l=(0,s.resolveComponent)("format-message");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Ri,[(0,s.createElementVNode)("div",Ai,(0,s.toDisplayString)(o.replyUsername),1),o.isImage?((0,s.openBlock)(),(0,s.createElementBlock)("div",Mi,[(0,s.createElementVNode)("div",{class:"vac-message-image vac-message-image-reply",style:(0,s.normalizeStyle)({"background-image":`url('${o.firstFile.url}')`})},null,4)])):o.isVideo?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ni,[(0,s.createElementVNode)("video",Pi,[(0,s.createElementVNode)("source",{src:o.firstFile.url},null,8,Bi)])])):o.isAudio?((0,s.openBlock)(),(0,s.createBlock)(a,{key:2,src:o.firstFile.url,onUpdateProgressTime:t[0]||(t[0]=t=>e.progressTime=t),onHoverAudioProgress:t[1]||(t[1]=t=>e.hoverAudioProgress=t)},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["src"])):o.isOtherFile?((0,s.openBlock)(),(0,s.createElementBlock)("div",Di,[(0,s.createElementVNode)("div",null,[(0,s.renderSlot)(e.$slots,"file-icon",{},(()=>[(0,s.createVNode)(c,{name:"file"})]))]),(0,s.createElementVNode)("div",Oi,(0,s.toDisplayString)(o.firstFile.name),1),o.firstFile.extension?((0,s.openBlock)(),(0,s.createElementBlock)("div",Li,(0,s.toDisplayString)(o.firstFile.extension),1)):(0,s.createCommentVNode)("",!0)])):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",Vi,[(0,s.createVNode)(l,{content:n.message.replyMessage.content,users:n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions,reply:!0},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["content","users","text-formatting","link-options"])])])}]]),zi={class:"vac-message-files-container"},$i=["onClick"],Ki={class:"vac-svg-button"},Gi={class:"vac-text-ellipsis"},Wi={key:0,class:"vac-text-ellipsis vac-text-extension"};const Yi={ref:"progress",class:"vac-progress-wrapper"},Xi=["height","width"],Qi=["stroke-dasharray","stroke-width","r","cx","cy"],Zi={class:"vac-progress-text"},Ji=(0,s.createElementVNode)("span",{class:"vac-progress-pourcent"},"%",-1);const eo={name:"ProgressBar",props:{progress:{type:Number,default:0}},data:()=>({radius:35,stroke:4,normalizedRadius:27,circumference:54*Math.PI}),computed:{strokeDashoffset(){return this.circumference-this.progress/100*this.circumference}}},to=(0,ue.Z)(eo,[["render",function(e,t,n,r,i,o){return(0,s.openBlock)(),(0,s.createBlock)(s.Transition,{name:"vac-fade-spinner",appear:""},{default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",Yi,[((0,s.openBlock)(),(0,s.createElementBlock)("svg",{height:2*i.radius,width:2*i.radius},[(0,s.createElementVNode)("circle",{stroke:"rgba(255, 255, 255, 0.7)","stroke-dasharray":i.circumference+" "+i.circumference,style:(0,s.normalizeStyle)({strokeDashoffset:o.strokeDashoffset,strokeLinecap:"round"}),"stroke-width":i.stroke,fill:"transparent",r:i.normalizedRadius,cx:i.radius,cy:i.radius},null,12,Qi)],8,Xi)),(0,s.createElementVNode)("div",{class:"vac-progress-content",style:(0,s.normalizeStyle)({height:2*i.radius-19+"px",width:2*i.radius-19+"px"})},[(0,s.createElementVNode)("div",Zi,[(0,s.createTextVNode)((0,s.toDisplayString)(n.progress),1),Ji])],4)],512)])),_:1})}]]),no={class:"vac-message-file-container"},so={key:0,class:"vac-image-buttons"},ro={width:"100%",height:"100%",controls:""},io=["src"];const{isImageFile:oo,isVideoFile:ao}=n(84539),co={name:"MessageFile",components:{SvgIcon:be,Loader:de,ProgressBar:to},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},file:{type:Object,required:!0},index:{type:Number,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file"],data:()=>({imageResponsive:"",imageLoading:!1,imageHover:!1}),computed:{isImageLoading(){return-1!==this.file.url.indexOf("blob:http")||this.imageLoading},isImage(){return oo(this.file)},isVideo(){return ao(this.file)}},watch:{file:{immediate:!0,handler(){this.checkImgLoad()}}},mounted(){const e=this.$refs["imageRef"+this.index];e&&(this.imageResponsive={maxHeight:e.clientWidth-18,loaderTop:e.clientHeight/2-9})},methods:{checkImgLoad(){if(!oo(this.file))return;this.imageLoading=!0;const e=new Image;e.src=this.file.url,e.addEventListener("load",(()=>this.imageLoading=!1))},openFile(e,t){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:this.file,action:t}))}}},lo=(0,ue.Z)(co,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("progress-bar"),c=(0,s.resolveComponent)("loader"),l=(0,s.resolveComponent)("svg-icon");return(0,s.openBlock)(),(0,s.createElementBlock)("div",no,[o.isImage?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,ref:"imageRef"+n.index,class:"vac-message-image-container",onMouseover:t[2]||(t[2]=e=>i.imageHover=!0),onMouseleave:t[3]||(t[3]=e=>i.imageHover=!1),onClick:t[4]||(t[4]=e=>o.openFile(e,"preview"))},[n.file.progress>=0?((0,s.openBlock)(),(0,s.createBlock)(a,{key:0,progress:n.file.progress,style:(0,s.normalizeStyle)({top:`${i.imageResponsive.loaderTop}px`})},null,8,["progress","style"])):((0,s.openBlock)(),(0,s.createBlock)(c,{key:1,show:o.isImageLoading,style:(0,s.normalizeStyle)({top:`${i.imageResponsive.loaderTop}px`})},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["show","style"])),(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["vac-message-image",{"vac-blur-loading":o.isImageLoading&&n.message.senderId===n.currentUserId}]),style:(0,s.normalizeStyle)({"background-image":`url('${o.isImageLoading&&n.file.preview||n.file.url}')`,"max-height":`${i.imageResponsive.maxHeight}px`})},[(0,s.createVNode)(s.Transition,{name:"vac-fade-image"},{default:(0,s.withCtx)((()=>[n.messageSelectionEnabled||!i.imageHover||o.isImageLoading?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",so,[(0,s.createElementVNode)("div",{class:"vac-svg-button vac-button-view",onClick:t[0]||(t[0]=e=>o.openFile(e,"preview"))},[(0,s.renderSlot)(e.$slots,"eye-icon",{},(()=>[(0,s.createVNode)(l,{name:"eye"})]))]),(0,s.createElementVNode)("div",{class:"vac-svg-button vac-button-download",onClick:t[1]||(t[1]=e=>o.openFile(e,"download"))},[(0,s.renderSlot)(e.$slots,"document-icon",{},(()=>[(0,s.createVNode)(l,{name:"document"})]))])]))])),_:3})],6)],544)):o.isVideo?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:1,class:"vac-video-container",onClick:t[5]||(t[5]=(0,s.withModifiers)((e=>o.openFile("preview")),["prevent"]))},[n.file.progress>=0?((0,s.openBlock)(),(0,s.createBlock)(a,{key:0,progress:n.file.progress},null,8,["progress"])):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("video",ro,[(0,s.createElementVNode)("source",{src:n.file.url},null,8,io)])])):(0,s.createCommentVNode)("",!0)])}]]),{isImageVideoFile:ho}=n(84539),uo={name:"MessageFiles",components:{SvgIcon:be,FormatMessage:We,ProgressBar:to,MessageFile:lo},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},roomUsers:{type:Array,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file","open-user-tag"],computed:{imageVideoFiles(){return this.message.files.filter((e=>ho(e)))},otherFiles(){return this.message.files.filter((e=>!ho(e)))}},methods:{openFile(e,t,n){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:t,action:n}))}}},mo=(0,ue.Z)(uo,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("message-file"),c=(0,s.resolveComponent)("progress-bar"),l=(0,s.resolveComponent)("svg-icon"),h=(0,s.resolveComponent)("format-message");return(0,s.openBlock)(),(0,s.createElementBlock)("div",zi,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.imageVideoFiles,((r,i)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:i+"iv"},[(0,s.createVNode)(a,{file:r,"current-user-id":n.currentUserId,message:n.message,index:i,"message-selection-enabled":n.messageSelectionEnabled,onOpenFile:t[0]||(t[0]=t=>e.$emit("open-file",t))},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["file","current-user-id","message","index","message-selection-enabled"])])))),128)),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.otherFiles,((t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:n+"a",class:"vac-file-wrapper"},[t.progress>=0?((0,s.openBlock)(),(0,s.createBlock)(c,{key:0,progress:t.progress,style:{top:"44px"}},null,8,["progress"])):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["vac-file-container",{"vac-file-container-progress":t.progress>=0}]),onClick:e=>o.openFile(e,t,"download")},[(0,s.createElementVNode)("div",Ki,[(0,s.renderSlot)(e.$slots,"document-icon",{},(()=>[(0,s.createVNode)(l,{name:"document"})]))]),(0,s.createElementVNode)("div",Gi,(0,s.toDisplayString)(t.name),1),t.extension?((0,s.openBlock)(),(0,s.createElementBlock)("div",Wi,(0,s.toDisplayString)(t.extension),1)):(0,s.createCommentVNode)("",!0)],10,$i)])))),128)),(0,s.createVNode)(h,{content:n.message.content,users:n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions,onOpenUserTag:t[1]||(t[1]=t=>e.$emit("open-user-tag"))},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["content","users","text-formatting","link-options"])])}]]),po={class:"vac-message-actions-wrapper"},fo={class:"vac-menu-list"},go=["onClick"];const _o={name:"MessageActions",components:{SvgIcon:be,EmojiPickerContainer:fr},directives:{clickOutside:Oe().directive},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},messageActions:{type:Array,required:!0},showReactionEmojis:{type:Boolean,required:!0},messageHover:{type:Boolean,required:!0},hoverMessageId:{type:[String,Number],default:null},hoverAudioProgress:{type:Boolean,required:!0}},emits:["update-emoji-opened","update-options-opened","update-message-hover","message-action-handler","send-message-reaction"],data:()=>({menuOptionsTop:0,optionsOpened:!1,optionsClosing:!1,emojiOpened:!1}),computed:{isMessageActions(){return this.filteredMessageActions.length&&this.messageHover&&!this.message.deleted&&!this.message.disableActions&&!this.hoverAudioProgress},isMessageReactions(){return this.showReactionEmojis&&this.messageHover&&!this.message.deleted&&!this.message.disableReactions&&!this.hoverAudioProgress},filteredMessageActions(){return this.message.senderId===this.currentUserId?this.messageActions:this.messageActions.filter((e=>!e.onlyMe))}},watch:{emojiOpened(e){this.$emit("update-emoji-opened",e),e&&(this.optionsOpened=!1)},optionsOpened(e){this.$emit("update-options-opened",e)}},methods:{openOptions(){this.optionsClosing||(this.optionsOpened=!this.optionsOpened,this.optionsOpened&&setTimeout((()=>{const e=document.getElementById("room-footer");if(!e||!this.$refs.menuOptions||!this.$refs.actionIcon)return;const t=this.$refs.menuOptions.getBoundingClientRect().height,n=this.$refs.actionIcon.getBoundingClientRect().top,s=e.getBoundingClientRect().top-n>t+50;this.menuOptionsTop=s?30:-t})))},closeOptions(){this.optionsOpened=!1,this.optionsClosing=!0,this.updateMessageHover(),setTimeout((()=>this.optionsClosing=!1),100)},openEmoji(){this.emojiOpened=!this.emojiOpened},closeEmoji(){this.emojiOpened=!1,this.updateMessageHover()},updateMessageHover(){this.hoverMessageId!==this.message._id&&this.$emit("update-message-hover",!1)},messageActionHandler(e){this.closeOptions(),this.$emit("message-action-handler",e)},sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t}),this.closeEmoji()}}},vo=(0,ue.Z)(_o,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("svg-icon"),c=(0,s.resolveComponent)("emoji-picker-container"),l=(0,s.resolveDirective)("click-outside");return(0,s.openBlock)(),(0,s.createElementBlock)("div",po,[(0,s.createElementVNode)("div",{class:"vac-options-container",style:(0,s.normalizeStyle)({display:n.hoverAudioProgress?"none":"initial",width:o.filteredMessageActions.length&&n.showReactionEmojis?"70px":"45px"})},[(0,s.createVNode)(s.TransitionGroup,{name:"vac-slide-left",tag:"span"},{default:(0,s.withCtx)((()=>[o.isMessageActions||o.isMessageReactions?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:"1",class:(0,s.normalizeClass)(["vac-blur-container",{"vac-options-me":n.message.senderId===n.currentUserId}])},null,2)):(0,s.createCommentVNode)("",!0),o.isMessageActions?((0,s.openBlock)(),(0,s.createElementBlock)("div",{ref:"actionIcon",key:"2",class:"vac-svg-button vac-message-options",onClick:t[0]||(t[0]=(...e)=>o.openOptions&&o.openOptions(...e))},[(0,s.renderSlot)(e.$slots,"dropdown-icon",{},(()=>[(0,s.createVNode)(a,{name:"dropdown",param:"message"})]))],512)):(0,s.createCommentVNode)("",!0),o.isMessageReactions?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(c,{key:"3",class:"vac-message-emojis",style:(0,s.normalizeStyle)({right:o.isMessageActions?"30px":"5px"}),"emoji-opened":i.emojiOpened,"emoji-reaction":!0,"position-right":n.message.senderId===n.currentUserId,onAddEmoji:o.sendMessageReaction,onOpenEmoji:o.openEmoji},{"emoji-picker-icon":(0,s.withCtx)((()=>[(0,s.renderSlot)(e.$slots,"emoji-picker-reaction-icon")])),_:3},8,["style","emoji-opened","position-right","onAddEmoji","onOpenEmoji"])),[[l,o.closeEmoji]]):(0,s.createCommentVNode)("",!0)])),_:3})],4),o.filteredMessageActions.length?((0,s.openBlock)(),(0,s.createBlock)(s.Transition,{key:0,name:n.message.senderId===n.currentUserId?"vac-slide-left":"vac-slide-right"},{default:(0,s.withCtx)((()=>[i.optionsOpened?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,ref:"menuOptions",class:(0,s.normalizeClass)(["vac-menu-options",{"vac-menu-left":n.message.senderId!==n.currentUserId}]),style:(0,s.normalizeStyle)({top:`${i.menuOptionsTop}px`})},[(0,s.createElementVNode)("div",fo,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.filteredMessageActions,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:e.name},[(0,s.createElementVNode)("div",{class:"vac-menu-item",onClick:t=>o.messageActionHandler(e)},(0,s.toDisplayString)(e.title),9,go)])))),128))])],6)),[[l,o.closeOptions]]):(0,s.createCommentVNode)("",!0)])),_:1},8,["name"])):(0,s.createCommentVNode)("",!0)])}]]),bo=["onClick"];const yo={name:"MessageReactions",props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0}},emits:["send-message-reaction"],methods:{sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t})}}},wo=(0,ue.Z)(yo,[["render",function(e,t,n,r,i,o){return n.message.deleted?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createBlock)(s.TransitionGroup,{key:0,name:"vac-slide-left",tag:"span"},{default:(0,s.withCtx)((()=>[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.message.reactions,((e,t)=>(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:t+0,class:(0,s.normalizeClass)(["vac-button-reaction",{"vac-reaction-me":-1!==e.indexOf(n.currentUserId)}]),style:(0,s.normalizeStyle)({float:n.message.senderId===n.currentUserId?"right":"left"}),onClick:n=>o.sendMessageReaction({unicode:t},e)},[(0,s.createTextVNode)((0,s.toDisplayString)(t),1),(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(e.length),1)],14,bo)),[[s.vShow,e.length]]))),128))])),_:1}))}]]),{messagesValidation:ko}=n(8391),{isAudioFile:xo}=n(84539),Eo={name:"RoomMessage",components:{SvgIcon:be,FormatMessage:We,AudioPlayer:zr,MessageReply:Hi,MessageFiles:mo,MessageActions:vo,MessageReactions:wo},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},index:{type:Number,required:!0},message:{type:Object,required:!0},messages:{type:Array,required:!0},editedMessageId:{type:[String,Number],default:null},roomUsers:{type:Array,default:()=>[]},messageActions:{type:Array,required:!0},newMessages:{type:Array,default:()=>[]},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},usernameOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},selectedMessages:{type:Array,default:()=>[]}},emits:["message-added","open-file","open-user-tag","open-failed-message","message-action-handler","send-message-reaction","select-message","unselect-message"],data:()=>({hoverMessageId:null,messageHover:!1,optionsOpened:!1,emojiOpened:!1,newMessage:{},progressTime:"- : -",hoverAudioProgress:!1}),computed:{showUsername(){return!(!this.usernameOptions.currentUser&&this.message.senderId===this.currentUserId)&&this.roomUsers.length>=this.usernameOptions.minUsers},showDate(){return this.index>0&&this.message.date!==this.messages[this.index-1].date},messageOffset(){return this.index>0&&this.message.senderId!==this.messages[this.index-1].senderId},isMessageHover(){return this.editedMessageId===this.message._id||this.hoverMessageId===this.message._id},isAudio(){return this.message.files?.some((e=>xo(e)))},isCheckmarkVisible(){return this.message.senderId===this.currentUserId&&!this.message.deleted&&(this.message.saved||this.message.distributed||this.message.seen)},hasCurrentUserAvatar(){return this.messages.some((e=>e.senderId===this.currentUserId&&e.avatar))},hasSenderUserAvatar(){return this.messages.some((e=>e.senderId!==this.currentUserId&&e.avatar))},isMessageSelected(){return this.messageSelectionEnabled&&!!this.selectedMessages.find((e=>e._id===this.message._id))}},watch:{newMessages:{immediate:!0,deep:!0,handler(e){e.length&&this.showNewMessagesDivider?this.newMessage=e.reduce(((e,t)=>t.index<e.index?t:e)):this.newMessage={}}},messageSelectionEnabled(){this.resetMessageHover()}},mounted(){ko(this.message),this.$emit("message-added",{message:this.message,index:this.index,ref:this.$refs.message})},methods:{onHoverMessage(){this.messageSelectionEnabled||(this.messageHover=!0,this.canEditMessage()&&(this.hoverMessageId=this.message._id))},canEditMessage(){return!this.message.deleted},onLeaveMessage(){this.messageSelectionEnabled||(this.optionsOpened||this.emojiOpened||(this.messageHover=!1),this.hoverMessageId=null)},resetMessageHover(){this.messageHover=!1,this.hoverMessageId=null},openFile(e){this.$emit("open-file",{message:this.message,file:e})},openUserTag(e){this.$emit("open-user-tag",{user:e})},messageActionHandler(e){this.resetMessageHover(),setTimeout((()=>{this.$emit("message-action-handler",{action:e,message:this.message})}),300)},sendMessageReaction({emoji:e,reaction:t}){this.$emit("send-message-reaction",{messageId:this.message._id,reaction:e,remove:t&&-1!==t.indexOf(this.currentUserId)}),this.messageHover=!1},selectMessage(){this.messageSelectionEnabled&&(this.isMessageSelected?this.$emit("unselect-message",this.message._id):this.$emit("select-message",this.message))}}},So={name:"Room",components:{Loader:de,SvgIcon:be,RoomHeader:xt,RoomFooter:gi,RoomMessage:(0,ue.Z)(Eo,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("format-message"),c=(0,s.resolveComponent)("message-reply"),l=(0,s.resolveComponent)("svg-icon"),h=(0,s.resolveComponent)("message-files"),u=(0,s.resolveComponent)("audio-player"),d=(0,s.resolveComponent)("message-actions"),m=(0,s.resolveComponent)("message-reactions");return(0,s.openBlock)(),(0,s.createElementBlock)("div",{id:n.message._id,ref:"message",class:"vac-message-wrapper"},[o.showDate?((0,s.openBlock)(),(0,s.createElementBlock)("div",vi,(0,s.toDisplayString)(n.message.date),1)):(0,s.createCommentVNode)("",!0),i.newMessage._id===n.message._id?((0,s.openBlock)(),(0,s.createElementBlock)("div",bi,(0,s.toDisplayString)(n.textMessages.NEW_MESSAGES),1)):(0,s.createCommentVNode)("",!0),n.message.system?((0,s.openBlock)(),(0,s.createElementBlock)("div",yi,[(0,s.createVNode)(a,{content:n.message.content,users:n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions,onOpenUserTag:o.openUserTag},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])])):((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:3,class:(0,s.normalizeClass)(["vac-message-box",{"vac-offset-current":n.message.senderId===n.currentUserId}]),onClick:t[8]||(t[8]=(...e)=>o.selectMessage&&o.selectMessage(...e))},[(0,s.renderSlot)(e.$slots,"message",(0,s.normalizeProps)((0,s.guardReactiveProps)({message:n.message})),(()=>[n.message.avatar&&n.message.senderId!==n.currentUserId?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-avatar",style:(0,s.normalizeStyle)({"background-image":`url('${n.message.avatar}')`})},null,4)):(0,s.createCommentVNode)("",!0),o.hasSenderUserAvatar&&!n.message.avatar?((0,s.openBlock)(),(0,s.createElementBlock)("div",wi)):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["vac-message-container",{"vac-message-container-offset":o.messageOffset}])},[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["vac-message-card",{"vac-message-highlight":o.isMessageHover,"vac-message-current":n.message.senderId===n.currentUserId,"vac-message-deleted":n.message.deleted,"vac-item-clickable":n.messageSelectionEnabled,"vac-message-selected":o.isMessageSelected}]),onMouseover:t[5]||(t[5]=(...e)=>o.onHoverMessage&&o.onHoverMessage(...e)),onMouseleave:t[6]||(t[6]=(...e)=>o.onLeaveMessage&&o.onLeaveMessage(...e))},[o.showUsername?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:(0,s.normalizeClass)(["vac-text-username",{"vac-username-reply":!n.message.deleted&&n.message.replyMessage}])},[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(n.message.username),1)],2)):(0,s.createCommentVNode)("",!0),!n.message.deleted&&n.message.replyMessage?((0,s.openBlock)(),(0,s.createBlock)(c,{key:1,message:n.message,"room-users":n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["message","room-users","text-formatting","link-options"])):(0,s.createCommentVNode)("",!0),n.message.deleted?((0,s.openBlock)(),(0,s.createElementBlock)("div",ki,[(0,s.renderSlot)(e.$slots,"deleted-icon",{},(()=>[(0,s.createVNode)(l,{name:"deleted",class:"vac-icon-deleted"})])),(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(n.textMessages.MESSAGE_DELETED),1)])):n.message.files&&n.message.files.length?!o.isAudio||n.message.files.length>1?((0,s.openBlock)(),(0,s.createBlock)(h,{key:4,"current-user-id":n.currentUserId,message:n.message,"room-users":n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"message-selection-enabled":n.messageSelectionEnabled,onOpenFile:o.openFile},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["current-user-id","message","room-users","text-formatting","link-options","message-selection-enabled","onOpenFile"])):((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:5},[(0,s.createVNode)(u,{"message-id":n.message._id,src:n.message.files[0].url,"message-selection-enabled":n.messageSelectionEnabled,onUpdateProgressTime:t[0]||(t[0]=e=>i.progressTime=e),onHoverAudioProgress:t[1]||(t[1]=e=>i.hoverAudioProgress=e)},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["message-id","src","message-selection-enabled"]),n.message.deleted?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",xi,(0,s.toDisplayString)(i.progressTime),1))],64)):((0,s.openBlock)(),(0,s.createBlock)(a,{key:3,content:n.message.content,users:n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions,onOpenUserTag:o.openUserTag},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])),(0,s.createElementVNode)("div",Ei,[n.message.edited&&!n.message.deleted?((0,s.openBlock)(),(0,s.createElementBlock)("div",Si,[(0,s.renderSlot)(e.$slots,"pencil-icon",{},(()=>[(0,s.createVNode)(l,{name:"pencil"})]))])):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(n.message.timestamp),1),o.isCheckmarkVisible?((0,s.openBlock)(),(0,s.createElementBlock)("span",Ti,[(0,s.renderSlot)(e.$slots,"checkmark-icon",(0,s.normalizeProps)((0,s.guardReactiveProps)({message:n.message})),(()=>[(0,s.createVNode)(l,{name:n.message.distributed?"double-checkmark":"checkmark",param:n.message.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])]))])):(0,s.createCommentVNode)("",!0)]),(0,s.createVNode)(d,{"current-user-id":n.currentUserId,message:n.message,"message-actions":n.messageActions,"show-reaction-emojis":n.showReactionEmojis,"message-hover":i.messageHover,"hover-message-id":i.hoverMessageId,"hover-audio-progress":i.hoverAudioProgress,onUpdateMessageHover:t[2]||(t[2]=e=>i.messageHover=e),onUpdateOptionsOpened:t[3]||(t[3]=e=>i.optionsOpened=e),onUpdateEmojiOpened:t[4]||(t[4]=e=>i.emojiOpened=e),onMessageActionHandler:o.messageActionHandler,onSendMessageReaction:o.sendMessageReaction},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["current-user-id","message","message-actions","show-reaction-emojis","message-hover","hover-message-id","hover-audio-progress","onMessageActionHandler","onSendMessageReaction"])],34),(0,s.createVNode)(m,{"current-user-id":n.currentUserId,message:n.message,onSendMessageReaction:o.sendMessageReaction},null,8,["current-user-id","message","onSendMessageReaction"])],2),(0,s.renderSlot)(e.$slots,"message-failure",(0,s.normalizeProps)((0,s.guardReactiveProps)({message:n.message})),(()=>[n.message.failure&&n.message.senderId===n.currentUserId?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:(0,s.normalizeClass)(["vac-failure-container vac-svg-button",{"vac-failure-container-avatar":n.message.avatar&&n.message.senderId===n.currentUserId}]),onClick:t[7]||(t[7]=t=>e.$emit("open-failed-message",{message:n.message}))},Ci,2)):(0,s.createCommentVNode)("",!0)])),n.message.avatar&&n.message.senderId===n.currentUserId?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:2,class:"vac-avatar vac-avatar-current",style:(0,s.normalizeStyle)({"background-image":`url('${n.message.avatar}')`})},null,4)):(0,s.createCommentVNode)("",!0),o.hasCurrentUserAvatar&&!n.message.avatar?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ii)):(0,s.createCommentVNode)("",!0)]))],2))],8,_i)}]])},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},roomId:{type:[String,Number],required:!0},loadFirstRoom:{type:Boolean,required:!0},messages:{type:Array,required:!0},roomMessage:{type:String,default:null},messagesLoaded:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},messageActions:{type:Array,required:!0},messageSelectionActions:{type:Array,required:!0},autoScroll:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},showEmojis:{type:Boolean,required:!0},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},loadingRooms:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},textareaActionEnabled:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},scrollDistance:{type:Number,required:!0},templatesText:{type:Array,default:null},usernameOptions:{type:Object,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","message-selection-action-handler","edit-message","send-message","delete-message","message-action-handler","fetch-messages","send-message-reaction","typing-message","open-file","open-user-tag","open-failed-message","textarea-action-handler"],data:()=>({editedMessageId:null,initReplyMessage:null,initEditMessage:null,infiniteState:null,loadingMessages:!1,observer:null,showLoader:!0,loadingMoreMessages:!1,scrollIcon:!1,scrollMessagesCount:0,newMessages:[],messageSelectionEnabled:!1,selectedMessages:[]}),computed:{room(){return this.rooms.find((e=>e.roomId===this.roomId))||{}},showNoMessages(){return this.roomId&&!this.messages.length&&!this.loadingMessages&&!this.loadingRooms},showNoRoom(){const e=!this.rooms.length&&!this.loadingRooms||!this.roomId&&!this.loadFirstRoom;return e&&(this.loadingMessages=!1),e},showMessagesStarted(){return this.messages.length&&this.messagesLoaded}},watch:{loadingMessages(e){e?this.infiniteState=null:(this.infiniteState&&this.infiniteState.loaded(),setTimeout((()=>this.initIntersectionObserver())))},roomId(){this.onRoomChanged()},messages:{deep:!0,handler(e,t){e.forEach(((e,t)=>{this.showNewMessagesDivider&&!e.seen&&e.senderId!==this.currentUserId&&this.newMessages.push({_id:e._id,index:t})})),t?.length===e?.length-1&&(this.newMessages=[]),this.infiniteState&&this.infiniteState.loaded(),setTimeout((()=>this.loadingMoreMessages=!1))}},messagesLoaded(e){e&&(this.loadingMessages=!1),this.infiniteState&&this.infiniteState.complete()}},mounted(){this.newMessages=[]},methods:{initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.getElementById("infinite-loader-messages");if(e){const t={root:document.getElementById("messages-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver((e=>{e[0].isIntersecting&&this.loadMoreMessages()}),t),this.observer.observe(e)}},preventTopScroll(){const e=this.$refs.scrollContainer,t=e.scrollHeight,n=new ResizeObserver((s=>{e.scrollHeight!==t&&this.$refs.scrollContainer&&(this.$refs.scrollContainer.scrollTo({top:e.scrollHeight-t}),n.disconnect())}));for(var s=0;s<e.children.length;s++)n.observe(e.children[s])},touchStart(e){if(!this.singleRoom&&1===e.changedTouches.length){const t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY;addEventListener("touchend",(e=>this.touchEnd(e,t,n)),{once:!0})}},touchEnd(e,t,n){if(1===e.changedTouches.length){const s=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY,i=s-t>100,o=Math.abs(r-n)>50;i&&!o&&this.$emit("toggle-rooms-list")}},onRoomChanged(){this.loadingMessages=!0,this.scrollIcon=!1,this.scrollMessagesCount=0,this.resetMessageSelection(),!this.messages.length&&this.messagesLoaded&&(this.loadingMessages=!1);const e=this.$watch((()=>this.messages),(t=>{if(!t||!t.length)return;const n=this.$refs.scrollContainer;n&&(e(),setTimeout((()=>{n.scrollTo({top:n.scrollHeight}),this.loadingMessages=!1})))}))},resetMessageSelection(){this.messageSelectionEnabled=!1,this.selectedMessages=[]},selectMessage(e){this.selectedMessages.push(e)},unselectMessage(e){this.selectedMessages=this.selectedMessages.filter((t=>t._id!==e))},onMessageAdded({message:e,index:t,ref:n}){if(t!==this.messages.length-1)return;const s=n.offsetHeight+60;setTimeout((()=>{const t=this.getBottomScroll(this.$refs.scrollContainer)>s;e.senderId===this.currentUserId?t?this.autoScroll.send.newAfterScrollUp&&this.scrollToBottom():this.autoScroll.send.new&&this.scrollToBottom():t?this.autoScroll.receive.newAfterScrollUp?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++):this.autoScroll.receive.new?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++)}))},onContainerScroll(e){if(!e.target)return;const t=this.getBottomScroll(e.target);t<60&&(this.scrollMessagesCount=0),this.scrollIcon=t>500||this.scrollMessagesCount},loadMoreMessages(){this.loadingMessages||setTimeout((()=>{if(!this.loadingMoreMessages){if(this.messagesLoaded||!this.roomId)return this.loadingMoreMessages=!1,void(this.showLoader=!1);this.preventTopScroll(),this.$emit("fetch-messages"),this.loadingMoreMessages=!0}}),500)},messageActionHandler({action:e,message:t}){switch(e.name){case"replyMessage":return void(this.initReplyMessage=t);case"editMessage":return void(this.initEditMessage=t);case"deleteMessage":return this.$emit("delete-message",t);case"selectMessages":return this.selectedMessages=[t],void(this.messageSelectionEnabled=!0);default:return this.$emit("message-action-handler",{action:e,message:t})}},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{action:e,messages:this.selectedMessages}),this.resetMessageSelection()},sendMessageReaction(e){this.$emit("send-message-reaction",e)},getBottomScroll(e){const{scrollHeight:t,clientHeight:n,scrollTop:s}=e;return t-n-s},scrollToBottom(){setTimeout((()=>{const e=this.$refs.scrollContainer;e.classList.add("vac-scroll-smooth"),e.scrollTo({top:e.scrollHeight,behavior:"smooth"}),setTimeout((()=>e.classList.remove("vac-scroll-smooth")))}),50)},openFile({message:e,file:t}){this.$emit("open-file",{message:e,file:t})},openUserTag(e){this.$emit("open-user-tag",e)}}},To=(0,ue.Z)(So,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("room-header"),c=(0,s.resolveComponent)("loader"),l=(0,s.resolveComponent)("room-message"),h=(0,s.resolveComponent)("svg-icon"),u=(0,s.resolveComponent)("room-footer");return(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"vac-col-messages",onTouchstart:t[12]||(t[12]=(...e)=>o.touchStart&&o.touchStart(...e))},[o.showNoRoom?(0,s.renderSlot)(e.$slots,"no-room-selected",{key:0},(()=>[(0,s.createElementVNode)("div",nt,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(n.textMessages.ROOM_EMPTY),1)])])):((0,s.openBlock)(),(0,s.createBlock)(a,{key:1,"current-user-id":n.currentUserId,"text-messages":n.textMessages,"single-room":n.singleRoom,"show-rooms-list":n.showRoomsList,"is-mobile":n.isMobile,"room-info-enabled":n.roomInfoEnabled,"menu-actions":n.menuActions,room:o.room,"message-selection-enabled":i.messageSelectionEnabled,"message-selection-actions":n.messageSelectionActions,"selected-messages-total":i.selectedMessages.length,onToggleRoomsList:t[0]||(t[0]=t=>e.$emit("toggle-rooms-list")),onRoomInfo:t[1]||(t[1]=t=>e.$emit("room-info")),onMenuActionHandler:t[2]||(t[2]=t=>e.$emit("menu-action-handler",t)),onMessageSelectionActionHandler:o.messageSelectionActionHandler,onCancelMessageSelection:t[3]||(t[3]=e=>i.messageSelectionEnabled=!1)},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["current-user-id","text-messages","single-room","show-rooms-list","is-mobile","room-info-enabled","menu-actions","room","message-selection-enabled","message-selection-actions","selected-messages-total","onMessageSelectionActionHandler"])),(0,s.createElementVNode)("div",{id:"messages-list",ref:"scrollContainer",class:"vac-container-scroll",onScroll:t[5]||(t[5]=(...e)=>o.onContainerScroll&&o.onContainerScroll(...e))},[(0,s.createVNode)(c,{show:i.loadingMessages},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["show"]),(0,s.createElementVNode)("div",st,[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)({"vac-messages-hidden":i.loadingMessages})},[(0,s.createVNode)(s.Transition,{name:"vac-fade-message"},{default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",null,[o.showNoMessages?((0,s.openBlock)(),(0,s.createElementBlock)("div",rt,[(0,s.renderSlot)(e.$slots,"messages-empty",{},(()=>[(0,s.createTextVNode)((0,s.toDisplayString)(n.textMessages.MESSAGES_EMPTY),1)]))])):(0,s.createCommentVNode)("",!0),o.showMessagesStarted?((0,s.openBlock)(),(0,s.createElementBlock)("div",it,(0,s.toDisplayString)(n.textMessages.CONVERSATION_STARTED)+" "+(0,s.toDisplayString)(n.messages[0].date),1)):(0,s.createCommentVNode)("",!0)])])),_:3}),n.messages.length&&!n.messagesLoaded?((0,s.openBlock)(),(0,s.createElementBlock)("div",ot,[(0,s.createVNode)(c,{show:!0,infinite:!0},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1024)])):(0,s.createCommentVNode)("",!0),((0,s.openBlock)(),(0,s.createBlock)(s.TransitionGroup,{key:n.roomId,name:"vac-fade-message",tag:"span"},{default:(0,s.withCtx)((()=>[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.messages,((r,a)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:r.indexId||r._id},[(0,s.createVNode)(l,{"current-user-id":n.currentUserId,message:r,index:a,messages:n.messages,"edited-message-id":i.editedMessageId,"message-actions":n.messageActions,"room-users":o.room.users,"text-messages":n.textMessages,"new-messages":i.newMessages,"show-reaction-emojis":n.showReactionEmojis,"show-new-messages-divider":n.showNewMessagesDivider,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"username-options":n.usernameOptions,"message-selection-enabled":i.messageSelectionEnabled,"selected-messages":i.selectedMessages,onMessageAdded:o.onMessageAdded,onMessageActionHandler:o.messageActionHandler,onOpenFile:o.openFile,onOpenUserTag:o.openUserTag,onOpenFailedMessage:t[4]||(t[4]=t=>e.$emit("open-failed-message",t)),onSendMessageReaction:o.sendMessageReaction,onSelectMessage:o.selectMessage,onUnselectMessage:o.unselectMessage},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["current-user-id","message","index","messages","edited-message-id","message-actions","room-users","text-messages","new-messages","show-reaction-emojis","show-new-messages-divider","text-formatting","link-options","username-options","message-selection-enabled","selected-messages","onMessageAdded","onMessageActionHandler","onOpenFile","onOpenUserTag","onSendMessageReaction","onSelectMessage","onUnselectMessage"])])))),128))])),_:3}))],2)])],544),i.loadingMessages?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",at,[(0,s.createVNode)(s.Transition,{name:"vac-bounce"},{default:(0,s.withCtx)((()=>[i.scrollIcon?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"vac-icon-scroll",onClick:t[6]||(t[6]=(...e)=>o.scrollToBottom&&o.scrollToBottom(...e))},[(0,s.createVNode)(s.Transition,{name:"vac-bounce"},{default:(0,s.withCtx)((()=>[i.scrollMessagesCount?((0,s.openBlock)(),(0,s.createElementBlock)("div",ct,(0,s.toDisplayString)(i.scrollMessagesCount),1)):(0,s.createCommentVNode)("",!0)])),_:1}),(0,s.renderSlot)(e.$slots,"scroll-icon",{},(()=>[(0,s.createVNode)(h,{name:"dropdown",param:"scroll"})]))])):(0,s.createCommentVNode)("",!0)])),_:3})])),(0,s.createVNode)(u,{room:o.room,"room-id":n.roomId,"room-message":n.roomMessage,"text-messages":n.textMessages,"show-send-icon":n.showSendIcon,"show-files":n.showFiles,"show-audio":n.showAudio,"show-emojis":n.showEmojis,"show-footer":n.showFooter,"accepted-files":n.acceptedFiles,"textarea-action-enabled":n.textareaActionEnabled,"user-tags-enabled":n.userTagsEnabled,"emojis-suggestion-enabled":n.emojisSuggestionEnabled,"templates-text":n.templatesText,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"audio-bit-rate":n.audioBitRate,"audio-sample-rate":n.audioSampleRate,"init-reply-message":i.initReplyMessage,"init-edit-message":i.initEditMessage,onUpdateEditedMessageId:t[7]||(t[7]=e=>i.editedMessageId=e),onEditMessage:t[8]||(t[8]=t=>e.$emit("edit-message",t)),onSendMessage:t[9]||(t[9]=t=>e.$emit("send-message",t)),onTypingMessage:t[10]||(t[10]=t=>e.$emit("typing-message",t)),onTextareaActionHandler:t[11]||(t[11]=t=>e.$emit("textarea-action-handler",t))},null,8,["room","room-id","room-message","text-messages","show-send-icon","show-files","show-audio","show-emojis","show-footer","accepted-files","textarea-action-enabled","user-tags-enabled","emojis-suggestion-enabled","templates-text","text-formatting","link-options","audio-bit-rate","audio-sample-rate","init-reply-message","init-edit-message"])],544)),[[s.vShow,n.isMobile&&!n.showRoomsList||!n.isMobile||n.singleRoom]])}]]),Co={key:0,class:"vac-media-preview-container"},Io={key:1,class:"vac-media-preview-container"},Ro={width:"100%",height:"100%",controls:"",autoplay:""},Ao=["src"],Mo={class:"vac-svg-button"};const{isImageFile:No,isVideoFile:Po}=n(84539),Bo={name:"MediaPreview",components:{SvgIcon:be},props:{file:{type:Object,required:!0}},emits:["close-media-preview"],computed:{isImage(){return No(this.file)},isVideo(){return Po(this.file)}},mounted(){this.$refs.modal.focus()},methods:{closeModal(){this.$emit("close-media-preview")}}},Do=(0,ue.Z)(Bo,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("svg-icon");return(0,s.openBlock)(),(0,s.createElementBlock)("div",{ref:"modal",tabindex:"0",class:"vac-media-preview",onClick:t[0]||(t[0]=(0,s.withModifiers)(((...e)=>o.closeModal&&o.closeModal(...e)),["stop"])),onKeydown:t[1]||(t[1]=(0,s.withKeys)(((...e)=>o.closeModal&&o.closeModal(...e)),["esc"]))},[(0,s.createVNode)(s.Transition,{name:"vac-bounce-preview",appear:""},{default:(0,s.withCtx)((()=>[o.isImage?((0,s.openBlock)(),(0,s.createElementBlock)("div",Co,[(0,s.createElementVNode)("div",{class:"vac-image-preview",style:(0,s.normalizeStyle)({"background-image":`url('${n.file.url}')`})},null,4)])):o.isVideo?((0,s.openBlock)(),(0,s.createElementBlock)("div",Io,[(0,s.createElementVNode)("video",Ro,[(0,s.createElementVNode)("source",{src:n.file.url},null,8,Ao)])])):(0,s.createCommentVNode)("",!0)])),_:1}),(0,s.createElementVNode)("div",Mo,[(0,s.renderSlot)(e.$slots,"preview-close-icon",{},(()=>[(0,s.createVNode)(a,{name:"close-outline",param:"preview"})]))])],544)}]]),Oo={ROOMS_EMPTY:"No rooms",ROOM_EMPTY:"No room selected",NEW_MESSAGES:"New Messages",MESSAGE_DELETED:"This message was deleted",MESSAGES_EMPTY:"No messages",CONVERSATION_STARTED:"Conversation started on:",TYPE_MESSAGE:"Type message",SEARCH:"Search",IS_ONLINE:"is online",LAST_SEEN:"last seen ",IS_TYPING:"is writing...",CANCEL_SELECT_MESSAGE:"Cancel"},Lo={light:{general:{color:"#0a0a0a",colorButtonClear:"#1976d2",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#fff",colorPlaceholder:"#9ca6af",colorCaret:"#1976d2",colorSpinner:"#333",borderStyle:"1px solid #e1e4e8",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#fff",colorRoomName:"#0a0a0a",colorRoomInfo:"#9ca6af"},footer:{background:"#f8f9fa",borderStyleInput:"1px solid #e1e4e8",borderInputSelected:"#1976d2",backgroundReply:"#e5e5e6",backgroundTagActive:"#e5e5e6",backgroundTag:"#f8f9fa"},content:{background:"#f8f9fa"},sidemenu:{background:"#fff",backgroundHover:"#f6f6f6",backgroundActive:"#e5effa",colorActive:"#1976d2",borderColorSearch:"#e1e5e8"},dropdown:{background:"#fff",backgroundHover:"#f6f6f6"},message:{background:"#fff",backgroundMe:"#ccf2cf",color:"#0a0a0a",colorStarted:"#9ca6af",backgroundDeleted:"#dadfe2",backgroundSelected:"#c2dcf2",colorDeleted:"#757e85",colorUsername:"#9ca6af",colorTimestamp:"#828c94",backgroundDate:"#e5effa",colorDate:"#505a62",backgroundSystem:"#e5effa",colorSystem:"#505a62",backgroundMedia:"rgba(0, 0, 0, 0.15)",backgroundReply:"rgba(0, 0, 0, 0.08)",colorReplyUsername:"#0a0a0a",colorReply:"#6e6e6e",colorTag:"#0d579c",backgroundImage:"#ddd",colorNewMessages:"#1976d2",backgroundScrollCounter:"#0696c7",colorScrollCounter:"#fff",backgroundReaction:"#eee",borderStyleReaction:"1px solid #eee",backgroundReactionHover:"#fff",borderStyleReactionHover:"1px solid #ddd",colorReactionCounter:"#0a0a0a",backgroundReactionMe:"#cfecf5",borderStyleReactionMe:"1px solid #3b98b8",backgroundReactionHoverMe:"#cfecf5",borderStyleReactionHoverMe:"1px solid #3b98b8",colorReactionCounterMe:"#0b59b3",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(0, 0, 0, 0.15)",backgroundAudioProgress:"#455247",backgroundAudioProgressSelector:"#455247",colorFileExtension:"#757e85"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#0a0a0a",colorMessage:"#67717a",colorTimestamp:"#a2aeb8",colorStateOnline:"#4caf50",colorStateOffline:"#9ca6af",backgroundCounterBadge:"#0696c7",colorCounterBadge:"#fff"},emoji:{background:"#fff"},icons:{search:"#9ca6af",add:"#1976d2",toggle:"#0a0a0a",menu:"#0a0a0a",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#1976d2",closeOutline:"#000",closePreview:"#fff",send:"#1976d2",sendDisabled:"#9ca6af",emoji:"#1976d2",emojiReaction:"rgba(0, 0, 0, 0.3)",document:"#1976d2",pencil:"#9e9e9e",checkmark:"#9e9e9e",checkmarkSeen:"#0696c7",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#9e9e9e",dropdownScroll:"#0a0a0a",microphone:"#1976d2",audioPlay:"#455247",audioPause:"#455247",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}},dark:{general:{color:"#fff",colorButtonClear:"#fff",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#202223",colorPlaceholder:"#596269",colorCaret:"#fff",colorSpinner:"#fff",borderStyle:"none",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#181a1b",colorRoomName:"#fff",colorRoomInfo:"#9ca6af"},footer:{background:"#131415",borderStyleInput:"none",borderInputSelected:"#1976d2",backgroundReply:"#1b1c1c",backgroundTagActive:"#1b1c1c",backgroundTag:"#131415"},content:{background:"#131415"},sidemenu:{background:"#181a1b",backgroundHover:"#202224",backgroundActive:"#151617",colorActive:"#fff",borderColorSearch:"#181a1b"},dropdown:{background:"#2a2c33",backgroundHover:"#26282e"},message:{background:"#22242a",backgroundMe:"#1f7e80",color:"#fff",colorStarted:"#9ca6af",backgroundDeleted:"#1b1c21",backgroundSelected:"#c2dcf2",colorDeleted:"#a2a5a8",colorUsername:"#b3bac9",colorTimestamp:"#ebedf2",backgroundDate:"rgba(0, 0, 0, 0.3)",colorDate:"#bec5cc",backgroundSystem:"rgba(0, 0, 0, 0.3)",colorSystem:"#bec5cc",backgroundMedia:"rgba(0, 0, 0, 0.18)",backgroundReply:"rgba(0, 0, 0, 0.18)",colorReplyUsername:"#fff",colorReply:"#d6d6d6",colorTag:"#f0c60a",backgroundImage:"#ddd",colorNewMessages:"#fff",backgroundScrollCounter:"#1976d2",colorScrollCounter:"#fff",backgroundReaction:"none",borderStyleReaction:"none",backgroundReactionHover:"#202223",borderStyleReactionHover:"none",colorReactionCounter:"#fff",backgroundReactionMe:"#4e9ad1",borderStyleReactionMe:"none",backgroundReactionHoverMe:"#4e9ad1",borderStyleReactionHoverMe:"none",colorReactionCounterMe:"#fff",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(255, 255, 255, 0.15)",backgroundAudioProgress:"#b7d4d3",backgroundAudioProgressSelector:"#b7d4d3",colorFileExtension:"#a2a5a8"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#fff",colorMessage:"#6c7278",colorTimestamp:"#6c7278",colorStateOnline:"#4caf50",colorStateOffline:"#596269",backgroundCounterBadge:"#1976d2",colorCounterBadge:"#fff"},emoji:{background:"#343740"},icons:{search:"#596269",add:"#fff",toggle:"#fff",menu:"#fff",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#fff",closeOutline:"#fff",closePreview:"#fff",send:"#fff",sendDisabled:"#646a70",emoji:"#fff",emojiReaction:"#fff",document:"#1976d2",pencil:"#ebedf2",checkmark:"#ebedf2",checkmarkSeen:"#f0d90a",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#fff",dropdownScroll:"#0a0a0a",microphone:"#fff",audioPlay:"#b7d4d3",audioPause:"#b7d4d3",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}}},{roomsValidation:Vo,partcipantsValidation:Fo}=n(8391),Uo={name:"ChatContainer",components:{RoomsList:tt,Room:To,MediaPreview:Do},props:{height:{type:String,default:"600px"},theme:{type:String,default:"light"},styles:{type:Object,default:()=>({})},responsiveBreakpoint:{type:Number,default:900},singleRoom:{type:Boolean,default:!1},roomsListOpened:{type:Boolean,default:!0},textMessages:{type:Object,default:null},currentUserId:{type:[String,Number],default:""},rooms:{type:Array,default:()=>[]},roomsOrder:{type:String,default:"desc"},loadingRooms:{type:Boolean,default:!1},roomsLoaded:{type:Boolean,default:!1},roomId:{type:[String,Number],default:null},loadFirstRoom:{type:Boolean,default:!0},messages:{type:Array,default:()=>[]},messagesLoaded:{type:Boolean,default:!1},roomActions:{type:Array,default:()=>[]},menuActions:{type:Array,default:()=>[]},messageActions:{type:Array,default:()=>[{name:"replyMessage",title:"Reply"},{name:"editMessage",title:"Edit Message",onlyMe:!0},{name:"deleteMessage",title:"Delete Message",onlyMe:!0},{name:"selectMessages",title:"Select"}]},messageSelectionActions:{type:Array,default:()=>[]},autoScroll:{type:Object,default:()=>({send:{new:!0,newAfterScrollUp:!0},receive:{new:!0,newAfterScrollUp:!1}})},showSearch:{type:Boolean,default:!0},showAddRoom:{type:Boolean,default:!0},showSendIcon:{type:Boolean,default:!0},showFiles:{type:Boolean,default:!0},showAudio:{type:Boolean,default:!0},audioBitRate:{type:Number,default:128},audioSampleRate:{type:Number,default:44100},showEmojis:{type:Boolean,default:!0},showReactionEmojis:{type:Boolean,default:!0},showNewMessagesDivider:{type:Boolean,default:!0},showFooter:{type:Boolean,default:!0},textFormatting:{type:Object,default:()=>({disabled:!1,italic:"_",bold:"*",strike:"~",underline:"°",multilineCode:"```",inlineCode:"`"})},linkOptions:{type:Object,default:()=>({disabled:!1,target:"_blank",rel:null})},roomInfoEnabled:{type:Boolean,default:!1},textareaActionEnabled:{type:Boolean,default:!1},userTagsEnabled:{type:Boolean,default:!0},emojisSuggestionEnabled:{type:Boolean,default:!0},roomMessage:{type:String,default:""},scrollDistance:{type:Number,default:60},acceptedFiles:{type:String,default:"*"},templatesText:{type:Array,default:null},mediaPreviewEnabled:{type:Boolean,default:!0},usernameOptions:{type:Object,default:()=>({minUsers:3,currentUser:!1})}},emits:["toggle-rooms-list","room-info","fetch-messages","send-message","edit-message","delete-message","open-file","open-user-tag","open-failed-message","menu-action-handler","message-action-handler","send-message-reaction","typing-message","textarea-action-handler","fetch-more-rooms","add-room","room-action-handler","message-selection-action-handler"],data:()=>({room:{},loadingMoreRooms:!1,showRoomsList:!0,isMobile:!1,showMediaPreview:!1,previewFile:{}}),computed:{t(){return{...Oo,...this.textMessages}},cssVars(){const e=Lo[this.theme],t={};return Object.keys(e).map((n=>{t[n]={...e[n],...this.styles[n]||{}}})),(({general:e,container:t,header:n,footer:s,sidemenu:r,content:i,dropdown:o,message:a,markdown:c,room:l,emoji:h,icons:u})=>({"--chat-color":e.color,"--chat-color-button-clear":e.colorButtonClear,"--chat-color-button":e.colorButton,"--chat-bg-color-button":e.backgroundColorButton,"--chat-bg-color-input":e.backgroundInput,"--chat-color-spinner":e.colorSpinner,"--chat-color-placeholder":e.colorPlaceholder,"--chat-color-caret":e.colorCaret,"--chat-border-style":e.borderStyle,"--chat-bg-scroll-icon":e.backgroundScrollIcon,"--chat-container-border":t.border,"--chat-container-border-radius":t.borderRadius,"--chat-container-box-shadow":t.boxShadow,"--chat-header-bg-color":n.background,"--chat-header-color-name":n.colorRoomName,"--chat-header-color-info":n.colorRoomInfo,"--chat-footer-bg-color":s.background,"--chat-border-style-input":s.borderStyleInput,"--chat-border-color-input-selected":s.borderInputSelected,"--chat-footer-bg-color-reply":s.backgroundReply,"--chat-footer-bg-color-tag-active":s.backgroundTagActive,"--chat-footer-bg-color-tag":s.backgroundTag,"--chat-content-bg-color":i.background,"--chat-sidemenu-bg-color":r.background,"--chat-sidemenu-bg-color-hover":r.backgroundHover,"--chat-sidemenu-bg-color-active":r.backgroundActive,"--chat-sidemenu-color-active":r.colorActive,"--chat-sidemenu-border-color-search":r.borderColorSearch,"--chat-dropdown-bg-color":o.background,"--chat-dropdown-bg-color-hover":o.backgroundHover,"--chat-message-bg-color":a.background,"--chat-message-bg-color-me":a.backgroundMe,"--chat-message-color-started":a.colorStarted,"--chat-message-bg-color-deleted":a.backgroundDeleted,"--chat-message-bg-color-selected":a.backgroundSelected,"--chat-message-color-deleted":a.colorDeleted,"--chat-message-color-username":a.colorUsername,"--chat-message-color-timestamp":a.colorTimestamp,"--chat-message-bg-color-date":a.backgroundDate,"--chat-message-color-date":a.colorDate,"--chat-message-bg-color-system":a.backgroundSystem,"--chat-message-color-system":a.colorSystem,"--chat-message-color":a.color,"--chat-message-bg-color-media":a.backgroundMedia,"--chat-message-bg-color-reply":a.backgroundReply,"--chat-message-color-reply-username":a.colorReplyUsername,"--chat-message-color-reply-content":a.colorReply,"--chat-message-color-tag":a.colorTag,"--chat-message-bg-color-image":a.backgroundImage,"--chat-message-color-new-messages":a.colorNewMessages,"--chat-message-bg-color-scroll-counter":a.backgroundScrollCounter,"--chat-message-color-scroll-counter":a.colorScrollCounter,"--chat-message-bg-color-reaction":a.backgroundReaction,"--chat-message-border-style-reaction":a.borderStyleReaction,"--chat-message-bg-color-reaction-hover":a.backgroundReactionHover,"--chat-message-border-style-reaction-hover":a.borderStyleReactionHover,"--chat-message-color-reaction-counter":a.colorReactionCounter,"--chat-message-bg-color-reaction-me":a.backgroundReactionMe,"--chat-message-border-style-reaction-me":a.borderStyleReactionMe,"--chat-message-bg-color-reaction-hover-me":a.backgroundReactionHoverMe,"--chat-message-border-style-reaction-hover-me":a.borderStyleReactionHoverMe,"--chat-message-color-reaction-counter-me":a.colorReactionCounterMe,"--chat-message-bg-color-audio-record":a.backgroundAudioRecord,"--chat-message-bg-color-audio-line":a.backgroundAudioLine,"--chat-message-bg-color-audio-progress":a.backgroundAudioProgress,"--chat-message-bg-color-audio-progress-selector":a.backgroundAudioProgressSelector,"--chat-message-color-file-extension":a.colorFileExtension,"--chat-markdown-bg":c.background,"--chat-markdown-border":c.border,"--chat-markdown-color":c.color,"--chat-markdown-color-multi":c.colorMulti,"--chat-room-color-username":l.colorUsername,"--chat-room-color-message":l.colorMessage,"--chat-room-color-timestamp":l.colorTimestamp,"--chat-room-color-online":l.colorStateOnline,"--chat-room-color-offline":l.colorStateOffline,"--chat-room-bg-color-badge":l.backgroundCounterBadge,"--chat-room-color-badge":l.colorCounterBadge,"--chat-emoji-bg-color":h.background,"--chat-icon-color-search":u.search,"--chat-icon-color-add":u.add,"--chat-icon-color-toggle":u.toggle,"--chat-icon-color-menu":u.menu,"--chat-icon-color-close":u.close,"--chat-icon-color-close-image":u.closeImage,"--chat-icon-color-file":u.file,"--chat-icon-color-paperclip":u.paperclip,"--chat-icon-color-close-outline":u.closeOutline,"--chat-icon-color-close-preview":u.closePreview,"--chat-icon-color-send":u.send,"--chat-icon-color-send-disabled":u.sendDisabled,"--chat-icon-color-emoji":u.emoji,"--chat-icon-color-emoji-reaction":u.emojiReaction,"--chat-icon-color-document":u.document,"--chat-icon-color-pencil":u.pencil,"--chat-icon-color-checkmark":u.checkmark,"--chat-icon-color-checkmark-seen":u.checkmarkSeen,"--chat-icon-color-eye":u.eye,"--chat-icon-color-dropdown-message":u.dropdownMessage,"--chat-icon-bg-dropdown-message":u.dropdownMessageBackground,"--chat-icon-color-dropdown-room":u.dropdownRoom,"--chat-icon-color-dropdown-scroll":u.dropdownScroll,"--chat-icon-color-microphone":u.microphone,"--chat-icon-color-audio-play":u.audioPlay,"--chat-icon-color-audio-pause":u.audioPause,"--chat-icon-color-audio-cancel":u.audioCancel,"--chat-icon-color-audio-confirm":u.audioConfirm}))(t)},orderedRooms(){return this.rooms.slice().sort(((e,t)=>{const n=e.index||0,s=t.index||0;return"asc"===this.roomsOrder?n<s?-1:s<n?1:0:n>s?-1:s>n?1:0}))}},watch:{rooms:{immediate:!0,deep:!0,handler(e,t){if(e[0]&&e.find((e=>e.roomId===this.room.roomId))||(this.showRoomsList=!0),!this.loadingMoreRooms&&this.loadFirstRoom&&e[0]&&(!t||e.length!==t.length))if(this.roomId){const t=e.find((e=>e.roomId===this.roomId))||{};this.fetchRoom({room:t})}else!this.isMobile||this.singleRoom?this.fetchRoom({room:this.orderedRooms[0]}):this.showRoomsList=!0}},loadingRooms(e){e&&(this.room={})},roomId:{immediate:!0,handler(e,t){if(e&&!this.loadingRooms&&this.rooms.length){const t=this.rooms.find((t=>t.roomId===e));this.fetchRoom({room:t})}else t&&!e&&(this.room={})}},room(e){e&&0!==Object.entries(e).length&&(Vo(e),e.users.forEach((e=>{Fo(e)})))},roomsListOpened(e){this.showRoomsList=e}},created(){this.updateResponsive(),console.log("chat rooms ",this.showRoomsList),window.addEventListener("resize",(e=>{e.isTrusted&&this.updateResponsive()}))},methods:{updateResponsive(){this.isMobile=window.innerWidth<this.responsiveBreakpoint},toggleRoomsList(){this.showRoomsList=!this.showRoomsList,this.isMobile&&(this.room={}),this.$emit("toggle-rooms-list",{opened:this.showRoomsList})},fetchRoom({room:e}){this.room=e,this.fetchMessages({reset:!0}),this.isMobile&&(this.showRoomsList=!1)},fetchMoreRooms(){this.$emit("fetch-more-rooms")},roomInfo(){this.$emit("room-info",this.room)},addRoom(){this.$emit("add-room")},fetchMessages(e){this.$emit("fetch-messages",{room:this.room,options:e})},sendMessage(e){this.$emit("send-message",{...e,roomId:this.room.roomId})},editMessage(e){this.$emit("edit-message",{...e,roomId:this.room.roomId})},deleteMessage(e){this.$emit("delete-message",{message:e,roomId:this.room.roomId})},openFile({message:e,file:t}){this.mediaPreviewEnabled&&"preview"===t.action?(this.previewFile=t.file,this.showMediaPreview=!0):this.$emit("open-file",{message:e,file:t})},openUserTag({user:e}){this.$emit("open-user-tag",{user:e})},openFailedMessage({message:e}){this.$emit("open-failed-message",{message:e,roomId:this.room.roomId})},menuActionHandler(e){this.$emit("menu-action-handler",{action:e,roomId:this.room.roomId})},roomActionHandler({action:e,roomId:t}){this.$emit("room-action-handler",{action:e,roomId:t})},messageActionHandler(e){this.$emit("message-action-handler",{...e,roomId:this.room.roomId})},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{...e,roomId:this.room.roomId})},sendMessageReaction(e){this.$emit("send-message-reaction",{...e,roomId:this.room.roomId})},typingMessage(e){this.$emit("typing-message",{message:e,roomId:this.room.roomId})},textareaActionHandler(e){this.$emit("textarea-action-handler",{message:e,roomId:this.room.roomId})}}};var jo=n(93379),qo=n.n(jo),Ho=n(62921),zo={insert:"head",singleton:!1};qo()(Ho.Z,zo);Ho.Z.locals;const $o={components:{ChatWindow:(0,ue.Z)(Uo,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("rooms-list"),c=(0,s.resolveComponent)("room"),l=(0,s.resolveComponent)("media-preview");return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"vac-card-window",style:(0,s.normalizeStyle)([{height:n.height},o.cssVars])},[(0,s.createElementVNode)("div",re,[n.singleRoom?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createBlock)(a,{key:0,"current-user-id":n.currentUserId,rooms:o.orderedRooms,"loading-rooms":n.loadingRooms,"rooms-loaded":n.roomsLoaded,room:i.room,"room-actions":n.roomActions,"text-messages":o.t,"show-search":n.showSearch,"show-add-room":n.showAddRoom,"show-rooms-list":i.showRoomsList,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"is-mobile":i.isMobile,"scroll-distance":n.scrollDistance,onFetchRoom:o.fetchRoom,onFetchMoreRooms:o.fetchMoreRooms,onLoadingMoreRooms:t[0]||(t[0]=e=>i.loadingMoreRooms=e),onAddRoom:o.addRoom,onRoomActionHandler:o.roomActionHandler},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["current-user-id","rooms","loading-rooms","rooms-loaded","room","room-actions","text-messages","show-search","show-add-room","show-rooms-list","text-formatting","link-options","is-mobile","scroll-distance","onFetchRoom","onFetchMoreRooms","onAddRoom","onRoomActionHandler"])),(0,s.createVNode)(c,{"current-user-id":n.currentUserId,rooms:n.rooms,"room-id":i.room.roomId||"","load-first-room":n.loadFirstRoom,messages:n.messages,"room-message":n.roomMessage,"messages-loaded":n.messagesLoaded,"menu-actions":n.menuActions,"message-actions":n.messageActions,"message-selection-actions":n.messageSelectionActions,"auto-scroll":n.autoScroll,"show-send-icon":n.showSendIcon,"show-files":n.showFiles,"show-audio":n.showAudio,"audio-bit-rate":n.audioBitRate,"audio-sample-rate":n.audioSampleRate,"show-emojis":n.showEmojis,"show-reaction-emojis":n.showReactionEmojis,"show-new-messages-divider":n.showNewMessagesDivider,"show-footer":n.showFooter,"text-messages":o.t,"single-room":n.singleRoom,"show-rooms-list":i.showRoomsList,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"is-mobile":i.isMobile,"loading-rooms":n.loadingRooms,"room-info-enabled":n.roomInfoEnabled,"textarea-action-enabled":n.textareaActionEnabled,"user-tags-enabled":n.userTagsEnabled,"emojis-suggestion-enabled":n.emojisSuggestionEnabled,"scroll-distance":n.scrollDistance,"accepted-files":n.acceptedFiles,"templates-text":n.templatesText,"username-options":n.usernameOptions,onToggleRoomsList:o.toggleRoomsList,onRoomInfo:o.roomInfo,onFetchMessages:o.fetchMessages,onSendMessage:o.sendMessage,onEditMessage:o.editMessage,onDeleteMessage:o.deleteMessage,onOpenFile:o.openFile,onOpenUserTag:o.openUserTag,onOpenFailedMessage:o.openFailedMessage,onMenuActionHandler:o.menuActionHandler,onMessageActionHandler:o.messageActionHandler,onMessageSelectionActionHandler:o.messageSelectionActionHandler,onSendMessageReaction:o.sendMessageReaction,onTypingMessage:o.typingMessage,onTextareaActionHandler:o.textareaActionHandler},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$scopedSlots,((t,n)=>({name:n,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,n,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1032,["current-user-id","rooms","room-id","load-first-room","messages","room-message","messages-loaded","menu-actions","message-actions","message-selection-actions","auto-scroll","show-send-icon","show-files","show-audio","audio-bit-rate","audio-sample-rate","show-emojis","show-reaction-emojis","show-new-messages-divider","show-footer","text-messages","single-room","show-rooms-list","text-formatting","link-options","is-mobile","loading-rooms","room-info-enabled","textarea-action-enabled","user-tags-enabled","emojis-suggestion-enabled","scroll-distance","accepted-files","templates-text","username-options","onToggleRoomsList","onRoomInfo","onFetchMessages","onSendMessage","onEditMessage","onDeleteMessage","onOpenFile","onOpenUserTag","onOpenFailedMessage","onMenuActionHandler","onMessageActionHandler","onMessageSelectionActionHandler","onSendMessageReaction","onTypingMessage","onTextareaActionHandler"])]),(0,s.createVNode)(s.Transition,{name:"vac-fade-preview",appear:""},{default:(0,s.withCtx)((()=>[i.showMediaPreview?((0,s.openBlock)(),(0,s.createBlock)(l,{key:0,file:i.previewFile,onCloseMediaPreview:t[1]||(t[1]=e=>i.showMediaPreview=!1)},null,8,["file"])):(0,s.createCommentVNode)("",!0)])),_:1})],4)}]])},props:{currentUserId:{type:String,required:!0},userData:{type:Object,required:!0},theme:{type:String,required:!0},isDevice:{type:Boolean,required:!0}},emits:["show-demo-options"],data:()=>({isLoading:!1,roomsPerPage:15,rooms:[],roomId:"",startRooms:null,endRooms:null,roomsLoaded:!1,loadingRooms:!0,allUsers:[],loadingLastMessageByRoom:0,roomsLoadedCount:!1,selectedRoom:null,messagesPerPage:20,messages:[],messagesLoaded:!1,roomMessage:"",lastLoadedMessage:null,previousLastLoadedMessage:null,roomsListeners:[],listeners:[],typingMessageCache:"",disableForm:!1,addNewRoom:null,addRoomUsername:"",inviteRoomId:null,invitedUsername:"",removeRoomId:null,removeUserId:"",removeUsers:[],roomActions:[{name:"deleteRoom",title:"Delete Room"}],menuActions:[{name:"deleteRoom",title:"Delete Room"}],messageSelectionActions:[{name:"deleteMessages",title:"Delete"}],styles:{container:{borderRadius:"4px"}},templatesText:[{tag:"help",text:"This is the help"},{tag:"action",text:"This is the action"},{tag:"action 2",text:"This is the second action"}]}),computed:{loadedRooms(){return this.rooms.slice(0,this.roomsLoadedCount)},screenHeight(){return this.isDevice?window.innerHeight+"px":"calc(100vh - 80px)"},archiveEndpoint(){return _.get(this,"$config.app.chat.archiveEndpoint",{})}},mounted(){this.fetchRooms(),(e=>{const t={state:"offline",lastChanged:(0,Z.Bt)()},n={state:"online",lastChanged:(0,Z.Bt)()},s=(0,Z.iH)(r.yG,".info/connected");(0,Z.jM)(s,(s=>{!0===s.val()&&(0,Z.ae)(ee(e)).set(t).then((()=>{(0,Z.t8)(ee(e),n)}))}))})(this.currentUserId)},methods:{resetRooms(){this.loadingRooms=!0,this.loadingLastMessageByRoom=0,this.roomsLoadedCount=0,this.rooms=[],this.roomsLoaded=!0,this.startRooms=null,this.endRooms=null,this.roomsListeners.forEach((e=>e())),this.roomsListeners=[],this.resetMessages()},resetMessages(){this.messages=[],this.messagesLoaded=!1,this.lastLoadedMessage=null,this.previousLastLoadedMessage=null,this.listeners.forEach((e=>e())),this.listeners=[]},fetchRooms(){this.resetRooms(),this.fetchMoreRooms()},async fetchMoreRooms(){if(this.endRooms&&!this.startRooms)return void(this.roomsLoaded=!0);const e=(this.currentUserId,t=this.roomsPerPage,(n=this.startRooms)?(0,i.IO)(C,(0,i.Xo)(u,"desc"),(0,i.b9)(t),(0,i.TQ)(n)):(0,i.IO)(C,(0,i.Xo)(u,"desc"),(0,i.b9)(t)));var t,n;const{data:s,docs:r}=await(e=>f(e))(e);this.roomsLoaded=0===s.length||s.length<this.roomsPerPage,this.startRooms&&(this.endRooms=this.startRooms),this.startRooms=r[r.length-1];const o=[];s.forEach((e=>{e.users.forEach((e=>{this.allUsers.find((t=>t?._id===e))||-1!==o.indexOf(e)||o.push(e)}))})),this.updateAllUsers(o),s.forEach((e=>{const t={...e,users:[]};e.users.forEach((e=>{const n=this.allUsers.find((t=>t?._id===e));n&&t.users.push(n)})),this.addRoomToList(t)})),s.length||(this.loadingRooms=!1,this.roomsLoadedCount=0),this.listenRooms(e)},async updateAllUsers(e){const t=[];e.forEach((e=>{const n=E("7WLqg8jVGiDh0Wy8R8Un","user-auth-100");t.push(n)})),this.allUsers=[...this.allUsers,...await Promise.all(t)]},async addRoomToList(e){const t={...e,roomId:e.id,roomName:"",avatar:"",index:e.lastUpdated.seconds,lastMessage:{content:"Room created",timestamp:se(new Date(e.lastUpdated.seconds),e.lastUpdated)}},n=await S(t.roomId);let s="";n.data.forEach(function(e){e.id!==this.currentUserId&&(s+=(s?", ":"")+e.userName)}.bind(this)),t.roomName=s||"Empty",this.rooms=this.rooms.concat(t),this.listenLastMessage(t),this.listenUsersOnlineStatus(t)},async removeRoomFromList(e){const t=this;let n=-1;for(let s=0;s<t.rooms.length;s++)e===t.rooms[s].roomId&&(n=s);n<0||(t.rooms[n].deletedByUser=!0,t.rooms.splice(n,1),t.selectedRoom=null,t.resetMessages(),t.$root.$emit("on-room-delete"),t.roomsRef.doc(e).update({deleted:!0,updatedAt:firebase.firestore.FieldValue.delete()}),setTimeout(function(){t.roomsRef.doc(e).delete().then((function(){console.log("deleted")})).catch((function(e){console.log("error")}))}.bind(this),5e3))},listenLastMessage(e){const t=q(e.roomId,(t=>{t.forEach((t=>{const n=this.formatLastMessage(t,e),s=this.rooms.findIndex((t=>e.roomId===t.roomId));this.rooms[s].lastMessage=n,this.rooms=[...this.rooms]})),this.loadingLastMessageByRoom<this.rooms.length&&(this.loadingLastMessageByRoom++,this.loadingLastMessageByRoom===this.rooms.length&&(this.loadingRooms=!1,this.roomsLoadedCount=this.rooms.length))}));this.roomsListeners.push(t)},formatLastMessage(e,t){if(!e.timestamp)return;let n=e.content;if(e.files?.length){const t=e.files[0];n=`${t.name}.${t.extension||t.type}`}const s=e.sender_id!==this.currentUserId?t.users.find((t=>e.sender_id===t._id))?.username:"";return{...e,content:n,timestamp:se(new Date(1e3*e.timestamp.seconds),e.timestamp),username:s,distributed:!0,seen:e.sender_id===this.currentUserId?e.seen:null,new:!(e.sender_id===this.currentUserId||e.seen&&e.seen[this.currentUserId])}},fetchMessages({room:e,options:t={}}){this.$emit("show-demo-options",!1),t.reset&&(this.resetMessages(),this.roomId=e.roomId),!this.previousLastLoadedMessage||this.lastLoadedMessage?(this.selectedRoom=e.roomId,O(e.roomId,this.messagesPerPage,this.lastLoadedMessage).then((({data:n,docs:s})=>{this.selectedRoom===e.roomId&&((0===n.length||n.length<this.messagesPerPage)&&setTimeout((()=>this.messagesLoaded=!0),0),t.reset&&(this.messages=[]),n.forEach((t=>{const n=this.formatMessage(e,t);this.messages.unshift(n)})),this.lastLoadedMessage&&(this.previousLastLoadedMessage=this.lastLoadedMessage),this.lastLoadedMessage=s[s.length-1],this.listenMessages(e))}))):this.messagesLoaded=!0},listenMessages(e){const t=F(e.roomId,this.lastLoadedMessage,this.previousLastLoadedMessage,(t=>{t.forEach((t=>{const n=this.formatMessage(e,t),s=this.messages.findIndex((e=>e._id===t.id));-1===s?this.messages=this.messages.concat([n]):(this.messages[s]=n,this.messages=[...this.messages]),this.markMessagesSeen(e,t)}))}));this.listeners.push(t)},markMessagesSeen(e,t){t.sender_id===this.currentUserId||t.seen&&t.seen[this.currentUserId]||L(e.roomId,t.id,{[`seen.${this.currentUserId}`]:new Date})},formatMessage(e,t){const n={...t,senderId:t.sender_id,_id:t.id,seconds:t.timestamp.seconds,timestamp:ne(t.timestamp,"HH:mm"),date:ne(t.timestamp,"DD MMMM YYYY"),username:e.users.find((e=>t.sender_id===e._id))?.username,distributed:!0};return t.replyMessage&&(n.replyMessage={...t.replyMessage,senderId:t.replyMessage.sender_id}),n},async sendMessage({content:e,roomId:t,files:n,replyMessage:s}){const r={sender_id:this.currentUserId,content:e,timestamp:new Date};n&&(r.files=this.formattedFiles(n)),s&&(r.replyMessage={_id:s._id,content:s.content,sender_id:s.senderId},s.files&&(r.replyMessage.files=s.files));const{id:i}=await((e,t)=>v(B(e),t))(t,r);if(n)for(let e=0;e<n.length;e++)await this.uploadFile({file:n[e],messageId:i,roomId:t});let o=!1;if((await S(t)).data.forEach(function(e){e.userId===this.userData.userId&&e.typeOfUser===this.userData.typeOfUser&&(o=!0)}.bind(this)),o)M(t,{lastUpdated:new Date,lastMessage:e});else{R(t,this.currentUserId,this.userData);const n=await(e=>(console.log(e),g(I(e))))(t),s=[...n.users,this.currentUserId];M(t,{users:s,lastUpdated:new Date,lastMessage:e})}},async editMessage({messageId:e,newContent:t,roomId:n,files:s}){const r={edited:new Date};if(r.content=t,r.files=s?this.formattedFiles(s):p,await L(n,e,r),s)for(let t=0;t<s.length;t++)s[t]?.blob&&await this.uploadFile({file:s[t],messageId:e,roomId:n})},async deleteMessage({message:e,roomId:t}){await L(t,e._id,{deleted:new Date});const{files:n}=e;n&&n.forEach((t=>{$(this.currentUserId,e._id,t)}))},async uploadFile({file:e,messageId:t,roomId:n}){return new Promise((s=>{let r=e.extension||e.type;"svg"!==r&&"pdf"!==r||(r=e.type),K(this.currentUserId,t,e,r,(n=>{this.updateFileProgress(t,e.localUrl,n)}),(e=>{s(!1)}),(async r=>{const i=await((e,t)=>g(D(e,t)))(n,t);i.files.forEach((t=>{t.url===e.localUrl&&(t.url=r)})),await L(n,t,{files:i.files}),s(!0)}))}))},updateFileProgress(e,t,n){const s=this.messages.find((t=>t._id===e));s&&s.files&&(s.files.find((e=>e.url===t)).progress=n,this.messages=[...this.messages])},formattedFiles(e){const t=[];return e.forEach((e=>{const n={name:e.name,size:e.size,type:e.type,extension:e.extension||e.type,url:e.url||e.localUrl};e.audio&&(n.audio=!0,n.duration=e.duration),t.push(n)})),t},openFile({file:e}){window.open(e.file.url,"_blank")},async openUserTag({user:e}){let t;if(this.rooms.forEach((n=>{if(2===n.users.length){const s=n.users[0]._id,r=n.users[1]._id;s!==e._id&&s!==this.currentUserId||r!==e._id&&r!==this.currentUserId||(t=n.roomId)}})),t)return void(this.roomId=t);const n=await P(this.currentUserId,e._id);if(n.data.length)return this.loadRoom(n);const s=await P(e._id,this.currentUserId);if(s.data.length)return this.loadRoom(s);const r=e._id===this.currentUserId?[this.currentUserId]:[e._id,this.currentUserId],i=await A({users:r,lastUpdated:new Date});this.roomId=i.id,this.fetchRooms()},async loadRoom(e){e.forEach((async e=>{this.loadingRooms||(await M(e.id,{lastUpdated:new Date}),this.roomId=e.id,this.fetchRooms())}))},menuActionHandler({action:e,roomId:t}){switch(e.name){case"inviteUser":return this.inviteUser(t);case"removeUser":return this.removeUser(t);case"deleteRoom":return this.deleteRoom(t)}},messageSelectionActionHandler({action:e,messages:t,roomId:n}){if("deleteMessages"===e.name)t.forEach((e=>{this.deleteMessage({message:e,roomId:n})}))},async sendMessageReaction({reaction:e,remove:t,messageId:n,roomId:s}){((e,t,n,s,r)=>{const o="add"===r?(0,i.vr)(n):(0,i.Ab)(n);L(e,t,{[`reactions.${s}`]:o})})(s,n,this.currentUserId,e.unicode,t?"remove":"add")},typingMessage({message:e,roomId:t}){if(t){if(e?.length>1)return void(this.typingMessageCache=e);if(1===e?.length&&this.typingMessageCache)return void(this.typingMessageCache=e);this.typingMessageCache=e,((e,t,n)=>{const s="add"===n?(0,i.vr)(t):(0,i.Ab)(t);M(e,{typingUsers:s})})(t,this.currentUserId,e?"add":"remove")}},async listenRooms(e){const t=((e,t)=>m(e,(e=>{t(j(e))})))(e,(e=>{e.forEach((e=>{const t=this.rooms.find((t=>t.roomId===e.id));t?(t.typingUsers=e.typingUsers,t.index=e.lastUpdated.seconds):setTimeout((async()=>{const t=[];e.users.forEach((e=>{this.allUsers.find((t=>t?._id===e))||-1!==t.indexOf(e)||t.push(e)})),this.updateAllUsers(t);const n={...e,users:[]};e.users.forEach((e=>{const t=this.allUsers.find((t=>t?._id===e));t&&n.users.push(t)})),this.addRoomToList(n)}),0)}))}));this.roomsListeners.push(t)},listenUsersOnlineStatus(e){e.users.forEach((t=>{const n=J(ee(t._id),(n=>{if(!n||!n.val())return;const s=se(new Date(n.val().lastChanged),new Date(n.val().lastChanged));t.status={...n.val(),lastChanged:s};const r=this.rooms.findIndex((t=>e.roomId===t.roomId));this.rooms[r]=e,this.rooms=[...this.rooms]}));this.roomsListeners.push(n)}))},addRoom(){this.resetForms(),this.addNewRoom=!0},async createRoom(){this.disableForm=!0;let e=await A({users:[this.currentUserId],lastUpdated:new Date});e&&e.id&&await R(e.id,this.currentUserId,this.userData),this.addNewRoom=!1,this.addRoomUsername=""},inviteUser(e){this.resetForms(),this.inviteRoomId=e},async addRoomUser(){this.disableForm=!0;const{id:e}=await(t={username:this.invitedUsername},v(k,t));var t,n,s;await((e,t)=>y(x(e),t))(e,{_id:e}),await(n=this.inviteRoomId,s=e,M(n,{[d]:(0,i.vr)(s)})),this.inviteRoomId=null,this.invitedUsername="",this.fetchRooms()},removeUser(e){this.resetForms(),this.removeRoomId=e,this.removeUsers=this.rooms.find((t=>t.roomId===e)).users},async deleteRoomUser(){var e,t;this.disableForm=!0,await(e=this.removeRoomId,t=this.removeUserId,M(e,{[d]:(0,i.Ab)(t)})),this.removeRoomId=null,this.removeUserId="",this.fetchRooms()},async deleteRoom(e){Object.keys(this.archiveEndpoint).length?(this.isLoading=!0,this.request(this.archiveEndpoint,{document_id:e},function({data:e}){this.successNotify("Chat deleted successfully"),this.fetchRooms(),this.isLoading=!1}.bind(this),function({data:e}){this.errorNotify("Error happened while deleting"),this.isLoading=!1}.bind(this))):(O(e).then((({data:t})=>{t.forEach((t=>{V(e,t.id),t.files&&t.files.forEach((e=>{$(this.currentUserId,t.id,e)}))}))})),await N(e),this.fetchRooms())},resetForms(){this.disableForm=!1,this.addNewRoom=null,this.addRoomUsername="",this.inviteRoomId=null,this.invitedUsername="",this.removeRoomId=null,this.removeUserId=""}}};var Ko=n(84937),Go={insert:"head",singleton:!1};qo()(Ko.Z,Go);Ko.Z.locals;const Wo={components:{ChatContainer:(0,ue.Z)($o,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("chat-window"),c=(0,s.resolveComponent)("VLoader");return(0,s.openBlock)(),(0,s.createBlock)(c,{size:"small",active:i.isLoading},{default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["window-container",{"window-mobile":n.isDevice}])},[i.addNewRoom?((0,s.openBlock)(),(0,s.createElementBlock)("form",{key:0,onSubmit:t[2]||(t[2]=(0,s.withModifiers)(((...e)=>o.createRoom&&o.createRoom(...e)),["prevent"]))},[(0,s.withDirectives)((0,s.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.addRoomUsername=e),type:"text",placeholder:"Add username"},null,512),[[s.vModelText,i.addRoomUsername]]),(0,s.createElementVNode)("button",{type:"submit",disabled:i.disableForm||!i.addRoomUsername}," Create Room ",8,G),(0,s.createElementVNode)("button",{class:"button-cancel",onClick:t[1]||(t[1]=e=>i.addNewRoom=!1)}," Cancel ")],32)):(0,s.createCommentVNode)("",!0),i.inviteRoomId?((0,s.openBlock)(),(0,s.createElementBlock)("form",{key:1,onSubmit:t[5]||(t[5]=(0,s.withModifiers)(((...e)=>o.addRoomUser&&o.addRoomUser(...e)),["prevent"]))},[(0,s.withDirectives)((0,s.createElementVNode)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.invitedUsername=e),type:"text",placeholder:"Add username"},null,512),[[s.vModelText,i.invitedUsername]]),(0,s.createElementVNode)("button",{type:"submit",disabled:i.disableForm||!i.invitedUsername}," Add User ",8,W),(0,s.createElementVNode)("button",{class:"button-cancel",onClick:t[4]||(t[4]=e=>i.inviteRoomId=null)}," Cancel ")],32)):(0,s.createCommentVNode)("",!0),i.removeRoomId?((0,s.openBlock)(),(0,s.createElementBlock)("form",{key:2,onSubmit:t[8]||(t[8]=(0,s.withModifiers)(((...e)=>o.deleteRoomUser&&o.deleteRoomUser(...e)),["prevent"]))},[(0,s.withDirectives)((0,s.createElementVNode)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.removeUserId=e)},[Y,((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(i.removeUsers,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{key:e._id,value:e._id},(0,s.toDisplayString)(e.username),9,X)))),128))],512),[[s.vModelSelect,i.removeUserId]]),(0,s.createElementVNode)("button",{type:"submit",disabled:i.disableForm||!i.removeUserId}," Remove User ",8,Q),(0,s.createElementVNode)("button",{class:"button-cancel",onClick:t[7]||(t[7]=e=>i.removeRoomId=null)}," Cancel ")],32)):(0,s.createCommentVNode)("",!0),(0,s.createVNode)(a,{height:o.screenHeight,theme:n.theme,styles:i.styles,"current-user-id":n.currentUserId,"room-id":i.roomId,rooms:o.loadedRooms,"loading-rooms":i.loadingRooms,messages:i.messages,"messages-loaded":i.messagesLoaded,"rooms-loaded":i.roomsLoaded,"room-actions":i.roomActions,"menu-actions":i.menuActions,"message-selection-actions":i.messageSelectionActions,"room-message":i.roomMessage,"templates-text":i.templatesText,onFetchMoreRooms:o.fetchMoreRooms,onFetchMessages:o.fetchMessages,onSendMessage:o.sendMessage,onEditMessage:o.editMessage,onDeleteMessage:o.deleteMessage,onOpenFile:o.openFile,onOpenUserTag:o.openUserTag,onAddRoom:o.addRoom,onRoomActionHandler:o.menuActionHandler,onMenuActionHandler:o.menuActionHandler,onMessageSelectionActionHandler:o.messageSelectionActionHandler,onSendMessageReaction:o.sendMessageReaction,onTypingMessage:o.typingMessage,onToggleRoomsList:t[9]||(t[9]=t=>e.$emit("show-demo-options",t.opened))},null,8,["height","theme","styles","current-user-id","room-id","rooms","loading-rooms","messages","messages-loaded","rooms-loaded","room-actions","menu-actions","message-selection-actions","room-message","templates-text","onFetchMoreRooms","onFetchMessages","onSendMessage","onEditMessage","onDeleteMessage","onOpenFile","onOpenUserTag","onAddRoom","onRoomActionHandler","onMenuActionHandler","onMessageSelectionActionHandler","onSendMessageReaction","onTypingMessage"])],2)])),_:1},8,["active"])}],["__scopeId","data-v-26fe4b0c"]])},props:{currentUser:{type:String,required:!0},userData:{type:Object,required:!0}},data(){return{theme:"light",showChat:!0,users:[],currentUserId:this.currentUser??"",userData:this.userData??{},isDevice:!1,showDemoOptions:!0,updatingData:!1}},computed:{showOptions(){return!this.isDevice||this.showDemoOptions}},watch:{currentUserId(){this.showChat=!1,setTimeout((()=>this.showChat=!0),150)}},mounted(){this.isDevice=window.innerWidth<500,window.addEventListener("resize",(e=>{e.isTrusted&&(this.isDevice=window.innerWidth<500)}))},methods:{resetData(){f((0,i.IO)(C)).then((({data:e})=>{e.forEach((async e=>{await O(e.id).then((({data:t})=>{t.forEach((t=>{V(e.id,t.id),t.files&&t.files.forEach((e=>{$(this.currentUserId,t.id,e)}))}))})),N(e.id)}))})),f((0,i.IO)(k)).then((({data:e})=>{e.forEach((e=>{var t;t=e.id,w(o,t)}))}))},async addData(){this.updatingData=!0;const e=this.users[0];await T(e._id,e);const t=this.users[1];await T(t._id,t);const n=this.users[2];await T(n._id,n),await A({users:[e._id,t._id],lastUpdated:new Date}),await A({users:[e._id,n._id],lastUpdated:new Date}),await A({users:[t._id,n._id],lastUpdated:new Date}),await A({users:[e._id,t._id,n._id],lastUpdated:new Date}),this.updatingData=!1,location.reload()}}};var Yo=n(30692),Xo={insert:"head",singleton:!1};qo()(Yo.Z,Xo);Yo.Z.locals;const Qo=(0,ue.Z)(Wo,[["render",function(e,t,n,r,i,o){const a=(0,s.resolveComponent)("chat-container");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["app-container",{"app-mobile":i.isDevice,"app-mobile-dark":"dark"===i.theme}])},[i.showChat?((0,s.openBlock)(),(0,s.createBlock)(a,{key:0,"current-user-id":i.currentUserId,"user-data":i.userData,theme:i.theme,"is-device":i.isDevice,onShowDemoOptions:t[0]||(t[0]=e=>i.showDemoOptions=e)},null,8,["current-user-id","user-data","theme","is-device"])):(0,s.createCommentVNode)("",!0)],2)])}]])},25816:(e,t,n)=>{"use strict";n.d(t,{Jn:()=>L,qX:()=>P,Xd:()=>N,Mq:()=>F,ZF:()=>V,KN:()=>U});var s=n(8463),r=n(53333),i=n(74444);const o=(e,t)=>t.some((t=>e instanceof t));let a,c;const l=new WeakMap,h=new WeakMap,u=new WeakMap,d=new WeakMap,m=new WeakMap;let p={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return h.get(e);if("objectStoreNames"===t)return e.objectStoreNames||u.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return _(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(v(this),t),_(l.get(this))}:function(...t){return _(e.apply(v(this),t))}:function(t,...n){const s=e.call(v(this),t,...n);return u.set(s,t.sort?t.sort():[t]),_(s)}}function g(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(h.has(e))return;const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),s()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));h.set(e,t)}(e),o(e,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,p):e)}function _(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(_(e.result)),s()},i=()=>{n(e.error),s()};e.addEventListener("success",r),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&l.set(t,e)})).catch((()=>{})),m.set(t,e),t}(e);if(d.has(e))return d.get(e);const t=g(e);return t!==e&&(d.set(e,t),m.set(t,e)),t}const v=e=>m.get(e);const b=["get","getKey","getAll","getAllKeys","count"],y=["put","add","delete","clear"],w=new Map;function k(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,r=y.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!r&&!b.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let o=i.store;return s&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&i.done]))[0]};return w.set(t,i),i}p=(e=>({...e,get:(t,n,s)=>k(t,n)||e.get(t,n,s),has:(t,n)=>!!k(t,n)||e.has(t,n)}))(p);class x{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const E="@firebase/app",S="0.9.13",T=new r.Yd("@firebase/app"),C="[DEFAULT]",I={[E]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},R=new Map,A=new Map;function M(e,t){try{e.container.addComponent(t)}catch(n){T.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function N(e){const t=e.name;if(A.has(t))return T.debug(`There were multiple attempts to register component ${t}.`),!1;A.set(t,e);for(const t of R.values())M(t,e);return!0}function P(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const B={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},D=new i.LL("app","Firebase",B);class O{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new s.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw D.create("app-deleted",{appName:this._name})}}const L="9.23.0";function V(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const r=Object.assign({name:C,automaticDataCollectionEnabled:!1},t),o=r.name;if("string"!=typeof o||!o)throw D.create("bad-app-name",{appName:String(o)});if(n||(n=(0,i.aH)()),!n)throw D.create("no-options");const a=R.get(o);if(a){if((0,i.vZ)(n,a.options)&&(0,i.vZ)(r,a.config))return a;throw D.create("duplicate-app",{appName:o})}const c=new s.H0(o);for(const e of A.values())c.addComponent(e);const l=new O(n,r,c);return R.set(o,l),l}function F(e=C){const t=R.get(e);if(!t&&e===C&&(0,i.aH)())return V();if(!t)throw D.create("no-app",{appName:e});return t}function U(e,t,n){var r;let i=null!==(r=I[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const o=i.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${i}" with version "${t}":`];return o&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void T.warn(e.join(" "))}N(new s.wA(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const j="firebase-heartbeat-database",q=1,H="firebase-heartbeat-store";let z=null;function $(){return z||(z=function(e,t,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(e,t),a=_(o);return s&&o.addEventListener("upgradeneeded",(e=>{s(_(o.result),e.oldVersion,e.newVersion,_(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(j,q,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(H)}}).catch((e=>{throw D.create("idb-open",{originalErrorMessage:e.message})}))),z}async function K(e,t){try{const n=(await $()).transaction(H,"readwrite"),s=n.objectStore(H);await s.put(t,G(e)),await n.done}catch(e){if(e instanceof i.ZR)T.warn(e.message);else{const t=D.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});T.warn(t.message)}}}function G(e){return`${e.name}!${e.options.appId}`}class W{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new X(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Y();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Y(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let s=e.slice();for(const r of e){const e=n.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),Q(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Q(n)>t){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),s=(0,i.L)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function Y(){return(new Date).toISOString().substring(0,10)}class X{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,i.hl)()&&(0,i.eu)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){return await async function(e){try{const t=await $();return await t.transaction(H).objectStore(H).get(G(e))}catch(e){if(e instanceof i.ZR)T.warn(e.message);else{const t=D.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});T.warn(t.message)}}}(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return K(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return K(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Q(e){return(0,i.L)(JSON.stringify({version:2,heartbeats:e})).length}var Z;Z="",N(new s.wA("platform-logger",(e=>new x(e)),"PRIVATE")),N(new s.wA("heartbeat",(e=>new W(e)),"PRIVATE")),U(E,S,Z),U(E,S,"esm2017"),U("fire-js","")},8463:(e,t,n)=>{"use strict";n.d(t,{H0:()=>a,wA:()=>r});var s=n(74444);class r{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const i="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new s.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),s=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(s)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:i})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=i){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=i){return this.instances.has(e)}getOptions(e=i){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(s)}return s}onInit(e,t){var n;const s=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(s))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=e,s===i?void 0:s),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var s;return n||null}normalizeInstanceIdentifier(e=i){return this.component?this.component.multipleInstances?e:i:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},53333:(e,t,n)=>{"use strict";n.d(t,{Yd:()=>l,in:()=>r});const s=[];var r;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));const i={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},o=r.INFO,a={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const s=(new Date).toISOString(),r=a[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${s}]  ${e.name}:`,...n)};class l{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,s.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?i[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}},83977:(e,t,n)=>{"use strict";n.d(t,{ZF:()=>s.ZF});var s=n(25816);(0,s.KN)("firebase","9.23.0","app")},89355:(e,t,n)=>{"use strict";n.d(t,{N8:()=>$r,ae:()=>Br,jM:()=>Fr,iH:()=>Nr,Bt:()=>Gr,t8:()=>Dr});var s=n(25816),r=n(8463),i=n(74444),o=n(53333),a=n(34155);const c="@firebase/database",l="0.14.4";let h="";class u{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,i.Wl)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,i.cI)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class d{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,i.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const m=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new u(t)}}catch(e){}return new d},p=m("localStorage"),f=m("sessionStorage"),g=new o.Yd("@firebase/database"),_=function(){let e=1;return function(){return e++}}(),v=function(e){const t=(0,i.dS)(e),n=new i.gQ;n.update(t);const s=n.digest();return i.US.encodeByteArray(s)},b=function(...e){let t="";for(let n=0;n<e.length;n++){const s=e[n];Array.isArray(s)||s&&"object"==typeof s&&"number"==typeof s.length?t+=b.apply(null,s):t+="object"==typeof s?(0,i.Wl)(s):s,t+=" "}return t};let y=null,w=!0;const k=function(e,t){(0,i.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(g.logLevel=o.in.VERBOSE,y=g.log.bind(g),t&&f.set("logging_enabled",!0)):"function"==typeof e?y=e:(y=null,f.remove("logging_enabled"))},x=function(...e){if(!0===w&&(w=!1,null===y&&!0===f.get("logging_enabled")&&k(!0)),y){const t=b.apply(null,e);y(t)}},E=function(e){return function(...t){x(e,...t)}},S=function(...e){const t="FIREBASE INTERNAL ERROR: "+b(...e);g.error(t)},T=function(...e){const t=`FIREBASE FATAL ERROR: ${b(...e)}`;throw g.error(t),new Error(t)},C=function(...e){const t="FIREBASE WARNING: "+b(...e);g.warn(t)},I=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},R="[MIN_NAME]",A="[MAX_NAME]",M=function(e,t){if(e===t)return 0;if(e===R||t===A)return-1;if(t===R||e===A)return 1;{const n=F(e),s=F(t);return null!==n?null!==s?n-s==0?e.length-t.length:n-s:-1:null!==s?1:e<t?-1:1}},N=function(e,t){return e===t?0:e<t?-1:1},P=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+(0,i.Wl)(t))},B=function(e){if("object"!=typeof e||null===e)return(0,i.Wl)(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let s=0;s<t.length;s++)0!==s&&(n+=","),n+=(0,i.Wl)(t[s]),n+=":",n+=B(e[t[s]]);return n+="}",n},D=function(e,t){const n=e.length;if(n<=t)return[e];const s=[];for(let r=0;r<n;r+=t)r+t>n?s.push(e.substring(r,n)):s.push(e.substring(r,r+t));return s};function O(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const L=function(e){(0,i.hu)(!I(e),"Invalid JSON number");const t=1023;let n,s,r,o,a;0===e?(s=0,r=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),s=o+t,r=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(s=0,r=Math.round(e/Math.pow(2,-1074))));const c=[];for(a=52;a;a-=1)c.push(r%2?1:0),r=Math.floor(r/2);for(a=11;a;a-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(n?1:0),c.reverse();const l=c.join("");let h="";for(a=0;a<64;a+=8){let e=parseInt(l.substr(a,8),2).toString(16);1===e.length&&(e="0"+e),h+=e}return h.toLowerCase()};const V=new RegExp("^-?(0*)\\d{1,10}$"),F=function(e){if(V.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},U=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw C("Exception was thrown by user callback.",t),e}),Math.floor(0))}},j=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class q{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){C(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class H{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(x("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',C(e)}}class z{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}z.OWNER="owner";const $="5",K=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,G="ac",W="websocket",Y="long_polling";class X{constructor(e,t,n,s,r=!1,i="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=p.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&p.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Q(e,t,n){let s;if((0,i.hu)("string"==typeof t,"typeof type must == string"),(0,i.hu)("object"==typeof n,"typeof params must == object"),t===W)s=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Y)throw new Error("Unknown connection type: "+t);s=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const r=[];return O(n,((e,t)=>{r.push(e+"="+t)})),s+r.join("&")}class Z{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,i.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,i.p$)(this.counters_)}}const J={},ee={};function te(e){const t=e.toString();return J[t]||(J[t]=new Z),J[t]}class ne{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&U((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const se="start";class re{constructor(e,t,n,s,r,i,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=s,this.authToken=r,this.transportSessionId=i,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=E(e),this.stats_=te(t),this.urlFn=e=>(this.appCheckToken&&(e[G]=this.appCheckToken),Q(t,Y,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ne(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if((0,i.Yr)()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new ie(((...e)=>{const[t,n,s,r,i]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===se)this.id=n,this.password=s;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[se]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=$,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[G]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&K.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){re.forceAllow_=!0}static forceDisallow(){re.forceDisallow_=!0}static isAvailable(){return!(0,i.Yr)()&&(!!re.forceAllow_||!(re.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=(0,i.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=(0,i.h$)(t),s=D(n,1840);for(let e=0;e<s.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,i.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=(0,i.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class ie{constructor(e,t,n,s){if(this.onDisconnect=n,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,i.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=_(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=ie.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const s="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(e){x("frame writing exception"),e.stack&&x(e.stack),x(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||x("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",s=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+s+"="+e.seg+"&ts"+s+"="+e.ts+"&d"+s+"="+e.d,s++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(s),n()}))}addTag(e,t){(0,i.Yr)()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{x("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let oe=null;"undefined"!=typeof MozWebSocket?oe=MozWebSocket:"undefined"!=typeof WebSocket&&(oe=WebSocket);class ae{constructor(e,t,n,s,r,i,o){this.connId=e,this.applicationId=n,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=E(this.connId),this.stats_=te(t),this.connURL=ae.connectionURL_(t,i,o,s,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,s,r){const o={};return o.v=$,!(0,i.Yr)()&&"undefined"!=typeof location&&location.hostname&&K.test(location.hostname)&&(o.r="f"),t&&(o.s=t),n&&(o.ls=n),s&&(o[G]=s),r&&(o.p=r),Q(e,W,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,p.set("previous_websocket_failure",!0);try{let e;if((0,i.Yr)()){const t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/${$}/${h}/${a.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n=a.env,s=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;s&&(e.proxy={origin:s})}this.mySock=new oe(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ae.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==oe&&!ae.forceDisallow_}static previouslyFailed(){return p.isInMemoryStorage||!0===p.get("previous_websocket_failure")}markConnectionHealthy(){p.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=(0,i.cI)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,i.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=(0,i.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=D(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ae.responsesRequiredToBeHealthy=2,ae.healthyTimeout=3e4;class ce{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[re,ae]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=ae&&ae.isAvailable();let n=t&&!ae.previouslyFailed();if(e.webSocketOnly&&(t||C("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ae];else{const e=this.transports_=[];for(const t of ce.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);ce.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ce.globalTransportInitialized_=!1;class le{constructor(e,t,n,s,r,i,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=i,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=E("c:"+this.id+":"),this.transportManager_=new ce(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=j((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=P("t",e),n=P("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=P("t",e),n=P("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=P("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?S("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):S("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),$!==n&&C("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),j((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):j((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(p.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class he{put(e,t,n,s){}merge(e,t,n,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class ue{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,i.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const s=this.getInitialEvent(e);s&&t.apply(n,s)}off(e,t,n){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let e=0;e<s.length;e++)if(s[e].callback===t&&(!n||n===s[e].context))return void s.splice(e,1)}validateEventType_(e){(0,i.hu)(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class de extends ue{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,i.uI)()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new de}getInitialEvent(e){return(0,i.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const me=32,pe=768;class fe{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function ge(){return new fe("")}function _e(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function ve(e){return e.pieces_.length-e.pieceNum_}function be(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new fe(e.pieces_,t)}function ye(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function we(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function ke(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new fe(t,0)}function xe(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof fe)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new fe(n,0)}function Ee(e){return e.pieceNum_>=e.pieces_.length}function Se(e,t){const n=_e(e),s=_e(t);if(null===n)return t;if(n===s)return Se(be(e),be(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Te(e,t){const n=we(e,0),s=we(t,0);for(let e=0;e<n.length&&e<s.length;e++){const t=M(n[e],s[e]);if(0!==t)return t}return n.length===s.length?0:n.length<s.length?-1:1}function Ce(e,t){if(ve(e)!==ve(t))return!1;for(let n=e.pieceNum_,s=t.pieceNum_;n<=e.pieces_.length;n++,s++)if(e.pieces_[n]!==t.pieces_[s])return!1;return!0}function Ie(e,t){let n=e.pieceNum_,s=t.pieceNum_;if(ve(e)>ve(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[s])return!1;++n,++s}return!0}class Re{constructor(e,t){this.errorPrefix_=t,this.parts_=we(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=(0,i.ug)(this.parts_[e]);Ae(this)}}function Ae(e){if(e.byteLength_>pe)throw new Error(e.errorPrefix_+"has a key path longer than "+pe+" bytes ("+e.byteLength_+").");if(e.parts_.length>me)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+me+") or object contains a cycle "+Me(e))}function Me(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Ne extends ue{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Ne}getInitialEvent(e){return(0,i.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Pe=1e3;class Be extends he{constructor(e,t,n,s,r,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Be.nextPersistentConnectionId_++,this.log_=E("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Pe,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!(0,i.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ne.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&de.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const s=++this.requestNumber_,r={r:s,a:e,b:t};this.log_((0,i.Wl)(r)),(0,i.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[s]=n)}get(e){this.initConnection_();const t=new i.BH,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),t.promise}listen(e,t,n,s){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),(0,i.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,i.hu)(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:n};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+n+" for "+s);const r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,(r=>{const i=r.d,o=r.s;Be.warnOnListenWarnings_(i,t);(this.listens.get(n)&&this.listens.get(n).get(s))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,s),e.onComplete&&e.onComplete(o,i))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&(0,i.r3)(e,"w")){const n=(0,i.DV)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();C(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,i.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=(0,i.w9)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,s=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,s))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+s),(0,i.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,s)&&this.connected_&&this.sendUnlisten_(n,s,e._queryObject,t)}sendUnlisten_(e,t,n,s){this.log_("Unlisten on "+e+" for "+t);const r={p:e};s&&(r.q=n,r.t=s),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,s){const r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{s&&setTimeout((()=>{s(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,s){this.putInternal("p",e,t,n,s)}merge(e,t,n,s){this.putInternal("m",e,t,n,s)}putInternal(e,t,n,s,r){this.initConnection_();const i={p:t,d:n};void 0!==r&&(i.h=r),this.outstandingPuts_.push({action:e,request:i,onComplete:s}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),s&&s(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,i.Wl)(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):S("Unrecognized action received from server: "+(0,i.Wl)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,i.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Pe,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Pe,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Pe),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Be.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,n())},l=function(e){(0,i.hu)(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:c,sendRequest:l};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[i,c]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?x("getToken() completed but was canceled"):(x("getToken() completed. Creating connection."),this.authToken_=i&&i.accessToken,this.appCheckToken_=c&&c.token,a=new le(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{C(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),r))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&C(e),c())}}}interrupt(e){x("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){x("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,i.xb)(this.interruptReasons_)&&(this.reconnectDelay_=Pe,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>B(e))).join("$"):"default";const s=this.removeListen_(e,n);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const n=new fe(e).toString();let s;if(this.listens.has(n)){const e=this.listens.get(n);s=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else s=void 0;return s}onAuthRevoked_(e,t){x("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){x("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";(0,i.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+h.replace(/\./g,"-")]=1,(0,i.uI)()?e["framework.cordova"]=1:(0,i.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=de.getInstance().currentlyOnline();return(0,i.xb)(this.interruptReasons_)&&e}}Be.nextPersistentConnectionId_=0,Be.nextConnectionId_=0;class De{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new De(e,t)}}class Oe{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new De(R,e),s=new De(R,t);return 0!==this.compare(n,s)}minPost(){return De.MIN}}let Le;class Ve extends Oe{static get __EMPTY_NODE(){return Le}static set __EMPTY_NODE(e){Le=e}compare(e,t){return M(e.name,t.name)}isDefinedOn(e){throw(0,i.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return De.MIN}maxPost(){return new De(A,Le)}makePost(e,t){return(0,i.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new De(e,Le)}toString(){return".key"}}const Fe=new Ve;class Ue{constructor(e,t,n,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,s&&(i*=-1),i<0)e=this.isReverse_?e.left:e.right;else{if(0===i){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class je{constructor(e,t,n,s,r){this.key=e,this.value=t,this.color=null!=n?n:je.RED,this.left=null!=s?s:qe.EMPTY_NODE,this.right=null!=r?r:qe.EMPTY_NODE}copy(e,t,n,s,r){return new je(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const r=n(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===r?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return qe.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,s;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return qe.EMPTY_NODE;s=n.right.min_(),n=n.copy(s.key,s.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,je.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,je.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}je.RED=!0,je.BLACK=!1;class qe{constructor(e,t=qe.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new qe(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,je.BLACK,null,null))}remove(e){return new qe(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,je.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,s=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return s?s.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(s=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ue(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ue(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ue(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ue(this.root_,null,this.comparator_,!0,e)}}function He(e,t){return M(e.name,t.name)}function ze(e,t){return M(e,t)}let $e;qe.EMPTY_NODE=new class{copy(e,t,n,s,r){return this}insert(e,t,n){return new je(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Ke=function(e){return"number"==typeof e?"number:"+L(e):"string:"+e},Ge=function(e){if(e.isLeafNode()){const t=e.val();(0,i.hu)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,i.r3)(t,".sv"),"Priority must be a string or number.")}else(0,i.hu)(e===$e||e.isEmpty(),"priority of unexpected type.");(0,i.hu)(e===$e||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let We,Ye,Xe;class Qe{constructor(e,t=Qe.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,(0,i.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ge(this.priorityNode_)}static set __childrenNodeConstructor(e){We=e}static get __childrenNodeConstructor(){return We}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Qe(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Qe.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ee(e)?this:".priority"===_e(e)?this.priorityNode_:Qe.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Qe.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=_e(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:((0,i.hu)(".priority"!==n||1===ve(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Qe.__childrenNodeConstructor.EMPTY_NODE.updateChild(be(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Ke(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?L(this.value_):this.value_,this.lazyHash_=v(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Qe.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Qe.__childrenNodeConstructor?-1:((0,i.hu)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,s=Qe.VALUE_TYPE_ORDER.indexOf(t),r=Qe.VALUE_TYPE_ORDER.indexOf(n);return(0,i.hu)(s>=0,"Unknown leaf type: "+t),(0,i.hu)(r>=0,"Unknown leaf type: "+n),s===r?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Qe.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Ze=new class extends Oe{compare(e,t){const n=e.node.getPriority(),s=t.node.getPriority(),r=n.compareTo(s);return 0===r?M(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return De.MIN}maxPost(){return new De(A,new Qe("[PRIORITY-POST]",Xe))}makePost(e,t){const n=Ye(e);return new De(t,new Qe("[PRIORITY-POST]",n))}toString(){return".priority"}},Je=Math.log(2);class et{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Je,10)),this.current_=this.count-1;const n=(s=this.count,parseInt(Array(s+1).join("1"),2));var s;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const tt=function(e,t,n,s){e.sort(t);const r=function(t,s){const i=s-t;let o,a;if(0===i)return null;if(1===i)return o=e[t],a=n?n(o):o,new je(a,o.node,je.BLACK,null,null);{const c=parseInt(i/2,10)+t,l=r(t,c),h=r(c+1,s);return o=e[c],a=n?n(o):o,new je(a,o.node,je.BLACK,l,h)}},i=function(t){let s=null,i=null,o=e.length;const a=function(t,s){const i=o-t,a=o;o-=t;const l=r(i+1,a),h=e[i],u=n?n(h):h;c(new je(u,h.node,s,null,l))},c=function(e){s?(s.left=e,s=e):(i=e,s=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),s=Math.pow(2,t.count-(e+1));n?a(s,je.BLACK):(a(s,je.BLACK),a(s,je.RED))}return i}(new et(e.length));return new qe(s||t,i)};let nt;const st={};class rt{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,i.hu)(st&&Ze,"ChildrenNode.ts has not been loaded"),nt=nt||new rt({".priority":st},{".priority":Ze}),nt}get(e){const t=(0,i.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof qe?t:null}hasIndex(e){return(0,i.r3)(this.indexSet_,e.toString())}addIndex(e,t){(0,i.hu)(e!==Fe,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let s=!1;const r=t.getIterator(De.Wrap);let o,a=r.getNext();for(;a;)s=s||e.isDefinedOn(a.node),n.push(a),a=r.getNext();o=s?tt(n,e.getCompare()):st;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const h=Object.assign({},this.indexes_);return h[c]=o,new rt(h,l)}addToIndexes(e,t){const n=(0,i.UI)(this.indexes_,((n,s)=>{const r=(0,i.DV)(this.indexSet_,s);if((0,i.hu)(r,"Missing index implementation for "+s),n===st){if(r.isDefinedOn(e.node)){const n=[],s=t.getIterator(De.Wrap);let i=s.getNext();for(;i;)i.name!==e.name&&n.push(i),i=s.getNext();return n.push(e),tt(n,r.getCompare())}return st}{const s=t.get(e.name);let r=n;return s&&(r=r.remove(new De(e.name,s))),r.insert(e,e.node)}}));return new rt(n,this.indexSet_)}removeFromIndexes(e,t){const n=(0,i.UI)(this.indexes_,(n=>{if(n===st)return n;{const s=t.get(e.name);return s?n.remove(new De(e.name,s)):n}}));return new rt(n,this.indexSet_)}}let it;class ot{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ge(this.priorityNode_),this.children_.isEmpty()&&(0,i.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return it||(it=new ot(new qe(ze),null,rt.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||it}updatePriority(e){return this.children_.isEmpty()?this:new ot(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?it:t}}getChild(e){const t=_e(e);return null===t?this:this.getImmediateChild(t).getChild(be(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if((0,i.hu)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new De(e,t);let s,r;t.isEmpty()?(s=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(s=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(n,this.children_));const i=s.isEmpty()?it:this.priorityNode_;return new ot(s,i,r)}}updateChild(e,t){const n=_e(e);if(null===n)return t;{(0,i.hu)(".priority"!==_e(e)||1===ve(e),".priority must be the last token in a path");const s=this.getImmediateChild(n).updateChild(be(e),t);return this.updateImmediateChild(n,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,s=0,r=!0;if(this.forEachChild(Ze,((i,o)=>{t[i]=o.val(e),n++,r&&ot.INTEGER_REGEXP_.test(i)?s=Math.max(s,Number(i)):r=!1})),!e&&r&&s<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Ke(this.getPriority().val())+":"),this.forEachChild(Ze,((t,n)=>{const s=n.hash();""!==s&&(e+=":"+t+":"+s)})),this.lazyHash_=""===e?"":v(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const s=this.resolveIndex_(n);if(s){const n=s.getPredecessorKey(new De(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new De(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new De(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,De.Wrap);let s=n.peek();for(;null!=s&&t.compare(s,e)<0;)n.getNext(),s=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,De.Wrap);let s=n.peek();for(;null!=s&&t.compare(s,e)>0;)n.getNext(),s=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===at?-1:0}withIndex(e){if(e===Fe||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ot(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Fe||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Ze),n=t.getIterator(Ze);let s=e.getNext(),r=n.getNext();for(;s&&r;){if(s.name!==r.name||!s.node.equals(r.node))return!1;s=e.getNext(),r=n.getNext()}return null===s&&null===r}return!1}return!1}}resolveIndex_(e){return e===Fe?null:this.indexMap_.get(e.toString())}}ot.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const at=new class extends ot{constructor(){super(new qe(ze),ot.EMPTY_NODE,rt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ot.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(De,{MIN:{value:new De(R,ot.EMPTY_NODE)},MAX:{value:new De(A,at)}}),Ve.__EMPTY_NODE=ot.EMPTY_NODE,Qe.__childrenNodeConstructor=ot,$e=at,function(e){Xe=e}(at);const ct=!0;function lt(e,t=null){if(null===e)return ot.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),(0,i.hu)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new Qe(e,lt(t))}if(e instanceof Array||!ct){let n=ot.EMPTY_NODE;return O(e,((t,s)=>{if((0,i.r3)(e,t)&&"."!==t.substring(0,1)){const e=lt(s);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(lt(t))}{const n=[];let s=!1;if(O(e,((e,t)=>{if("."!==e.substring(0,1)){const r=lt(t);r.isEmpty()||(s=s||!r.getPriority().isEmpty(),n.push(new De(e,r)))}})),0===n.length)return ot.EMPTY_NODE;const r=tt(n,He,(e=>e.name),ze);if(s){const e=tt(n,Ze.getCompare());return new ot(r,lt(t),new rt({".priority":e},{".priority":Ze}))}return new ot(r,lt(t),rt.Default)}}!function(e){Ye=e}(lt);class ht extends Oe{constructor(e){super(),this.indexPath_=e,(0,i.hu)(!Ee(e)&&".priority"!==_e(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),s=this.extractChild(t.node),r=n.compareTo(s);return 0===r?M(e.name,t.name):r}makePost(e,t){const n=lt(e),s=ot.EMPTY_NODE.updateChild(this.indexPath_,n);return new De(t,s)}maxPost(){const e=ot.EMPTY_NODE.updateChild(this.indexPath_,at);return new De(A,e)}toString(){return we(this.indexPath_,0).join("/")}}const ut=new class extends Oe{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?M(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return De.MIN}maxPost(){return De.MAX}makePost(e,t){const n=lt(e);return new De(t,n)}toString(){return".value"}};function dt(e){return{type:"value",snapshotNode:e}}function mt(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function pt(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function ft(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class gt{constructor(e){this.index_=e}updateChild(e,t,n,s,r,o){(0,i.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(n.getChild(s))&&a.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(pt(t,a)):(0,i.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(mt(t,n)):o.trackChildChange(ft(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Ze,((e,s)=>{t.hasChild(e)||n.trackChildChange(pt(e,s))})),t.isLeafNode()||t.forEachChild(Ze,((t,s)=>{if(e.hasChild(t)){const r=e.getImmediateChild(t);r.equals(s)||n.trackChildChange(ft(t,s,r))}else n.trackChildChange(mt(t,s))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ot.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class _t{constructor(e){this.indexedFilter_=new gt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=_t.getStartPost_(e),this.endPost_=_t.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,s,r,i){return this.matches(new De(t,n))||(n=ot.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,s,r,i)}updateFullNode(e,t,n){t.isLeafNode()&&(t=ot.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(ot.EMPTY_NODE);const r=this;return t.forEachChild(Ze,((e,t)=>{r.matches(new De(e,t))||(s=s.updateImmediateChild(e,ot.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,s,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class vt{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new _t(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,s,r,i){return this.rangedFilter_.matches(new De(t,n))||(n=ot.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,s,r,i):this.fullLimitUpdateChild_(e,t,n,r,i)}updateFullNode(e,t,n){let s;if(t.isLeafNode()||t.isEmpty())s=ot.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;s=ot.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;s=s.updateImmediateChild(t.name,t.node),n++}}}else{let e;s=t.withIndex(this.index_),s=s.updatePriority(ot.EMPTY_NODE),e=this.reverse_?s.getReverseIterator(this.index_):s.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:s=s.updateImmediateChild(t.name,ot.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,s,r){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=e;(0,i.hu)(a.numChildren()===this.limit_,"");const c=new De(t,n),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(t)){const e=a.getImmediateChild(t);let i=s.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=i&&(i.name===t||a.hasChild(i.name));)i=s.getChildAfterChild(this.index_,i,this.reverse_);const u=null==i?1:o(i,c);if(h&&!n.isEmpty()&&u>=0)return null!=r&&r.trackChildChange(ft(t,n,e)),a.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(pt(t,e));const n=a.updateImmediateChild(t,ot.EMPTY_NODE);return null!=i&&this.rangedFilter_.matches(i)?(null!=r&&r.trackChildChange(mt(i.name,i.node)),n.updateImmediateChild(i.name,i.node)):n}}return n.isEmpty()?e:h&&o(l,c)>=0?(null!=r&&(r.trackChildChange(pt(l.name,l.node)),r.trackChildChange(mt(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(l.name,ot.EMPTY_NODE)):e}}class bt{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ze}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,i.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,i.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:R}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,i.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,i.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:A}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,i.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ze}copy(){const e=new bt;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function yt(e){const t={};if(e.isDefault())return t;let n;if(e.index_===Ze?n="$priority":e.index_===ut?n="$value":e.index_===Fe?n="$key":((0,i.hu)(e.index_ instanceof ht,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=(0,i.Wl)(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=(0,i.Wl)(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+(0,i.Wl)(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=(0,i.Wl)(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+(0,i.Wl)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function wt(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Ze&&(t.i=e.index_.toString()),t}class kt extends he{constructor(e,t,n,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=s,this.log_=E("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,i.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=kt.getListenId_(e,n),a={};this.listens_[o]=a;const c=yt(e._queryParams);this.restRequest_(r+".json",c,((e,t)=>{let c=t;if(404===e&&(c=null,e=null),null===e&&this.onDataUpdate_(r,c,!1,n),(0,i.DV)(this.listens_,o)===a){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",s(t,null)}}))}unlisten(e,t){const n=kt.getListenId_(e,t);delete this.listens_[n]}get(e){const t=yt(e._queryParams),n=e._path.toString(),s=new i.BH;return this.restRequest_(n+".json",t,((e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),s.resolve(r)):s.reject(new Error(r))})),s.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,i.xO)(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let e=null;if(a.status>=200&&a.status<300){try{e=(0,i.cI)(a.responseText)}catch(e){C("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,e)}else 401!==a.status&&404!==a.status&&C("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()}))}}class xt{constructor(){this.rootNode_=ot.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Et(){return{value:null,children:new Map}}function St(e,t,n){if(Ee(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const s=_e(t);e.children.has(s)||e.children.set(s,Et());St(e.children.get(s),t=be(t),n)}}function Tt(e,t){if(Ee(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(Ze,((t,n)=>{St(e,new fe(t),n)})),Tt(e,t)}}if(e.children.size>0){const n=_e(t);if(t=be(t),e.children.has(n)){Tt(e.children.get(n),t)&&e.children.delete(n)}return 0===e.children.size}return!0}function Ct(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,s)=>{Ct(s,new fe(t.toString()+"/"+e),n)}))}class It{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&O(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Rt{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new It(e);const n=1e4+2e4*Math.random();j(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;O(e,((e,s)=>{s>0&&(0,i.r3)(this.statsToReport_,e)&&(t[e]=s,n=!0)})),n&&this.server_.reportStats(t),j(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var At;function Mt(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(At||(At={}));class Nt{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=At.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Ee(this.path)){if(null!=this.affectedTree.value)return(0,i.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new fe(e));return new Nt(ge(),t,this.revert)}}return(0,i.hu)(_e(this.path)===e,"operationForChild called for unrelated child."),new Nt(be(this.path),this.affectedTree,this.revert)}}class Pt{constructor(e,t){this.source=e,this.path=t,this.type=At.LISTEN_COMPLETE}operationForChild(e){return Ee(this.path)?new Pt(this.source,ge()):new Pt(this.source,be(this.path))}}class Bt{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=At.OVERWRITE}operationForChild(e){return Ee(this.path)?new Bt(this.source,ge(),this.snap.getImmediateChild(e)):new Bt(this.source,be(this.path),this.snap)}}class Dt{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=At.MERGE}operationForChild(e){if(Ee(this.path)){const t=this.children.subtree(new fe(e));return t.isEmpty()?null:t.value?new Bt(this.source,ge(),t.value):new Dt(this.source,ge(),t)}return(0,i.hu)(_e(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Dt(this.source,be(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Ot{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ee(e))return this.isFullyInitialized()&&!this.filtered_;const t=_e(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Lt{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Vt(e,t,n,s,r,o){const a=s.filter((e=>e.type===n));a.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw(0,i.g5)("Should only compare child_ events.");const s=new De(t.childName,t.snapshotNode),r=new De(n.childName,n.snapshotNode);return e.index_.compare(s,r)}(e,t,n))),a.forEach((n=>{const s=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);r.forEach((r=>{r.respondsTo(n.type)&&t.push(r.createEvent(s,e.query_))}))}))}function Ft(e,t){return{eventCache:e,serverCache:t}}function Ut(e,t,n,s){return Ft(new Ot(t,n,s),e.serverCache)}function jt(e,t,n,s){return Ft(e.eventCache,new Ot(t,n,s))}function qt(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Ht(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let zt;class $t{constructor(e,t=(()=>(zt||(zt=new qe(N)),zt))()){this.value=e,this.children=t}static fromObject(e){let t=new $t(null);return O(e,((e,n)=>{t=t.set(new fe(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:ge(),value:this.value};if(Ee(e))return null;{const n=_e(e),s=this.children.get(n);if(null!==s){const r=s.findRootMostMatchingPathAndValue(be(e),t);if(null!=r){return{path:xe(new fe(n),r.path),value:r.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Ee(e))return this;{const t=_e(e),n=this.children.get(t);return null!==n?n.subtree(be(e)):new $t(null)}}set(e,t){if(Ee(e))return new $t(t,this.children);{const n=_e(e),s=(this.children.get(n)||new $t(null)).set(be(e),t),r=this.children.insert(n,s);return new $t(this.value,r)}}remove(e){if(Ee(e))return this.children.isEmpty()?new $t(null):new $t(null,this.children);{const t=_e(e),n=this.children.get(t);if(n){const s=n.remove(be(e));let r;return r=s.isEmpty()?this.children.remove(t):this.children.insert(t,s),null===this.value&&r.isEmpty()?new $t(null):new $t(this.value,r)}return this}}get(e){if(Ee(e))return this.value;{const t=_e(e),n=this.children.get(t);return n?n.get(be(e)):null}}setTree(e,t){if(Ee(e))return t;{const n=_e(e),s=(this.children.get(n)||new $t(null)).setTree(be(e),t);let r;return r=s.isEmpty()?this.children.remove(n):this.children.insert(n,s),new $t(this.value,r)}}fold(e){return this.fold_(ge(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((s,r)=>{n[s]=r.fold_(xe(e,s),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,ge(),t)}findOnPath_(e,t,n){const s=!!this.value&&n(t,this.value);if(s)return s;if(Ee(e))return null;{const s=_e(e),r=this.children.get(s);return r?r.findOnPath_(be(e),xe(t,s),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ge(),t)}foreachOnPath_(e,t,n){if(Ee(e))return this;{this.value&&n(t,this.value);const s=_e(e),r=this.children.get(s);return r?r.foreachOnPath_(be(e),xe(t,s),n):new $t(null)}}foreach(e){this.foreach_(ge(),e)}foreach_(e,t){this.children.inorderTraversal(((n,s)=>{s.foreach_(xe(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class Kt{constructor(e){this.writeTree_=e}static empty(){return new Kt(new $t(null))}}function Gt(e,t,n){if(Ee(t))return new Kt(new $t(n));{const s=e.writeTree_.findRootMostValueAndPath(t);if(null!=s){const r=s.path;let i=s.value;const o=Se(r,t);return i=i.updateChild(o,n),new Kt(e.writeTree_.set(r,i))}{const s=new $t(n),r=e.writeTree_.setTree(t,s);return new Kt(r)}}}function Wt(e,t,n){let s=e;return O(n,((e,n)=>{s=Gt(s,xe(t,e),n)})),s}function Yt(e,t){if(Ee(t))return Kt.empty();{const n=e.writeTree_.setTree(t,new $t(null));return new Kt(n)}}function Xt(e,t){return null!=Qt(e,t)}function Qt(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Se(n.path,t)):null}function Zt(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Ze,((e,n)=>{t.push(new De(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new De(e,n.value))})),t}function Jt(e,t){if(Ee(t))return e;{const n=Qt(e,t);return new Kt(null!=n?new $t(n):e.writeTree_.subtree(t))}}function en(e){return e.writeTree_.isEmpty()}function tn(e,t){return nn(ge(),e.writeTree_,t)}function nn(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let s=null;return t.children.inorderTraversal(((t,r)=>{".priority"===t?((0,i.hu)(null!==r.value,"Priority writes must always be leaf nodes"),s=r.value):n=nn(xe(e,t),r,n)})),n.getChild(e).isEmpty()||null===s||(n=n.updateChild(xe(e,".priority"),s)),n}}function sn(e,t){return _n(t,e)}function rn(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));(0,i.hu)(n>=0,"removeWrite called with nonexistent writeId.");const s=e.allWrites[n];e.allWrites.splice(n,1);let r=s.visible,o=!1,a=e.allWrites.length-1;for(;r&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=n&&on(t,s.path)?r=!1:Ie(s.path,t.path)&&(o=!0)),a--}if(r){if(o)return function(e){e.visibleWrites=cn(e.allWrites,an,ge()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(s.snap)e.visibleWrites=Yt(e.visibleWrites,s.path);else{O(s.children,(t=>{e.visibleWrites=Yt(e.visibleWrites,xe(s.path,t))}))}return!0}return!1}function on(e,t){if(e.snap)return Ie(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Ie(xe(e.path,n),t))return!0;return!1}function an(e){return e.visible}function cn(e,t,n){let s=Kt.empty();for(let r=0;r<e.length;++r){const o=e[r];if(t(o)){const e=o.path;let t;if(o.snap)Ie(n,e)?(t=Se(n,e),s=Gt(s,t,o.snap)):Ie(e,n)&&(t=Se(e,n),s=Gt(s,ge(),o.snap.getChild(t)));else{if(!o.children)throw(0,i.g5)("WriteRecord should have .snap or .children");if(Ie(n,e))t=Se(n,e),s=Wt(s,t,o.children);else if(Ie(e,n))if(t=Se(e,n),Ee(t))s=Wt(s,ge(),o.children);else{const e=(0,i.DV)(o.children,_e(t));if(e){const n=e.getChild(be(t));s=Gt(s,ge(),n)}}}}}return s}function ln(e,t,n,s,r){if(s||r){const i=Jt(e.visibleWrites,t);if(!r&&en(i))return n;if(r||null!=n||Xt(i,ge())){const i=function(e){return(e.visible||r)&&(!s||!~s.indexOf(e.writeId))&&(Ie(e.path,t)||Ie(t,e.path))};return tn(cn(e.allWrites,i,t),n||ot.EMPTY_NODE)}return null}{const s=Qt(e.visibleWrites,t);if(null!=s)return s;{const s=Jt(e.visibleWrites,t);if(en(s))return n;if(null!=n||Xt(s,ge())){return tn(s,n||ot.EMPTY_NODE)}return null}}}function hn(e,t,n,s){return ln(e.writeTree,e.treePath,t,n,s)}function un(e,t){return function(e,t,n){let s=ot.EMPTY_NODE;const r=Qt(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(Ze,((e,t)=>{s=s.updateImmediateChild(e,t)})),s;if(n){const r=Jt(e.visibleWrites,t);return n.forEachChild(Ze,((e,t)=>{const n=tn(Jt(r,new fe(e)),t);s=s.updateImmediateChild(e,n)})),Zt(r).forEach((e=>{s=s.updateImmediateChild(e.name,e.node)})),s}return Zt(Jt(e.visibleWrites,t)).forEach((e=>{s=s.updateImmediateChild(e.name,e.node)})),s}(e.writeTree,e.treePath,t)}function dn(e,t,n,s){return function(e,t,n,s,r){(0,i.hu)(s||r,"Either existingEventSnap or existingServerSnap must exist");const o=xe(t,n);if(Xt(e.visibleWrites,o))return null;{const t=Jt(e.visibleWrites,o);return en(t)?r.getChild(n):tn(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,s)}function mn(e,t){return function(e,t){return Qt(e.visibleWrites,t)}(e.writeTree,xe(e.treePath,t))}function pn(e,t,n,s,r,i){return function(e,t,n,s,r,i,o){let a;const c=Jt(e.visibleWrites,t),l=Qt(c,ge());if(null!=l)a=l;else{if(null==n)return[];a=tn(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=i?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let c=n.getNext();for(;c&&e.length<r;)0!==t(c,s)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,s,r,i)}function fn(e,t,n){return function(e,t,n,s){const r=xe(t,n),i=Qt(e.visibleWrites,r);if(null!=i)return i;if(s.isCompleteForChild(n))return tn(Jt(e.visibleWrites,r),s.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function gn(e,t){return _n(xe(e.treePath,t),e.writeTree)}function _n(e,t){return{treePath:e,writeTree:t}}class vn{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;(0,i.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,i.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(n);if(s){const r=s.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,ft(n,e.snapshotNode,s.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,pt(n,s.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,mt(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==r)throw(0,i.g5)("Illegal combination of changes: "+e+" occurred after "+s);this.changeMap.set(n,ft(n,e.snapshotNode,s.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const bn=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class yn{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Ot(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return fn(this.writes_,e,t)}}getChildAfterChild(e,t,n){const s=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Ht(this.viewCache_),r=pn(this.writes_,s,t,1,n,e);return 0===r.length?null:r[0]}}function wn(e,t,n,s,r){const o=new vn;let a,c;if(n.type===At.OVERWRITE){const l=n;l.source.fromUser?a=En(e,t,l.path,l.snap,s,r,o):((0,i.hu)(l.source.fromServer,"Unknown source."),c=l.source.tagged||t.serverCache.isFiltered()&&!Ee(l.path),a=xn(e,t,l.path,l.snap,s,r,c,o))}else if(n.type===At.MERGE){const l=n;l.source.fromUser?a=function(e,t,n,s,r,i,o){let a=t;return s.foreach(((s,c)=>{const l=xe(n,s);Sn(t,_e(l))&&(a=En(e,a,l,c,r,i,o))})),s.foreach(((s,c)=>{const l=xe(n,s);Sn(t,_e(l))||(a=En(e,a,l,c,r,i,o))})),a}(e,t,l.path,l.children,s,r,o):((0,i.hu)(l.source.fromServer,"Unknown source."),c=l.source.tagged||t.serverCache.isFiltered(),a=Cn(e,t,l.path,l.children,s,r,c,o))}else if(n.type===At.ACK_USER_WRITE){const c=n;a=c.revert?function(e,t,n,s,r,o){let a;if(null!=mn(s,n))return t;{const c=new yn(s,t,r),l=t.eventCache.getNode();let h;if(Ee(n)||".priority"===_e(n)){let n;if(t.serverCache.isFullyInitialized())n=hn(s,Ht(t));else{const e=t.serverCache.getNode();(0,i.hu)(e instanceof ot,"serverChildren would be complete if leaf node"),n=un(s,e)}h=e.filter.updateFullNode(l,n,o)}else{const r=_e(n);let i=fn(s,r,t.serverCache);null==i&&t.serverCache.isCompleteForChild(r)&&(i=l.getImmediateChild(r)),h=null!=i?e.filter.updateChild(l,r,i,be(n),c,o):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(l,r,ot.EMPTY_NODE,be(n),c,o):l,h.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=hn(s,Ht(t)),a.isLeafNode()&&(h=e.filter.updateFullNode(h,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=mn(s,ge()),Ut(t,h,a,e.filter.filtersNodes())}}(e,t,c.path,s,r,o):function(e,t,n,s,r,i,o){if(null!=mn(r,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=s.value){if(Ee(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return xn(e,t,n,c.getNode().getChild(n),r,i,a,o);if(Ee(n)){let s=new $t(null);return c.getNode().forEachChild(Fe,((e,t)=>{s=s.set(new fe(e),t)})),Cn(e,t,n,s,r,i,a,o)}return t}{let l=new $t(null);return s.foreach(((e,t)=>{const s=xe(n,e);c.isCompleteForPath(s)&&(l=l.set(e,c.getNode().getChild(s)))})),Cn(e,t,n,l,r,i,a,o)}}(e,t,c.path,c.affectedTree,s,r,o)}else{if(n.type!==At.LISTEN_COMPLETE)throw(0,i.g5)("Unknown operation type: "+n.type);a=function(e,t,n,s,r){const i=t.serverCache,o=jt(t,i.getNode(),i.isFullyInitialized()||Ee(n),i.isFiltered());return kn(e,o,n,s,bn,r)}(e,t,n.path,s,o)}const l=o.getChanges();return function(e,t,n){const s=t.eventCache;if(s.isFullyInitialized()){const r=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=qt(e);(n.length>0||!e.eventCache.isFullyInitialized()||r&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&n.push(dt(qt(t)))}}(t,a,l),{viewCache:a,changes:l}}function kn(e,t,n,s,r,o){const a=t.eventCache;if(null!=mn(s,n))return t;{let c,l;if(Ee(n))if((0,i.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Ht(t),r=un(s,n instanceof ot?n:ot.EMPTY_NODE);c=e.filter.updateFullNode(t.eventCache.getNode(),r,o)}else{const n=hn(s,Ht(t));c=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const h=_e(n);if(".priority"===h){(0,i.hu)(1===ve(n),"Can't have a priority with additional path components");const r=a.getNode();l=t.serverCache.getNode();const o=dn(s,n,r,l);c=null!=o?e.filter.updatePriority(r,o):a.getNode()}else{const i=be(n);let u;if(a.isCompleteForChild(h)){l=t.serverCache.getNode();const e=dn(s,n,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(h).updateChild(i,e):a.getNode().getImmediateChild(h)}else u=fn(s,h,t.serverCache);c=null!=u?e.filter.updateChild(a.getNode(),h,u,i,r,o):a.getNode()}}return Ut(t,c,a.isFullyInitialized()||Ee(n),e.filter.filtersNodes())}}function xn(e,t,n,s,r,i,o,a){const c=t.serverCache;let l;const h=o?e.filter:e.filter.getIndexedFilter();if(Ee(n))l=h.updateFullNode(c.getNode(),s,null);else if(h.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,s);l=h.updateFullNode(c.getNode(),e,null)}else{const e=_e(n);if(!c.isCompleteForPath(n)&&ve(n)>1)return t;const r=be(n),i=c.getNode().getImmediateChild(e).updateChild(r,s);l=".priority"===e?h.updatePriority(c.getNode(),i):h.updateChild(c.getNode(),e,i,r,bn,null)}const u=jt(t,l,c.isFullyInitialized()||Ee(n),h.filtersNodes());return kn(e,u,n,r,new yn(r,u,i),a)}function En(e,t,n,s,r,i,o){const a=t.eventCache;let c,l;const h=new yn(r,t,i);if(Ee(n))l=e.filter.updateFullNode(t.eventCache.getNode(),s,o),c=Ut(t,l,!0,e.filter.filtersNodes());else{const r=_e(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),s),c=Ut(t,l,a.isFullyInitialized(),a.isFiltered());else{const i=be(n),l=a.getNode().getImmediateChild(r);let u;if(Ee(i))u=s;else{const e=h.getCompleteChild(r);u=null!=e?".priority"===ye(i)&&e.getChild(ke(i)).isEmpty()?e:e.updateChild(i,s):ot.EMPTY_NODE}if(l.equals(u))c=t;else{c=Ut(t,e.filter.updateChild(a.getNode(),r,u,i,h,o),a.isFullyInitialized(),e.filter.filtersNodes())}}}return c}function Sn(e,t){return e.eventCache.isCompleteForChild(t)}function Tn(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Cn(e,t,n,s,r,i,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=Ee(n)?s:new $t(null).setTree(n,s);const h=t.serverCache.getNode();return c.children.inorderTraversal(((n,s)=>{if(h.hasChild(n)){const c=Tn(0,t.serverCache.getNode().getImmediateChild(n),s);l=xn(e,l,new fe(n),c,r,i,o,a)}})),c.children.inorderTraversal(((n,s)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===s.value;if(!h.hasChild(n)&&!c){const c=Tn(0,t.serverCache.getNode().getImmediateChild(n),s);l=xn(e,l,new fe(n),c,r,i,o,a)}})),l}class In{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,s=new gt(n.getIndex()),r=(i=n).loadsAllData()?new gt(i.getIndex()):i.hasLimit()?new vt(i):new _t(i);var i;this.processor_=function(e){return{filter:e}}(r);const o=t.serverCache,a=t.eventCache,c=s.updateFullNode(ot.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(ot.EMPTY_NODE,a.getNode(),null),h=new Ot(c,o.isFullyInitialized(),s.filtersNodes()),u=new Ot(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Ft(u,h),this.eventGenerator_=new Lt(this.query_)}get query(){return this.query_}}function Rn(e,t){const n=Ht(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Ee(t)&&!n.getImmediateChild(_e(t)).isEmpty())?n.getChild(t):null}function An(e){return 0===e.eventRegistrations_.length}function Mn(e,t,n){const s=[];if(n){(0,i.hu)(null==t,"A cancel should cancel all event registrations.");const r=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,r);t&&s.push(t)}))}if(t){let n=[];for(let s=0;s<e.eventRegistrations_.length;++s){const r=e.eventRegistrations_[s];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(s+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return s}function Nn(e,t,n,s){t.type===At.MERGE&&null!==t.source.queryId&&((0,i.hu)(Ht(e.viewCache_),"We should always have a full cache before handling merges"),(0,i.hu)(qt(e.viewCache_),"Missing event cache, even though we have a server cache"));const r=e.viewCache_,o=wn(e.processor_,r,t,n,s);var a,c;return a=e.processor_,c=o.viewCache,(0,i.hu)(c.eventCache.getNode().isIndexed(a.filter.getIndex()),"Event snap not indexed"),(0,i.hu)(c.serverCache.getNode().isIndexed(a.filter.getIndex()),"Server snap not indexed"),(0,i.hu)(o.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,Pn(e,o.changes,o.viewCache.eventCache.getNode(),null)}function Pn(e,t,n,s){const r=s?[s]:e.eventRegistrations_;return function(e,t,n,s){const r=[],i=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&i.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Vt(e,r,"child_removed",t,s,n),Vt(e,r,"child_added",t,s,n),Vt(e,r,"child_moved",i,s,n),Vt(e,r,"child_changed",t,s,n),Vt(e,r,"value",t,s,n),r}(e.eventGenerator_,t,n,r)}let Bn,Dn;class On{constructor(){this.views=new Map}}function Ln(e,t,n,s){const r=t.source.queryId;if(null!==r){const o=e.views.get(r);return(0,i.hu)(null!=o,"SyncTree gave us an op for an invalid query."),Nn(o,t,n,s)}{let r=[];for(const i of e.views.values())r=r.concat(Nn(i,t,n,s));return r}}function Vn(e,t,n,s,r){const i=t._queryIdentifier,o=e.views.get(i);if(!o){let e=hn(n,r?s:null),i=!1;e?i=!0:s instanceof ot?(e=un(n,s),i=!1):(e=ot.EMPTY_NODE,i=!1);const o=Ft(new Ot(e,i,!1),new Ot(s,r,!1));return new In(t,o)}return o}function Fn(e,t,n,s,r,i){const o=Vn(e,t,s,r,i);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,s=[];n.getNode().isLeafNode()||n.getNode().forEachChild(Ze,((e,t)=>{s.push(mt(e,t))}));return n.isFullyInitialized()&&s.push(dt(n.getNode())),Pn(e,s,n.getNode(),t)}(o,n)}function Un(e,t,n,s){const r=t._queryIdentifier,o=[];let a=[];const c=$n(e);if("default"===r)for(const[t,r]of e.views.entries())a=a.concat(Mn(r,n,s)),An(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||o.push(r.query));else{const t=e.views.get(r);t&&(a=a.concat(Mn(t,n,s)),An(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||o.push(t.query)))}return c&&!$n(e)&&o.push(new((0,i.hu)(Bn,"Reference.ts has not been loaded"),Bn)(t._repo,t._path)),{removed:o,events:a}}function jn(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function qn(e,t){let n=null;for(const s of e.views.values())n=n||Rn(s,t);return n}function Hn(e,t){if(t._queryParams.loadsAllData())return Kn(e);{const n=t._queryIdentifier;return e.views.get(n)}}function zn(e,t){return null!=Hn(e,t)}function $n(e){return null!=Kn(e)}function Kn(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Gn=1;class Wn{constructor(e){this.listenProvider_=e,this.syncPointTree_=new $t(null),this.pendingWriteTree_={visibleWrites:Kt.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Yn(e,t,n,s,r){return function(e,t,n,s,r){(0,i.hu)(s>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:t,snap:n,writeId:s,visible:r}),r&&(e.visibleWrites=Gt(e.visibleWrites,t,n)),e.lastWriteId=s}(e.pendingWriteTree_,t,n,s,r),r?ns(e,new Bt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Xn(e,t,n=!1){const s=function(e,t){for(let n=0;n<e.allWrites.length;n++){const s=e.allWrites[n];if(s.writeId===t)return s}return null}(e.pendingWriteTree_,t);if(rn(e.pendingWriteTree_,t)){let t=new $t(null);return null!=s.snap?t=t.set(ge(),!0):O(s.children,(e=>{t=t.set(new fe(e),!0)})),ns(e,new Nt(s.path,t,n))}return[]}function Qn(e,t,n){return ns(e,new Bt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Zn(e,t,n,s,r=!1){const i=t._path,o=e.syncPointTree_.get(i);let a=[];if(o&&("default"===t._queryIdentifier||zn(o,t))){const c=Un(o,t,n,s);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(i));const l=c.removed;if(a=c.events,!r){const n=-1!==l.findIndex((e=>e._queryParams.loadsAllData())),r=e.syncPointTree_.findOnPath(i,((e,t)=>$n(t)));if(n&&!r){const t=e.syncPointTree_.subtree(i);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&$n(t)){return[Kn(t)]}{let e=[];return t&&(e=jn(t)),O(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const s=n[t],r=s.query,i=is(e,s);e.listenProvider_.startListening(us(r),os(e,r),i.hashFn,i.onComplete)}}}if(!r&&l.length>0&&!s)if(n){const n=null;e.listenProvider_.stopListening(us(t),n)}else l.forEach((t=>{const n=e.queryToTagMap.get(as(t));e.listenProvider_.stopListening(us(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const s=t[n];if(!s._queryParams.loadsAllData()){const t=as(s),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,l)}return a}function Jn(e,t,n,s){const r=cs(e,s);if(null!=r){const s=ls(r),i=s.path,o=s.queryId,a=Se(i,t);return hs(e,i,new Bt(Mt(o),a,n))}return[]}function es(e,t,n,s=!1){const r=t._path;let o=null,a=!1;e.syncPointTree_.foreachOnPath(r,((e,t)=>{const n=Se(e,r);o=o||qn(t,n),a=a||$n(t)}));let c,l=e.syncPointTree_.get(r);if(l?(a=a||$n(l),o=o||qn(l,ge())):(l=new On,e.syncPointTree_=e.syncPointTree_.set(r,l)),null!=o)c=!0;else{c=!1,o=ot.EMPTY_NODE;e.syncPointTree_.subtree(r).foreachChild(((e,t)=>{const n=qn(t,ge());n&&(o=o.updateImmediateChild(e,n))}))}const h=zn(l,t);if(!h&&!t._queryParams.loadsAllData()){const n=as(t);(0,i.hu)(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const s=Gn++;e.queryToTagMap.set(n,s),e.tagToQueryMap.set(s,n)}let u=Fn(l,t,n,sn(e.pendingWriteTree_,r),o,c);if(!h&&!a&&!s){const n=Hn(l,t);u=u.concat(function(e,t,n){const s=t._path,r=os(e,t),o=is(e,n),a=e.listenProvider_.startListening(us(t),r,o.hashFn,o.onComplete),c=e.syncPointTree_.subtree(s);if(r)(0,i.hu)(!$n(c.value),"If we're adding a query, it shouldn't be shadowed");else{const t=c.fold(((e,t,n)=>{if(!Ee(e)&&t&&$n(t))return[Kn(t).query];{let e=[];return t&&(e=e.concat(jn(t).map((e=>e.query)))),O(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const s=t[n];e.listenProvider_.stopListening(us(s),os(e,s))}}return a}(e,t,n))}return u}function ts(e,t,n){const s=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,((e,n)=>{const s=qn(n,Se(e,t));if(s)return s}));return ln(s,t,r,n,!0)}function ns(e,t){return ss(t,e.syncPointTree_,null,sn(e.pendingWriteTree_,ge()))}function ss(e,t,n,s){if(Ee(e.path))return rs(e,t,n,s);{const r=t.get(ge());null==n&&null!=r&&(n=qn(r,ge()));let i=[];const o=_e(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=gn(s,o);i=i.concat(ss(a,c,e,t))}return r&&(i=i.concat(Ln(r,e,s,n))),i}}function rs(e,t,n,s){const r=t.get(ge());null==n&&null!=r&&(n=qn(r,ge()));let i=[];return t.children.inorderTraversal(((t,r)=>{const o=n?n.getImmediateChild(t):null,a=gn(s,t),c=e.operationForChild(t);c&&(i=i.concat(rs(c,r,o,a)))})),r&&(i=i.concat(Ln(r,e,s,n))),i}function is(e,t){const n=t.query,s=os(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||ot.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return s?function(e,t,n){const s=cs(e,n);if(s){const n=ls(s),r=n.path,i=n.queryId,o=Se(r,t);return hs(e,r,new Pt(Mt(i),o))}return[]}(e,n._path,s):function(e,t){return ns(e,new Pt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const s=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const s=new Error(e+" at "+t._path.toString()+": "+n);return s.code=e.toUpperCase(),s}(t,n);return Zn(e,n,null,s)}}}}function os(e,t){const n=as(t);return e.queryToTagMap.get(n)}function as(e){return e._path.toString()+"$"+e._queryIdentifier}function cs(e,t){return e.tagToQueryMap.get(t)}function ls(e){const t=e.indexOf("$");return(0,i.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new fe(e.substr(0,t))}}function hs(e,t,n){const s=e.syncPointTree_.get(t);(0,i.hu)(s,"Missing sync point for query tag that we're tracking");return Ln(s,n,sn(e.pendingWriteTree_,t),null)}function us(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new((0,i.hu)(Dn,"Reference.ts has not been loaded"),Dn)(e._repo,e._path):e}class ds{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ds(t)}node(){return this.node_}}class ms{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=xe(this.path_,e);return new ms(this.syncTree_,t)}node(){return ts(this.syncTree_,this.path_)}}const ps=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},fs=function(e,t,n){return e&&"object"==typeof e?((0,i.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?gs(e[".sv"],t,n):"object"==typeof e[".sv"]?_s(e[".sv"],t):void(0,i.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},gs=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,i.hu)(!1,"Unexpected server value: "+e)},_s=function(e,t,n){e.hasOwnProperty("increment")||(0,i.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const s=e.increment;"number"!=typeof s&&(0,i.hu)(!1,"Unexpected increment value: "+s);const r=t.node();if((0,i.hu)(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return"number"!=typeof o?s:o+s},vs=function(e,t,n,s){return ys(t,new ms(n,e),s)},bs=function(e,t,n){return ys(e,new ds(t),n)};function ys(e,t,n){const s=e.getPriority().val(),r=fs(s,t.getImmediateChild(".priority"),n);let i;if(e.isLeafNode()){const s=e,i=fs(s.getValue(),t,n);return i!==s.getValue()||r!==s.getPriority().val()?new Qe(i,lt(r)):e}{const s=e;return i=s,r!==s.getPriority().val()&&(i=i.updatePriority(new Qe(r))),s.forEachChild(Ze,((e,s)=>{const r=ys(s,t.getImmediateChild(e),n);r!==s&&(i=i.updateImmediateChild(e,r))})),i}}class ws{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function ks(e,t){let n=t instanceof fe?t:new fe(t),s=e,r=_e(n);for(;null!==r;){const e=(0,i.DV)(s.node.children,r)||{children:{},childCount:0};s=new ws(r,s,e),n=be(n),r=_e(n)}return s}function xs(e){return e.node.value}function Es(e,t){e.node.value=t,Rs(e)}function Ss(e){return e.node.childCount>0}function Ts(e,t){O(e.node.children,((n,s)=>{t(new ws(n,e,s))}))}function Cs(e,t,n,s){n&&!s&&t(e),Ts(e,(e=>{Cs(e,t,!0,s)})),n&&s&&t(e)}function Is(e){return new fe(null===e.parent?e.name:Is(e.parent)+"/"+e.name)}function Rs(e){null!==e.parent&&function(e,t,n){const s=function(e){return void 0===xs(e)&&!Ss(e)}(n),r=(0,i.r3)(e.node.children,t);s&&r?(delete e.node.children[t],e.node.childCount--,Rs(e)):s||r||(e.node.children[t]=n.node,e.node.childCount++,Rs(e))}(e.parent,e.name,e)}const As=/[\[\].#$\/\u0000-\u001F\u007F]/,Ms=/[\[\].#$\u0000-\u001F\u007F]/,Ns=10485760,Ps=function(e){return"string"==typeof e&&0!==e.length&&!As.test(e)},Bs=function(e){return"string"==typeof e&&0!==e.length&&!Ms.test(e)},Ds=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!I(e)||e&&"object"==typeof e&&(0,i.r3)(e,".sv")},Os=function(e,t,n,s){s&&void 0===t||Ls((0,i.gK)(e,"value"),t,n)},Ls=function(e,t,n){const s=n instanceof fe?new Re(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Me(s));if("function"==typeof t)throw new Error(e+"contains a function "+Me(s)+" with contents = "+t.toString());if(I(t))throw new Error(e+"contains "+t.toString()+" "+Me(s));if("string"==typeof t&&t.length>Ns/3&&(0,i.ug)(t)>Ns)throw new Error(e+"contains a string greater than "+Ns+" utf8 bytes "+Me(s)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(O(t,((t,o)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!Ps(t)))throw new Error(e+" contains an invalid key ("+t+") "+Me(s)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=(0,i.ug)(t),Ae(e)}(s,t),Ls(e,o,s),function(e){const t=e.parts_.pop();e.byteLength_-=(0,i.ug)(t),e.parts_.length>0&&(e.byteLength_-=1)}(s)})),n&&r)throw new Error(e+' contains ".value" child '+Me(s)+" in addition to actual children.")}},Vs=function(e,t,n,s){if(s&&void 0===t)return;const r=(0,i.gK)(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(r+" must be an object containing the children to replace.");const o=[];O(t,((e,t)=>{const s=new fe(e);if(Ls(r,t,xe(n,s)),".priority"===ye(s)&&!Ds(t))throw new Error(r+"contains an invalid value for '"+s.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(s)})),function(e,t){let n,s;for(n=0;n<t.length;n++){s=t[n];const r=we(s);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!Ps(r[t]))throw new Error(e+"contains an invalid key ("+r[t]+") in path "+s.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(Te);let r=null;for(n=0;n<t.length;n++){if(s=t[n],null!==r&&Ie(r,s))throw new Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+s.toString());r=s}}(r,o)},Fs=function(e,t,n){if(!n||void 0!==t){if(I(t))throw new Error((0,i.gK)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ds(t))throw new Error((0,i.gK)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Us=function(e,t,n,s){if(!(s&&void 0===n||Bs(n)))throw new Error((0,i.gK)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},js=function(e,t,n,s){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Us(e,t,n,s)},qs=function(e,t){if(".info"===_e(t))throw new Error(e+" failed = Can't modify data under /.info/")},Hs=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Ps(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Bs(e)}(n))throw new Error((0,i.gK)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class zs{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function $s(e,t){let n=null;for(let s=0;s<t.length;s++){const r=t[s],i=r.getPath();null===n||Ce(i,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:i}),n.events.push(r)}n&&e.eventLists_.push(n)}function Ks(e,t,n){$s(e,n),Ws(e,(e=>Ce(e,t)))}function Gs(e,t,n){$s(e,n),Ws(e,(e=>Ie(e,t)||Ie(t,e)))}function Ws(e,t){e.recursionDepth_++;let n=!0;for(let s=0;s<e.eventLists_.length;s++){const r=e.eventLists_[s];if(r){t(r.path)?(Ys(e.eventLists_[s]),e.eventLists_[s]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function Ys(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const s=n.getEventRunner();y&&x("event: "+n.toString()),U(s)}}}const Xs="repo_interrupt",Qs=25;class Zs{constructor(e,t,n,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new zs,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Et(),this.transactionQueueTree_=new ws,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Js(e,t,n){if(e.stats_=te(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new kt(e.repoInfo_,((t,n,s,r)=>{nr(e,t,n,s,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>sr(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,i.Wl)(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Be(e.repoInfo_,t,((t,n,s,r)=>{nr(e,t,n,s,r)}),(t=>{sr(e,t)}),(t=>{!function(e,t){O(t,((t,n)=>{rr(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return ee[n]||(ee[n]=t()),ee[n]}(e.repoInfo_,(()=>new Rt(e.stats_,e.server_))),e.infoData_=new xt,e.infoSyncTree_=new Wn({startListening:(t,n,s,r)=>{let i=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(i=Qn(e.infoSyncTree_,t._path,o),setTimeout((()=>{r("ok")}),0)),i},stopListening:()=>{}}),rr(e,"connected",!1),e.serverSyncTree_=new Wn({startListening:(t,n,s,r)=>(e.server_.listen(t,s,n,((n,s)=>{const i=r(n,s);Gs(e.eventQueue_,t._path,i)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function er(e){const t=e.infoData_.getNode(new fe(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function tr(e){return ps({timestamp:er(e)})}function nr(e,t,n,s,r){e.dataUpdateCount++;const o=new fe(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let a=[];if(r)if(s){const t=(0,i.UI)(n,(e=>lt(e)));a=function(e,t,n,s){const r=cs(e,s);if(r){const s=ls(r),i=s.path,o=s.queryId,a=Se(i,t),c=$t.fromObject(n);return hs(e,i,new Dt(Mt(o),a,c))}return[]}(e.serverSyncTree_,o,t,r)}else{const t=lt(n);a=Jn(e.serverSyncTree_,o,t,r)}else if(s){const t=(0,i.UI)(n,(e=>lt(e)));a=function(e,t,n){const s=$t.fromObject(n);return ns(e,new Dt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,s))}(e.serverSyncTree_,o,t)}else{const t=lt(n);a=Qn(e.serverSyncTree_,o,t)}let c=o;a.length>0&&(c=fr(e,o)),Gs(e.eventQueue_,c,a)}function sr(e,t){rr(e,"connected",t),!1===t&&function(e){ur(e,"onDisconnectEvents");const t=tr(e),n=Et();Ct(e.onDisconnect_,ge(),((s,r)=>{const i=vs(s,r,e.serverSyncTree_,t);St(n,s,i)}));let s=[];Ct(n,ge(),((t,n)=>{s=s.concat(Qn(e.serverSyncTree_,t,n));const r=yr(e,t);fr(e,r)})),e.onDisconnect_=Et(),Gs(e.eventQueue_,ge(),s)}(e)}function rr(e,t,n){const s=new fe("/.info/"+t),r=lt(n);e.infoData_.updateSnapshot(s,r);const i=Qn(e.infoSyncTree_,s,r);Gs(e.eventQueue_,s,i)}function ir(e){return e.nextWriteId_++}function or(e,t,n,s,r){ur(e,"set",{path:t.toString(),value:n,priority:s});const i=tr(e),o=lt(n,s),a=ts(e.serverSyncTree_,t),c=bs(o,a,i),l=ir(e),h=Yn(e.serverSyncTree_,t,c,l,!0);$s(e.eventQueue_,h),e.server_.put(t.toString(),o.val(!0),((n,s)=>{const i="ok"===n;i||C("set at "+t+" failed: "+n);const o=Xn(e.serverSyncTree_,l,!i);Gs(e.eventQueue_,t,o),dr(e,r,n,s)}));const u=yr(e,t);fr(e,u),Gs(e.eventQueue_,u,[])}function ar(e,t,n){e.server_.onDisconnectCancel(t.toString(),((s,r)=>{"ok"===s&&Tt(e.onDisconnect_,t),dr(e,n,s,r)}))}function cr(e,t,n,s){const r=lt(n);e.server_.onDisconnectPut(t.toString(),r.val(!0),((n,i)=>{"ok"===n&&St(e.onDisconnect_,t,r),dr(e,s,n,i)}))}function lr(e,t,n){let s;s=".info"===_e(t._path)?Zn(e.infoSyncTree_,t,n):Zn(e.serverSyncTree_,t,n),Ks(e.eventQueue_,t._path,s)}function hr(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Xs)}function ur(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),x(n,...t)}function dr(e,t,n,s){t&&U((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let r=e;s&&(r+=": "+s);const i=new Error(r);i.code=e,t(i)}}))}function mr(e,t,n){return ts(e.serverSyncTree_,t,n)||ot.EMPTY_NODE}function pr(e,t=e.transactionQueueTree_){if(t||br(e,t),xs(t)){const n=_r(e,t);(0,i.hu)(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,t,n){const s=n.map((e=>e.currentWriteId)),r=mr(e,t,s);let o=r;const a=r.hash();for(let e=0;e<n.length;e++){const s=n[e];(0,i.hu)(0===s.status,"tryToSendTransactionQueue_: items in queue should all be run."),s.status=1,s.retryCount++;const r=Se(t,s.path);o=o.updateChild(r,s.currentOutputSnapshotRaw)}const c=o.val(!0),l=t;e.server_.put(l.toString(),c,(s=>{ur(e,"transaction put response",{path:l.toString(),status:s});let r=[];if("ok"===s){const s=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(Xn(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&s.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();br(e,ks(e.transactionQueueTree_,t)),pr(e,e.transactionQueueTree_),Gs(e.eventQueue_,t,r);for(let e=0;e<s.length;e++)U(s[e])}else{if("datastale"===s)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{C("transaction at "+l.toString()+" failed: "+s);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=s}fr(e,t)}}),a)}(e,Is(t),n)}else Ss(t)&&Ts(t,(t=>{pr(e,t)}))}function fr(e,t){const n=gr(e,t),s=Is(n);return function(e,t,n){if(0===t.length)return;const s=[];let r=[];const o=t.filter((e=>0===e.status)),a=o.map((e=>e.currentWriteId));for(let o=0;o<t.length;o++){const l=t[o],h=Se(n,l.path);let u,d=!1;if((0,i.hu)(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,r=r.concat(Xn(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=Qs)d=!0,u="maxretry",r=r.concat(Xn(e.serverSyncTree_,l.currentWriteId,!0));else{const n=mr(e,l.path,a);l.currentInputSnapshot=n;const s=t[o].update(n.val());if(void 0!==s){Ls("transaction failed: Data returned ",s,l.path);let t=lt(s);"object"==typeof s&&null!=s&&(0,i.r3)(s,".priority")||(t=t.updatePriority(n.getPriority()));const o=l.currentWriteId,c=tr(e),h=bs(t,n,c);l.currentOutputSnapshotRaw=t,l.currentOutputSnapshotResolved=h,l.currentWriteId=ir(e),a.splice(a.indexOf(o),1),r=r.concat(Yn(e.serverSyncTree_,l.path,h,l.currentWriteId,l.applyLocally)),r=r.concat(Xn(e.serverSyncTree_,o,!0))}else d=!0,u="nodata",r=r.concat(Xn(e.serverSyncTree_,l.currentWriteId,!0))}Gs(e.eventQueue_,n,r),r=[],d&&(t[o].status=2,c=t[o].unwatcher,setTimeout(c,Math.floor(0)),t[o].onComplete&&("nodata"===u?s.push((()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot))):s.push((()=>t[o].onComplete(new Error(u),!1,null)))))}var c;br(e,e.transactionQueueTree_);for(let e=0;e<s.length;e++)U(s[e]);pr(e,e.transactionQueueTree_)}(e,_r(e,n),s),s}function gr(e,t){let n,s=e.transactionQueueTree_;for(n=_e(t);null!==n&&void 0===xs(s);)s=ks(s,n),n=_e(t=be(t));return s}function _r(e,t){const n=[];return vr(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function vr(e,t,n){const s=xs(t);if(s)for(let e=0;e<s.length;e++)n.push(s[e]);Ts(t,(t=>{vr(e,t,n)}))}function br(e,t){const n=xs(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Es(t,n.length>0?n:void 0)}Ts(t,(t=>{br(e,t)}))}function yr(e,t){const n=Is(gr(e,t)),s=ks(e.transactionQueueTree_,t);return function(e,t,n){let s=n?e:e.parent;for(;null!==s;){if(t(s))return!0;s=s.parent}}(s,(t=>{wr(e,t)})),wr(e,s),Cs(s,(t=>{wr(e,t)})),n}function wr(e,t){const n=xs(t);if(n){const s=[];let r=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?((0,i.hu)(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):((0,i.hu)(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(Xn(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&s.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Es(t,void 0):n.length=o+1,Gs(e.eventQueue_,Is(t),r);for(let e=0;e<s.length;e++)U(s[e])}}const kr=function(e,t){const n=xr(e),s=n.namespace;"firebase.com"===n.domain&&T(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),s&&"undefined"!==s||"localhost"===n.domain||T("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&C("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new X(n.host,n.secure,s,r,t,"",s!==n.subdomain),path:new fe(n.pathString)}},xr=function(e){let t="",n="",s="",r="",i="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let h=e.indexOf("/");-1===h&&(h=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(h,u)),h<u&&(r=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let s=n[e];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch(e){}t+="/"+s}return t}(e.substring(h,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const s=n.split("=");2===s.length?t[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):C(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const m=t.slice(0,l);if("localhost"===m.toLowerCase())n="localhost";else if(m.split(".").length<=2)n=m;else{const e=t.indexOf(".");s=t.substring(0,e).toLowerCase(),n=t.substring(e+1),i=s}"ns"in d&&(i=d.ns)}return{host:t,port:c,domain:n,subdomain:s,secure:o,scheme:a,pathString:r,namespace:i}},Er="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";!function(){let e=0;const t=[]}();class Sr{constructor(e,t,n,s){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=s}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,i.Wl)(this.snapshot.exportVal())}}class Tr{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Cr{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,i.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Ir{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new i.BH;return ar(this._repo,this._path,e.wrapCallback((()=>{}))),e.promise}remove(){qs("OnDisconnect.remove",this._path);const e=new i.BH;return cr(this._repo,this._path,null,e.wrapCallback((()=>{}))),e.promise}set(e){qs("OnDisconnect.set",this._path),Os("OnDisconnect.set",e,this._path,!1);const t=new i.BH;return cr(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}setWithPriority(e,t){qs("OnDisconnect.setWithPriority",this._path),Os("OnDisconnect.setWithPriority",e,this._path,!1),Fs("OnDisconnect.setWithPriority",t,!1);const n=new i.BH;return function(e,t,n,s,r){const i=lt(n,s);e.server_.onDisconnectPut(t.toString(),i.val(!0),((n,s)=>{"ok"===n&&St(e.onDisconnect_,t,i),dr(0,r,n,s)}))}(this._repo,this._path,e,t,n.wrapCallback((()=>{}))),n.promise}update(e){qs("OnDisconnect.update",this._path),Vs("OnDisconnect.update",e,this._path,!1);const t=new i.BH;return function(e,t,n,s){if((0,i.xb)(n))return x("onDisconnect().update() called with empty data.  Don't do anything."),void dr(0,s,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,((r,i)=>{"ok"===r&&O(n,((n,s)=>{const r=lt(s);St(e.onDisconnect_,xe(t,n),r)})),dr(0,s,r,i)}))}(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}}class Rr{constructor(e,t,n,s){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=s}get key(){return Ee(this._path)?null:ye(this._path)}get ref(){return new Ar(this._repo,this._path)}get _queryIdentifier(){const e=wt(this._queryParams),t=B(e);return"{}"===t?"default":t}get _queryObject(){return wt(this._queryParams)}isEqual(e){if(!((e=(0,i.m9)(e))instanceof Rr))return!1;const t=this._repo===e._repo,n=Ce(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&n&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Ar extends Rr{constructor(e,t){super(e,t,new bt,!1)}get parent(){const e=ke(this._path);return null===e?null:new Ar(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Mr{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new fe(e),n=Pr(this.ref,e);return new Mr(this._node.getChild(t),n,Ze)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new Mr(n,Pr(this.ref,t),Ze))))}hasChild(e){const t=new fe(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Nr(e,t){return(e=(0,i.m9)(e))._checkNotDeleted("ref"),void 0!==t?Pr(e._root,t):e._root}function Pr(e,t){return null===_e((e=(0,i.m9)(e))._path)?js("child","path",t,!1):Us("child","path",t,!1),new Ar(e._repo,xe(e._path,t))}function Br(e){return e=(0,i.m9)(e),new Ir(e._repo,e._path)}function Dr(e,t){e=(0,i.m9)(e),qs("set",e._path),Os("set",t,e._path,!1);const n=new i.BH;return or(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}class Or{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new Sr("value",this,new Mr(e.snapshotNode,new Ar(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Tr(this,e,t):null}matches(e){return e instanceof Or&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Lr{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Tr(this,e,t):null}createEvent(e,t){(0,i.hu)(null!=e.childName,"Child events should have a childName.");const n=Pr(new Ar(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new Sr(e.type,this,new Mr(e.snapshotNode,n,s),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Lr&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Vr(e,t,n,s,r){let i;if("object"==typeof s&&(i=void 0,r=s),"function"==typeof s&&(i=s),r&&r.onlyOnce){const t=n,s=(n,s)=>{lr(e._repo,e,a),t(n,s)};s.userCallback=n.userCallback,s.context=n.context,n=s}const o=new Cr(n,i||void 0),a="value"===t?new Or(o):new Lr(t,o);return function(e,t,n){let s;s=".info"===_e(t._path)?es(e.infoSyncTree_,t,n):es(e.serverSyncTree_,t,n),Ks(e.eventQueue_,t._path,s)}(e._repo,e,a),()=>lr(e._repo,e,a)}function Fr(e,t,n,s){return Vr(e,"value",t,n,s)}!function(e){(0,i.hu)(!Bn,"__referenceConstructor has already been defined"),Bn=e}(Ar),function(e){(0,i.hu)(!Dn,"__referenceConstructor has already been defined"),Dn=e}(Ar);const Ur="FIREBASE_DATABASE_EMULATOR_HOST",jr={};let qr=!1;function Hr(e,t,n,s,r){let i=s||e.options.databaseURL;void 0===i&&(e.options.projectId||T("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),x("Using default host for project ",e.options.projectId),i=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,c,l=kr(i,r),h=l.repoInfo;void 0!==a&&a.env&&(c=a.env[Ur]),c?(o=!0,i=`http://${c}?ns=${h.namespace}`,l=kr(i,r),h=l.repoInfo):o=!l.repoInfo.secure;const u=r&&o?new z(z.OWNER):new H(e.name,e.options,t);Hs("Invalid Firebase Database URL",l),Ee(l.path)||T("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,n,s){let r=jr[t.name];r||(r={},jr[t.name]=r);let i=r[e.toURLString()];i&&T("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return i=new Zs(e,qr,n,s),r[e.toURLString()]=i,i}(h,e,u,new q(e.name,n));return new zr(d,e)}class zr{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Js(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ar(this._repo,ge())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=jr[t];n&&n[e.key]===e||T(`Database ${t}(${e.repoInfo_}) has already been deleted.`),hr(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&T("Cannot call "+e+" on a deleted database.")}}function $r(e=(0,s.Mq)(),t){const n=(0,s.qX)(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=(0,i.P0)("database");e&&function(e,t,n,s={}){e=(0,i.m9)(e),e._checkNotDeleted("useEmulator"),e._instanceStarted&&T("Cannot call useEmulator() after instance has already been initialized.");const r=e._repoInternal;let o;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&T('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new z(z.OWNER);else if(s.mockUserToken){const t="string"==typeof s.mockUserToken?s.mockUserToken:(0,i.Sg)(s.mockUserToken,e.app.options.projectId);o=new z(t)}!function(e,t,n,s){e.repoInfo_=new X(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),s&&(e.authTokenProvider_=s)}(r,t,n,o)}(n,...e)}return n}const Kr={".sv":"timestamp"};function Gr(){return Kr}Be.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Be.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Wr;!function(e){h=e}(s.Jn),(0,s.Xd)(new r.wA("database",((e,{instanceIdentifier:t})=>Hr(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),(0,s.KN)(c,l,Wr),(0,s.KN)(c,l,"esm2017")},36100:(e,t,n)=>{"use strict";n.d(t,{ET:()=>Ju,Ab:()=>id,vr:()=>rd,hJ:()=>Bh,oe:()=>Zu,AK:()=>sd,JU:()=>Dh,Wu:()=>Bu,QT:()=>Gu,PL:()=>Yu,ad:()=>Fh,b9:()=>Ru,cf:()=>ed,Xo:()=>Cu,IO:()=>ku,pl:()=>Xu,TQ:()=>Nu,e0:()=>Mu,r7:()=>Qu,ar:()=>Eu});var s,r=n(25816),i=n(8463),o=n(53333),a=n(74444),c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l={},h=h||{},u=c||self;function d(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var p="closure_uid_"+(1e9*Math.random()>>>0),f=0;function g(e,t,n){return e.call.apply(e.bind,arguments)}function _(e,t,n){if(!e)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function v(e,t,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?g:_).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function y(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[n].apply(e,r)}}function w(){this.s=this.s,this.o=this.o}w.prototype.s=!1,w.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,p)&&e[p]||(e[p]=++f))},w.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const k=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function x(e){const t=e.length;if(0<t){const n=Array(t);for(let s=0;s<t;s++)n[s]=e[s];return n}return[]}function E(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(d(n)){const t=e.length||0,s=n.length||0;e.length=t+s;for(let r=0;r<s;r++)e[t+r]=n[r]}else e.push(n)}}function S(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}S.prototype.h=function(){this.defaultPrevented=!0};var T=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{u.addEventListener("test",(()=>{}),t),u.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function C(e){return/^[\s\xa0]*$/.test(e)}function I(){var e=u.navigator;return e&&(e=e.userAgent)?e:""}function R(e){return-1!=I().indexOf(e)}function A(e){return A[" "](e),e}A[" "]=function(){};var M,N,P,B=R("Opera"),D=R("Trident")||R("MSIE"),O=R("Edge"),L=O||D,V=R("Gecko")&&!(-1!=I().toLowerCase().indexOf("webkit")&&!R("Edge"))&&!(R("Trident")||R("MSIE"))&&!R("Edge"),F=-1!=I().toLowerCase().indexOf("webkit")&&!R("Edge");function U(){var e=u.document;return e?e.documentMode:void 0}e:{var j="",q=(N=I(),V?/rv:([^\);]+)(\)|;)/.exec(N):O?/Edge\/([\d\.]+)/.exec(N):D?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(N):F?/WebKit\/(\S+)/.exec(N):B?/(?:Version)[ \/]?(\S+)/.exec(N):void 0);if(q&&(j=q?q[1]:""),D){var H=U();if(null!=H&&H>parseFloat(j)){M=String(H);break e}}M=j}if(u.document&&D){var z=U();P=z||(parseInt(M,10)||void 0)}else P=void 0;var $=P;function K(e,t){if(S.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,s=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(V){e:{try{A(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:G[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&K.$.h.call(this)}}y(K,S);var G={2:"touch",3:"pen",4:"mouse"};K.prototype.h=function(){K.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var W="closure_listenable_"+(1e6*Math.random()|0),Y=0;function X(e,t,n,s,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!s,this.la=r,this.key=++Y,this.fa=this.ia=!1}function Q(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Z(e,t,n){for(const s in e)t.call(n,e[s],s,e)}function J(e){const t={};for(const n in e)t[n]=e[n];return t}const ee="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(e,t){let n,s;for(let t=1;t<arguments.length;t++){for(n in s=arguments[t],s)e[n]=s[n];for(let t=0;t<ee.length;t++)n=ee[t],Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}}function ne(e){this.src=e,this.g={},this.h=0}function se(e,t){var n=t.type;if(n in e.g){var s,r=e.g[n],i=k(r,t);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Q(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function re(e,t,n,s){for(var r=0;r<e.length;++r){var i=e[r];if(!i.fa&&i.listener==t&&i.capture==!!n&&i.la==s)return r}return-1}ne.prototype.add=function(e,t,n,s,r){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=re(e,t,s,r);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new X(t,this.src,i,!!s,r)).ia=n,e.push(t)),t};var ie="closure_lm_"+(1e6*Math.random()|0),oe={};function ae(e,t,n,s,r){if(s&&s.once)return le(e,t,n,s,r);if(Array.isArray(t)){for(var i=0;i<t.length;i++)ae(e,t[i],n,s,r);return null}return n=ge(n),e&&e[W]?e.O(t,n,m(s)?!!s.capture:!!s,r):ce(e,t,n,!1,s,r)}function ce(e,t,n,s,r,i){if(!t)throw Error("Invalid event type");var o=m(r)?!!r.capture:!!r,a=pe(e);if(a||(e[ie]=a=new ne(e)),(n=a.add(t,n,s,o,i)).proxy)return n;if(s=function(){function e(n){return t.call(e.src,e.listener,n)}const t=me;return e}(),n.proxy=s,s.src=e,s.listener=n,e.addEventListener)T||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),s,r);else if(e.attachEvent)e.attachEvent(de(t.toString()),s);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(s)}return n}function le(e,t,n,s,r){if(Array.isArray(t)){for(var i=0;i<t.length;i++)le(e,t[i],n,s,r);return null}return n=ge(n),e&&e[W]?e.P(t,n,m(s)?!!s.capture:!!s,r):ce(e,t,n,!0,s,r)}function he(e,t,n,s,r){if(Array.isArray(t))for(var i=0;i<t.length;i++)he(e,t[i],n,s,r);else s=m(s)?!!s.capture:!!s,n=ge(n),e&&e[W]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=re(i=e.g[t],n,s,r))&&(Q(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete e.g[t],e.h--)))):e&&(e=pe(e))&&(t=e.g[t.toString()],e=-1,t&&(e=re(t,n,s,r)),(n=-1<e?t[e]:null)&&ue(n))}function ue(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[W])se(t.i,e);else{var n=e.type,s=e.proxy;t.removeEventListener?t.removeEventListener(n,s,e.capture):t.detachEvent?t.detachEvent(de(n),s):t.addListener&&t.removeListener&&t.removeListener(s),(n=pe(t))?(se(n,e),0==n.h&&(n.src=null,t[ie]=null)):Q(e)}}}function de(e){return e in oe?oe[e]:oe[e]="on"+e}function me(e,t){if(e.fa)e=!0;else{t=new K(t,this);var n=e.listener,s=e.la||e.src;e.ia&&ue(e),e=n.call(s,t)}return e}function pe(e){return(e=e[ie])instanceof ne?e:null}var fe="__closure_events_fn_"+(1e9*Math.random()>>>0);function ge(e){return"function"==typeof e?e:(e[fe]||(e[fe]=function(t){return e.handleEvent(t)}),e[fe])}function _e(){w.call(this),this.i=new ne(this),this.S=this,this.J=null}function ve(e,t){var n,s=e.J;if(s)for(n=[];s;s=s.J)n.push(s);if(e=e.S,s=t.type||t,"string"==typeof t)t=new S(t,e);else if(t instanceof S)t.target=t.target||e;else{var r=t;te(t=new S(s,e),r)}if(r=!0,n)for(var i=n.length-1;0<=i;i--){var o=t.g=n[i];r=be(o,s,!0,t)&&r}if(r=be(o=t.g=e,s,!0,t)&&r,r=be(o,s,!1,t)&&r,n)for(i=0;i<n.length;i++)r=be(o=t.g=n[i],s,!1,t)&&r}function be(e,t,n,s){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&se(e.i,o),r=!1!==a.call(c,s)&&r}}return r&&!s.defaultPrevented}y(_e,w),_e.prototype[W]=!0,_e.prototype.removeEventListener=function(e,t,n,s){he(this,e,t,n,s)},_e.prototype.N=function(){if(_e.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],s=0;s<n.length;s++)Q(n[s]);delete t.g[e],t.h--}}this.J=null},_e.prototype.O=function(e,t,n,s){return this.i.add(String(e),t,!1,n,s)},_e.prototype.P=function(e,t,n,s){return this.i.add(String(e),t,!0,n,s)};var ye=u.JSON.stringify;function we(){var e=Ie;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var ke=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new xe),(e=>e.reset()));class xe{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ee(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Se(e){u.setTimeout((()=>{throw e}),0)}let Te,Ce=!1,Ie=new class{constructor(){this.h=this.g=null}add(e,t){const n=ke.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},Re=()=>{const e=u.Promise.resolve(void 0);Te=()=>{e.then(Ae)}};var Ae=()=>{for(var e;e=we();){try{e.h.call(e.g)}catch(e){Se(e)}var t=ke;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Ce=!1};function Me(e,t){_e.call(this),this.h=e||1,this.g=t||u,this.j=v(this.qb,this),this.l=Date.now()}function Ne(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function Pe(e,t,n){if("function"==typeof e)n&&(e=v(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=v(e.handleEvent,e)}return 2147483647<Number(t)?-1:u.setTimeout(e,t||0)}function Be(e){e.g=Pe((()=>{e.g=null,e.i&&(e.i=!1,Be(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}y(Me,_e),(s=Me.prototype).ga=!1,s.T=null,s.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ve(this,"tick"),this.ga&&(Ne(this),this.start()))}},s.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},s.N=function(){Me.$.N.call(this),Ne(this),delete this.g};class De extends w{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Be(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Oe(e){w.call(this),this.h=e,this.g={}}y(Oe,w);var Le=[];function Ve(e,t,n,s){Array.isArray(n)||(n&&(Le[0]=n.toString()),n=Le);for(var r=0;r<n.length;r++){var i=ae(t,n[r],s||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function Fe(e){Z(e.g,(function(e,t){this.g.hasOwnProperty(t)&&ue(e)}),e),e.g={}}function Ue(){this.g=!0}function je(e,t,n,s){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var s=n[e];if(!(2>s.length)){var r=s[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<r.length;o++)r[o]=""}}}return ye(n)}catch(e){return t}}(e,n)+(s?" "+s:"")}))}Oe.prototype.N=function(){Oe.$.N.call(this),Fe(this)},Oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ue.prototype.Ea=function(){this.g=!1},Ue.prototype.info=function(){};var qe={},He=null;function ze(){return He=He||new _e}function $e(e){S.call(this,qe.Ta,e)}function Ke(e){const t=ze();ve(t,new $e(t))}function Ge(e,t){S.call(this,qe.STAT_EVENT,e),this.stat=t}function We(e){const t=ze();ve(t,new Ge(t,e))}function Ye(e,t){S.call(this,qe.Ua,e),this.size=t}function Xe(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return u.setTimeout((function(){e()}),t)}qe.Ta="serverreachability",y($e,S),qe.STAT_EVENT="statevent",y(Ge,S),qe.Ua="timingevent",y(Ye,S);var Qe={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Ze={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Je(){}function et(e){return e.h||(e.h=e.i())}function tt(){}Je.prototype.h=null;var nt,st={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function rt(){S.call(this,"d")}function it(){S.call(this,"c")}function ot(){}function at(e,t,n,s){this.l=e,this.j=t,this.m=n,this.W=s||1,this.U=new Oe(this),this.P=lt,e=L?125:void 0,this.V=new Me(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ct}function ct(){this.i=null,this.g="",this.h=!1}y(rt,S),y(it,S),y(ot,Je),ot.prototype.g=function(){return new XMLHttpRequest},ot.prototype.i=function(){return{}},nt=new ot;var lt=45e3,ht={},ut={};function dt(e,t,n){e.L=1,e.v=Mt(Tt(t)),e.s=n,e.S=!0,mt(e,null)}function mt(e,t){e.G=Date.now(),_t(e),e.A=Tt(e.v);var n=e.A,s=e.W;Array.isArray(s)||(s=[String(s)]),zt(n.i,"t",s),e.C=0,n=e.l.J,e.h=new ct,e.g=$n(e.l,n?t:null,!e.s),0<e.O&&(e.M=new De(v(e.Pa,e,e.g),e.O)),Ve(e.U,e.g,"readystatechange",e.nb),t=e.I?J(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),Ke(),function(e,t,n,s,r,i){e.info((function(){if(e.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var h=l[0];l=l[1];var u=h.split("_");o=2<=u.length&&"type"==u[1]?o+(h+"=")+l+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function pt(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.l.Ha)}function ft(e,t,n){let s,r=!0;for(;!e.J&&e.C<n.length;){if(s=gt(e,n),s==ut){4==t&&(e.o=4,We(14),r=!1),je(e.j,e.m,null,"[Incomplete Response]");break}if(s==ht){e.o=4,We(15),je(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}je(e.j,e.m,s,null),kt(e,s)}pt(e)&&s!=ut&&s!=ht&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,We(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ln(t),t.M=!0,We(11))):(je(e.j,e.m,n,"[Invalid Chunked Response]"),wt(e),yt(e))}function gt(e,t){var n=e.C,s=t.indexOf("\n",n);return-1==s?ut:(n=Number(t.substring(n,s)),isNaN(n)?ht:(s+=1)+n>t.length?ut:(t=t.slice(s,s+n),e.C=s+n,t))}function _t(e){e.Y=Date.now()+e.P,vt(e,e.P)}function vt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Xe(v(e.lb,e),t)}function bt(e){e.B&&(u.clearTimeout(e.B),e.B=null)}function yt(e){0==e.l.H||e.J||Un(e.l,e)}function wt(e){bt(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Ne(e.V),Fe(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function kt(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Qt(n.i,e)))if(!e.K&&Qt(n.i,e)&&3==n.H){try{var s=n.Ja.g.parse(t)}catch(e){s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;Fn(n),Rn(n)}On(n),We(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&0==n.A&&!n.v&&(n.v=Xe(v(n.ib,n),6e3));if(1>=Xt(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else qn(n,11)}else if((e.K||n.g==e)&&Fn(n),!C(t))for(r=n.Ja.g.parse(t),t=0;t<r.length;t++){let l=r[t];if(n.V=l[0],l=l[1],2==n.H)if("c"==l[0]){n.K=l[1],n.pa=l[2];const t=l[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const r=l[4];null!=r&&(n.Ga=r,n.l.info("SVER="+n.Ga));const h=l[5];null!=h&&"number"==typeof h&&0<h&&(s=1.5*h,n.L=s,n.l.info("backChannelRequestTimeoutMs_="+s)),s=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=s.i;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Zt(i,i.h),i.h=null))}if(s.F){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(s.Da=e,At(s.I,s.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((s=n).wa=zn(s,s.J?s.pa:null,s.Y),o.K){Jt(s.i,o);var a=o,c=s.L;c&&a.setTimeout(c),a.B&&(bt(a),_t(a)),s.g=o}else Dn(s);0<n.j.length&&Mn(n)}else"stop"!=l[0]&&"close"!=l[0]||qn(n,7);else 3==n.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?qn(n,7):In(n):"noop"!=l[0]&&n.h&&n.h.Aa(l),n.A=0)}Ke()}catch(e){}}function xt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(d(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(d(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const s in e)t[n++]=s;return t}}}(e),s=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(d(e)){for(var t=[],n=e.length,s=0;s<n;s++)t.push(e[s]);return t}for(s in t=[],n=0,e)t[n++]=e[s];return t}(e),r=s.length,i=0;i<r;i++)t.call(void 0,s[i],n&&n[i],e)}(s=at.prototype).setTimeout=function(e){this.P=e},s.nb=function(e){e=e.target;const t=this.M;t&&3==kn(e)?t.l():this.Pa(e)},s.Pa=function(e){try{if(e==this.g)e:{const h=kn(this.g);var t=this.g.Ia();this.g.da();if(!(3>h)&&(3!=h||L||this.g&&(this.h.h||this.g.ja()||xn(this.g)))){this.J||4!=h||7==t||Ke(),bt(this);var n=this.g.da();this.ca=n;t:if(pt(this)){var s=xn(this.g);e="";var r=s.length,i=4==kn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){wt(this),yt(this);var o="";break t}this.h.i=new u.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(s[t],{stream:i&&t==r-1});s.splice(0,r),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,s,r,i,o){e.info((function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(a)){var l=a;break t}}l=null}if(!(n=l)){this.i=!1,this.o=3,We(12),wt(this),yt(this);break e}je(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,kt(this,n)}this.S?(ft(this,h,o),L&&this.i&&3==h&&(Ve(this.U,this.V,"tick",this.mb),this.V.start())):(je(this.j,this.m,o,null),kt(this,o)),4==h&&wt(this),this.i&&!this.J&&(4==h?Un(this.l,this):(this.i=!1,_t(this)))}else(function(e){const t={};e=(e.g&&2<=kn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<e.length;s++){if(C(e[s]))continue;var n=Ee(e[s]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=t[r]||[];t[r]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,We(12)):(this.o=0,We(13)),wt(this),yt(this)}}}catch(e){}},s.mb=function(){if(this.g){var e=kn(this.g),t=this.g.ja();this.C<t.length&&(bt(this),ft(this,e,t),this.i&&4!=e&&_t(this))}},s.cancel=function(){this.J=!0,wt(this)},s.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(Ke(),We(17)),wt(this),this.o=2,yt(this)):vt(this,this.Y-e)};var Et=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function St(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof St){this.h=e.h,Ct(this,e.j),this.s=e.s,this.g=e.g,It(this,e.m),this.l=e.l;var t=e.i,n=new Ut;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Rt(this,n),this.o=e.o}else e&&(t=String(e).match(Et))?(this.h=!1,Ct(this,t[1]||"",!0),this.s=Nt(t[2]||""),this.g=Nt(t[3]||"",!0),It(this,t[4]),this.l=Nt(t[5]||"",!0),Rt(this,t[6]||"",!0),this.o=Nt(t[7]||"")):(this.h=!1,this.i=new Ut(null,this.h))}function Tt(e){return new St(e)}function Ct(e,t,n){e.j=n?Nt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function It(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Rt(e,t,n){t instanceof Ut?(e.i=t,function(e,t){t&&!e.j&&(jt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(qt(this,t),zt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Pt(t,Vt)),e.i=new Ut(t,e.h))}function At(e,t,n){e.i.set(t,n)}function Mt(e){return At(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Nt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Pt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Bt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Bt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}St.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Pt(t,Dt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Pt(t,Dt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Pt(n,"/"==n.charAt(0)?Lt:Ot,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Pt(n,Ft)),e.join("")};var Dt=/[#\/\?@]/g,Ot=/[#\?:]/g,Lt=/[#\?]/g,Vt=/[#\?@]/g,Ft=/#/g;function Ut(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function jt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var s=e[n].indexOf("="),r=null;if(0<=s){var i=e[n].substring(0,s);r=e[n].substring(s+1)}else i=e[n];t(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function qt(e,t){jt(e),t=$t(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Ht(e,t){return jt(e),t=$t(e,t),e.g.has(t)}function zt(e,t,n){qt(e,t),0<n.length&&(e.i=null,e.g.set($t(e,t),x(n)),e.h+=n.length)}function $t(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(s=Ut.prototype).add=function(e,t){jt(this),this.i=null,e=$t(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},s.forEach=function(e,t){jt(this),this.g.forEach((function(n,s){n.forEach((function(n){e.call(t,n,s,this)}),this)}),this)},s.ta=function(){jt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let s=0;s<t.length;s++){const r=e[s];for(let e=0;e<r.length;e++)n.push(t[s])}return n},s.Z=function(e){jt(this);let t=[];if("string"==typeof e)Ht(this,e)&&(t=t.concat(this.g.get($t(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},s.set=function(e,t){return jt(this),this.i=null,Ht(this,e=$t(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},s.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var s=t[n];const i=encodeURIComponent(String(s)),o=this.Z(s);for(s=0;s<o.length;s++){var r=i;""!==o[s]&&(r+="="+encodeURIComponent(String(o[s]))),e.push(r)}}return this.i=e.join("&")};var Kt=class{constructor(e,t){this.g=e,this.map=t}};function Gt(e){this.l=e||Wt,u.PerformanceNavigationTiming?e=0<(e=u.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(u.g&&u.g.Ka&&u.g.Ka()&&u.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Wt=10;function Yt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Xt(e){return e.h?1:e.g?e.g.size:0}function Qt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Zt(e,t){e.g?e.g.add(t):e.h=t}function Jt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function en(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return x(e.i)}Gt.prototype.cancel=function(){if(this.i=en(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var tn=class{stringify(e){return u.JSON.stringify(e,void 0)}parse(e){return u.JSON.parse(e,void 0)}};function nn(){this.g=new tn}function sn(e,t,n){const s=n||"";try{xt(e,(function(e,n){let r=e;m(e)&&(r=ye(e)),t.push(s+n+"="+encodeURIComponent(r))}))}catch(e){throw t.push(s+"type="+encodeURIComponent("_badmap")),e}}function rn(e,t,n,s,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(s)}catch(e){}}function on(e){this.l=e.fc||null,this.j=e.ob||!1}function an(e,t){_e.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=cn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}y(on,Je),on.prototype.g=function(){return new an(this.l,this.j)},on.prototype.i=function(e){return function(){return e}}({}),y(an,_e);var cn=0;function ln(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function hn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,un(e)}function un(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(s=an.prototype).open=function(e,t){if(this.readyState!=cn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,un(this)},s.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||u).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},s.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,hn(this)),this.readyState=cn},s.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,un(this)),this.g&&(this.readyState=3,un(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==u.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ln(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},s.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?hn(this):un(this),3==this.readyState&&ln(this)}},s.Za=function(e){this.g&&(this.response=this.responseText=e,hn(this))},s.Ya=function(e){this.g&&(this.response=e,hn(this))},s.ka=function(){this.g&&hn(this)},s.setRequestHeader=function(e,t){this.v.append(e,t)},s.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(an.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var dn=u.JSON.parse;function mn(e){_e.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=pn,this.L=this.M=!1}y(mn,_e);var pn="",fn=/^https?$/i,gn=["POST","PUT"];function _n(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,vn(e),yn(e)}function vn(e){e.F||(e.F=!0,ve(e,"complete"),ve(e,"error"))}function bn(e){if(e.h&&void 0!==h&&(!e.C[1]||4!=kn(e)||2!=e.da()))if(e.v&&4==kn(e))Pe(e.La,0,e);else if(ve(e,"readystatechange"),4==kn(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===o){var r=String(e.I).match(Et)[1]||null;!r&&u.self&&u.self.location&&(r=u.self.location.protocol.slice(0,-1)),s=!fn.test(r?r.toLowerCase():"")}n=s}if(n)ve(e,"complete"),ve(e,"success");else{e.m=6;try{var i=2<kn(e)?e.g.statusText:""}catch(e){i=""}e.j=i+" ["+e.da()+"]",vn(e)}}finally{yn(e)}}}function yn(e,t){if(e.g){wn(e);const n=e.g,s=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||ve(e,"ready");try{n.onreadystatechange=s}catch(e){}}}function wn(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(u.clearTimeout(e.A),e.A=null)}function kn(e){return e.g?e.g.readyState:0}function xn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case pn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function En(e){let t="";return Z(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Sn(e,t,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=En(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):At(e,t,n))}function Tn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Cn(e){this.Ga=0,this.j=[],this.l=new Ue,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Tn("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Tn("baseRetryDelayMs",5e3,e),this.hb=Tn("retryDelaySeedMs",1e4,e),this.eb=Tn("forwardChannelMaxRetries",2,e),this.xa=Tn("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Gt(e&&e.concurrentRequestLimit),this.Ja=new nn,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function In(e){if(An(e),3==e.H){var t=e.W++,n=Tt(e.I);if(At(n,"SID",e.K),At(n,"RID",t),At(n,"TYPE","terminate"),Pn(e,n),(t=new at(e,e.l,t)).L=2,t.v=Mt(Tt(n)),n=!1,u.navigator&&u.navigator.sendBeacon)try{n=u.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&u.Image&&((new Image).src=t.v,n=!0),n||(t.g=$n(t.l,null),t.g.ha(t.v)),t.G=Date.now(),_t(t)}Hn(e)}function Rn(e){e.g&&(Ln(e),e.g.cancel(),e.g=null)}function An(e){Rn(e),e.u&&(u.clearTimeout(e.u),e.u=null),Fn(e),e.i.cancel(),e.m&&("number"==typeof e.m&&u.clearTimeout(e.m),e.m=null)}function Mn(e){if(!Yt(e.i)&&!e.m){e.m=!0;var t=e.Na;Te||Re(),Ce||(Te(),Ce=!0),Ie.add(t,e),e.C=0}}function Nn(e,t){var n;n=t?t.m:e.W++;const s=Tt(e.I);At(s,"SID",e.K),At(s,"RID",n),At(s,"AID",e.V),Pn(e,s),e.o&&e.s&&Sn(s,e.o,e.s),n=new at(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Bn(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),Zt(e.i,n),dt(n,s,t)}function Pn(e,t){e.na&&Z(e.na,(function(e,n){At(t,n,e)})),e.h&&xt({},(function(e,n){At(t,n,e)}))}function Bn(e,t,n){n=Math.min(e.j.length,n);var s=e.h?v(e.h.Va,e.h,e):null;e:{var r=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let i=!0;for(let o=0;o<n;o++){let n=r[o].g;const a=r[o].map;if(n-=t,0>n)t=Math.max(0,r[o].g-100),i=!1;else try{sn(a,e,"req"+n+"_")}catch(e){s&&s(a)}}if(i){s=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,s}function Dn(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Te||Re(),Ce||(Te(),Ce=!0),Ie.add(t,e),e.A=0}}function On(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=Xe(v(e.Ma,e),jn(e,e.A)),e.A++,!0)}function Ln(e){null!=e.B&&(u.clearTimeout(e.B),e.B=null)}function Vn(e){e.g=new at(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Tt(e.wa);At(t,"RID","rpc"),At(t,"SID",e.K),At(t,"AID",e.V),At(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&At(t,"TO",e.qa),At(t,"TYPE","xmlhttp"),Pn(e,t),e.o&&e.s&&Sn(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=Mt(Tt(t)),n.s=null,n.S=!0,mt(n,e)}function Fn(e){null!=e.v&&(u.clearTimeout(e.v),e.v=null)}function Un(e,t){var n=null;if(e.g==t){Fn(e),Ln(e),e.g=null;var s=2}else{if(!Qt(e.i,t))return;n=t.F,Jt(e.i,t),s=1}if(0!=e.H)if(t.i)if(1==s){n=t.s?t.s.length:0,t=Date.now()-t.G;var r=e.C;ve(s=ze(),new Ye(s,n)),Mn(e)}else Dn(e);else if(3==(r=t.o)||0==r&&0<t.ca||!(1==s&&function(e,t){return!(Xt(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=Xe(v(e.Na,e,t),jn(e,e.C)),e.C++,0)))}(e,t)||2==s&&On(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),r){case 1:qn(e,5);break;case 4:qn(e,10);break;case 3:qn(e,6);break;default:qn(e,2)}}function jn(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function qn(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var s=v(e.pb,e);n||(n=new St("//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||Ct(n,"https"),Mt(n)),function(e,t){const n=new Ue;if(u.Image){const s=new Image;s.onload=b(rn,n,s,"TestLoadImage: loaded",!0,t),s.onerror=b(rn,n,s,"TestLoadImage: error",!1,t),s.onabort=b(rn,n,s,"TestLoadImage: abort",!1,t),s.ontimeout=b(rn,n,s,"TestLoadImage: timeout",!1,t),u.setTimeout((function(){s.ontimeout&&s.ontimeout()}),1e4),s.src=e}else t(!1)}(n.toString(),s)}else We(2);e.H=0,e.h&&e.h.za(t),Hn(e),An(e)}function Hn(e){if(e.H=0,e.ma=[],e.h){const t=en(e.i);0==t.length&&0==e.j.length||(E(e.ma,t),E(e.ma,e.j),e.i.i.length=0,x(e.j),e.j.length=0),e.h.ya()}}function zn(e,t,n){var s=n instanceof St?Tt(n):new St(n);if(""!=s.g)t&&(s.g=t+"."+s.g),It(s,s.m);else{var r=u.location;s=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var i=new St(null);s&&Ct(i,s),t&&(i.g=t),r&&It(i,r),n&&(i.l=n),s=i}return n=e.F,t=e.Da,n&&t&&At(s,n,t),At(s,"VER",e.ra),Pn(e,s),s}function $n(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new mn(new on({ob:!0})):new mn(e.va)).Oa(e.J),t}function Kn(){}function Gn(){if(D&&!(10<=Number($)))throw Error("Environmental error: no available transport.")}function Wn(e,t){_e.call(this),this.g=new Cn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!C(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!C(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Qn(this)}function Yn(e){rt.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Xn(){it.call(this),this.status=1}function Qn(e){this.g=e}function Zn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Jn(e,t,n){n||(n=0);var s=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)s[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)s[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var i=e.g[3],o=t+(i^n&(r^i))+s[0]+3614090360&4294967295;o=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=n+(o<<7&4294967295|o>>>25))+((o=i+(r^t&(n^r))+s[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(t^n))+s[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(i^t))+s[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(r^i))+s[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^t&(n^r))+s[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(t^n))+s[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(i^t))+s[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(r^i))+s[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^t&(n^r))+s[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(t^n))+s[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(i^t))+s[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(r^i))+s[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^t&(n^r))+s[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(t^n))+s[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(i^t))+s[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^i&(n^r))+s[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(t^n))+s[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(i^t))+s[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(r^i))+s[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^i&(n^r))+s[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(t^n))+s[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(i^t))+s[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(r^i))+s[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^i&(n^r))+s[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(t^n))+s[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(i^t))+s[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(r^i))+s[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^i&(n^r))+s[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(t^n))+s[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(i^t))+s[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(r^i))+s[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^r^i)+s[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^r)+s[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^t^n)+s[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^t)+s[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^i)+s[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^r)+s[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^t^n)+s[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^t)+s[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^i)+s[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^r)+s[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^t^n)+s[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^t)+s[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^i)+s[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^r)+s[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^t^n)+s[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^t)+s[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^(n|~i))+s[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~r))+s[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(i|~n))+s[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(r|~t))+s[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(n|~i))+s[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~r))+s[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(i|~n))+s[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(r|~t))+s[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(n|~i))+s[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~r))+s[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(i|~n))+s[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(r|~t))+s[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(t=n+((o=t+(r^(n|~i))+s[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~r))+s[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=i+((o=r+(t^(i|~n))+s[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+s[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+i&4294967295}function es(e,t){this.h=t;for(var n=[],s=!0,r=e.length-1;0<=r;r--){var i=0|e[r];s&&i==t||(n[r]=i,s=!1)}this.g=n}(s=mn.prototype).Oa=function(e){this.M=e},s.ha=function(e,t,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():nt.g(),this.C=this.u?et(this.u):et(nt),this.g.onreadystatechange=v(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void _n(this,e)}if(e=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const e of s.keys())n.set(e,s.get(e))}s=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),r=u.FormData&&e instanceof u.FormData,!(0<=k(gn,t))||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{wn(this),0<this.B&&((this.L=function(e){return D&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=v(this.ua,this)):this.A=Pe(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){_n(this,e)}},s.ua=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ve(this,"timeout"),this.abort(8))},s.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,ve(this,"complete"),ve(this,"abort"),yn(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),yn(this,!0)),mn.$.N.call(this)},s.La=function(){this.s||(this.G||this.v||this.l?bn(this):this.kb())},s.kb=function(){bn(this)},s.isActive=function(){return!!this.g},s.da=function(){try{return 2<kn(this)?this.g.status:-1}catch(e){return-1}},s.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},s.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),dn(t)}},s.Ia=function(){return this.m},s.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(s=Cn.prototype).ra=8,s.H=1,s.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const r=new at(this,this.l,e);let i=this.s;if(this.U&&(i?(i=J(i),te(i,this.U)):i=this.U),null!==this.o||this.O||(r.I=i,i=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var s=this.j[n];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if(4096<(t+=s)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Bn(this,r,t),At(n=Tt(this.I),"RID",e),At(n,"CVER",22),this.F&&At(n,"X-HTTP-Session-Id",this.F),Pn(this,n),i&&(this.O?t="headers="+encodeURIComponent(String(En(i)))+"&"+t:this.o&&Sn(n,this.o,i)),Zt(this.i,r),this.bb&&At(n,"TYPE","init"),this.P?(At(n,"$req",t),At(n,"SID","null"),r.aa=!0,dt(r,n,null)):dt(r,n,t),this.H=2}}else 3==this.H&&(e?Nn(this,e):0==this.j.length||Yt(this.i)||Nn(this))},s.Ma=function(){if(this.u=null,Vn(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Xe(v(this.jb,this),e)}},s.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,We(10),Rn(this),Vn(this))},s.ib=function(){null!=this.v&&(this.v=null,Rn(this),On(this),We(19))},s.pb=function(e){e?(this.l.info("Successfully pinged google.com"),We(2)):(this.l.info("Failed to ping google.com"),We(1))},s.isActive=function(){return!!this.h&&this.h.isActive(this)},(s=Kn.prototype).Ba=function(){},s.Aa=function(){},s.za=function(){},s.ya=function(){},s.isActive=function(){return!0},s.Va=function(){},Gn.prototype.g=function(e,t){return new Wn(e,t)},y(Wn,_e),Wn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;We(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=zn(e,null,e.Y),Mn(e)},Wn.prototype.close=function(){In(this.g)},Wn.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ye(e),e=n);t.j.push(new Kt(t.fb++,e)),3==t.H&&Mn(t)},Wn.prototype.N=function(){this.g.h=null,delete this.j,In(this.g),delete this.g,Wn.$.N.call(this)},y(Yn,rt),y(Xn,it),y(Qn,Kn),Qn.prototype.Ba=function(){ve(this.g,"a")},Qn.prototype.Aa=function(e){ve(this.g,new Yn(e))},Qn.prototype.za=function(e){ve(this.g,new Xn)},Qn.prototype.ya=function(){ve(this.g,"b")},y(Zn,(function(){this.blockSize=-1})),Zn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Zn.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,s=this.m,r=this.h,i=0;i<t;){if(0==r)for(;i<=n;)Jn(this,e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(s[r++]=e.charCodeAt(i++),r==this.blockSize){Jn(this,s),r=0;break}}else for(;i<t;)if(s[r++]=e[i++],r==this.blockSize){Jn(this,s),r=0;break}}this.h=r,this.i+=t},Zn.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var s=0;32>s;s+=8)e[n++]=this.g[t]>>>s&255;return e};var ts={};function ns(e){return-128<=e&&128>e?function(e,t){var n=ts;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new es([0|e],0>e?-1:0)})):new es([0|e],0>e?-1:0)}function ss(e){if(isNaN(e)||!isFinite(e))return is;if(0>e)return hs(ss(-e));for(var t=[],n=1,s=0;e>=n;s++)t[s]=e/n|0,n*=rs;return new es(t,0)}var rs=4294967296,is=ns(0),os=ns(1),as=ns(16777216);function cs(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function ls(e){return-1==e.h}function hs(e){for(var t=e.g.length,n=[],s=0;s<t;s++)n[s]=~e.g[s];return new es(n,~e.h).add(os)}function us(e,t){return e.add(hs(t))}function ds(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function ms(e,t){this.g=e,this.h=t}function ps(e,t){if(cs(t))throw Error("division by zero");if(cs(e))return new ms(is,is);if(ls(e))return t=ps(hs(e),t),new ms(hs(t.g),hs(t.h));if(ls(t))return t=ps(e,hs(t)),new ms(hs(t.g),t.h);if(30<e.g.length){if(ls(e)||ls(t))throw Error("slowDivide_ only works with positive integers.");for(var n=os,s=t;0>=s.X(e);)n=fs(n),s=fs(s);var r=gs(n,1),i=gs(s,1);for(s=gs(s,2),n=gs(n,2);!cs(s);){var o=i.add(s);0>=o.X(e)&&(r=r.add(n),i=o),s=gs(s,1),n=gs(n,1)}return t=us(e,r.R(t)),new ms(r,t)}for(r=is;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),s=48>=(s=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,s-48),o=(i=ss(n)).R(t);ls(o)||0<o.X(e);)o=(i=ss(n-=s)).R(t);cs(i)&&(i=os),r=r.add(i),e=us(e,o)}return new ms(r,e)}function fs(e){for(var t=e.g.length+1,n=[],s=0;s<t;s++)n[s]=e.D(s)<<1|e.D(s-1)>>>31;return new es(n,e.h)}function gs(e,t){var n=t>>5;t%=32;for(var s=e.g.length-n,r=[],i=0;i<s;i++)r[i]=0<t?e.D(i+n)>>>t|e.D(i+n+1)<<32-t:e.D(i+n);return new es(r,e.h)}(s=es.prototype).ea=function(){if(ls(this))return-hs(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var s=this.D(n);e+=(0<=s?s:rs+s)*t,t*=rs}return e},s.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(cs(this))return"0";if(ls(this))return"-"+hs(this).toString(e);for(var t=ss(Math.pow(e,6)),n=this,s="";;){var r=ps(n,t).g,i=((0<(n=us(n,r.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(cs(n=r))return i+s;for(;6>i.length;)i="0"+i;s=i+s}},s.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},s.X=function(e){return ls(e=us(this,e))?-1:cs(e)?0:1},s.abs=function(){return ls(this)?hs(this):this},s.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0,r=0;r<=t;r++){var i=s+(65535&this.D(r))+(65535&e.D(r)),o=(i>>>16)+(this.D(r)>>>16)+(e.D(r)>>>16);s=o>>>16,i&=65535,o&=65535,n[r]=o<<16|i}return new es(n,-2147483648&n[n.length-1]?-1:0)},s.R=function(e){if(cs(this)||cs(e))return is;if(ls(this))return ls(e)?hs(this).R(hs(e)):hs(hs(this).R(e));if(ls(e))return hs(this.R(hs(e)));if(0>this.X(as)&&0>e.X(as))return ss(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],s=0;s<2*t;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var r=0;r<e.g.length;r++){var i=this.D(s)>>>16,o=65535&this.D(s),a=e.D(r)>>>16,c=65535&e.D(r);n[2*s+2*r]+=o*c,ds(n,2*s+2*r),n[2*s+2*r+1]+=i*c,ds(n,2*s+2*r+1),n[2*s+2*r+1]+=o*a,ds(n,2*s+2*r+1),n[2*s+2*r+2]+=i*a,ds(n,2*s+2*r+2)}for(s=0;s<t;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=t;s<2*t;s++)n[s]=0;return new es(n,0)},s.gb=function(e){return ps(this,e).h},s.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.D(s)&e.D(s);return new es(n,this.h&e.h)},s.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.D(s)|e.D(s);return new es(n,this.h|e.h)},s.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.D(s)^e.D(s);return new es(n,this.h^e.h)},Gn.prototype.createWebChannel=Gn.prototype.g,Wn.prototype.send=Wn.prototype.u,Wn.prototype.open=Wn.prototype.m,Wn.prototype.close=Wn.prototype.close,Qe.NO_ERROR=0,Qe.TIMEOUT=8,Qe.HTTP_ERROR=6,Ze.COMPLETE="complete",tt.EventType=st,st.OPEN="a",st.CLOSE="b",st.ERROR="c",st.MESSAGE="d",_e.prototype.listen=_e.prototype.O,mn.prototype.listenOnce=mn.prototype.P,mn.prototype.getLastError=mn.prototype.Sa,mn.prototype.getLastErrorCode=mn.prototype.Ia,mn.prototype.getStatus=mn.prototype.da,mn.prototype.getResponseJson=mn.prototype.Wa,mn.prototype.getResponseText=mn.prototype.ja,mn.prototype.send=mn.prototype.ha,mn.prototype.setWithCredentials=mn.prototype.Oa,Zn.prototype.digest=Zn.prototype.l,Zn.prototype.reset=Zn.prototype.reset,Zn.prototype.update=Zn.prototype.j,es.prototype.add=es.prototype.add,es.prototype.multiply=es.prototype.R,es.prototype.modulo=es.prototype.gb,es.prototype.compare=es.prototype.X,es.prototype.toNumber=es.prototype.ea,es.prototype.toString=es.prototype.toString,es.prototype.getBits=es.prototype.D,es.fromNumber=ss,es.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return hs(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var s=ss(Math.pow(n,8)),r=is,i=0;i<t.length;i+=8){var o=Math.min(8,t.length-i),a=parseInt(t.substring(i,i+o),n);8>o?(o=ss(Math.pow(n,o)),r=r.R(o).add(ss(a))):r=(r=r.R(s)).add(ss(a))}return r};var _s=l.createWebChannelTransport=function(){return new Gn},vs=l.getStatEventTarget=function(){return ze()},bs=l.ErrorCode=Qe,ys=l.EventType=Ze,ws=l.Event=qe,ks=l.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},xs=l.FetchXmlHttpFactory=on,Es=l.WebChannel=tt,Ss=l.XhrIo=mn,Ts=l.Md5=Zn,Cs=l.Integer=es;n(34155);const Is="@firebase/firestore";class Rs{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Rs.UNAUTHENTICATED=new Rs(null),Rs.GOOGLE_CREDENTIALS=new Rs("google-credentials-uid"),Rs.FIRST_PARTY=new Rs("first-party-uid"),Rs.MOCK_USER=new Rs("mock-user");let As="9.23.0";const Ms=new o.Yd("@firebase/firestore");function Ns(){return Ms.logLevel}function Ps(e,...t){if(Ms.logLevel<=o.in.DEBUG){const n=t.map(Os);Ms.debug(`Firestore (${As}): ${e}`,...n)}}function Bs(e,...t){if(Ms.logLevel<=o.in.ERROR){const n=t.map(Os);Ms.error(`Firestore (${As}): ${e}`,...n)}}function Ds(e,...t){if(Ms.logLevel<=o.in.WARN){const n=t.map(Os);Ms.warn(`Firestore (${As}): ${e}`,...n)}}function Os(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Ls(e="Unexpected state"){const t=`FIRESTORE (${As}) INTERNAL ASSERTION FAILED: `+e;throw Bs(t),new Error(t)}function Vs(e,t){e||Ls()}function Fs(e,t){return e}const Us={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class js extends a.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class qs{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Hs{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class zs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Rs.UNAUTHENTICATED)))}shutdown(){}}class $s{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Ks{constructor(e){this.t=e,this.currentUser=Rs.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const s=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new qs;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new qs,e.enqueueRetryable((()=>s(this.currentUser)))};const i=()=>{const t=r;e.enqueueRetryable((async()=>{await t.promise,await s(this.currentUser)}))},o=e=>{Ps("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Ps("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new qs)}}),0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Ps("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Vs("string"==typeof t.accessToken),new Hs(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Vs(null===e||"string"==typeof e),new Rs(e)}}class Gs{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=Rs.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Ws{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Gs(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(Rs.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ys{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Xs{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const n=e=>{null!=e.error&&Ps("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.T;return this.T=e.token,Ps("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const s=e=>{Ps("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit((e=>s(e))),setTimeout((()=>{if(!this.appCheck){const e=this.I.getImmediate({optional:!0});e?s(e):Ps("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Vs("string"==typeof e.token),this.T=e.token,new Ys(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Qs(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Zs{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const s=Qs(40);for(let r=0;r<s.length;++r)n.length<20&&s[r]<t&&(n+=e.charAt(s[r]%62))}return n}}function Js(e,t){return e<t?-1:e>t?1:0}function er(e,t,n){return e.length===t.length&&e.every(((e,s)=>n(e,t[s])))}class tr{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new js(Us.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new js(Us.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new js(Us.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new js(Us.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return tr.fromMillis(Date.now())}static fromDate(e){return tr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new tr(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Js(this.nanoseconds,e.nanoseconds):Js(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class nr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new nr(e)}static min(){return new nr(new tr(0,0))}static max(){return new nr(new tr(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class sr{constructor(e,t,n){void 0===t?t=0:t>e.length&&Ls(),void 0===n?n=e.length-t:n>e.length-t&&Ls(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===sr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof sr?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const n=e.get(s),r=t.get(s);if(n<r)return-1;if(n>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class rr extends sr{construct(e,t,n){return new rr(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new js(Us.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new rr(t)}static emptyPath(){return new rr([])}}const ir=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class or extends sr{construct(e,t,n){return new or(e,t,n)}static isValidIdentifier(e){return ir.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),or.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new or(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const r=()=>{if(0===n.length)throw new js(Us.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;s<e.length;){const t=e[s];if("\\"===t){if(s+1===e.length)throw new js(Us.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[s+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new js(Us.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,s+=2}else"`"===t?(i=!i,s++):"."!==t||i?(n+=t,s++):(r(),s++)}if(r(),i)throw new js(Us.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new or(t)}static emptyPath(){return new or([])}}class ar{constructor(e){this.path=e}static fromPath(e){return new ar(rr.fromString(e))}static fromName(e){return new ar(rr.fromString(e).popFirst(5))}static empty(){return new ar(rr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===rr.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return rr.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ar(new rr(e.slice()))}}class cr{constructor(e,t,n,s){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=s}}cr.UNKNOWN_ID=-1;function lr(e,t){const n=e.toTimestamp().seconds,s=e.toTimestamp().nanoseconds+1,r=nr.fromTimestamp(1e9===s?new tr(n+1,0):new tr(n,s));return new ur(r,ar.empty(),t)}function hr(e){return new ur(e.readTime,e.key,-1)}class ur{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ur(nr.min(),ar.empty(),-1)}static max(){return new ur(nr.max(),ar.empty(),-1)}}function dr(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ar.comparator(e.documentKey,t.documentKey),0!==n?n:Js(e.largestBatchId,t.largestBatchId))}const mr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class pr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function fr(e){if(e.code!==Us.FAILED_PRECONDITION||e.message!==mr)throw e;Ps("LocalStore","Unexpectedly lost primary lease")}class gr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ls(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new gr(((n,s)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,s)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof gr?t:gr.resolve(t)}catch(e){return gr.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):gr.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):gr.reject(t)}static resolve(e){return new gr(((t,n)=>{t(e)}))}static reject(e){return new gr(((t,n)=>{n(e)}))}static waitFor(e){return new gr(((t,n)=>{let s=0,r=0,i=!1;e.forEach((e=>{++s,e.next((()=>{++r,i&&r===s&&t()}),(e=>n(e)))})),i=!0,r===s&&t()}))}static or(e){let t=gr.resolve(!1);for(const n of e)t=t.next((e=>e?gr.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,s)=>{n.push(t.call(this,e,s))})),this.waitFor(n)}static mapArray(e,t){return new gr(((n,s)=>{const r=e.length,i=new Array(r);let o=0;for(let a=0;a<r;a++){const c=a;t(e[c]).next((e=>{i[c]=e,++o,o===r&&n(i)}),(e=>s(e)))}}))}static doWhile(e,t){return new gr(((n,s)=>{const r=()=>{!0===e()?t().next((()=>{r()}),s):n()};r()}))}}function _r(e){return"IndexedDbTransactionError"===e.name}class vr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}function br(e){return null==e}function yr(e){return 0===e&&1/e==-1/0}function wr(e){return"number"==typeof e&&Number.isInteger(e)&&!yr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}vr.ct=-1;const kr=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],xr=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Er=xr;function Sr(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Tr(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Cr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ir{constructor(e,t){this.comparator=e,this.root=t||Ar.EMPTY}insert(e,t){return new Ir(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ar.BLACK,null,null))}remove(e){return new Ir(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ar.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Rr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Rr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Rr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Rr(this.root,e,this.comparator,!0)}}class Rr{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ar{constructor(e,t,n,s,r){this.key=e,this.value=t,this.color=null!=n?n:Ar.RED,this.left=null!=s?s:Ar.EMPTY,this.right=null!=r?r:Ar.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,r){return new Ar(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const r=n(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===r?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ar.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return Ar.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ar.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ar.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ls();if(this.right.isRed())throw Ls();const e=this.left.check();if(e!==this.right.check())throw Ls();return e+(this.isRed()?0:1)}}Ar.EMPTY=null,Ar.RED=!0,Ar.BLACK=!1,Ar.EMPTY=new class{constructor(){this.size=0}get key(){throw Ls()}get value(){throw Ls()}get color(){throw Ls()}get left(){throw Ls()}get right(){throw Ls()}copy(e,t,n,s,r){return this}insert(e,t,n){return new Ar(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Mr{constructor(e){this.comparator=e,this.data=new Ir(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Nr(this.data.getIterator())}getIteratorFrom(e){return new Nr(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Mr))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(e,s))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Mr(this.comparator);return t.data=e,t}}class Nr{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Pr{constructor(e){this.fields=e,e.sort(or.comparator)}static empty(){return new Pr([])}unionWith(e){let t=new Mr(or.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Pr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return er(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Br extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Dr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Br("Invalid base64 string: "+e):e}}(e);return new Dr(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Dr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Js(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Dr.EMPTY_BYTE_STRING=new Dr("");const Or=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Lr(e){if(Vs(!!e),"string"==typeof e){let t=0;const n=Or.exec(e);if(Vs(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:Vr(e.seconds),nanos:Vr(e.nanos)}}function Vr(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Fr(e){return"string"==typeof e?Dr.fromBase64String(e):Dr.fromUint8Array(e)}function Ur(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function jr(e){const t=e.mapValue.fields.__previous_value__;return Ur(t)?jr(t):t}function qr(e){const t=Lr(e.mapValue.fields.__local_write_time__.timestampValue);return new tr(t.seconds,t.nanos)}class Hr{constructor(e,t,n,s,r,i,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class zr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new zr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof zr&&e.projectId===this.projectId&&e.database===this.database}}const $r={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Kr(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ur(e)?4:oi(e)?9007199254740991:10:Ls()}function Gr(e,t){if(e===t)return!0;const n=Kr(e);if(n!==Kr(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return qr(e).isEqual(qr(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Lr(e.timestampValue),s=Lr(t.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Fr(e.bytesValue).isEqual(Fr(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Vr(e.geoPointValue.latitude)===Vr(t.geoPointValue.latitude)&&Vr(e.geoPointValue.longitude)===Vr(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Vr(e.integerValue)===Vr(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Vr(e.doubleValue),s=Vr(t.doubleValue);return n===s?yr(n)===yr(s):isNaN(n)&&isNaN(s)}return!1}(e,t);case 9:return er(e.arrayValue.values||[],t.arrayValue.values||[],Gr);case 10:return function(e,t){const n=e.mapValue.fields||{},s=t.mapValue.fields||{};if(Sr(n)!==Sr(s))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===s[e]||!Gr(n[e],s[e])))return!1;return!0}(e,t);default:return Ls()}}function Wr(e,t){return void 0!==(e.values||[]).find((e=>Gr(e,t)))}function Yr(e,t){if(e===t)return 0;const n=Kr(e),s=Kr(t);if(n!==s)return Js(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return Js(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Vr(e.integerValue||e.doubleValue),s=Vr(t.integerValue||t.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(e,t);case 3:return Xr(e.timestampValue,t.timestampValue);case 4:return Xr(qr(e),qr(t));case 5:return Js(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Fr(e),s=Fr(t);return n.compareTo(s)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),s=t.split("/");for(let e=0;e<n.length&&e<s.length;e++){const t=Js(n[e],s[e]);if(0!==t)return t}return Js(n.length,s.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Js(Vr(e.latitude),Vr(t.latitude));return 0!==n?n:Js(Vr(e.longitude),Vr(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],s=t.values||[];for(let e=0;e<n.length&&e<s.length;++e){const t=Yr(n[e],s[e]);if(t)return t}return Js(n.length,s.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===$r.mapValue&&t===$r.mapValue)return 0;if(e===$r.mapValue)return 1;if(t===$r.mapValue)return-1;const n=e.fields||{},s=Object.keys(n),r=t.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let e=0;e<s.length&&e<i.length;++e){const t=Js(s[e],i[e]);if(0!==t)return t;const o=Yr(n[s[e]],r[i[e]]);if(0!==o)return o}return Js(s.length,i.length)}(e.mapValue,t.mapValue);default:throw Ls()}}function Xr(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Js(e,t);const n=Lr(e),s=Lr(t),r=Js(n.seconds,s.seconds);return 0!==r?r:Js(n.nanos,s.nanos)}function Qr(e){return Zr(e)}function Zr(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Lr(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Fr(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,ar.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const s of e.values||[])n?n=!1:t+=",",t+=Zr(s);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",s=!0;for(const r of t)s?s=!1:n+=",",n+=`${r}:${Zr(e.fields[r])}`;return n+"}"}(e.mapValue):Ls();var t,n}function Jr(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ei(e){return!!e&&"integerValue"in e}function ti(e){return!!e&&"arrayValue"in e}function ni(e){return!!e&&"nullValue"in e}function si(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ri(e){return!!e&&"mapValue"in e}function ii(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Tr(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=ii(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ii(e.arrayValue.values[n]);return t}return Object.assign({},e)}function oi(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class ai{constructor(e){this.value=e}static empty(){return new ai({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ri(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ii(t)}setAll(e){let t=or.emptyPath(),n={},s=[];e.forEach(((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,s),n={},s=[],t=r.popLast()}e?n[r.lastSegment()]=ii(e):s.push(r.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,n,s)}delete(e){const t=this.field(e.popLast());ri(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Gr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];ri(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Tr(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new ai(ii(this.value))}}function ci(e){const t=[];return Tr(e.fields,((e,n)=>{const s=new or([e]);if(ri(n)){const e=ci(n.mapValue).fields;if(0===e.length)t.push(s);else for(const n of e)t.push(s.child(n))}else t.push(s)})),new Pr(t)}class li{constructor(e,t,n,s,r,i,o){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=r,this.data=i,this.documentState=o}static newInvalidDocument(e){return new li(e,0,nr.min(),nr.min(),nr.min(),ai.empty(),0)}static newFoundDocument(e,t,n,s){return new li(e,1,t,nr.min(),n,s,0)}static newNoDocument(e,t){return new li(e,2,t,nr.min(),nr.min(),ai.empty(),0)}static newUnknownDocument(e,t){return new li(e,3,t,nr.min(),nr.min(),ai.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(nr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ai.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ai.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=nr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof li&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new li(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class hi{constructor(e,t){this.position=e,this.inclusive=t}}function ui(e,t,n){let s=0;for(let r=0;r<e.position.length;r++){const i=t[r],o=e.position[r];if(s=i.field.isKeyField()?ar.comparator(ar.fromName(o.referenceValue),n.key):Yr(o,n.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function di(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Gr(e.position[n],t.position[n]))return!1;return!0}class mi{constructor(e,t="asc"){this.field=e,this.dir=t}}function pi(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class fi{}class gi extends fi{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Ei(e,t,n):"array-contains"===t?new Ii(e,n):"in"===t?new Ri(e,n):"not-in"===t?new Ai(e,n):"array-contains-any"===t?new Mi(e,n):new gi(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Si(e,n):new Ti(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Yr(t,this.value)):null!==t&&Kr(this.value)===Kr(t)&&this.matchesComparison(Yr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ls()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class _i extends fi{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new _i(e,t)}matches(e){return vi(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft((e=>e.isInequality()));return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function vi(e){return"and"===e.op}function bi(e){return yi(e)&&vi(e)}function yi(e){for(const t of e.filters)if(t instanceof _i)return!1;return!0}function wi(e){if(e instanceof gi)return e.field.canonicalString()+e.op.toString()+Qr(e.value);if(bi(e))return e.filters.map((e=>wi(e))).join(",");{const t=e.filters.map((e=>wi(e))).join(",");return`${e.op}(${t})`}}function ki(e,t){return e instanceof gi?function(e,t){return t instanceof gi&&e.op===t.op&&e.field.isEqual(t.field)&&Gr(e.value,t.value)}(e,t):e instanceof _i?function(e,t){return t instanceof _i&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,s)=>e&&ki(n,t.filters[s])),!0)}(e,t):void Ls()}function xi(e){return e instanceof gi?function(e){return`${e.field.canonicalString()} ${e.op} ${Qr(e.value)}`}(e):e instanceof _i?function(e){return e.op.toString()+" {"+e.getFilters().map(xi).join(" ,")+"}"}(e):"Filter"}class Ei extends gi{constructor(e,t,n){super(e,t,n),this.key=ar.fromName(n.referenceValue)}matches(e){const t=ar.comparator(e.key,this.key);return this.matchesComparison(t)}}class Si extends gi{constructor(e,t){super(e,"in",t),this.keys=Ci("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Ti extends gi{constructor(e,t){super(e,"not-in",t),this.keys=Ci("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ci(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>ar.fromName(e.referenceValue)))}class Ii extends gi{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ti(t)&&Wr(t.arrayValue,this.value)}}class Ri extends gi{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Wr(this.value.arrayValue,t)}}class Ai extends gi{constructor(e,t){super(e,"not-in",t)}matches(e){if(Wr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Wr(this.value.arrayValue,t)}}class Mi extends gi{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ti(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Wr(this.value.arrayValue,e)))}}class Ni{constructor(e,t=null,n=[],s=[],r=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=o,this.dt=null}}function Pi(e,t=null,n=[],s=[],r=null,i=null,o=null){return new Ni(e,t,n,s,r,i,o)}function Bi(e){const t=Fs(e);if(null===t.dt){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>wi(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),br(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Qr(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Qr(e))).join(",")),t.dt=e}return t.dt}function Di(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!pi(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!ki(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!di(e.startAt,t.startAt)&&di(e.endAt,t.endAt)}function Oi(e){return ar.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Li{constructor(e,t=null,n=[],s=[],r=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=i,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function Vi(e,t,n,s,r,i,o,a){return new Li(e,t,n,s,r,i,o,a)}function Fi(e){return new Li(e)}function Ui(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ji(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function qi(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Hi(e){return null!==e.collectionGroup}function zi(e){const t=Fs(e);if(null===t.wt){t.wt=[];const e=qi(t),n=ji(t);if(null!==e&&null===n)e.isKeyField()||t.wt.push(new mi(e)),t.wt.push(new mi(or.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.wt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new mi(or.keyField(),e))}}}return t.wt}function $i(e){const t=Fs(e);if(!t._t)if("F"===t.limitType)t._t=Pi(t.path,t.collectionGroup,zi(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of zi(t)){const t="desc"===n.dir?"asc":"desc";e.push(new mi(n.field,t))}const n=t.endAt?new hi(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new hi(t.startAt.position,t.startAt.inclusive):null;t._t=Pi(t.path,t.collectionGroup,e,t.filters,t.limit,n,s)}return t._t}function Ki(e,t){t.getFirstInequalityField(),qi(e);const n=e.filters.concat([t]);return new Li(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Gi(e,t,n){return new Li(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Wi(e,t){return Di($i(e),$i(t))&&e.limitType===t.limitType}function Yi(e){return`${Bi($i(e))}|lt:${e.limitType}`}function Xi(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>xi(e))).join(", ")}]`),br(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Qr(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Qr(e))).join(",")),`Target(${t})`}($i(e))}; limitType=${e.limitType})`}function Qi(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ar.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of zi(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const s=ui(e,t,n);return e.inclusive?s<=0:s<0}(e.startAt,zi(e),t))&&!(e.endAt&&!function(e,t,n){const s=ui(e,t,n);return e.inclusive?s>=0:s>0}(e.endAt,zi(e),t))}(e,t)}function Zi(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Ji(e){return(t,n)=>{let s=!1;for(const r of zi(e)){const e=eo(r,t,n);if(0!==e)return e;s=s||r.field.isKeyField()}return 0}}function eo(e,t,n){const s=e.field.isKeyField()?ar.comparator(t.key,n.key):function(e,t,n){const s=t.data.field(e),r=n.data.field(e);return null!==s&&null!==r?Yr(s,r):Ls()}(e.field,t,n);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return Ls()}}class to{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,s]of n)if(this.equalsFn(t,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],e))return void(s[n]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Tr(this.inner,((t,n)=>{for(const[t,s]of n)e(t,s)}))}isEmpty(){return Cr(this.inner)}size(){return this.innerSize}}const no=new Ir(ar.comparator);function so(){return no}const ro=new Ir(ar.comparator);function io(...e){let t=ro;for(const n of e)t=t.insert(n.key,n);return t}function oo(e){let t=ro;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function ao(){return lo()}function co(){return lo()}function lo(){return new to((e=>e.toString()),((e,t)=>e.isEqual(t)))}const ho=new Ir(ar.comparator),uo=new Mr(ar.comparator);function mo(...e){let t=uo;for(const n of e)t=t.add(n);return t}const po=new Mr(Js);function fo(){return po}function go(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:yr(t)?"-0":t}}function _o(e){return{integerValue:""+e}}function vo(e,t){return wr(t)?_o(t):go(e,t)}class bo{constructor(){this._=void 0}}function yo(e,t,n){return e instanceof xo?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Ur(t)&&(t=jr(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Eo?So(e,t):e instanceof To?Co(e,t):function(e,t){const n=ko(e,t),s=Ro(n)+Ro(e.gt);return ei(n)&&ei(e.gt)?_o(s):go(e.serializer,s)}(e,t)}function wo(e,t,n){return e instanceof Eo?So(e,t):e instanceof To?Co(e,t):n}function ko(e,t){return e instanceof Io?ei(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class xo extends bo{}class Eo extends bo{constructor(e){super(),this.elements=e}}function So(e,t){const n=Ao(t);for(const t of e.elements)n.some((e=>Gr(e,t)))||n.push(t);return{arrayValue:{values:n}}}class To extends bo{constructor(e){super(),this.elements=e}}function Co(e,t){let n=Ao(t);for(const t of e.elements)n=n.filter((e=>!Gr(e,t)));return{arrayValue:{values:n}}}class Io extends bo{constructor(e,t){super(),this.serializer=e,this.gt=t}}function Ro(e){return Vr(e.integerValue||e.doubleValue)}function Ao(e){return ti(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Mo{constructor(e,t){this.field=e,this.transform=t}}class No{constructor(e,t){this.version=e,this.transformResults=t}}class Po{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Po}static exists(e){return new Po(void 0,e)}static updateTime(e){return new Po(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Bo(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Do{}function Oo(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Ko(e.key,Po.none()):new jo(e.key,e.data,Po.none());{const n=e.data,s=ai.empty();let r=new Mr(or.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?s.delete(e):s.set(e,t),r=r.add(e)}return new qo(e.key,s,new Pr(r.toArray()),Po.none())}}function Lo(e,t,n){e instanceof jo?function(e,t,n){const s=e.value.clone(),r=zo(e.fieldTransforms,t,n.transformResults);s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):e instanceof qo?function(e,t,n){if(!Bo(e.precondition,t))return void t.convertToUnknownDocument(n.version);const s=zo(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(Ho(e)),r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Vo(e,t,n,s){return e instanceof jo?function(e,t,n,s){if(!Bo(e.precondition,t))return n;const r=e.value.clone(),i=$o(e.fieldTransforms,s,t);return r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,s):e instanceof qo?function(e,t,n,s){if(!Bo(e.precondition,t))return n;const r=$o(e.fieldTransforms,s,t),i=t.data;return i.setAll(Ho(e)),i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,s):function(e,t,n){return Bo(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Fo(e,t){let n=null;for(const s of e.fieldTransforms){const e=t.data.field(s.field),r=ko(s.transform,e||null);null!=r&&(null===n&&(n=ai.empty()),n.set(s.field,r))}return n||null}function Uo(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&er(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Eo&&t instanceof Eo||e instanceof To&&t instanceof To?er(e.elements,t.elements,Gr):e instanceof Io&&t instanceof Io?Gr(e.gt,t.gt):e instanceof xo&&t instanceof xo}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class jo extends Do{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class qo extends Do{constructor(e,t,n,s,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Ho(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=e.data.field(n);t.set(n,s)}})),t}function zo(e,t,n){const s=new Map;Vs(e.length===n.length);for(let r=0;r<n.length;r++){const i=e[r],o=i.transform,a=t.data.field(i.field);s.set(i.field,wo(o,a,n[r]))}return s}function $o(e,t,n){const s=new Map;for(const r of e){const e=r.transform,i=n.data.field(r.field);s.set(r.field,yo(e,i,t))}return s}class Ko extends Do{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Go extends Do{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Wo{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const s=this.mutations[t];s.key.isEqual(e.key)&&Lo(s,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Vo(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Vo(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=co();return this.mutations.forEach((s=>{const r=e.get(s.key),i=r.overlayedDocument;let o=this.applyToLocalView(i,r.mutatedFields);o=t.has(s.key)?null:o;const a=Oo(i,o);null!==a&&n.set(s.key,a),i.isValidDocument()||i.convertToNoDocument(nr.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),mo())}isEqual(e){return this.batchId===e.batchId&&er(this.mutations,e.mutations,((e,t)=>Uo(e,t)))&&er(this.baseMutations,e.baseMutations,((e,t)=>Uo(e,t)))}}class Yo{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){Vs(e.mutations.length===n.length);let s=ho;const r=e.mutations;for(let e=0;e<r.length;e++)s=s.insert(r[e].key,n[e].version);return new Yo(e,t,n,s)}}class Xo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Qo{constructor(e,t){this.count=e,this.unchangedNames=t}}var Zo,Jo;function ea(e){switch(e){default:return Ls();case Us.CANCELLED:case Us.UNKNOWN:case Us.DEADLINE_EXCEEDED:case Us.RESOURCE_EXHAUSTED:case Us.INTERNAL:case Us.UNAVAILABLE:case Us.UNAUTHENTICATED:return!1;case Us.INVALID_ARGUMENT:case Us.NOT_FOUND:case Us.ALREADY_EXISTS:case Us.PERMISSION_DENIED:case Us.FAILED_PRECONDITION:case Us.ABORTED:case Us.OUT_OF_RANGE:case Us.UNIMPLEMENTED:case Us.DATA_LOSS:return!0}}function ta(e){if(void 0===e)return Bs("GRPC error has no .code"),Us.UNKNOWN;switch(e){case Zo.OK:return Us.OK;case Zo.CANCELLED:return Us.CANCELLED;case Zo.UNKNOWN:return Us.UNKNOWN;case Zo.DEADLINE_EXCEEDED:return Us.DEADLINE_EXCEEDED;case Zo.RESOURCE_EXHAUSTED:return Us.RESOURCE_EXHAUSTED;case Zo.INTERNAL:return Us.INTERNAL;case Zo.UNAVAILABLE:return Us.UNAVAILABLE;case Zo.UNAUTHENTICATED:return Us.UNAUTHENTICATED;case Zo.INVALID_ARGUMENT:return Us.INVALID_ARGUMENT;case Zo.NOT_FOUND:return Us.NOT_FOUND;case Zo.ALREADY_EXISTS:return Us.ALREADY_EXISTS;case Zo.PERMISSION_DENIED:return Us.PERMISSION_DENIED;case Zo.FAILED_PRECONDITION:return Us.FAILED_PRECONDITION;case Zo.ABORTED:return Us.ABORTED;case Zo.OUT_OF_RANGE:return Us.OUT_OF_RANGE;case Zo.UNIMPLEMENTED:return Us.UNIMPLEMENTED;case Zo.DATA_LOSS:return Us.DATA_LOSS;default:return Ls()}}(Jo=Zo||(Zo={}))[Jo.OK=0]="OK",Jo[Jo.CANCELLED=1]="CANCELLED",Jo[Jo.UNKNOWN=2]="UNKNOWN",Jo[Jo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Jo[Jo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Jo[Jo.NOT_FOUND=5]="NOT_FOUND",Jo[Jo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Jo[Jo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Jo[Jo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Jo[Jo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Jo[Jo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Jo[Jo.ABORTED=10]="ABORTED",Jo[Jo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Jo[Jo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Jo[Jo.INTERNAL=13]="INTERNAL",Jo[Jo.UNAVAILABLE=14]="UNAVAILABLE",Jo[Jo.DATA_LOSS=15]="DATA_LOSS";class na{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return sa}static getOrCreateInstance(){return null===sa&&(sa=new na),sa}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach((t=>t(e)))}}let sa=null;function ra(){return new TextEncoder}const ia=new Cs([4294967295,4294967295],0);function oa(e){const t=ra().encode(e),n=new Ts;return n.update(t),new Uint8Array(n.digest())}function aa(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),r=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Cs([n,s],0),new Cs([r,i],0)]}class ca{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new la(`Invalid padding: ${t}`);if(n<0)throw new la(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new la(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new la(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=Cs.fromNumber(this.It)}Et(e,t,n){let s=e.add(t.multiply(Cs.fromNumber(n)));return 1===s.compare(ia)&&(s=new Cs([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=oa(e),[n,s]=aa(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,s,e);if(!this.At(t))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),i=new ca(r,s,t);return n.forEach((e=>i.insert(e))),i}insert(e){if(0===this.It)return;const t=oa(e),[n,s]=aa(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,s,e);this.Rt(t)}}Rt(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class la extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ha{constructor(e,t,n,s,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,ua.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ha(nr.min(),s,new Ir(Js),so(),mo())}}class ua{constructor(e,t,n,s,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ua(n,t,mo(),mo(),mo())}}class da{constructor(e,t,n,s){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=s}}class ma{constructor(e,t){this.targetId=e,this.Vt=t}}class pa{constructor(e,t,n=Dr.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class fa{constructor(){this.St=0,this.Dt=va(),this.Ct=Dr.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=mo(),t=mo(),n=mo();return this.Dt.forEach(((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:Ls()}})),new ua(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=va()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class ga{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=so(),this.zt=_a(),this.Wt=new Ir(Js)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,(t=>{const n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:Ls()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach(((e,n)=>{this.te(n)&&t(n)}))}ne(e){var t;const n=e.targetId,s=e.Vt.count,r=this.se(n);if(r){const i=r.target;if(Oi(i))if(0===s){const e=new ar(i.path);this.Yt(n,e,li.newNoDocument(e,nr.min()))}else Vs(1===s);else{const r=this.ie(n);if(r!==s){const s=this.re(e,r);if(0!==s){this.ee(n);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,e)}null===(t=na.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var s,r,i,o,a,c;const l={localCacheCount:t,existenceFilterCount:n.count},h=n.unchangedNames;return h&&(l.bloomFilter={applied:0===e,hashCount:null!==(s=null==h?void 0:h.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(o=null===(i=null===(r=null==h?void 0:h.bits)||void 0===r?void 0:r.bitmap)||void 0===i?void 0:i.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),l}(s,r,e.Vt))}}}}re(e,t){const{unchangedNames:n,count:s}=e.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let a,c;try{a=Fr(r).toUint8Array()}catch(e){if(e instanceof Br)return Ds("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{c=new ca(a,i,o)}catch(e){return Ds(e instanceof la?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===c.It?1:s!==t-this.oe(e.targetId,c)?2:0}oe(e,t){const n=this.Gt.getRemoteKeysForTarget(e);let s=0;return n.forEach((n=>{const r=this.Gt.ue(),i=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;t.vt(i)||(this.Yt(e,n,null),s++)})),s}ce(e){const t=new Map;this.Qt.forEach(((n,s)=>{const r=this.se(s);if(r){if(n.current&&Oi(r.target)){const t=new ar(r.target.path);null!==this.jt.get(t)||this.ae(s,t)||this.Yt(s,t,li.newNoDocument(t,e))}n.Mt&&(t.set(s,n.Ot()),n.Ft())}}));let n=mo();this.zt.forEach(((e,t)=>{let s=!0;t.forEachWhile((e=>{const t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(s=!1,!1)})),s&&(n=n.add(e))})),this.jt.forEach(((t,n)=>n.setReadTime(e)));const s=new ha(e,t,this.Wt,this.jt,n);return this.jt=so(),this.zt=_a(),this.Wt=new Ir(Js),s}Jt(e,t){if(!this.te(e))return;const n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;const s=this.Zt(e);this.ae(e,t)?s.Bt(t,1):s.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new fa,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new Mr(Js),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||Ps("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new fa),this.Gt.getRemoteKeysForTarget(e).forEach((t=>{this.Yt(e,t,null)}))}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function _a(){return new Ir(ar.comparator)}function va(){return new Ir(ar.comparator)}const ba={asc:"ASCENDING",desc:"DESCENDING"},ya={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wa={and:"AND",or:"OR"};class ka{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function xa(e,t){return e.useProto3Json||br(t)?t:{value:t}}function Ea(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Sa(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Ta(e,t){return Ea(e,t.toTimestamp())}function Ca(e){return Vs(!!e),nr.fromTimestamp(function(e){const t=Lr(e);return new tr(t.seconds,t.nanos)}(e))}function Ia(e,t){return function(e){return new rr(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Ra(e){const t=rr.fromString(e);return Vs(Ya(t)),t}function Aa(e,t){return Ia(e.databaseId,t.path)}function Ma(e,t){const n=Ra(t);if(n.get(1)!==e.databaseId.projectId)throw new js(Us.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new js(Us.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ar(Da(n))}function Na(e,t){return Ia(e.databaseId,t)}function Pa(e){const t=Ra(e);return 4===t.length?rr.emptyPath():Da(t)}function Ba(e){return new rr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Da(e){return Vs(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Oa(e,t,n){return{name:Aa(e,t),fields:n.value.mapValue.fields}}function La(e,t){let n;if(t instanceof jo)n={update:Oa(e,t.key,t.value)};else if(t instanceof Ko)n={delete:Aa(e,t.key)};else if(t instanceof qo)n={update:Oa(e,t.key,t.data),updateMask:Wa(t.fieldMask)};else{if(!(t instanceof Go))return Ls();n={verify:Aa(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof xo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Eo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof To)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Io)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw Ls()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Ta(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ls()}(e,t.precondition)),n}function Va(e,t){return{documents:[Na(e,t.path)]}}function Fa(e,t){const n={structuredQuery:{}},s=t.path;null!==t.collectionGroup?(n.parent=Na(e,s),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Na(e,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const r=function(e){if(0!==e.length)return Ga(_i.create(e,"and"))}(t.filters);r&&(n.structuredQuery.where=r);const i=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:$a(e.field),direction:qa(e.dir)}}(e)))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);const o=xa(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Ua(e){let t=Pa(e.parent);const n=e.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){Vs(1===s);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=ja(e);return t instanceof _i&&bi(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new mi(Ka(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,br(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new hi(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new hi(n,t)}(n.endAt)),Vi(t,r,o,i,a,"F",c,l)}function ja(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Ka(e.unaryFilter.field);return gi.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Ka(e.unaryFilter.field);return gi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Ka(e.unaryFilter.field);return gi.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Ka(e.unaryFilter.field);return gi.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Ls()}}(e):void 0!==e.fieldFilter?function(e){return gi.create(Ka(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ls()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return _i.create(e.compositeFilter.filters.map((e=>ja(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Ls()}}(e.compositeFilter.op))}(e):Ls()}function qa(e){return ba[e]}function Ha(e){return ya[e]}function za(e){return wa[e]}function $a(e){return{fieldPath:e.canonicalString()}}function Ka(e){return or.fromServerFormat(e.fieldPath)}function Ga(e){return e instanceof gi?function(e){if("=="===e.op){if(si(e.value))return{unaryFilter:{field:$a(e.field),op:"IS_NAN"}};if(ni(e.value))return{unaryFilter:{field:$a(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(si(e.value))return{unaryFilter:{field:$a(e.field),op:"IS_NOT_NAN"}};if(ni(e.value))return{unaryFilter:{field:$a(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$a(e.field),op:Ha(e.op),value:e.value}}}(e):e instanceof _i?function(e){const t=e.getFilters().map((e=>Ga(e)));return 1===t.length?t[0]:{compositeFilter:{op:za(e.op),filters:t}}}(e):Ls()}function Wa(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Ya(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Xa{constructor(e,t,n,s,r=nr.min(),i=nr.min(),o=Dr.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Xa(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Xa(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Xa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Xa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Qa{constructor(e){this.fe=e}}function Za(e){const t=Ua({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Gi(t,t.limit,"L"):t}class Ja{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(Vr(e.integerValue));else if("doubleValue"in e){const n=Vr(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),yr(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(Fr(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?oi(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):Ls()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const n=e.fields||{};this.ye(t,55);for(const e of Object.keys(n))this.Te(e,t),this.me(n[e],t)}Pe(e,t){const n=e.values||[];this.ye(t,50);for(const e of n)this.me(e,t)}ve(e,t){this.ye(t,37),ar.fromName(e).path.forEach((e=>{this.ye(t,60),this.be(e,t)}))}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}Ja.Ve=new Ja;class ec{constructor(){this.rn=new tc}addToCollectionParentIndex(e,t){return this.rn.add(t),gr.resolve()}getCollectionParents(e,t){return gr.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return gr.resolve()}deleteFieldIndex(e,t){return gr.resolve()}getDocumentsMatchingTarget(e,t){return gr.resolve(null)}getIndexType(e,t){return gr.resolve(0)}getFieldIndexes(e,t){return gr.resolve([])}getNextCollectionGroupToUpdate(e){return gr.resolve(null)}getMinOffset(e,t){return gr.resolve(ur.min())}getMinOffsetFromCollectionGroup(e,t){return gr.resolve(ur.min())}updateCollectionGroup(e,t,n){return gr.resolve()}updateIndexEntries(e,t){return gr.resolve()}}class tc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new Mr(rr.comparator),r=!s.has(n);return this.index[t]=s.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new Mr(rr.comparator)).toArray()}}new Uint8Array(0);class nc{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new nc(e,nc.DEFAULT_COLLECTION_PERCENTILE,nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}nc.DEFAULT_COLLECTION_PERCENTILE=10,nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nc.DEFAULT=new nc(41943040,nc.DEFAULT_COLLECTION_PERCENTILE,nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nc.DISABLED=new nc(-1,0,0);class sc{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new sc(0)}static Mn(){return new sc(-1)}}class rc{constructor(){this.changes=new to((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,li.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?gr.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ic{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class oc{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(n=s,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Vo(n.mutation,e,Pr.empty(),tr.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,mo()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=mo()){const s=ao();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,n).next((e=>{let t=io();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=ao();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,mo())))}populateOverlays(e,t,n){const s=[];return n.forEach((e=>{t.has(e)||s.push(e)})),this.documentOverlayCache.getOverlays(e,s).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,s){let r=so();const i=lo(),o=lo();return t.forEach(((e,t)=>{const o=n.get(t.key);s.has(t.key)&&(void 0===o||o.mutation instanceof qo)?r=r.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),Vo(o.mutation,t,o.mutation.getFieldMask(),tr.now())):i.set(t.key,Pr.empty())})),this.recalculateAndSaveOverlays(e,r).next((e=>(e.forEach(((e,t)=>i.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new ic(t,null!==(n=i.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=lo();let s=new Ir(((e,t)=>e-t)),r=mo();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const r of e)r.keys().forEach((e=>{const i=t.get(e);if(null===i)return;let o=n.get(e)||Pr.empty();o=r.applyToLocalView(i,o),n.set(e,o);const a=(s.get(r.batchId)||mo()).add(e);s=s.insert(r.batchId,a)}))})).next((()=>{const i=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),a=s.key,c=s.value,l=co();c.forEach((e=>{if(!r.has(e)){const s=Oo(t.get(e),n.get(e));null!==s&&l.set(e,s),r=r.add(e)}})),i.push(this.documentOverlayCache.saveOverlays(e,a,l))}return gr.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return ar.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Hi(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next((r=>{const i=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-r.size):gr.resolve(ao());let o=-1,a=r;return i.next((t=>gr.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?gr.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,r))).next((()=>this.computeViews(e,a,t,mo()))).next((e=>({batchId:o,changes:oo(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ar(t)).next((e=>{let t=io();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const s=t.collectionGroup;let r=io();return this.indexManager.getCollectionParents(e,s).next((i=>gr.forEach(i,(i=>{const o=function(e,t){return new Li(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,i.child(s));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{r=r.insert(e,t)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(e,t,n){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s)))).next((e=>{s.forEach(((t,n)=>{const s=n.getKey();null===e.get(s)&&(e=e.insert(s,li.newInvalidDocument(s)))}));let n=io();return e.forEach(((e,r)=>{const i=s.get(e);void 0!==i&&Vo(i.mutation,r,Pr.empty(),tr.now()),Qi(t,r)&&(n=n.insert(e,r))})),n}))}}class ac{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return gr.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var n;return this.cs.set(t.id,{id:(n=t).id,version:n.version,createTime:Ca(n.createTime)}),gr.resolve()}getNamedQuery(e,t){return gr.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,function(e){return{name:e.name,query:Za(e.bundledQuery),readTime:Ca(e.readTime)}}(t)),gr.resolve()}}class cc{constructor(){this.overlays=new Ir(ar.comparator),this.ls=new Map}getOverlay(e,t){return gr.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ao();return gr.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,s)=>{this.we(e,t,s)})),gr.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.ls.get(n);return void 0!==s&&(s.forEach((e=>this.overlays=this.overlays.remove(e))),this.ls.delete(n)),gr.resolve()}getOverlaysForCollection(e,t,n){const s=ao(),r=t.length+1,i=new ar(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===r&&e.largestBatchId>n&&s.set(e.getKey(),e)}return gr.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let r=new Ir(((e,t)=>e-t));const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=ao(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=ao(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=s)););return gr.resolve(o)}we(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const e=this.ls.get(s.largestBatchId).delete(n.key);this.ls.set(s.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Xo(t,n));let r=this.ls.get(t);void 0===r&&(r=mo(),this.ls.set(t,r)),this.ls.set(t,r.add(n.key))}}class lc{constructor(){this.fs=new Mr(hc.ds),this.ws=new Mr(hc._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const n=new hc(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.ys(new hc(e,t))}ps(e,t){e.forEach((e=>this.removeReference(e,t)))}Is(e){const t=new ar(new rr([])),n=new hc(t,e),s=new hc(t,e+1),r=[];return this.ws.forEachInRange([n,s],(e=>{this.ys(e),r.push(e.key)})),r}Ts(){this.fs.forEach((e=>this.ys(e)))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new ar(new rr([])),n=new hc(t,e),s=new hc(t,e+1);let r=mo();return this.ws.forEachInRange([n,s],(e=>{r=r.add(e.key)})),r}containsKey(e){const t=new hc(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class hc{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return ar.comparator(e.key,t.key)||Js(e.As,t.As)}static _s(e,t){return Js(e.As,t.As)||ar.comparator(e.key,t.key)}}class uc{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new Mr(hc.ds)}checkEmpty(e){return gr.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const r=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Wo(r,t,n,s);this.mutationQueue.push(i);for(const t of s)this.Rs=this.Rs.add(new hc(t.key,r)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return gr.resolve(i)}lookupMutationBatch(e,t){return gr.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.bs(n),r=s<0?0:s;return gr.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return gr.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return gr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new hc(t,0),s=new hc(t,Number.POSITIVE_INFINITY),r=[];return this.Rs.forEachInRange([n,s],(e=>{const t=this.Ps(e.As);r.push(t)})),gr.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Mr(Js);return t.forEach((e=>{const t=new hc(e,0),s=new hc(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,s],(e=>{n=n.add(e.As)}))})),gr.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let r=n;ar.isDocumentKey(r)||(r=r.child(""));const i=new hc(new ar(r),0);let o=new Mr(Js);return this.Rs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===s&&(o=o.add(e.As)),!0)}),i),gr.resolve(this.Vs(o))}Vs(e){const t=[];return e.forEach((e=>{const n=this.Ps(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Vs(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return gr.forEach(t.mutations,(s=>{const r=new hc(s.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Rs=n}))}Cn(e){}containsKey(e,t){const n=new hc(t,0),s=this.Rs.firstAfterOrEqual(n);return gr.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,gr.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class dc{constructor(e){this.Ds=e,this.docs=new Ir(ar.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),r=s?s.size:0,i=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return gr.resolve(n?n.document.mutableCopy():li.newInvalidDocument(t))}getEntries(e,t){let n=so();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():li.newInvalidDocument(e))})),gr.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let r=so();const i=t.path,o=new ar(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||dr(hr(o),n)<=0||(s.has(o.key)||Qi(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return gr.resolve(r)}getAllFromCollectionGroup(e,t,n,s){Ls()}Cs(e,t){return gr.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new mc(this)}getSize(e){return gr.resolve(this.size)}}class mc extends rc{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?t.push(this.os.addEntry(e,s)):this.os.removeEntry(n)})),gr.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class pc{constructor(e){this.persistence=e,this.xs=new to((e=>Bi(e)),Di),this.lastRemoteSnapshotVersion=nr.min(),this.highestTargetId=0,this.Ns=0,this.ks=new lc,this.targetCount=0,this.Ms=sc.kn()}forEachTarget(e,t){return this.xs.forEach(((e,n)=>t(n))),gr.resolve()}getLastRemoteSnapshotVersion(e){return gr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return gr.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),gr.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),gr.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new sc(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,gr.resolve()}updateTargetData(e,t){return this.Fn(t),gr.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,gr.resolve()}removeTargets(e,t,n){let s=0;const r=[];return this.xs.forEach(((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(i),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),s++)})),gr.waitFor(r).next((()=>s))}getTargetCount(e){return gr.resolve(this.targetCount)}getTargetData(e,t){const n=this.xs.get(t)||null;return gr.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),gr.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);const s=this.persistence.referenceDelegate,r=[];return s&&t.forEach((t=>{r.push(s.markPotentiallyOrphaned(e,t))})),gr.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),gr.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ks.Es(t);return gr.resolve(n)}containsKey(e,t){return gr.resolve(this.ks.containsKey(t))}}class fc{constructor(e,t){this.$s={},this.overlays={},this.Os=new vr(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new pc(this),this.indexManager=new ec,this.remoteDocumentCache=function(e){return new dc(e)}((e=>this.referenceDelegate.Ls(e))),this.serializer=new Qa(t),this.qs=new ac(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new cc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new uc(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){Ps("MemoryPersistence","Starting transaction:",e);const s=new gc(this.Os.next());return this.referenceDelegate.Us(),n(s).next((e=>this.referenceDelegate.Ks(s).next((()=>e)))).toPromise().then((e=>(s.raiseOnCommittedEvent(),e)))}Gs(e,t){return gr.or(Object.values(this.$s).map((n=>()=>n.containsKey(e,t))))}}class gc extends pr{constructor(e){super(),this.currentSequenceNumber=e}}class _c{constructor(e){this.persistence=e,this.Qs=new lc,this.js=null}static zs(e){return new _c(e)}get Ws(){if(this.js)return this.js;throw Ls()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),gr.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),gr.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),gr.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach((e=>this.Ws.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ws.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return gr.forEach(this.Ws,(n=>{const s=ar.fromPath(n);return this.Hs(e,s).next((e=>{e||t.removeEntry(s,nr.min())}))})).next((()=>(this.js=null,t.apply(e))))}updateLimboDocument(e,t){return this.Hs(e,t).next((e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())}))}Ls(e){return 0}Hs(e,t){return gr.or([()=>gr.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class vc{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=s}static Li(e,t){let n=mo(),s=mo();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:s=s.add(e.doc.key)}return new vc(e,t.fromCache,n,s)}}class bc{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,s){return this.Ki(e,t).next((r=>r||this.Gi(e,t,s,n))).next((n=>n||this.Qi(e,t)))}Ki(e,t){if(Ui(t))return gr.resolve(null);let n=$i(t);return this.indexManager.getIndexType(e,n).next((s=>0===s?null:(null!==t.limit&&1===s&&(t=Gi(t,null,"F"),n=$i(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((s=>{const r=mo(...s);return this.Ui.getDocuments(e,r).next((s=>this.indexManager.getMinOffset(e,n).next((n=>{const i=this.ji(t,s);return this.zi(t,i,r,n.readTime)?this.Ki(e,Gi(t,null,"F")):this.Wi(e,i,t,n)}))))})))))}Gi(e,t,n,s){return Ui(t)||s.isEqual(nr.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next((r=>{const i=this.ji(t,r);return this.zi(t,i,n,s)?this.Qi(e,t):(Ns()<=o.in.DEBUG&&Ps("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Xi(t)),this.Wi(e,i,t,lr(s,-1)))}))}ji(e,t){let n=new Mr(Ji(e));return t.forEach(((t,s)=>{Qi(e,s)&&(n=n.add(s))})),n}zi(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Qi(e,t){return Ns()<=o.in.DEBUG&&Ps("QueryEngine","Using full collection scan to execute query:",Xi(t)),this.Ui.getDocumentsMatchingQuery(e,t,ur.min())}Wi(e,t,n,s){return this.Ui.getDocumentsMatchingQuery(e,n,s).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class yc{constructor(e,t,n,s){this.persistence=e,this.Hi=t,this.serializer=s,this.Ji=new Ir(Js),this.Yi=new to((e=>Bi(e)),Di),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oc(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ji)))}}function wc(e,t,n,s){return new yc(e,t,n,s)}async function kc(e,t){const n=Fs(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let s;return n.mutationQueue.getAllMutationBatches(e).next((r=>(s=r,n.tr(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const r=[],i=[];let o=mo();for(const e of s){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({er:e,removedBatchIds:r,addedBatchIds:i})))}))}))}function xc(e){const t=Fs(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Bs.getLastRemoteSnapshotVersion(e)))}function Ec(e,t,n){let s=mo(),r=mo();return n.forEach((e=>s=s.add(e))),t.getEntries(e,s).next((e=>{let s=so();return n.forEach(((n,i)=>{const o=e.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),i.isNoDocument()&&i.version.isEqual(nr.min())?(t.removeEntry(n,i.readTime),s=s.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),s=s.insert(n,i)):Ps("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{nr:s,sr:r}}))}function Sc(e,t){const n=Fs(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Tc(e,t){const n=Fs(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let s;return n.Bs.getTargetData(e,t).next((r=>r?(s=r,gr.resolve(s)):n.Bs.allocateTargetId(e).next((r=>(s=new Xa(t,r,"TargetPurposeListen",e.currentSequenceNumber),n.Bs.addTargetData(e,s).next((()=>s)))))))})).then((e=>{const s=n.Ji.get(e.targetId);return(null===s||e.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e}))}async function Cc(e,t,n){const s=Fs(e),r=s.Ji.get(t),i=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",i,(e=>s.persistence.referenceDelegate.removeTarget(e,r)))}catch(e){if(!_r(e))throw e;Ps("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}s.Ji=s.Ji.remove(t),s.Yi.delete(r.target)}function Ic(e,t,n){const s=Fs(e);let r=nr.min(),i=mo();return s.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const s=Fs(e),r=s.Yi.get(n);return void 0!==r?gr.resolve(s.Ji.get(r)):s.Bs.getTargetData(t,n)}(s,e,$i(t)).next((t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,s.Bs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{i=e}))})).next((()=>s.Hi.getDocumentsMatchingQuery(e,t,n?r:nr.min(),n?i:mo()))).next((e=>(Rc(s,Zi(t),e),{documents:e,ir:i})))))}function Rc(e,t,n){let s=e.Xi.get(t)||nr.min();n.forEach(((e,t)=>{t.readTime.compareTo(s)>0&&(s=t.readTime)})),e.Xi.set(t,s)}class Ac{constructor(){this.activeTargetIds=fo()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Mc{constructor(){this.Hr=new Ac,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new Ac,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Nc{Yr(e){}shutdown(){}}class Pc{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){Ps("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){Ps("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Bc=null;function Dc(){return null===Bc?Bc=268435456+Math.round(2147483648*Math.random()):Bc++,"0x"+Bc.toString(16)}const Oc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Lc{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const Vc="WebChannelConnection";class Fc extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,s,r){const i=Dc(),o=this.To(e,t);Ps("RestConnection",`Sending RPC '${e}' ${i}:`,o,n);const a={};return this.Eo(a,s,r),this.Ao(e,o,a,n).then((t=>(Ps("RestConnection",`Received RPC '${e}' ${i}: `,t),t)),(t=>{throw Ds("RestConnection",`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,s,r,i){return this.Io(e,t,n,s,r)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+As,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}To(e,t){const n=Oc[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,s){const r=Dc();return new Promise(((i,o)=>{const a=new Ss;a.setWithCredentials(!0),a.listenOnce(ys.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case bs.NO_ERROR:const t=a.getResponseJson();Ps(Vc,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),i(t);break;case bs.TIMEOUT:Ps(Vc,`RPC '${e}' ${r} timed out`),o(new js(Us.DEADLINE_EXCEEDED,"Request time out"));break;case bs.HTTP_ERROR:const n=a.getStatus();if(Ps(Vc,`RPC '${e}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Us).indexOf(t)>=0?t:Us.UNKNOWN}(t.status);o(new js(e,t.message))}else o(new js(Us.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new js(Us.UNAVAILABLE,"Connection failed."));break;default:Ls()}}finally{Ps(Vc,`RPC '${e}' ${r} completed.`)}}));const c=JSON.stringify(s);Ps(Vc,`RPC '${e}' ${r} sending request:`,s),a.send(t,"POST",c,n,15)}))}Ro(e,t,n){const s=Dc(),r=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=_s(),o=vs(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new xs({})),this.Eo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const l=r.join("");Ps(Vc,`Creating RPC '${e}' stream ${s}: ${l}`,a);const h=i.createWebChannel(l,a);let u=!1,d=!1;const m=new Lc({ro:t=>{d?Ps(Vc,`Not sending because RPC '${e}' stream ${s} is closed:`,t):(u||(Ps(Vc,`Opening RPC '${e}' stream ${s} transport.`),h.open(),u=!0),Ps(Vc,`RPC '${e}' stream ${s} sending:`,t),h.send(t))},oo:()=>h.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(h,Es.EventType.OPEN,(()=>{d||Ps(Vc,`RPC '${e}' stream ${s} transport opened.`)})),p(h,Es.EventType.CLOSE,(()=>{d||(d=!0,Ps(Vc,`RPC '${e}' stream ${s} transport closed`),m.wo())})),p(h,Es.EventType.ERROR,(t=>{d||(d=!0,Ds(Vc,`RPC '${e}' stream ${s} transport errored:`,t),m.wo(new js(Us.UNAVAILABLE,"The operation could not be completed")))})),p(h,Es.EventType.MESSAGE,(t=>{var n;if(!d){const r=t.data[0];Vs(!!r);const i=r,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){Ps(Vc,`RPC '${e}' stream ${s} received error:`,o);const t=o.status;let n=function(e){const t=Zo[e];if(void 0!==t)return ta(t)}(t),r=o.message;void 0===n&&(n=Us.INTERNAL,r="Unknown error status: "+t+" with message "+o.message),d=!0,m.wo(new js(n,r)),h.close()}else Ps(Vc,`RPC '${e}' stream ${s} received:`,r),m._o(r)}})),p(o,ws.STAT_EVENT,(t=>{t.stat===ks.PROXY?Ps(Vc,`RPC '${e}' stream ${s} detected buffering proxy`):t.stat===ks.NOPROXY&&Ps(Vc,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{m.fo()}),0),m}}function Uc(){return"undefined"!=typeof document?document:null}function jc(e){return new ka(e,!0)}class qc{constructor(e,t,n=1e3,s=1.5,r=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=s,this.Vo=r,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),s=Math.max(0,t-n);s>0&&Ps("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,s,(()=>(this.Co=Date.now(),e()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Hc{constructor(e,t,n,s,r,i,o,a){this.ii=e,this.$o=n,this.Oo=s,this.connection=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new qc(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===Us.RESOURCE_EXHAUSTED?(Bs(t.toString()),Bs("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===Us.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Fo===t&&this.Zo(e,n)}),(t=>{e((()=>{const e=new js(Us.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)}))}))}Zo(e,t){const n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((e=>{n((()=>this.tu(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(e){return Ps("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget((()=>this.Fo===e?t():(Ps("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class zc extends Hc{constructor(e,t,n,s,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,i),this.serializer=r}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const s=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ls()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(Vs(void 0===t||"string"==typeof t),Dr.fromBase64String(t||"")):(Vs(void 0===t||t instanceof Uint8Array),Dr.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Us.UNKNOWN:ta(e.code);return new js(t,e.message||"")}(o);n=new pa(s,r,i,a||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const r=Ma(e,s.document.name),i=Ca(s.document.updateTime),o=s.document.createTime?Ca(s.document.createTime):nr.min(),a=new ai({mapValue:{fields:s.document.fields}}),c=li.newFoundDocument(r,i,o,a),l=s.targetIds||[],h=s.removedTargetIds||[];n=new da(l,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const r=Ma(e,s.document),i=s.readTime?Ca(s.readTime):nr.min(),o=li.newNoDocument(r,i),a=s.removedTargetIds||[];n=new da([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const r=Ma(e,s.document),i=s.removedTargetIds||[];n=new da([],i,r,null)}else{if(!("filter"in t))return Ls();{t.filter;const e=t.filter;e.targetId;const{count:s=0,unchangedNames:r}=e,i=new Qo(s,r),o=e.targetId;n=new ma(o,i)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return nr.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?nr.min():t.readTime?Ca(t.readTime):nr.min()}(e);return this.listener.nu(t,n)}su(e){const t={};t.database=Ba(this.serializer),t.addTarget=function(e,t){let n;const s=t.target;if(n=Oi(s)?{documents:Va(e,s)}:{query:Fa(e,s)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Sa(e,t.resumeToken);const s=xa(e,t.expectedCount);null!==s&&(n.expectedCount=s)}else if(t.snapshotVersion.compareTo(nr.min())>0){n.readTime=Ea(e,t.snapshotVersion.toTimestamp());const s=xa(e,t.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ls()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){const t={};t.database=Ba(this.serializer),t.removeTarget=e,this.Wo(t)}}class $c extends Hc{constructor(e,t,n,s,r,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,i),this.serializer=r,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(Vs(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function(e,t){return e&&e.length>0?(Vs(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Ca(e.updateTime):Ca(t);return n.isEqual(nr.min())&&(n=Ca(t)),new No(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Ca(e.commitTime);return this.listener.cu(n,t)}return Vs(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=Ba(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>La(this.serializer,e)))};this.Wo(t)}}class Kc extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.lu=!1}fu(){if(this.lu)throw new js(Us.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.connection.Io(e,t,n,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Us.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new js(Us.UNKNOWN,e.toString())}))}vo(e,t,n,s){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.vo(e,t,n,r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Us.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new js(Us.UNKNOWN,e.toString())}))}terminate(){this.lu=!0}}class Gc{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Bs(t),this.mu=!1):Ps("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class Wc{constructor(e,t,n,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=r,this.Pu.Yr((e=>{n.enqueueAndForget((async()=>{sl(this)&&(Ps("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Fs(e);t.vu.add(4),await Xc(t),t.bu.set("Unknown"),t.vu.delete(4),await Yc(t)}(this))}))})),this.bu=new Gc(n,s)}}async function Yc(e){if(sl(e))for(const t of e.Ru)await t(!0)}async function Xc(e){for(const t of e.Ru)await t(!1)}function Qc(e,t){const n=Fs(e);n.Au.has(t.targetId)||(n.Au.set(t.targetId,t),nl(n)?tl(n):wl(n).Ko()&&Jc(n,t))}function Zc(e,t){const n=Fs(e),s=wl(n);n.Au.delete(t),s.Ko()&&el(n,t),0===n.Au.size&&(s.Ko()?s.jo():sl(n)&&n.bu.set("Unknown"))}function Jc(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(nr.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}wl(e).su(t)}function el(e,t){e.Vu.qt(t),wl(e).iu(t)}function tl(e){e.Vu=new ga({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),wl(e).start(),e.bu.gu()}function nl(e){return sl(e)&&!wl(e).Uo()&&e.Au.size>0}function sl(e){return 0===Fs(e).vu.size}function rl(e){e.Vu=void 0}async function il(e){e.Au.forEach(((t,n)=>{Jc(e,t)}))}async function ol(e,t){rl(e),nl(e)?(e.bu.Iu(t),tl(e)):e.bu.set("Unknown")}async function al(e,t,n){if(e.bu.set("Online"),t instanceof pa&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const s of t.targetIds)e.Au.has(s)&&(await e.remoteSyncer.rejectListen(s,n),e.Au.delete(s),e.Vu.removeTarget(s))}(e,t)}catch(n){Ps("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await cl(e,n)}else if(t instanceof da?e.Vu.Ht(t):t instanceof ma?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(nr.min()))try{const t=await xc(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Vu.ce(t);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.Au.get(s);r&&e.Au.set(s,r.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const s=e.Au.get(t);if(!s)return;e.Au.set(t,s.withResumeToken(Dr.EMPTY_BYTE_STRING,s.snapshotVersion)),el(e,t);const r=new Xa(s.target,t,n,s.sequenceNumber);Jc(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Ps("RemoteStore","Failed to raise snapshot:",t),await cl(e,t)}}async function cl(e,t,n){if(!_r(t))throw t;e.vu.add(1),await Xc(e),e.bu.set("Offline"),n||(n=()=>xc(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Ps("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await Yc(e)}))}function ll(e,t){return t().catch((n=>cl(e,n,t)))}async function hl(e){const t=Fs(e),n=kl(t);let s=t.Eu.length>0?t.Eu[t.Eu.length-1].batchId:-1;for(;ul(t);)try{const e=await Sc(t.localStore,s);if(null===e){0===t.Eu.length&&n.jo();break}s=e.batchId,dl(t,e)}catch(e){await cl(t,e)}ml(t)&&pl(t)}function ul(e){return sl(e)&&e.Eu.length<10}function dl(e,t){e.Eu.push(t);const n=kl(e);n.Ko()&&n.ou&&n.uu(t.mutations)}function ml(e){return sl(e)&&!kl(e).Uo()&&e.Eu.length>0}function pl(e){kl(e).start()}async function fl(e){kl(e).hu()}async function gl(e){const t=kl(e);for(const n of e.Eu)t.uu(n.mutations)}async function _l(e,t,n){const s=e.Eu.shift(),r=Yo.from(s,t,n);await ll(e,(()=>e.remoteSyncer.applySuccessfulWrite(r))),await hl(e)}async function vl(e,t){t&&kl(e).ou&&await async function(e,t){if(ea(n=t.code)&&n!==Us.ABORTED){const n=e.Eu.shift();kl(e).Qo(),await ll(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await hl(e)}var n}(e,t),ml(e)&&pl(e)}async function bl(e,t){const n=Fs(e);n.asyncQueue.verifyOperationInProgress(),Ps("RemoteStore","RemoteStore received new credentials");const s=sl(n);n.vu.add(3),await Xc(n),s&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.vu.delete(3),await Yc(n)}async function yl(e,t){const n=Fs(e);t?(n.vu.delete(2),await Yc(n)):t||(n.vu.add(2),await Xc(n),n.bu.set("Unknown"))}function wl(e){return e.Su||(e.Su=function(e,t,n){const s=Fs(e);return s.fu(),new zc(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{uo:il.bind(null,e),ao:ol.bind(null,e),nu:al.bind(null,e)}),e.Ru.push((async t=>{t?(e.Su.Qo(),nl(e)?tl(e):e.bu.set("Unknown")):(await e.Su.stop(),rl(e))}))),e.Su}function kl(e){return e.Du||(e.Du=function(e,t,n){const s=Fs(e);return s.fu(),new $c(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{uo:fl.bind(null,e),ao:vl.bind(null,e),au:gl.bind(null,e),cu:_l.bind(null,e)}),e.Ru.push((async t=>{t?(e.Du.Qo(),await hl(e)):(await e.Du.stop(),e.Eu.length>0&&(Ps("RemoteStore",`Stopping write stream with ${e.Eu.length} pending writes`),e.Eu=[]))}))),e.Du}class xl{constructor(e,t,n,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new qs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,s,r){const i=Date.now()+n,o=new xl(e,t,i,s,r);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new js(Us.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function El(e,t){if(Bs("AsyncQueue",`${t}: ${e}`),_r(e))return new js(Us.UNAVAILABLE,`${t}: ${e}`);throw e}class Sl{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ar.comparator(t.key,n.key):(e,t)=>ar.comparator(e.key,t.key),this.keyedMap=io(),this.sortedSet=new Ir(this.comparator)}static emptySet(e){return new Sl(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Sl))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(!e.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Sl;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Tl{constructor(){this.Cu=new Ir(ar.comparator)}track(e){const t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):Ls():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Cl{constructor(e,t,n,s,r,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,s,r){const i=[];return t.forEach((e=>{i.push({type:0,doc:e})})),new Cl(e,t,Sl.emptySet(t),i,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Wi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Il{constructor(){this.Nu=void 0,this.listeners=[]}}class Rl{constructor(){this.queries=new to((e=>Yi(e)),Wi),this.onlineState="Unknown",this.ku=new Set}}async function Al(e,t){const n=Fs(e),s=t.query;let r=!1,i=n.queries.get(s);if(i||(r=!0,i=new Il),r)try{i.Nu=await n.onListen(s)}catch(e){const n=El(e,`Initialization of query '${Xi(t.query)}' failed`);return void t.onError(n)}n.queries.set(s,i),i.listeners.push(t),t.Mu(n.onlineState),i.Nu&&t.$u(i.Nu)&&Bl(n)}async function Ml(e,t){const n=Fs(e),s=t.query;let r=!1;const i=n.queries.get(s);if(i){const e=i.listeners.indexOf(t);e>=0&&(i.listeners.splice(e,1),r=0===i.listeners.length)}if(r)return n.queries.delete(s),n.onUnlisten(s)}function Nl(e,t){const n=Fs(e);let s=!1;for(const e of t){const t=e.query,r=n.queries.get(t);if(r){for(const t of r.listeners)t.$u(e)&&(s=!0);r.Nu=e}}s&&Bl(n)}function Pl(e,t,n){const s=Fs(e),r=s.queries.get(t);if(r)for(const e of r.listeners)e.onError(n);s.queries.delete(t)}function Bl(e){e.ku.forEach((e=>{e.next()}))}class Dl{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Cl(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Ku||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;const t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=Cl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class Ol{constructor(e){this.key=e}}class Ll{constructor(e){this.key=e}}class Vl{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=mo(),this.mutatedKeys=mo(),this.tc=Ji(e),this.ec=new Sl(this.tc)}get nc(){return this.Yu}sc(e,t){const n=t?t.ic:new Tl,s=t?t.ec:this.ec;let r=t?t.mutatedKeys:this.mutatedKeys,i=s,o=!1;const a="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((e,t)=>{const l=s.get(e),h=Qi(this.query,t)?t:null,u=!!l&&this.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let m=!1;l&&h?l.data.isEqual(h.data)?u!==d&&(n.track({type:3,doc:h}),m=!0):this.rc(l,h)||(n.track({type:2,doc:h}),m=!0,(a&&this.tc(h,a)>0||c&&this.tc(h,c)<0)&&(o=!0)):!l&&h?(n.track({type:0,doc:h}),m=!0):l&&!h&&(n.track({type:1,doc:l}),m=!0,(a||c)&&(o=!0)),m&&(h?(i=i.add(h),r=d?r.add(e):r.delete(e)):(i=i.delete(e),r=r.delete(e)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{ec:i,ic:n,zi:o,mutatedKeys:r}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const s=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const r=e.ic.xu();r.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ls()}};return n(e)-n(t)}(e.type,t.type)||this.tc(e.doc,t.doc))),this.oc(n);const i=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==r.length||a?{snapshot:new Cl(this.query,e.ec,s,r,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:i}:{cc:i}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new Tl,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach((e=>this.Yu=this.Yu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Yu=this.Yu.delete(e))),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=mo(),this.ec.forEach((e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))}));const t=[];return e.forEach((e=>{this.Zu.has(e)||t.push(new Ll(e))})),this.Zu.forEach((n=>{e.has(n)||t.push(new Ol(n))})),t}hc(e){this.Yu=e.ir,this.Zu=mo();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return Cl.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Fl{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Ul{constructor(e){this.key=e,this.fc=!1}}class jl{constructor(e,t,n,s,r,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.dc={},this.wc=new to((e=>Yi(e)),Wi),this._c=new Map,this.mc=new Set,this.gc=new Ir(ar.comparator),this.yc=new Map,this.Ic=new lc,this.Tc={},this.Ec=new Map,this.Ac=sc.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function ql(e,t){const n=oh(e);let s,r;const i=n.wc.get(t);if(i)s=i.targetId,n.sharedClientState.addLocalQueryTarget(s),r=i.view.lc();else{const e=await Tc(n.localStore,$i(t)),i=n.sharedClientState.addLocalQueryTarget(e.targetId);s=e.targetId,r=await Hl(n,t,s,"current"===i,e.resumeToken),n.isPrimaryClient&&Qc(n.remoteStore,e)}return r}async function Hl(e,t,n,s,r){e.Rc=(t,n,s)=>async function(e,t,n,s){let r=t.view.sc(n);r.zi&&(r=await Ic(e.localStore,t.query,!1).then((({documents:e})=>t.view.sc(e,r))));const i=s&&s.targetChanges.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,i);return eh(e,t.targetId,o.cc),o.snapshot}(e,t,n,s);const i=await Ic(e.localStore,t,!0),o=new Vl(t,i.ir),a=o.sc(i.documents),c=ua.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==e.onlineState,r),l=o.applyChanges(a,e.isPrimaryClient,c);eh(e,n,l.cc);const h=new Fl(t,n,o);return e.wc.set(t,h),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),l.snapshot}async function zl(e,t){const n=Fs(e),s=n.wc.get(t),r=n._c.get(s.targetId);if(r.length>1)return n._c.set(s.targetId,r.filter((e=>!Wi(e,t)))),void n.wc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Cc(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),Zc(n.remoteStore,s.targetId),Zl(n,s.targetId)})).catch(fr)):(Zl(n,s.targetId),await Cc(n.localStore,s.targetId,!0))}async function $l(e,t){const n=Fs(e);try{const e=await function(e,t){const n=Fs(e),s=t.snapshotVersion;let r=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const i=n.Zi.newChangeBuffer({trackRemovals:!0});r=n.Ji;const o=[];t.targetChanges.forEach(((i,a)=>{const c=r.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(e,i.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(e,i.addedDocuments,a))));let l=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?l=l.withResumeToken(Dr.EMPTY_BYTE_STRING,nr.min()).withLastLimboFreeSnapshotVersion(nr.min()):i.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(i.resumeToken,s)),r=r.insert(a,l),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,i)&&o.push(n.Bs.updateTargetData(e,l))}));let a=so(),c=mo();if(t.documentUpdates.forEach((s=>{t.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,s))})),o.push(Ec(e,i,t.documentUpdates).next((e=>{a=e.nr,c=e.sr}))),!s.isEqual(nr.min())){const t=n.Bs.getLastRemoteSnapshotVersion(e).next((t=>n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,s)));o.push(t)}return gr.waitFor(o).next((()=>i.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ji=r,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const s=n.yc.get(t);s&&(Vs(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?s.fc=!0:e.modifiedDocuments.size>0?Vs(s.fc):e.removedDocuments.size>0&&(Vs(s.fc),s.fc=!1))})),await sh(n,e,t)}catch(e){await fr(e)}}function Kl(e,t,n){const s=Fs(e);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const e=[];s.wc.forEach(((n,s)=>{const r=s.view.Mu(t);r.snapshot&&e.push(r.snapshot)})),function(e,t){const n=Fs(e);n.onlineState=t;let s=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Mu(t)&&(s=!0)})),s&&Bl(n)}(s.eventManager,t),e.length&&s.dc.nu(e),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function Gl(e,t,n){const s=Fs(e);s.sharedClientState.updateQueryState(t,"rejected",n);const r=s.yc.get(t),i=r&&r.key;if(i){let e=new Ir(ar.comparator);e=e.insert(i,li.newNoDocument(i,nr.min()));const n=mo().add(i),r=new ha(nr.min(),new Map,new Ir(Js),e,n);await $l(s,r),s.gc=s.gc.remove(i),s.yc.delete(t),nh(s)}else await Cc(s.localStore,t,!1).then((()=>Zl(s,t,n))).catch(fr)}async function Wl(e,t){const n=Fs(e),s=t.batch.batchId;try{const e=await function(e,t){const n=Fs(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const s=t.batch.keys(),r=n.Zi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,s){const r=n.batch,i=r.keys();let o=gr.resolve();return i.forEach((e=>{o=o.next((()=>s.getEntry(t,e))).next((t=>{const i=n.docVersions.get(e);Vs(null!==i),t.version.compareTo(i)<0&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),s.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,r)))}(n,e,t,r).next((()=>r.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=mo();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,s)))}))}(n.localStore,t);Ql(n,s,null),Xl(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await sh(n,e)}catch(e){await fr(e)}}async function Yl(e,t,n){const s=Fs(e);try{const e=await function(e,t){const n=Fs(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let s;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Vs(null!==t),s=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,s))).next((()=>n.localDocuments.getDocuments(e,s)))}))}(s.localStore,t);Ql(s,t,n),Xl(s,t),s.sharedClientState.updateMutationState(t,"rejected",n),await sh(s,e)}catch(n){await fr(n)}}function Xl(e,t){(e.Ec.get(t)||[]).forEach((e=>{e.resolve()})),e.Ec.delete(t)}function Ql(e,t,n){const s=Fs(e);let r=s.Tc[s.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),s.Tc[s.currentUser.toKey()]=r}}function Zl(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const s of e._c.get(t))e.wc.delete(s),n&&e.dc.Pc(s,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach((t=>{e.Ic.containsKey(t)||Jl(e,t)}))}function Jl(e,t){e.mc.delete(t.path.canonicalString());const n=e.gc.get(t);null!==n&&(Zc(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),nh(e))}function eh(e,t,n){for(const s of n)s instanceof Ol?(e.Ic.addReference(s.key,t),th(e,s)):s instanceof Ll?(Ps("SyncEngine","Document no longer in limbo: "+s.key),e.Ic.removeReference(s.key,t),e.Ic.containsKey(s.key)||Jl(e,s.key)):Ls()}function th(e,t){const n=t.key,s=n.path.canonicalString();e.gc.get(n)||e.mc.has(s)||(Ps("SyncEngine","New document in limbo: "+n),e.mc.add(s),nh(e))}function nh(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){const t=e.mc.values().next().value;e.mc.delete(t);const n=new ar(rr.fromString(t)),s=e.Ac.next();e.yc.set(s,new Ul(n)),e.gc=e.gc.insert(n,s),Qc(e.remoteStore,new Xa($i(Fi(n.path)),s,"TargetPurposeLimboResolution",vr.ct))}}async function sh(e,t,n){const s=Fs(e),r=[],i=[],o=[];s.wc.isEmpty()||(s.wc.forEach(((e,a)=>{o.push(s.Rc(a,t,n).then((e=>{if((e||n)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){r.push(e);const t=vc.Li(a.targetId,e);i.push(t)}})))})),await Promise.all(o),s.dc.nu(r),await async function(e,t){const n=Fs(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>gr.forEach(t,(t=>gr.forEach(t.Fi,(s=>n.persistence.referenceDelegate.addReference(e,t.targetId,s))).next((()=>gr.forEach(t.Bi,(s=>n.persistence.referenceDelegate.removeReference(e,t.targetId,s)))))))))}catch(e){if(!_r(e))throw e;Ps("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ji.get(t),s=e.snapshotVersion,r=e.withLastLimboFreeSnapshotVersion(s);n.Ji=n.Ji.insert(t,r)}}}(s.localStore,i))}async function rh(e,t){const n=Fs(e);if(!n.currentUser.isEqual(t)){Ps("SyncEngine","User change. New user:",t.toKey());const e=await kc(n.localStore,t);n.currentUser=t,function(e,t){e.Ec.forEach((e=>{e.forEach((e=>{e.reject(new js(Us.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ec.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await sh(n,e.er)}}function ih(e,t){const n=Fs(e),s=n.yc.get(t);if(s&&s.fc)return mo().add(s.key);{let e=mo();const s=n._c.get(t);if(!s)return e;for(const t of s){const s=n.wc.get(t);e=e.unionWith(s.view.nc)}return e}}function oh(e){const t=Fs(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=$l.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ih.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Gl.bind(null,t),t.dc.nu=Nl.bind(null,t.eventManager),t.dc.Pc=Pl.bind(null,t.eventManager),t}function ah(e){const t=Fs(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Wl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Yl.bind(null,t),t}class ch{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=jc(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return wc(this.persistence,new bc,e.initialUser,this.serializer)}createPersistence(e){return new fc(_c.zs,this.serializer)}createSharedClientState(e){return new Mc}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class lh{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Kl(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=rh.bind(null,this.syncEngine),await yl(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Rl}createDatastore(e){const t=jc(e.databaseInfo.databaseId),n=(s=e.databaseInfo,new Fc(s));var s;return function(e,t,n,s){return new Kc(e,t,n,s)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,s=e.asyncQueue,r=e=>Kl(this.syncEngine,e,0),i=Pc.D()?new Pc:new Nc,new Wc(t,n,s,r,i);var t,n,s,r,i}createSyncEngine(e,t){return function(e,t,n,s,r,i,o){const a=new jl(e,t,n,s,r,i);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Fs(e);Ps("RemoteStore","RemoteStore shutting down."),t.vu.add(5),await Xc(t),t.Pu.shutdown(),t.bu.set("Unknown")}(this.remoteStore)}}class hh{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):Bs("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class uh{constructor(e,t,n,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=Rs.UNAUTHENTICATED,this.clientId=Zs.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Ps("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Ps("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new js(Us.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new qs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=El(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function dh(e,t){e.asyncQueue.verifyOperationInProgress(),Ps("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let s=n.initialUser;e.setCredentialChangeListener((async e=>{s.isEqual(e)||(await kc(t.localStore,e),s=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function mh(e,t){e.asyncQueue.verifyOperationInProgress();const n=await fh(e);Ps("FirestoreClient","Initializing OnlineComponentProvider");const s=await e.getConfiguration();await t.initialize(n,s),e.setCredentialChangeListener((e=>bl(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>bl(t.remoteStore,n))),e._onlineComponents=t}function ph(e){return"FirebaseError"===e.name?e.code===Us.FAILED_PRECONDITION||e.code===Us.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function fh(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Ps("FirestoreClient","Using user provided OfflineComponentProvider");try{await dh(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!ph(n))throw n;Ds("Error using user provided cache. Falling back to memory cache: "+n),await dh(e,new ch)}}else Ps("FirestoreClient","Using default OfflineComponentProvider"),await dh(e,new ch);return e._offlineComponents}async function gh(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Ps("FirestoreClient","Using user provided OnlineComponentProvider"),await mh(e,e._uninitializedComponentsProvider._online)):(Ps("FirestoreClient","Using default OnlineComponentProvider"),await mh(e,new lh))),e._onlineComponents}function _h(e){return gh(e).then((e=>e.syncEngine))}async function vh(e){const t=await gh(e),n=t.eventManager;return n.onListen=ql.bind(null,t.syncEngine),n.onUnlisten=zl.bind(null,t.syncEngine),n}function bh(e,t,n={}){const s=new qs;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,s,r){const i=new hh({next:i=>{t.enqueueAndForget((()=>Ml(e,o)));const a=i.docs.has(n);!a&&i.fromCache?r.reject(new js(Us.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&s&&"server"===s.source?r.reject(new js(Us.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(i)},error:e=>r.reject(e)}),o=new Dl(Fi(n.path),i,{includeMetadataChanges:!0,Ku:!0});return Al(e,o)}(await vh(e),e.asyncQueue,t,n,s))),s.promise}function yh(e,t,n={}){const s=new qs;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,s,r){const i=new hh({next:n=>{t.enqueueAndForget((()=>Ml(e,o))),n.fromCache&&"server"===s.source?r.reject(new js(Us.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:e=>r.reject(e)}),o=new Dl(n,i,{includeMetadataChanges:!0,Ku:!0});return Al(e,o)}(await vh(e),e.asyncQueue,t,n,s))),s.promise}function wh(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const kh=new Map;function xh(e,t,n){if(!n)throw new js(Us.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Eh(e){if(!ar.isDocumentKey(e))throw new js(Us.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Sh(e){if(ar.isDocumentKey(e))throw new js(Us.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Th(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Ls()}function Ch(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new js(Us.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Th(e);throw new js(Us.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Ih(e,t){if(t<=0)throw new js(Us.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Rh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new js(Us.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new js(Us.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,s){if(!0===t&&!0===s)throw new js(Us.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=wh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new js(Us.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new js(Us.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new js(Us.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Ah{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Rh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new js(Us.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new js(Us.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Rh(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new zs;switch(e.type){case"firstParty":return new Ws(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new js(Us.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=kh.get(e);t&&(Ps("ComponentProvider","Removing Datastore"),kh.delete(e),t.terminate())}(this),Promise.resolve()}}class Mh{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ph(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Mh(this.firestore,e,this._key)}}class Nh{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Nh(this.firestore,e,this._query)}}class Ph extends Nh{constructor(e,t,n){super(e,t,Fi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Mh(this.firestore,null,new ar(e))}withConverter(e){return new Ph(this.firestore,e,this._path)}}function Bh(e,t,...n){if(e=(0,a.m9)(e),xh("collection","path",t),e instanceof Ah){const s=rr.fromString(t,...n);return Sh(s),new Ph(e,null,s)}{if(!(e instanceof Mh||e instanceof Ph))throw new js(Us.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(rr.fromString(t,...n));return Sh(s),new Ph(e.firestore,null,s)}}function Dh(e,t,...n){if(e=(0,a.m9)(e),1===arguments.length&&(t=Zs.A()),xh("doc","path",t),e instanceof Ah){const s=rr.fromString(t,...n);return Eh(s),new Mh(e,null,new ar(s))}{if(!(e instanceof Mh||e instanceof Ph))throw new js(Us.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(rr.fromString(t,...n));return Eh(s),new Mh(e.firestore,e instanceof Ph?e.converter:null,new ar(s))}}class Oh{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new qc(this,"async_queue_retry"),this.Xc=()=>{const e=Uc();e&&Ps("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};const e=Uc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=Uc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise((()=>{}));const t=new qs;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Qc.push(e),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!_r(e))throw e;Ps("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(e){const t=this.Gc.then((()=>(this.Hc=!0,e().catch((e=>{this.Wc=e,this.Hc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Bs("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Hc=!1,e))))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const s=xl.createAndSchedule(this,e,t,n,(e=>this.na(e)));return this.zc.push(s),s}Zc(){this.Wc&&Ls()}verifyOperationInProgress(){}async sa(){let e;do{e=this.Gc,await e}while(e!==this.Gc)}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then((()=>{this.zc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()}))}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}function Lh(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class Vh extends Ah{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new Oh,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||jh(this),this._firestoreClient.terminate()}}function Fh(e,t){const n="object"==typeof e?e:(0,r.Mq)(),s="string"==typeof e?e:t||"(default)",i=(0,r.qX)(n,"firestore").getImmediate({identifier:s});if(!i._initialized){const e=(0,a.P0)("firestore");e&&function(e,t,n,s={}){var r;const i=(e=Ch(e,Ah))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&Ds("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),s.mockUserToken){let t,n;if("string"==typeof s.mockUserToken)t=s.mockUserToken,n=Rs.MOCK_USER;else{t=(0,a.Sg)(s.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);const i=s.mockUserToken.sub||s.mockUserToken.user_id;if(!i)throw new js(Us.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Rs(i)}e._authCredentials=new $s(new Hs(t,n))}}(i,...e)}return i}function Uh(e){return e._firestoreClient||jh(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function jh(e){var t,n,s;const r=e._freezeSettings(),i=function(e,t,n,s){return new Hr(e,t,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,wh(s.experimentalLongPollingOptions),s.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,r);e._firestoreClient=new uh(e._authCredentials,e._appCheckCredentials,e._queue,i),(null===(n=r.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(s=r.cache)||void 0===s?void 0:s._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.cache.kind,_offline:r.cache._offlineComponentProvider,_online:r.cache._onlineComponentProvider})}class qh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new qh(Dr.fromBase64String(e))}catch(e){throw new js(Us.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new qh(Dr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Hh{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new js(Us.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new or(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class zh{constructor(e){this._methodName=e}}class $h{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new js(Us.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new js(Us.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Js(this._lat,e._lat)||Js(this._long,e._long)}}const Kh=/^__.*__$/;class Gh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new qo(e,this.data,this.fieldMask,t,this.fieldTransforms):new jo(e,this.data,t,this.fieldTransforms)}}class Wh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new qo(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Yh(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ls()}}class Xh{constructor(e,t,n,s,r,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===r&&this.ua(),this.fieldTransforms=r||[],this.fieldMask=i||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new Xh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.aa({path:n,la:!1});return s.fa(e),s}da(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.aa({path:n,la:!1});return s.ua(),s}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return pu(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(Yh(this.ca)&&Kh.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class Qh{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||jc(e)}ya(e,t,n,s=!1){return new Xh({ca:e,methodName:t,ga:n,path:or.emptyPath(),la:!1,ma:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Zh(e){const t=e._freezeSettings(),n=jc(e._databaseId);return new Qh(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Jh(e,t,n,s,r,i={}){const o=e.ya(i.merge||i.mergeFields?2:0,t,n,r);hu("Data must be an object, but it was:",o,s);const a=cu(s,o);let c,l;if(i.merge)c=new Pr(o.fieldMask),l=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const s of i.mergeFields){const r=uu(t,s,n);if(!o.contains(r))throw new js(Us.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);fu(e,r)||e.push(r)}c=new Pr(e),l=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,l=o.fieldTransforms;return new Gh(new ai(a),c,l)}class eu extends zh{_toFieldTransform(e){if(2!==e.ca)throw 1===e.ca?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof eu}}function tu(e,t,n){return new Xh({ca:3,ga:t.settings.ga,methodName:e._methodName,la:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class nu extends zh{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=tu(this,e,!0),n=this.pa.map((e=>au(e,t))),s=new Eo(n);return new Mo(e.path,s)}isEqual(e){return this===e}}class su extends zh{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=tu(this,e,!0),n=this.pa.map((e=>au(e,t))),s=new To(n);return new Mo(e.path,s)}isEqual(e){return this===e}}function ru(e,t,n,s){const r=e.ya(1,t,n);hu("Data must be an object, but it was:",r,s);const i=[],o=ai.empty();Tr(s,((e,s)=>{const c=mu(t,e,n);s=(0,a.m9)(s);const l=r.da(c);if(s instanceof eu)i.push(c);else{const e=au(s,l);null!=e&&(i.push(c),o.set(c,e))}}));const c=new Pr(i);return new Wh(o,c,r.fieldTransforms)}function iu(e,t,n,s,r,i){const o=e.ya(1,t,n),c=[uu(t,s,n)],l=[r];if(i.length%2!=0)throw new js(Us.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<i.length;e+=2)c.push(uu(t,i[e])),l.push(i[e+1]);const h=[],u=ai.empty();for(let e=c.length-1;e>=0;--e)if(!fu(h,c[e])){const t=c[e];let n=l[e];n=(0,a.m9)(n);const s=o.da(t);if(n instanceof eu)h.push(t);else{const e=au(n,s);null!=e&&(h.push(t),u.set(t,e))}}const d=new Pr(h);return new Wh(u,d,o.fieldTransforms)}function ou(e,t,n,s=!1){return au(n,e.ya(s?4:3,t))}function au(e,t){if(lu(e=(0,a.m9)(e)))return hu("Unsupported field value:",t,e),cu(e,t);if(e instanceof zh)return function(e,t){if(!Yh(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){const n=[];let s=0;for(const r of e){let e=au(r,t.wa(s));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),s++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,a.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return vo(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=tr.fromDate(e);return{timestampValue:Ea(t.serializer,n)}}if(e instanceof tr){const n=new tr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Ea(t.serializer,n)}}if(e instanceof $h)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof qh)return{bytesValue:Sa(t.serializer,e._byteString)};if(e instanceof Mh){const n=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(n))throw t._a(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Ia(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${Th(e)}`)}(e,t)}function cu(e,t){const n={};return Cr(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Tr(e,((e,s)=>{const r=au(s,t.ha(e));null!=r&&(n[e]=r)})),{mapValue:{fields:n}}}function lu(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof tr||e instanceof $h||e instanceof qh||e instanceof Mh||e instanceof zh)}function hu(e,t,n){if(!lu(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const s=Th(n);throw"an object"===s?t._a(e+" a custom object"):t._a(e+" "+s)}}function uu(e,t,n){if((t=(0,a.m9)(t))instanceof Hh)return t._internalPath;if("string"==typeof t)return mu(e,t);throw pu("Field path arguments must be of type string or ",e,!1,void 0,n)}const du=new RegExp("[~\\*/\\[\\]]");function mu(e,t,n){if(t.search(du)>=0)throw pu(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Hh(...t.split("."))._internalPath}catch(s){throw pu(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function pu(e,t,n,s,r){const i=s&&!s.isEmpty(),o=void 0!==r;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${s}`),o&&(c+=` in document ${r}`),c+=")"),new js(Us.INVALID_ARGUMENT,a+e+c)}function fu(e,t){return e.some((e=>e.isEqual(t)))}class gu{constructor(e,t,n,s,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Mh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new _u(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(vu("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class _u extends gu{data(){return super.data()}}function vu(e,t){return"string"==typeof t?mu(e,t):t instanceof Hh?t._internalPath:t._delegate._internalPath}function bu(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new js(Us.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class yu{}class wu extends yu{}function ku(e,t,...n){let s=[];t instanceof yu&&s.push(t),s=s.concat(n),function(e){const t=e.filter((e=>e instanceof Su)).length,n=e.filter((e=>e instanceof xu)).length;if(t>1||t>0&&n>0)throw new js(Us.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const t of s)e=t._apply(e);return e}class xu extends wu{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new xu(e,t,n)}_apply(e){const t=this._parse(e);return Vu(e._query,t),new Nh(e.firestore,e.converter,Ki(e._query,t))}_parse(e){const t=Zh(e.firestore),n=function(e,t,n,s,r,i,o){let a;if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new js(Us.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){Lu(o,i);const t=[];for(const n of o)t.push(Ou(s,e,n));a={arrayValue:{values:t}}}else a=Ou(s,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Lu(o,i),a=ou(n,"where",o,"in"===i||"not-in"===i);return gi.create(r,i,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function Eu(e,t,n){const s=t,r=vu("where",e);return xu._create(r,s,n)}class Su extends yu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Su(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:_i.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const s=t.getFlattenedFilters();for(const e of s)Vu(n,e),n=Ki(n,e)}(e._query,t),new Nh(e.firestore,e.converter,Ki(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Tu extends wu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Tu(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new js(Us.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new js(Us.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new mi(t,n);return function(e,t){if(null===ji(e)){const n=qi(e);null!==n&&Fu(e,n,t.field)}}(e,s),s}(e._query,this._field,this._direction);return new Nh(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Li(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Cu(e,t="asc"){const n=t,s=vu("orderBy",e);return Tu._create(s,n)}class Iu extends wu{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Iu(e,t,n)}_apply(e){return new Nh(e.firestore,e.converter,Gi(e._query,this._limit,this._limitType))}}function Ru(e){return Ih("limit",e),Iu._create("limit",e,"F")}class Au extends wu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Au(e,t,n)}_apply(e){const t=Du(e,this.type,this._docOrFields,this._inclusive);return new Nh(e.firestore,e.converter,function(e,t){return new Li(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function Mu(...e){return Au._create("startAt",e,!0)}function Nu(...e){return Au._create("startAfter",e,!1)}class Pu extends wu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Pu(e,t,n)}_apply(e){const t=Du(e,this.type,this._docOrFields,this._inclusive);return new Nh(e.firestore,e.converter,function(e,t){return new Li(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function Bu(...e){return Pu._create("endAt",e,!0)}function Du(e,t,n,s){if(n[0]=(0,a.m9)(n[0]),n[0]instanceof gu)return function(e,t,n,s,r){if(!s)throw new js(Us.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of zi(e))if(n.field.isKeyField())i.push(Jr(t,s.key));else{const e=s.data.field(n.field);if(Ur(e))throw new js(Us.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new js(Us.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}i.push(e)}return new hi(i,r)}(e._query,e.firestore._databaseId,t,n[0]._document,s);{const r=Zh(e.firestore);return function(e,t,n,s,r,i){const o=e.explicitOrderBy;if(r.length>o.length)throw new js(Us.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<r.length;i++){const c=r[i];if(o[i].field.isKeyField()){if("string"!=typeof c)throw new js(Us.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof c}`);if(!Hi(e)&&-1!==c.indexOf("/"))throw new js(Us.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(rr.fromString(c));if(!ar.isDocumentKey(n))throw new js(Us.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const r=new ar(n);a.push(Jr(t,r))}else{const e=ou(n,s,c);a.push(e)}}return new hi(a,i)}(e._query,e.firestore._databaseId,r,t,n,s)}}function Ou(e,t,n){if("string"==typeof(n=(0,a.m9)(n))){if(""===n)throw new js(Us.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Hi(t)&&-1!==n.indexOf("/"))throw new js(Us.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=t.path.child(rr.fromString(n));if(!ar.isDocumentKey(s))throw new js(Us.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Jr(e,new ar(s))}if(n instanceof Mh)return Jr(e,n._key);throw new js(Us.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Th(n)}.`)}function Lu(e,t){if(!Array.isArray(e)||0===e.length)throw new js(Us.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Vu(e,t){if(t.isInequality()){const n=qi(e),s=t.field;if(null!==n&&!n.isEqual(s))throw new js(Us.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${s.toString()}'`);const r=ji(e);null!==r&&Fu(e,s,r)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new js(Us.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new js(Us.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function Fu(e,t,n){if(!n.isEqual(t))throw new js(Us.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Uu{convertValue(e,t="none"){switch(Kr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Vr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Fr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Ls()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Tr(e,((e,s)=>{n[e]=this.convertValue(s,t)})),n}convertGeoPoint(e){return new $h(Vr(e.latitude),Vr(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=jr(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(qr(e));default:return null}}convertTimestamp(e){const t=Lr(e);return new tr(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=rr.fromString(e);Vs(Ya(n));const s=new zr(n.get(1),n.get(3)),r=new ar(n.popFirst(5));return s.isEqual(t)||Bs(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function ju(e,t,n){let s;return s=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,s}class qu{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Hu extends gu{constructor(e,t,n,s,r,i){super(e,t,n,s,i),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new zu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(vu("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class zu extends Hu{data(e={}){return super.data(e)}}class $u{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new qu(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new zu(this._firestore,this._userDataWriter,n.key,n,new qu(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new js(Us.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const s=new zu(e._firestore,e._userDataWriter,n.doc.key,n.doc,new qu(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const s=new zu(e._firestore,e._userDataWriter,t.doc.key,t.doc,new qu(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,i=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:Ku(t.type),doc:s,oldIndex:r,newIndex:i}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Ku(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ls()}}function Gu(e){e=Ch(e,Mh);const t=Ch(e.firestore,Vh);return bh(Uh(t),e._key).then((n=>nd(t,e,n)))}class Wu extends Uu{constructor(e){super(),this.firestore=e}convertBytes(e){return new qh(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Mh(this.firestore,null,t)}}function Yu(e){e=Ch(e,Nh);const t=Ch(e.firestore,Vh),n=Uh(t),s=new Wu(t);return bu(e._query),yh(n,e._query).then((n=>new $u(t,s,e,n)))}function Xu(e,t,n){e=Ch(e,Mh);const s=Ch(e.firestore,Vh),r=ju(e.converter,t,n);return td(s,[Jh(Zh(s),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,Po.none())])}function Qu(e,t,n,...s){e=Ch(e,Mh);const r=Ch(e.firestore,Vh),i=Zh(r);let o;return o="string"==typeof(t=(0,a.m9)(t))||t instanceof Hh?iu(i,"updateDoc",e._key,t,n,s):ru(i,"updateDoc",e._key,t),td(r,[o.toMutation(e._key,Po.exists(!0))])}function Zu(e){return td(Ch(e.firestore,Vh),[new Ko(e._key,Po.none())])}function Ju(e,t){const n=Ch(e.firestore,Vh),s=Dh(e),r=ju(e.converter,t);return td(n,[Jh(Zh(e.firestore),"addDoc",s._key,r,null!==e.converter,{}).toMutation(s._key,Po.exists(!1))]).then((()=>s))}function ed(e,...t){var n,s,r;e=(0,a.m9)(e);let i={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||Lh(t[o])||(i=t[o],o++);const c={includeMetadataChanges:i.includeMetadataChanges};if(Lh(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(s=e.error)||void 0===s?void 0:s.bind(e),t[o+2]=null===(r=e.complete)||void 0===r?void 0:r.bind(e)}let l,h,u;if(e instanceof Mh)h=Ch(e.firestore,Vh),u=Fi(e._key.path),l={next:n=>{t[o]&&t[o](nd(h,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Ch(e,Nh);h=Ch(n.firestore,Vh),u=n._query;const s=new Wu(h);l={next:e=>{t[o]&&t[o](new $u(h,s,n,e))},error:t[o+1],complete:t[o+2]},bu(e._query)}return function(e,t,n,s){const r=new hh(s),i=new Dl(t,r,n);return e.asyncQueue.enqueueAndForget((async()=>Al(await vh(e),i))),()=>{r.Dc(),e.asyncQueue.enqueueAndForget((async()=>Ml(await vh(e),i)))}}(Uh(h),u,c,l)}function td(e,t){return function(e,t){const n=new qs;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const s=ah(e);try{const e=await function(e,t){const n=Fs(e),s=tr.now(),r=t.reduce(((e,t)=>e.add(t.key)),mo());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=so(),c=mo();return n.Zi.getEntries(e,r).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((r=>{i=r;const o=[];for(const e of t){const t=Fo(e,i.get(e.key).overlayedDocument);null!=t&&o.push(new qo(e.key,t,ci(t.value.mapValue),Po.exists(!0)))}return n.mutationQueue.addMutationBatch(e,s,o,t)})).next((t=>{o=t;const s=t.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,s)}))})).then((()=>({batchId:o.batchId,changes:oo(i)})))}(s.localStore,t);s.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let s=e.Tc[e.currentUser.toKey()];s||(s=new Ir(Js)),s=s.insert(t,n),e.Tc[e.currentUser.toKey()]=s}(s,e.batchId,n),await sh(s,e.changes),await hl(s.remoteStore)}catch(e){const t=El(e,"Failed to persist write");n.reject(t)}}(await _h(e),t,n))),n.promise}(Uh(e),t)}function nd(e,t,n){const s=n.docs.get(t._key),r=new Wu(e);return new Hu(e,r,t._key,s,new qu(n.hasPendingWrites,n.fromCache),t.converter)}function sd(){return new eu("deleteField")}function rd(...e){return new nu("arrayUnion",e)}function id(...e){return new su("arrayRemove",e)}!function(e,t=!0){!function(e){As=e}(r.Jn),(0,r.Xd)(new i.wA("firestore",((e,{instanceIdentifier:n,options:s})=>{const r=e.getProvider("app").getImmediate(),i=new Vh(new Ks(e.getProvider("auth-internal")),new Xs(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new js(Us.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zr(e.options.projectId,t)}(r,n),r);return s=Object.assign({useFetchStreams:t},s),i._setSettings(s),i}),"PUBLIC").setMultipleInstances(!0)),(0,r.KN)(Is,"3.13.0",e),(0,r.KN)(Is,"3.13.0","esm2017")}()},80175:(e,t,n)=>{"use strict";n.d(t,{KL:()=>Tt,LP:()=>Ct,ps:()=>It});var s=n(25816),r=n(8463),i=n(74444);const o=(e,t)=>t.some((t=>e instanceof t));let a,c;const l=new WeakMap,h=new WeakMap,u=new WeakMap,d=new WeakMap,m=new WeakMap;let p={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return h.get(e);if("objectStoreNames"===t)return e.objectStoreNames||u.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return _(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(v(this),t),_(l.get(this))}:function(...t){return _(e.apply(v(this),t))}:function(t,...n){const s=e.call(v(this),t,...n);return u.set(s,t.sort?t.sort():[t]),_(s)}}function g(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(h.has(e))return;const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),s()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));h.set(e,t)}(e),o(e,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,p):e)}function _(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(_(e.result)),s()},i=()=>{n(e.error),s()};e.addEventListener("success",r),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&l.set(t,e)})).catch((()=>{})),m.set(t,e),t}(e);if(d.has(e))return d.get(e);const t=g(e);return t!==e&&(d.set(e,t),m.set(t,e)),t}const v=e=>m.get(e);const b=["get","getKey","getAll","getAllKeys","count"],y=["put","add","delete","clear"],w=new Map;function k(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,r=y.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!r&&!b.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let o=i.store;return s&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&i.done]))[0]};return w.set(t,i),i}p=(e=>({...e,get:(t,n,s)=>k(t,n)||e.get(t,n,s),has:(t,n)=>!!k(t,n)||e.has(t,n)}))(p);const x="@firebase/installations",E="0.6.4",S=1e4,T=`w:${E}`,C="FIS_v2",I="https://firebaseinstallations.googleapis.com/v1",R=36e5,A={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},M=new i.LL("installations","Installations",A);function N(e){return e instanceof i.ZR&&e.code.includes("request-failed")}function P({projectId:e}){return`${I}/projects/${e}/installations`}function B(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function D(e,t){const n=(await t.json()).error;return M.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function O({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function L(e,{refreshToken:t}){const n=O(e);return n.append("Authorization",function(e){return`${C} ${e}`}(t)),n}async function V(e){const t=await e();return t.status>=500&&t.status<600?e():t}function F(e){return new Promise((t=>{setTimeout(t,e)}))}const U=/^[cdef][\w-]{21}$/,j="";function q(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){const t=(n=e,btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_"));var n;return t.substr(0,22)}(e);return U.test(t)?t:j}catch(e){return j}}function H(e){return`${e.appName}!${e.appId}`}const z=new Map;function $(e,t){const n=H(e);K(n,t),function(e,t){const n=W();n&&n.postMessage({key:e,fid:t});Y()}(n,t)}function K(e,t){const n=z.get(e);if(n)for(const e of n)e(t)}let G=null;function W(){return!G&&"BroadcastChannel"in self&&(G=new BroadcastChannel("[Firebase] FID Change"),G.onmessage=e=>{K(e.data.key,e.data.fid)}),G}function Y(){0===z.size&&G&&(G.close(),G=null)}const X="firebase-installations-database",Q=1,Z="firebase-installations-store";let J=null;function ee(){return J||(J=function(e,t,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(e,t),a=_(o);return s&&o.addEventListener("upgradeneeded",(e=>{s(_(o.result),e.oldVersion,e.newVersion,_(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{i&&e.addEventListener("close",(()=>i())),r&&e.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}(X,Q,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(Z)}})),J}async function te(e,t){const n=H(e),s=(await ee()).transaction(Z,"readwrite"),r=s.objectStore(Z),i=await r.get(n);return await r.put(t,n),await s.done,i&&i.fid===t.fid||$(e,t.fid),t}async function ne(e){const t=H(e),n=(await ee()).transaction(Z,"readwrite");await n.objectStore(Z).delete(t),await n.done}async function se(e,t){const n=H(e),s=(await ee()).transaction(Z,"readwrite"),r=s.objectStore(Z),i=await r.get(n),o=t(i);return void 0===o?await r.delete(n):await r.put(o,n),await s.done,!o||i&&i.fid===o.fid||$(e,o.fid),o}async function re(e){let t;const n=await se(e.appConfig,(n=>{const s=function(e){const t=e||{fid:q(),registrationStatus:0};return ae(t)}(n),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine){return{installationEntry:t,registrationPromise:Promise.reject(M.create("app-offline"))}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},s=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const s=P(e),r=O(e),i=t.getImmediate({optional:!0});if(i){const e=await i.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={fid:n,authVersion:C,appId:e.appId,sdkVersion:T},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await V((()=>fetch(s,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:B(e.authToken)}}throw await D("Create Installation",c)}(e,t);return te(e.appConfig,n)}catch(n){throw N(n)&&409===n.customData.serverCode?await ne(e.appConfig):await te(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:s}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:ie(e)}:{installationEntry:t}}(e,s);return t=r.registrationPromise,r.installationEntry}));return n.fid===j?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function ie(e){let t=await oe(e.appConfig);for(;1===t.registrationStatus;)await F(100),t=await oe(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await re(e);return n||t}return t}function oe(e){return se(e,(e=>{if(!e)throw M.create("installation-not-found");return ae(e)}))}function ae(e){return 1===(t=e).registrationStatus&&t.registrationTime+S<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function ce({appConfig:e,heartbeatServiceProvider:t},n){const s=function(e,{fid:t}){return`${P(e)}/${t}/authTokens:generate`}(e,n),r=L(e,n),i=t.getImmediate({optional:!0});if(i){const e=await i.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={installation:{sdkVersion:T,appId:e.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await V((()=>fetch(s,a)));if(c.ok){return B(await c.json())}throw await D("Generate Auth Token",c)}async function le(e,t=!1){let n;const s=await se(e.appConfig,(s=>{if(!ue(s))throw M.create("not-registered");const r=s.authToken;if(!t&&function(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+R}(e)}(r))return s;if(1===r.requestStatus)return n=async function(e,t){let n=await he(e.appConfig);for(;1===n.authToken.requestStatus;)await F(100),n=await he(e.appConfig);const s=n.authToken;return 0===s.requestStatus?le(e,t):s}(e,t),s;{if(!navigator.onLine)throw M.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(s);return n=async function(e,t){try{const n=await ce(e,t),s=Object.assign(Object.assign({},t),{authToken:n});return await te(e.appConfig,s),n}catch(n){if(!N(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await te(e.appConfig,n)}else await ne(e.appConfig);throw n}}(e,t),t}}));return n?await n:s.authToken}function he(e){return se(e,(e=>{if(!ue(e))throw M.create("not-registered");const t=e.authToken;return 1===(n=t).requestStatus&&n.requestTime+S<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var n}))}function ue(e){return void 0!==e&&2===e.registrationStatus}async function de(e,t=!1){const n=e;await async function(e){const{registrationPromise:t}=await re(e);t&&await t}(n);return(await le(n,t)).token}function me(e){return M.create("missing-app-config-values",{valueName:e})}const pe="installations",fe=e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw me("App Configuration");if(!e.name)throw me("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw me(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:(0,s.qX)(t,"heartbeat"),_delete:()=>Promise.resolve()}},ge=e=>{const t=e.getProvider("app").getImmediate(),n=(0,s.qX)(t,pe).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:s}=await re(t);return s?s.catch(console.error):le(t).catch(console.error),n.fid}(n),getToken:e=>de(n,e)}};(0,s.Xd)(new r.wA(pe,fe,"PUBLIC")),(0,s.Xd)(new r.wA("installations-internal",ge,"PRIVATE")),(0,s.KN)(x,E),(0,s.KN)(x,E,"esm2017");const _e=(e,t)=>t.some((t=>e instanceof t));let ve,be;const ye=new WeakMap,we=new WeakMap,ke=new WeakMap,xe=new WeakMap,Ee=new WeakMap;let Se={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return we.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ke.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ie(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Te(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(be||(be=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Re(this),t),Ie(ye.get(this))}:function(...t){return Ie(e.apply(Re(this),t))}:function(t,...n){const s=e.call(Re(this),t,...n);return ke.set(s,t.sort?t.sort():[t]),Ie(s)}}function Ce(e){return"function"==typeof e?Te(e):(e instanceof IDBTransaction&&function(e){if(we.has(e))return;const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),s()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));we.set(e,t)}(e),_e(e,ve||(ve=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Se):e)}function Ie(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(Ie(e.result)),s()},i=()=>{n(e.error),s()};e.addEventListener("success",r),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&ye.set(t,e)})).catch((()=>{})),Ee.set(t,e),t}(e);if(xe.has(e))return xe.get(e);const t=Ce(e);return t!==e&&(xe.set(e,t),Ee.set(t,e)),t}const Re=e=>Ee.get(e);function Ae(e,t,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(e,t),a=Ie(o);return s&&o.addEventListener("upgradeneeded",(e=>{s(Ie(o.result),e.oldVersion,e.newVersion,Ie(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{i&&e.addEventListener("close",(()=>i())),r&&e.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}function Me(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(()=>t())),Ie(n).then((()=>{}))}const Ne=["get","getKey","getAll","getAllKeys","count"],Pe=["put","add","delete","clear"],Be=new Map;function De(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Be.get(t))return Be.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,r=Pe.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!r&&!Ne.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let o=i.store;return s&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&i.done]))[0]};return Be.set(t,i),i}!function(e){Se=e(Se)}((e=>({...e,get:(t,n,s)=>De(t,n)||e.get(t,n,s),has:(t,n)=>!!De(t,n)||e.has(t,n)})));const Oe="/firebase-messaging-sw.js",Le="/firebase-cloud-messaging-push-scope",Ve="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Fe="https://fcmregistrations.googleapis.com/v1",Ue="google.c.a.c_id",je="google.c.a.c_l",qe="google.c.a.ts";var He,ze;function $e(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Ke(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),s=new Uint8Array(n.length);for(let e=0;e<n.length;++e)s[e]=n.charCodeAt(e);return s}!function(e){e[e.DATA_MESSAGE=1]="DATA_MESSAGE",e[e.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"}(He||(He={})),function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(ze||(ze={}));const Ge="fcm_token_details_db",We=5,Ye="fcm_token_object_Store";const Xe="firebase-messaging-database",Qe=1,Ze="firebase-messaging-store";let Je=null;function et(){return Je||(Je=Ae(Xe,Qe,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(Ze)}})),Je}async function tt(e){const t=st(e),n=await et(),s=await n.transaction(Ze).objectStore(Ze).get(t);if(s)return s;{const t=await async function(e){if("databases"in indexedDB){const e=(await indexedDB.databases()).map((e=>e.name));if(!e.includes(Ge))return null}let t=null;return(await Ae(Ge,We,{upgrade:async(n,s,r,i)=>{var o;if(s<2)return;if(!n.objectStoreNames.contains(Ye))return;const a=i.objectStore(Ye),c=await a.index("fcmSenderId").get(e);if(await a.clear(),c)if(2===s){const e=c;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(o=e.createTime)&&void 0!==o?o:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:$e(e.vapidKey)}}}else if(3===s){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:$e(e.auth),p256dh:$e(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:$e(e.vapidKey)}}}else if(4===s){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:$e(e.auth),p256dh:$e(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:$e(e.vapidKey)}}}}})).close(),await Me(Ge),await Me("fcm_vapid_details_db"),await Me("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}(t)?t:null}(e.appConfig.senderId);if(t)return await nt(e,t),t}}async function nt(e,t){const n=st(e),s=(await et()).transaction(Ze,"readwrite");return await s.objectStore(Ze).put(t,n),await s.done,t}function st({appConfig:e}){return e.appId}const rt={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},it=new i.LL("messaging","Messaging",rt);async function ot(e,t){const n={method:"DELETE",headers:await ct(e)};try{const s=await fetch(`${at(e.appConfig)}/${t}`,n),r=await s.json();if(r.error){const e=r.error.message;throw it.create("token-unsubscribe-failed",{errorInfo:e})}}catch(e){throw it.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function at({projectId:e}){return`${Fe}/projects/${e}/registrations`}async function ct({appConfig:e,installations:t}){const n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function lt({p256dh:e,auth:t,endpoint:n,vapidKey:s}){const r={web:{endpoint:n,auth:t,p256dh:e}};return s!==Ve&&(r.web.applicationPubKey=s),r}const ht=6048e5;async function ut(e){const t=await async function(e,t){const n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ke(t)})}(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:$e(t.getKey("auth")),p256dh:$e(t.getKey("p256dh"))},s=await tt(e.firebaseDependencies);if(s){if(function(e,t){const n=t.vapidKey===e.vapidKey,s=t.endpoint===e.endpoint,r=t.auth===e.auth,i=t.p256dh===e.p256dh;return n&&s&&r&&i}(s.subscriptionOptions,n))return Date.now()>=s.createTime+ht?async function(e,t){try{const n=await async function(e,t){const n=await ct(e),s=lt(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(s)};let i;try{const n=await fetch(`${at(e.appConfig)}/${t.token}`,r);i=await n.json()}catch(e){throw it.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){const e=i.error.message;throw it.create("token-update-failed",{errorInfo:e})}if(!i.token)throw it.create("token-update-no-token");return i.token}(e.firebaseDependencies,t),s=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await nt(e.firebaseDependencies,s),n}catch(t){throw await dt(e),t}}(e,{token:s.token,createTime:Date.now(),subscriptionOptions:n}):s.token;try{await ot(e.firebaseDependencies,s.token)}catch(e){console.warn(e)}return mt(e.firebaseDependencies,n)}return mt(e.firebaseDependencies,n)}async function dt(e){const t=await tt(e.firebaseDependencies);t&&(await ot(e.firebaseDependencies,t.token),await async function(e){const t=st(e),n=(await et()).transaction(Ze,"readwrite");await n.objectStore(Ze).delete(t),await n.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function mt(e,t){const n=await async function(e,t){const n=await ct(e),s=lt(t),r={method:"POST",headers:n,body:JSON.stringify(s)};let i;try{const t=await fetch(at(e.appConfig),r);i=await t.json()}catch(e){throw it.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){const e=i.error.message;throw it.create("token-subscribe-failed",{errorInfo:e})}if(!i.token)throw it.create("token-subscribe-no-token");return i.token}(e,t),s={token:n,createTime:Date.now(),subscriptionOptions:t};return await nt(e,s),s.token}function pt(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const s=t.notification.body;s&&(e.notification.body=s);const r=t.notification.image;r&&(e.notification.image=r);const i=t.notification.icon;i&&(e.notification.icon=i)}(t,e),function(e,t){if(!t.data)return;e.data=t.data}(t,e),function(e,t){var n,s,r,i,o;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};const a=null!==(r=null===(s=t.fcmOptions)||void 0===s?void 0:s.link)&&void 0!==r?r:null===(i=t.notification)||void 0===i?void 0:i.click_action;a&&(e.fcmOptions.link=a);const c=null===(o=t.fcmOptions)||void 0===o?void 0:o.analytics_label;c&&(e.fcmOptions.analyticsLabel=c)}(t,e),t}function ft(e,t){const n=[];for(let s=0;s<e.length;s++)n.push(e.charAt(s)),s<t.length&&n.push(t.charAt(s));return n.join("")}function gt(e){return it.create("missing-app-config-values",{valueName:e})}ft("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),ft("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class _t{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=function(e){if(!e||!e.options)throw gt("App Configuration Object");if(!e.name)throw gt("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const e of t)if(!n[e])throw gt(e);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function vt(e){try{e.swRegistration=await navigator.serviceWorker.register(Oe,{scope:Le}),e.swRegistration.update().catch((()=>{}))}catch(e){throw it.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}}async function bt(e,t){if(!navigator)throw it.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw it.create("permission-blocked");return await async function(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=Ve)}(e,null==t?void 0:t.vapidKey),await async function(e,t){if(t||e.swRegistration||await vt(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw it.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),ut(e)}async function yt(e,t,n){const s=function(e){switch(e){case ze.NOTIFICATION_CLICKED:return"notification_open";case ze.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);(await e.firebaseDependencies.analyticsProvider.get()).logEvent(s,{message_id:n[Ue],message_name:n[je],message_time:n[qe],message_device_time:Math.floor(Date.now()/1e3)})}async function wt(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===ze.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(pt(n)):e.onMessageHandler.next(pt(n)));const s=n.data;var r;"object"==typeof(r=s)&&r&&Ue in r&&"1"===s["google.c.a.e"]&&await yt(e,n.messageType,s)}const kt="@firebase/messaging",xt="0.12.4",Et=e=>{const t=new _t(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",(e=>wt(t,e))),t},St=e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>bt(t,e)}};function Tt(e=(0,s.Mq)()){return async function(){try{await(0,i.eu)()}catch(e){return!1}return"undefined"!=typeof window&&(0,i.hl)()&&(0,i.zI)()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}().then((e=>{if(!e)throw it.create("unsupported-browser")}),(e=>{throw it.create("indexed-db-unsupported")})),(0,s.qX)((0,i.m9)(e),"messaging").getImmediate()}async function Ct(e,t){return bt(e=(0,i.m9)(e),t)}function It(e,t){return function(e,t){if(!navigator)throw it.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=(0,i.m9)(e),t)}(0,s.Xd)(new r.wA("messaging",Et,"PUBLIC")),(0,s.Xd)(new r.wA("messaging-internal",St,"PRIVATE")),(0,s.KN)(kt,xt),(0,s.KN)(kt,xt,"esm2017")},86650:(e,t,n)=>{"use strict";n.d(t,{oq:()=>De,Jt:()=>Be,cF:()=>Le,iH:()=>Oe,B0:()=>Pe});var s=n(25816),r=n(74444),i=n(8463);const o="firebasestorage.googleapis.com",a="storageBucket";class c extends r.ZR{constructor(e,t,n=0){super(u(e),`Firebase Storage: ${t} (${u(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,c.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return u(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var l,h;function u(e){return"storage/"+e}function d(){return new c(l.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function m(){return new c(l.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function p(){return new c(l.CANCELED,"User canceled the upload/download.")}function f(){return new c(l.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function g(e){return new c(l.INVALID_ARGUMENT,e)}function _(){return new c(l.APP_DELETED,"The Firebase app was deleted.")}function v(e,t){return new c(l.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function b(e){throw new c(l.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(l||(l={}));class y{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=y.makeFromUrl(e,t)}catch(t){return new y(e,"")}if(""===n.path)return n;throw s=e,new c(l.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.");var s}static makeFromUrl(e,t){let n=null;const s="([A-Za-z0-9.\\-_]+)";const r=new RegExp("^gs://"+s+"(/(.*))?$","i");function i(e){e.path_=decodeURIComponent(e.path)}const a=t.replace(/[.]/g,"\\."),h=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${s}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp(`^https?://${t===o?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${s}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:i}];for(let t=0;t<h.length;t++){const s=h[t],r=s.regex.exec(e);if(r){const e=r[s.indices.bucket];let t=r[s.indices.path];t||(t=""),n=new y(e,t),s.postModify(n);break}}if(null==n)throw function(e){return new c(l.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class w{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function k(e){return"string"==typeof e||e instanceof String}function x(e){return E()&&e instanceof Blob}function E(){return"undefined"!=typeof Blob&&!(0,r.UG)()}function S(e,t,n,s){if(s<t)throw g(`Invalid value for '${e}'. Expected ${t} or greater.`);if(s>n)throw g(`Invalid value for '${e}'. Expected ${n} or less.`)}function T(e,t,n){let s=t;return null==n&&(s=`https://${t}`),`${n}://${s}/v0${e}`}function C(e){const t=encodeURIComponent;let n="?";for(const s in e)if(e.hasOwnProperty(s)){n=n+(t(s)+"="+t(e[s]))+"&"}return n=n.slice(0,-1),n}function I(e,t){const n=e>=500&&e<600,s=-1!==[408,429].indexOf(e),r=-1!==t.indexOf(e);return n||s||r}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(h||(h={}));class R{constructor(e,t,n,s,r,i,o,a,c,l,h,u=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=s,this.successCodes_=r,this.additionalRetryCodes_=i,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=h,this.retry=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new A(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const s=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(s),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(s),this.pendingConnection_=null;const t=n.getErrorCode()===h.NO_ERROR,r=n.getStatus();if(!t||I(r,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===h.ABORT;return void e(!1,new A(!1,null,t))}const i=-1!==this.successCodes_.indexOf(r);e(!0,new A(i,n))}))},t=(e,t)=>{const n=this.resolve_,s=this.reject_,r=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(r,r.getResponse());void 0!==e?n(e):n()}catch(e){s(e)}else if(null!==r){const e=d();e.serverResponse=r.getErrorText(),this.errorCallback_?s(this.errorCallback_(r,e)):s(e)}else if(t.canceled){s(this.appDelete_?_():p())}else{s(m())}};this.canceled_?t(0,new A(!1,null,!0)):this.backoffId_=function(e,t,n){let s=1,r=null,i=null,o=!1,a=0;function c(){return 2===a}let l=!1;function h(...e){l||(l=!0,t.apply(null,e))}function u(t){r=setTimeout((()=>{r=null,e(m,c())}),t)}function d(){i&&clearTimeout(i)}function m(e,...t){if(l)return void d();if(e)return d(),void h.call(null,e,...t);if(c()||o)return d(),void h.call(null,e,...t);let n;s<64&&(s*=2),1===a?(a=2,n=0):n=1e3*(s+Math.random()),u(n)}let p=!1;function f(e){p||(p=!0,d(),l||(null!==r?(e||(a=2),clearTimeout(r),u(0)):e||(a=1)))}return u(0),i=setTimeout((()=>{o=!0,f(!0)}),n),f}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class A{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function M(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function N(...e){const t=M();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(E())return new Blob(e);throw new c(l.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function P(e){if("undefined"==typeof atob)throw t="base-64",new c(l.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`);var t;return atob(e)}const B={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class D{constructor(e,t){this.data=e,this.contentType=t||null}}function O(e,t){switch(e){case B.RAW:return new D(L(t));case B.BASE64:case B.BASE64URL:return new D(V(e,t));case B.DATA_URL:return new D(function(e){const t=new F(e);return t.base64?V(B.BASE64,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw v(B.DATA_URL,"Malformed data URL.")}return L(t)}(t.rest)}(t),new F(t).contentType)}throw d()}function L(e){const t=[];for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);if(s<=127)t.push(s);else if(s<=2047)t.push(192|s>>6,128|63&s);else if(55296==(64512&s)){if(n<e.length-1&&56320==(64512&e.charCodeAt(n+1))){s=65536|(1023&s)<<10|1023&e.charCodeAt(++n),t.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|63&s)}else t.push(239,191,189)}else 56320==(64512&s)?t.push(239,191,189):t.push(224|s>>12,128|s>>6&63,128|63&s)}return new Uint8Array(t)}function V(e,t){switch(e){case B.BASE64:{const n=-1!==t.indexOf("-"),s=-1!==t.indexOf("_");if(n||s){throw v(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case B.BASE64URL:{const n=-1!==t.indexOf("+"),s=-1!==t.indexOf("/");if(n||s){throw v(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=P(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw v(e,"Invalid character found")}const s=new Uint8Array(n.length);for(let e=0;e<n.length;e++)s[e]=n.charCodeAt(e);return s}class F{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw v(B.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){if(!(e.length>=t.length))return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class U{constructor(e,t){let n=0,s="";x(e)?(this.data_=e,n=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(x(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new U(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new U(n,!0)}}static getBlob(...e){if(E()){const t=e.map((e=>e instanceof U?e.data_:e));return new U(N.apply(null,t))}{const t=e.map((e=>k(e)?O(B.RAW,e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const s=new Uint8Array(n);let r=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)s[r++]=e[t]})),new U(s,!0)}}uploadData(){return this.data_}}function j(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(n=t)||Array.isArray(n)?null:t;var n}function q(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function H(e,t){return t}class z{constructor(e,t,n,s){this.server=e,this.local=t||e,this.writable=!!n,this.xform=s||H}}let $=null;function K(){if($)return $;const e=[];e.push(new z("bucket")),e.push(new z("generation")),e.push(new z("metageneration")),e.push(new z("name","fullPath",!0));const t=new z("name");t.xform=function(e,t){return function(e){return!k(e)||e.length<2?e:q(e)}(t)},e.push(t);const n=new z("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new z("timeCreated")),e.push(new z("updated")),e.push(new z("md5Hash",null,!0)),e.push(new z("cacheControl",null,!0)),e.push(new z("contentDisposition",null,!0)),e.push(new z("contentEncoding",null,!0)),e.push(new z("contentLanguage",null,!0)),e.push(new z("contentType",null,!0)),e.push(new z("metadata","customMetadata",!0)),$=e,$}function G(e,t,n){const s={type:"file"},r=n.length;for(let e=0;e<r;e++){const r=n[e];s[r.local]=r.xform(s,t[r.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,s=e.fullPath,r=new y(n,s);return t._makeStorageReference(r)}})}(s,e),s}function W(e,t,n){const s=j(t);if(null===s)return null;return G(e,s,n)}function Y(e,t){const n={},s=t.length;for(let r=0;r<s;r++){const s=t[r];s.writable&&(n[s.server]=e[s.local])}return JSON.stringify(n)}class X{constructor(e,t,n,s){this.url=e,this.method=t,this.handler=n,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Q(e){if(!e)throw d()}function Z(e,t){return function(n,s){const r=W(e,s,t);return Q(null!==r),r}}function J(e,t){return function(n,s){const r=W(e,s,t);return Q(null!==r),function(e,t,n,s){const r=j(t);if(null===r)return null;if(!k(r.downloadTokens))return null;const i=r.downloadTokens;if(0===i.length)return null;const o=encodeURIComponent;return i.split(",").map((t=>{const r=e.bucket,i=e.fullPath;return T("/b/"+o(r)+"/o/"+o(i),n,s)+C({alt:"media",token:t})}))[0]}(r,s,e.host,e._protocol)}}function ee(e){return function(t,n){let s;var r,i;return 401===t.getStatus()?s=t.getErrorText().includes("Firebase App Check token is invalid")?new c(l.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new c(l.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=e.bucket,s=new c(l.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(r=e.path,s=new c(l.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):s=n,s.status=t.getStatus(),s.serverResponse=n.serverResponse,s}}function te(e){const t=ee(e);return function(n,s){let r=t(n,s);var i;return 404===n.getStatus()&&(i=e.path,r=new c(l.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),r.serverResponse=s.serverResponse,r}}function ne(e,t,n){const s=T(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,i=new X(s,"GET",Z(e,n),r);return i.errorHandler=te(t),i}function se(e,t,n){const s=Object.assign({},n);return s.fullPath=e.path,s.size=t.size(),s.contentType||(s.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),s}function re(e,t,n,s,r){const i=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};const a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=se(t,s,r),l="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Y(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",h="\r\n--"+a+"--",u=U.getBlob(l,s,h);if(null===u)throw f();const d={name:c.fullPath},m=T(i,e.host,e._protocol),p=e.maxUploadRetryTime,g=new X(m,"POST",Z(e,n),p);return g.urlParams=d,g.headers=o,g.body=u.uploadData(),g.errorHandler=ee(t),g}class ie{constructor(e,t,n,s){this.current=e,this.total=t,this.finalized=!!n,this.metadata=s||null}}function oe(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){Q(!1)}return Q(!!n&&-1!==(t||["active"]).indexOf(n)),n}const ae=262144;function ce(e,t,n,s,r,i,o,a){const h=new ie(0,0);if(o?(h.current=o.current,h.total=o.total):(h.current=0,h.total=s.size()),s.size()!==h.total)throw new c(l.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");const u=h.total-h.current;let d=u;r>0&&(d=Math.min(d,r));const m=h.current,p=m+d;let g="";g=0===d?"finalize":u===d?"upload, finalize":"upload";const _={"X-Goog-Upload-Command":g,"X-Goog-Upload-Offset":`${h.current}`},v=s.slice(m,p);if(null===v)throw f();const b=t.maxUploadRetryTime,y=new X(n,"POST",(function(e,n){const r=oe(e,["active","final"]),o=h.current+d,a=s.size();let c;return c="final"===r?Z(t,i)(e,n):null,new ie(o,a,"final"===r,c)}),b);return y.headers=_,y.body=v.uploadData(),y.progressCallback=a||null,y.errorHandler=ee(e),y}const le="running",he="paused",ue="success",de="canceled",me="error";function pe(e){switch(e){case"running":case"pausing":case"canceling":return le;case"paused":return he;case"success":return ue;case"canceled":return de;default:return me}}class fe{constructor(e,t,n){if("function"==typeof e||null!=t||null!=n)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function ge(e){return(...t)=>{Promise.resolve().then((()=>e(...t)))}}let _e=null;class ve{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=h.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=h.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=h.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,s){if(this.sent_)throw b("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==s)for(const e in s)s.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,s[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw b("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw b("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw b("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw b("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class be extends ve{initXhr(){this.xhr_.responseType="text"}}function ye(){return _e?_e():new be}class we{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=K(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(l.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const t=this.isExponentialBackoffExpired();if(I(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=m()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(l.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t,this._start()})),this._promise.then(null,(()=>{}))}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout((()=>{this.pendingTimeout=void 0,this._continueUpload()}),this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}}))}_createResumable(){this._resolveToken(((e,t)=>{const n=function(e,t,n,s,r){const i=t.bucketOnlyServerUrl(),o=se(t,s,r),a={name:o.fullPath},c=T(i,e.host,e._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${s.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=Y(o,n),u=e.maxUploadRetryTime,d=new X(c,"POST",(function(e){let t;oe(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){Q(!1)}return Q(k(t)),t}),u);return d.urlParams=a,d.headers=l,d.body=h,d.errorHandler=ee(t),d}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(n,ye,e,t);this._request=s,s.getPromise().then((e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const e=this._uploadUrl;this._resolveToken(((t,n)=>{const s=function(e,t,n,s){const r=e.maxUploadRetryTime,i=new X(n,"POST",(function(e){const t=oe(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){Q(!1)}n||Q(!1);const r=Number(n);return Q(!isNaN(r)),new ie(r,s.size(),"final"===t)}),r);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=ee(t),i}(this._ref.storage,this._ref._location,e,this._blob),r=this._ref.storage._makeRequest(s,ye,t,n);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const e=ae*this._chunkMultiplier,t=new ie(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken(((s,r)=>{let i;try{i=ce(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const o=this._ref.storage._makeRequest(i,ye,s,r,!1);this._request=o,o.getPromise().then((e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()}),this._errorHandler)}))}_increaseMultiplier(){2*(ae*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken(((e,t)=>{const n=ne(this._ref.storage,this._ref._location,this._mappings),s=this._ref.storage._makeRequest(n,ye,e,t);this._request=s,s.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((e,t)=>{const n=re(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(n,ye,e,t);this._request=s,s.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")}),this._errorHandler)}))}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=p(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=pe(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,s){const r=new fe(t||void 0,n||void 0,s||void 0);return this._addObserver(r),()=>{this._removeObserver(r)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();this._observers.slice().forEach((e=>{this._notifyObserver(e)}))}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(pe(this._state)){case ue:ge(this._resolve.bind(null,this.snapshot))();break;case de:case me:ge(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(pe(this._state)){case le:case he:e.next&&ge(e.next.bind(e,this.snapshot))();break;case ue:e.complete&&ge(e.complete.bind(e))();break;default:e.error&&ge(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class ke{constructor(e,t){this._service=e,this._location=t instanceof y?t:y.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new ke(e,t)}get root(){const e=new y(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return q(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new y(this._location.bucket,e);return new ke(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new c(l.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function xe(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const s=T(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,i=new X(s,"GET",J(e,n),r);return i.errorHandler=te(t),i}(e.storage,e._location,K());return e.storage.makeRequestWithTokens(t,ye).then((e=>{if(null===e)throw new c(l.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}function Ee(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=T(t.fullServerUrl(),e.host,e._protocol),s=e.maxOperationRetryTime,r=new X(n,"DELETE",(function(e,t){}),s);return r.successCodes=[200,204],r.errorHandler=te(t),r}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,ye)}function Se(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),s=new y(e._location.bucket,n);return new ke(e.storage,s)}function Te(e,t){if(e instanceof Re){const n=e;if(null==n._bucket)throw new c(l.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+a+"' property when initializing the app?");const s=new ke(n,n._bucket);return null!=t?Te(s,t):s}return void 0!==t?Se(e,t):e}function Ce(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof Re)return new ke(e,t);throw g("To use ref(service, url), the first argument must be a Storage instance.")}return Te(e,t)}function Ie(e,t){const n=null==t?void 0:t[a];return null==n?null:y.makeFromBucketSpec(n,e)}class Re{constructor(e,t,n,s,r){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=s,this._firebaseVersion=r,this._bucket=null,this._host=o,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=s?y.makeFromBucketSpec(s,this._host):Ie(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=y.makeFromBucketSpec(this._url,e):this._bucket=Ie(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){S("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){S("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ke(this,e)}_makeRequest(e,t,n,s,r=!0){if(this._deleted)return new w(_());{const i=function(e,t,n,s,r,i,o=!0){const a=C(e.urlParams),c=e.url+a,l=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(l,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(l,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(l,i),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(l,s),new R(c,e.method,l,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r,o)}(e,this._appId,n,s,t,this._firebaseVersion,r);return this._requests.add(i),i.getPromise().then((()=>this._requests.delete(i)),(()=>this._requests.delete(i))),i}}async makeRequestWithTokens(e,t){const[n,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,s).getPromise()}}const Ae="@firebase/storage",Me="0.11.2",Ne="storage";function Pe(e,t,n){return function(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new we(e,new U(t),n)}(e=(0,r.m9)(e),t,n)}function Be(e){return xe(e=(0,r.m9)(e))}function De(e){return Ee(e=(0,r.m9)(e))}function Oe(e,t){return Ce(e=(0,r.m9)(e),t)}function Le(e=(0,s.Mq)(),t){e=(0,r.m9)(e);const n=(0,s.qX)(e,Ne).getImmediate({identifier:t}),i=(0,r.P0)("storage");return i&&function(e,t,n,s={}){!function(e,t,n,s={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:i}=s;i&&(e._overrideAuthToken="string"==typeof i?i:(0,r.Sg)(i,e.app.options.projectId))}(e,t,n,s)}(n,...i),n}function Ve(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new Re(n,r,i,t,s.Jn)}(0,s.Xd)(new i.wA(Ne,Ve,"PUBLIC").setMultipleInstances(!0)),(0,s.KN)(Ae,Me,""),(0,s.KN)(Ae,Me,"esm2017")}}]);
